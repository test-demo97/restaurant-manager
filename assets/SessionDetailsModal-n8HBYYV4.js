import{d as u,u as O,i as ee,r as l,j as e,M as se,K as te,J as ae,e as ce,B as le,s as H,a4 as U,P as ne,x as re,Q as ie,a3 as de,q as oe}from"./index-DlwzvMJs.js";import{u as me}from"./useCurrency-BeQWT6-C.js";const xe=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],fe=u("list-checks",xe);const pe=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],he=u("shuffle",pe);const ue=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ye=u("square-check-big",ue);const ge=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],ve=u("square",ge);function ke({isOpen:g,onClose:i,sessionId:n,orderId:_,onViewOrder:M,onEditOrder:q,onDeleteOrder:P,onOpenSplit:b,onOpenBillStatus:j,onAddOrder:N,onTransfer:f,onCloseSession:$}){const{formatPrice:r}=me(),{t:E}=O(),{smacEnabled:F}=ee(),y=(s,a)=>{try{const c=E(s);return!c||c===s?a:c}catch{return a}},[v,T]=l.useState([]),[J,K]=l.useState({}),[Q,L]=l.useState([]),[z,k]=l.useState(0),[t,C]=l.useState(null),[W,A]=l.useState(!1),[R,w]=l.useState(!1),[m,B]=l.useState(0),[x,G]=l.useState(0),V={pending:{labelKey:"orders.pending",color:"badge-warning"},preparing:{labelKey:"orders.preparing",color:"badge-info"},ready:{labelKey:"orders.ready",color:"badge-success"},delivered:{labelKey:"orders.completed",color:"badge-success"},cancelled:{labelKey:"orders.cancelled",color:"badge-danger"}};return l.useEffect(()=>{if(!g)return;async function s(){A(!0);try{if(n){const a=await re(n);T(a);const c={};await Promise.all(a.map(async o=>{const d=await ie(o.id);c[o.id]=d})),K(c);const S=await de(n);L(S);const X=await U(n);k(X);const p=await H(n);C(p);try{const d=(await oe())?.cover_charge||0,h=p?.covers||0;if(B(d),G(h),d>0&&h>0){const D=a.reduce((Z,I)=>Z+I.total,0)+d*h,Y=Math.abs((p?.total||0)-D)<.01||(p?.total||0)>=D-.01;w(Y&&d>0&&h>0)}else w(!1)}catch(o){console.error("Error loading settings for cover:",o)}}else _&&(T([]),K({}),L([]),k(0),C(null))}catch(a){console.error("Error loading session details:",a)}finally{A(!1)}}s()},[g,n,_]),e.jsx(se,{isOpen:g,onClose:i,title:t?`${t.table_name} - Conto`:"Dettagli Conto",size:"lg",children:W?e.jsx("div",{className:"flex items-center justify-center h-40",children:"Loading..."}):e.jsxs("div",{className:"space-y-4",children:[t&&e.jsx("div",{className:`rounded-xl p-3 text-center border ${t.status==="open"?"bg-primary-500/10 border-primary-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:e.jsxs("span",{className:`font-medium ${t.status==="open"?"text-primary-400":"text-emerald-400"}`,children:[t.status==="open"?"Conto Aperto":"Conto Chiuso",v.length>1&&` - ${v.length} comande`]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tipo"}),e.jsx("p",{className:"font-medium text-white",children:t?t.order_type||"Al Tavolo":""}),F&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"SMAC"}),e.jsx("p",{className:"font-medium text-white text-sm px-2 py-1 rounded bg-dark-800 inline-block",children:Q.filter(s=>s.smac_passed).length?"SÃ¬":"No"})]}),t?.customer_name&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Cliente"}),e.jsx("p",{className:"font-medium text-white",children:t.customer_name})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Stato"}),e.jsx("div",{className:"flex items-center gap-3",children:(()=>{const s=t?.status,c={open:{label:y("sessions.open","Aperto"),color:"badge-primary"},closed:{label:y("sessions.closed","Chiuso"),color:"badge-success"},paid:{label:y("sessions.paid","Pagato"),color:"badge-success"}}[s]||{label:s||"",color:"badge-secondary"};return e.jsx("span",{className:`${c.color}`,children:c.label})})()}),t?.table_name&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tavolo"}),e.jsx("p",{className:"font-medium text-white",children:t.table_name})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Comande del conto"}),e.jsx("div",{className:"space-y-3",children:v.map(s=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-dark-700 px-2 py-1 rounded text-dark-300",children:["#",s.order_number||s.id]}),e.jsxs("span",{className:"font-medium text-white",children:["Comanda ",s.order_number||s.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${V[s.status]?.color||"badge-secondary"} text-[10px]`,children:E(V[s.status]?.labelKey)}),e.jsx("span",{className:"font-bold text-primary-400",children:r(s.total)})]})]}),e.jsx("div",{className:"space-y-1 pl-2 border-l-2 border-dark-700",children:(J[s.id]||[]).map(a=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-white",children:[a.quantity,"x ",a.menu_item_name]})}),e.jsx("span",{className:"text-dark-300",children:r(a.price*a.quantity)})]},a.id))}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 pt-2 border-t border-dark-700",children:[M&&e.jsx("button",{onClick:()=>M(s),className:"btn-ghost btn-sm px-2 py-1",title:"Visualizza comanda",children:e.jsx(te,{className:"w-4 h-4"})}),q&&e.jsx("button",{onClick:()=>q(s),className:"btn-ghost btn-sm px-2 py-1",title:"Modifica comanda",children:e.jsx(ae,{className:"w-4 h-4"})}),P&&e.jsx("button",{onClick:()=>P(s.id,n??void 0),className:"btn-ghost btn-sm px-2 py-1 text-red-400",title:"Elimina",children:e.jsx(ce,{className:"w-4 h-4"})})]})]},s.id))})]}),R&&m>0&&x>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Voci aggiuntive"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"text-sm text-white",children:[x,"x Coperto"]}),e.jsx("div",{className:"text-sm text-primary-400 font-semibold",children:r(m*x)})]})]}),e.jsx("div",{className:"p-3 bg-dark-900 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:r(t?.total||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:r((t?.total||0)-z)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:r(z)})]})]})}),t&&m>0&&x>0&&e.jsx("div",{className:"p-3 bg-dark-900 rounded-xl",children:e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:async s=>{const a=s.target.checked;if(w(a),!!t?.id)try{await le(t.id,a);const c=await H(t.id);C(c);const S=await U(t.id);k(S)}catch(c){console.error("Error toggling cover:",c)}}}),e.jsxs("span",{className:"ml-1",children:["Applica coperto (",r(m)," / ospite)"]})]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 flex-wrap",children:[typeof N=="function"&&e.jsxs("button",{onClick:()=>{N&&N(),i()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"})," Nuova Comanda"]}),typeof f=="function"&&e.jsxs("button",{onClick:()=>{f&&f(),i()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"})," Trasferisci"]}),typeof b=="function"&&e.jsx("button",{onClick:()=>{b&&b(),i()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:"Dividi Conto"}),typeof j=="function"&&e.jsx("button",{onClick:()=>{j&&j(),i()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:"Stato Conto"}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>{$?$():i()},className:"px-4 py-3 rounded-xl bg-amber-500 text-dark-900 font-semibold",children:"Chiudi Conto"})]})]})})}export{fe as L,ye as S,ve as a,ke as b};
