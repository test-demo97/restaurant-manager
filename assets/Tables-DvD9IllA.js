import{u as Is,i as Qs,l as qs,r,p as Ls,ag as Bs,ah as ze,t as o,j as e,P as Us,U as ae,K as de,e as Vs,ai as Ae,N as Ks,X as Oe,M as y,S as Ws,O as me,f as te,Q as ne,aj as Xs,ak as Hs,al as Js,am as Ys,an as Zs,ao as ea,y as sa,E as $e,a2 as De,a7 as xe,ap as aa,a9 as ta,$ as Ge,a1 as Ie,a8 as na,B as la,x as ra}from"./index-CxekAIcl.js";import{u as ia}from"./useDemoGuard-GecSMS-1.js";import{C as he}from"./calendar-CGEwVjQo.js";import{L}from"./link-2-DScQOgJh.js";import{C as Qe}from"./clock-CZXzOpr1.js";import{S as oa,a as ca,b as da,L as qe}from"./square-B6q2td4I.js";import{M as ma}from"./message-square-D68xP2tc.js";import{C as xa}from"./chevron-up-6lnGFNzE.js";import{C as ha}from"./chevron-down-GDJtgWoy.js";import{A as pa}from"./arrow-right-C5XYq50A.js";import{C as ua}from"./clipboard-list-DkQkRABl.js";import{B}from"./banknote-BO4Zs-7B.js";import{G as pe}from"./globe-qe367lWd.js";import{P as Le}from"./printer-C0jS6du4.js";import{F as ja}from"./file-text-CNNr-UDg.js";function Ma(){Is();const{smacEnabled:F}=Qs(),{checkCanWrite:v}=ia(),Be=qs(),[E,Ue]=r.useState([]),[U,Ve]=r.useState([]),[ue,Ke]=r.useState([]),[We,Xe]=r.useState(!0),[C,He]=r.useState(new Date().toISOString().split("T")[0]),[Je,V]=r.useState(!1),[Ye,_]=r.useState(!1),[Ze,K]=r.useState(!1),[es,W]=r.useState(!1),[ss,M]=r.useState(!1),[as,X]=r.useState(!1),[ts,A]=r.useState(!1),[ns,H]=r.useState(!1),[ls,le]=r.useState(!1),[rs,re]=r.useState(!1),[c,is]=r.useState(null),[J,je]=r.useState(null),[O,Y]=r.useState(null),[h,os]=r.useState(null),[ge,cs]=r.useState(null),[l,ds]=r.useState(null),[Z,ms]=r.useState([]),[$,be]=r.useState([]),[ie,fe]=r.useState(new Set),[ee,Ne]=r.useState({}),[p,ve]=r.useState(0),[R,z]=r.useState("manual"),[ye,xs]=r.useState([]),[w,we]=r.useState([]),[P,D]=r.useState({}),[j,oe]=r.useState({totalPeople:"",payingPeople:""}),[T,se]=r.useState({name:"",capacity:"4"}),[k,G]=r.useState({covers:"2",customer_name:"",customer_phone:""}),[g,I]=r.useState({method:"cash",smac:!1}),[x,b]=r.useState({amount:"",method:"cash",notes:"",smac:!1}),[u,S]=r.useState({customerGives:"",showChange:!1}),[i,f]=r.useState({table_id:0,table_ids:[],date:new Date().toISOString().split("T")[0],time:"19:00",customer_name:"",phone:"",guests:"2",notes:""});r.useEffect(()=>{N()},[C]);async function N(){try{const[s,a,t]=await Promise.all([Ls(),Bs(C),ze()]);Ue(s),Ve(a),Ke(t)}catch(s){console.error("Error loading data:",s),o("Errore nel caricamento dati","error")}finally{Xe(!1)}}function Q(s){return ue.some(n=>n.table_id===s)?"occupied":U.some(n=>n.status!=="confirmed"?!1:(n.table_ids||[n.table_id]).includes(s))?"reserved":"available"}function ke(s){return ue.find(a=>a.table_id===s)}function Ce(s){return U.find(a=>(a.table_ids||[a.table_id]).includes(s)&&a.status==="confirmed")}function Se(s){s?(je(s),se({name:s.name,capacity:s.capacity.toString()})):(je(null),se({name:"",capacity:"4"})),V(!0)}function hs(s){f({...i,table_id:s,table_ids:[s],date:C}),_(!0)}function ps(){f({table_id:0,table_ids:[],date:C,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),_(!0)}function us(s){f(a=>{const t=a.table_ids||[];if(t.includes(s)){const d=t.filter(m=>m!==s);return{...a,table_ids:d.length>0?d:[s],table_id:d.length>0?d[0]:s}}else return{...a,table_ids:[...t,s],table_id:a.table_id||s}})}function js(){const s=i.table_ids||[];return E.filter(a=>s.includes(a.id)).reduce((a,t)=>a+t.capacity,0)}async function gs(){if(v()){if(!T.name.trim()){o("Inserisci un nome per il tavolo","warning");return}try{const s={name:T.name.trim(),capacity:parseInt(T.capacity)||4};J?(await Js(J.id,s),o("Tavolo aggiornato","success")):(await Ys(s),o("Tavolo creato","success")),V(!1),N()}catch(s){console.error("Error saving table:",s),o("Errore nel salvataggio","error")}}}async function bs(s){if(v()&&confirm("Sei sicuro di voler eliminare questo tavolo?"))try{await Xs(s),o("Tavolo eliminato","success"),N()}catch(a){console.error("Error deleting table:",a),o("Errore nell'eliminazione","error")}}async function fs(){if(v()){if(!i.customer_name.trim()){o("Inserisci il nome del cliente","warning");return}if(i.table_ids.length===0){o("Seleziona almeno un tavolo","warning");return}try{await ea({table_id:i.table_ids[0],table_ids:i.table_ids,date:i.date,time:i.time,customer_name:i.customer_name.trim(),phone:i.phone,guests:parseInt(i.guests)||2,notes:i.notes||void 0,status:"confirmed"}),o("Prenotazione creata","success"),_(!1),f({table_id:0,table_ids:[],date:C,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),N()}catch(s){console.error("Error creating reservation:",s),o("Errore nella creazione","error")}}}async function _e(s){if(v()&&confirm("Annullare questa prenotazione?"))try{await Hs(s),o("Prenotazione annullata","success"),N()}catch(a){console.error("Error cancelling reservation:",a),o("Errore nell'annullamento","error")}}function Ns(s){os(s),K(!0)}function Pe(s){Y(s),f({table_id:s.table_id,table_ids:s.table_ids||[s.table_id],date:s.date,time:s.time,customer_name:s.customer_name,phone:s.phone||"",guests:s.guests.toString(),notes:s.notes||""}),K(!1),_(!0)}async function vs(){if(v()&&O){if(!i.customer_name.trim()){o("Inserisci il nome del cliente","warning");return}if(i.table_ids.length===0){o("Seleziona almeno un tavolo","warning");return}try{await Zs(O.id,{table_id:i.table_ids[0],table_ids:i.table_ids,date:i.date,time:i.time,customer_name:i.customer_name.trim(),phone:i.phone,guests:parseInt(i.guests)||2,notes:i.notes||void 0}),o("Prenotazione aggiornata","success"),_(!1),Y(null),f({table_id:0,table_ids:[],date:C,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),N()}catch(s){console.error("Error updating reservation:",s),o("Errore nell'aggiornamento","error")}}}function Te(s){const a=Q(s),t=ke(s),n=Ce(s);a==="occupied"&&t?ys(t):(a==="available"||a==="reserved")&&(cs(s),G(n?{covers:n.guests?.toString()||"2",customer_name:n.customer_name||"",customer_phone:n.phone||""}:{covers:"2",customer_name:"",customer_phone:""}),W(!0))}async function ys(s){try{await la(s.id);const[a,t,n]=await Promise.all([ra(s.id),Ge(s.id),Ie(s.id)]),m=(await ze()).find(q=>q.id===s.id);ds(m||s),ms(a),be(t),ve(n),fe(new Set),Ne({}),M(!0)}catch(a){console.error("Error loading session details:",a),o("Errore nel caricamento dettagli","error")}}async function ws(s){const a=new Set(ie);if(a.has(s))a.delete(s);else if(a.add(s),!ee[s])try{const t=await $e(s);Ne(n=>({...n,[s]:t}))}catch(t){console.error("Error loading order items:",t)}fe(a)}async function ks(){if(v()&&ge)try{await sa(ge,parseInt(k.covers)||1,k.customer_name||void 0,k.customer_phone||void 0),o("Conto aperto","success"),W(!1),N()}catch(s){console.error("Error opening session:",s),o("Errore nell'apertura conto","error")}}function Cs(){l&&Be(`/orders/new?table=${l.table_id}&session=${l.id}`)}async function Ss(){if(v()&&l){if(l.total===0){if(window.confirm("Vuoi chiudere questo conto a €0.00?"))try{await xe(l.id,"cash",!1),o("Conto chiuso","success"),M(!1),N()}catch(a){console.error("Error closing session:",a),o("Errore nella chiusura","error")}return}I({method:"cash",smac:!1}),S({customerGives:"",showChange:!1}),A(!0)}}async function Fe(){if(v()&&l)try{await xe(l.id,g.method,g.smac),o("Conto chiuso","success"),A(!1),M(!1),N()}catch(s){console.error("Error closing session:",s),o("Errore nella chiusura","error")}}function _s(){l&&X(!0)}async function Ps(s){if(v()&&l)try{await aa(l.id,s),o("Tavolo trasferito","success"),X(!1),M(!1),N()}catch(a){console.error("Error transferring table:",a),o("Errore nel trasferimento","error")}}async function Ts(){if(l){b({amount:"",method:"cash",notes:"",smac:!1}),z("manual"),D({}),oe({totalPeople:l.covers.toString(),payingPeople:""}),S({customerGives:"",showChange:!1});try{const s=[];for(const n of Z)(await $e(n.id)).forEach(m=>{s.push({...m,order_number:n.order_number||1})});xs(s);const a=await De(l.id),t=s.map(n=>({...n,remainingQty:n.quantity-(a[n.id]||0)})).filter(n=>n.remainingQty>0);we(t)}catch(s){console.error("Error loading items:",s)}H(!0)}}function Fs(){const s=parseFloat(u.customerGives)||0,a=parseFloat(x.amount)||0;return Math.max(0,s-a)}function Ee(){if(!l)return 0;const s=parseInt(j.totalPeople)||1,a=parseInt(j.payingPeople)||1,t=p/s;return Math.min(t*a,p)}function ce(){return Object.entries(P).reduce((s,[a,t])=>{const n=w.find(d=>d.id===Number(a));return n&&t>0?s+n.price*t:s},0)}function Es(s){const a=w.find(t=>t.id===s);a&&D(t=>{const n=t[s]||0;return n<a.remainingQty?{...t,[s]:n+1}:t})}function Ms(s){D(a=>{const t=a[s]||0;if(t>0){const n=t-1;if(n===0){const{[s]:d,...m}=a;return m}return{...a,[s]:n}}return a})}function Rs(s){const a=w.find(t=>t.id===s);a&&D(t=>{if((t[s]||0)===a.remainingQty){const{[s]:d,...m}=t;return m}else return{...t,[s]:a.remainingQty}})}function zs(){const s=Ee();s>0&&(b(a=>({...a,amount:s.toFixed(2),notes:`Alla romana (${j.payingPeople}/${j.totalPeople} persone)`})),z("manual"))}const[Me,Re]=r.useState([]);function As(){const s=ce();if(s>0&&s<=p){const a=Object.entries(P).map(([n,d])=>{const m=w.find(q=>q.id===Number(n));return m?`${d}x ${m.menu_item_name}`:""}).filter(Boolean).join(", "),t=Object.entries(P).map(([n,d])=>{const m=w.find(q=>q.id===Number(n));return m?{order_item_id:m.id,quantity:d,menu_item_name:m.menu_item_name,price:m.price}:null}).filter(n=>n!==null);Re(t),b(n=>({...n,amount:Math.min(s,p).toFixed(2),notes:a.length>40?a.substring(0,40)+"...":a})),z("manual"),D({})}}async function Os(){if(!v())return;if(!l){o("Sessione non trovata","error");return}const s=parseFloat(x.amount);if(isNaN(s)||s<=0){o("Inserisci un importo valido","warning");return}if(s>p+.01){o("Importo superiore al rimanente","warning");return}try{await ta(l.id,s,x.method,x.notes||void 0,x.smac,Me.length>0?Me:void 0);const[a,t,n]=await Promise.all([Ge(l.id),Ie(l.id),De(l.id)]);be(a),ve(t);const d=ye.map(m=>({...m,remainingQty:m.quantity-(n[m.id]||0)})).filter(m=>m.remainingQty>0);if(we(d),b({amount:"",method:"cash",notes:"",smac:!1}),Re([]),o("Pagamento aggiunto","success"),t<=.01)try{await xe(l.id,"split",!1),o("Conto saldato e chiuso","success"),H(!1),M(!1),N()}catch(m){console.error("Error closing session:",m),o("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(a){console.error("Error adding payment:",a),o("Errore nell'aggiunta pagamento","error")}}function $s(){le(!0)}async function Ds(s){try{const a=await na(s);a&&(is(a),re(!0))}catch(a){console.error("Error generating receipt:",a),o("Errore nella generazione scontrino","error")}}function Gs(){if(!c)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${c.shop_info.name}</div>
            ${c.shop_info.address?`<div>${c.shop_info.address}</div>`:""}
            ${c.shop_info.phone?`<div>Tel: ${c.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${c.date} ${c.time}</div>
          <div class="divider"></div>
          ${c.items.map(t=>`
            <div class="item">
              <span>${t.quantity}x ${t.name}</span>
              <span>€${t.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>€${c.total.toFixed(2)}</span>
          </div>
          <div>Pagamento: ${c.payment_method==="cash"?"Contanti":c.payment_method==="card"?"Carta":"Online"}</div>
          ${F&&c.smac_passed?"<div>SMAC: Sì</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,a=window.open("","_blank");a&&(a.document.write(s),a.document.close(),a.print())}return We?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Tavoli"}),e.jsx("p",{className:"text-dark-400 mt-1 text-sm sm:text-base",children:"Gestisci tavoli e prenotazioni"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>ps(),className:"btn-secondary flex-1 sm:flex-none",children:[e.jsx(he,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Prenotazione"})]}),e.jsxs("button",{onClick:()=>Se(),className:"btn-primary flex-1 sm:flex-none",children:[e.jsx(Us,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Tavolo"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(he,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"}),e.jsx("input",{type:"date",value:C,onChange:s=>He(s.target.value),className:"input w-auto text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-emerald-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Disponibile"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Occupato"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-amber-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Prenotato"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-2 sm:gap-4",children:E.map(s=>{const a=Q(s.id),t=ke(s.id),n=Ce(s.id);return e.jsxs("div",{onClick:()=>Te(s.id),className:`
                group relative
                ${a==="available"?"table-available cursor-pointer hover:scale-105":""}
                ${a==="occupied"?"table-occupied cursor-pointer hover:scale-105":""}
                ${a==="reserved"?"table-reserved cursor-pointer hover:scale-105":""}
                p-3 sm:p-4 transition-transform
              `,children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ae,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:s.capacity})]}),t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),t.covers," coperti"]}),e.jsxs("p",{className:"font-semibold text-base sm:text-lg",children:["€",t.total.toFixed(2)]}),t.customer_name&&e.jsx("p",{className:"truncate",children:t.customer_name})]}),n&&!t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs",children:[e.jsx("p",{className:"truncate",children:n.customer_name}),e.jsx("p",{children:n.time}),n.table_ids&&n.table_ids.length>1&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-amber-400",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsxs("span",{children:[n.table_ids.length," tavoli"]})]})]}),a==="available"&&e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-1",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),Te(s.id)},className:"text-[10px] sm:text-xs font-medium text-emerald-400 hover:text-emerald-300",children:"Apri Conto"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),hs(s.id)},className:"block text-[10px] sm:text-xs underline hover:no-underline",children:"Prenota"})]}),e.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),Se(s)},className:"p-1 bg-dark-800 rounded hover:bg-dark-700",children:e.jsx(de,{className:"w-3 h-3"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),bs(s.id)},className:"p-1 bg-dark-800 rounded hover:bg-red-500/20",children:e.jsx(Vs,{className:"w-3 h-3"})})]})]},s.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white text-sm sm:text-base",children:["Prenotazioni per ",new Date(C).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"})]})}),e.jsx("div",{className:"card-body",children:U.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4 text-sm",children:"Nessuna prenotazione per questa data"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:U.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 bg-dark-900 rounded-xl gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Qe,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm sm:text-base truncate",children:s.customer_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 sm:gap-x-3 gap-y-0.5 text-xs sm:text-sm text-dark-400",children:[e.jsx("span",{children:s.time}),e.jsxs("span",{className:"flex items-center gap-1",children:[s.table_ids&&s.table_ids.length>1&&e.jsx(L,{className:"w-3 h-3 text-primary-400"}),s.table_name]}),e.jsxs("span",{children:[s.guests," ospiti"]})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-dark-400",children:[e.jsx(Ae,{className:"w-3 h-3"}),s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:`badge text-xs ${s.status==="confirmed"?"badge-success":"badge-danger"}`,children:s.status==="confirmed"?"Confermata":"Annullata"}),e.jsx("button",{onClick:()=>Ns(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Visualizza dettagli",children:e.jsx(Ks,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),e.jsx("button",{onClick:()=>Pe(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Modifica",children:e.jsx(de,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),s.status==="confirmed"&&e.jsx("button",{onClick:()=>_e(s.id),className:"p-1.5 sm:p-2 hover:bg-red-500/20 rounded-lg transition-colors",title:"Annulla",children:e.jsx(Oe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-400"})})]})]},s.id))})})]}),e.jsx(y,{isOpen:Je,onClose:()=>V(!1),title:J?"Modifica Tavolo":"Nuovo Tavolo",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Tavolo"}),e.jsx("input",{type:"text",value:T.name,onChange:s=>se({...T,name:s.target.value}),className:"input",placeholder:"Es. Tavolo 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Capacità (posti)"}),e.jsx("input",{type:"number",min:"1",value:T.capacity,onChange:s=>se({...T,capacity:s.target.value}),className:"input"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:gs,className:"btn-primary flex-1",children:J?"Salva":"Crea"}),e.jsx("button",{onClick:()=>V(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(y,{isOpen:Ye,onClose:()=>{_(!1),Y(null)},title:O?"Modifica Prenotazione":"Nuova Prenotazione",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:i.date,onChange:s=>f({...i,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ora"}),e.jsx("input",{type:"time",value:i.time,onChange:s=>f({...i,time:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>f({...i,phone:s.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ospiti"}),e.jsx("input",{type:"number",min:"1",value:i.guests,onChange:s=>f({...i,guests:s.target.value}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente *"}),e.jsx("input",{type:"text",value:i.customer_name,onChange:s=>f({...i,customer_name:s.target.value}),className:"input",placeholder:"Nome e cognome"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"label mb-0",children:[e.jsx(L,{className:"w-4 h-4 inline mr-1"}),"Tavoli"]}),e.jsxs("span",{className:"text-xs text-dark-400",children:["Capacità totale: ",e.jsx("span",{className:"text-primary-400 font-semibold",children:js()})," posti"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 max-h-32 overflow-y-auto p-2 bg-dark-900 rounded-xl",children:E.map(s=>{const a=i.table_ids.includes(s.id),n=Q(s.id)==="available";return e.jsxs("button",{type:"button",onClick:()=>n&&us(s.id),disabled:!n,className:`p-3 rounded-lg border-2 text-sm flex items-center gap-2 transition-all ${a?"border-primary-500 bg-primary-500/10 text-white":n?"border-dark-600 text-dark-300 hover:border-dark-500":"border-dark-700 text-dark-500 opacity-50 cursor-not-allowed"}`,children:[a?e.jsx(oa,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(ca,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:s.name}),e.jsxs("span",{className:"text-xs text-dark-400 flex-shrink-0",children:[s.capacity,"p"]})]},s.id)})}),i.table_ids.length>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-2 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),"Tavoli uniti: ",E.filter(s=>i.table_ids.includes(s.id)).map(s=>s.name).join(" + ")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:i.notes,onChange:s=>f({...i,notes:s.target.value}),className:"input resize-none h-16",placeholder:"Note aggiuntive..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:O?vs:fs,className:"btn-primary flex-1",children:O?"Salva Modifiche":"Crea Prenotazione"}),e.jsx("button",{onClick:()=>{_(!1),Y(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(y,{isOpen:Ze,onClose:()=>K(!1),title:"Dettagli Prenotazione",size:"md",children:h&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:`badge text-lg px-4 py-2 ${h.status==="confirmed"?"badge-success":h.status==="cancelled"?"badge-danger":"badge-secondary"}`,children:h.status==="confirmed"?"Confermata":h.status==="cancelled"?"Annullata":"Completata"})}),e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-500/20 flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:h.customer_name}),h.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-dark-400",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${h.phone}`,className:"hover:text-primary-400",children:h.phone})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(he,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(h.date).toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(Qe,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ora"}),e.jsx("p",{className:"font-semibold text-white",children:h.time})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ae,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ospiti"}),e.jsxs("p",{className:"font-semibold text-white",children:[h.guests," persone"]})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(L,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:h.table_ids&&h.table_ids.length>1?"Tavoli Uniti":"Tavolo"}),e.jsx("p",{className:"font-semibold text-white",children:h.table_name}),h.table_ids&&h.table_ids.length>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-1",children:[h.table_ids.length," tavoli"]})]})]}),h.notes&&e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ma,{className:"w-4 h-4 text-dark-400"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Note"})]}),e.jsx("p",{className:"text-white",children:h.notes})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>Pe(h),className:"btn-secondary flex-1",children:[e.jsx(de,{className:"w-5 h-5"}),"Modifica"]}),h.status==="confirmed"&&e.jsxs("button",{onClick:()=>{_e(h.id),K(!1)},className:"btn-danger",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Annulla"]})]})]})}),e.jsx(y,{isOpen:es,onClose:()=>W(!1),title:"Apri Conto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Numero Coperti"}),e.jsx("input",{type:"number",min:"1",value:k.covers,onChange:s=>G({...k,covers:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente (opzionale)"}),e.jsx("input",{type:"text",value:k.customer_name,onChange:s=>G({...k,customer_name:s.target.value}),className:"input",placeholder:"Es. Marco Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono (opzionale)"}),e.jsx("input",{type:"tel",value:k.customer_phone,onChange:s=>G({...k,customer_phone:s.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:ks,className:"btn-primary flex-1",children:"Apri Conto"}),e.jsx("button",{onClick:()=>W(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(y,{isOpen:ss,onClose:()=>M(!1),title:`Conto ${l?.table_name||""}`,size:"2xl",children:l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Coperti"}),e.jsx("p",{className:"text-lg font-bold text-white",children:l.covers})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Comande"}),e.jsx("p",{className:"text-lg font-bold text-white",children:Z.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["€",l.total.toFixed(2)]})]})]}),l.customer_name&&e.jsxs("p",{className:"text-dark-400 text-sm",children:["Cliente: ",e.jsx("span",{className:"text-white",children:l.customer_name})]}),e.jsxs("div",{className:"md:grid md:grid-cols-5 md:gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("h3",{className:"font-semibold text-white mb-2 text-sm",children:"Comande"}),Z.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4 bg-dark-900 rounded-lg text-sm",children:"Nessuna comanda ancora"}):e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-64 overflow-y-auto",children:Z.map(s=>e.jsxs("div",{className:"bg-dark-900 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer hover:bg-dark-800 transition-colors",onClick:()=>ws(s.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ie.has(s.id)?e.jsx(xa,{className:"w-3.5 h-3.5 text-dark-400"}):e.jsx(ha,{className:"w-3.5 h-3.5 text-dark-400"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-white text-sm",children:["#",s.order_number||1]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.status==="pending"?"badge-warning":s.status==="preparing"?"badge-info":s.status==="ready"?"badge-success":"badge-secondary"}`,children:s.status==="pending"?"Attesa":s.status==="preparing"?"Prep.":s.status==="ready"?"Pronto":s.status==="delivered"?"OK":s.status})]})]}),e.jsxs("span",{className:"font-semibold text-white text-sm",children:["€",s.total.toFixed(2)]})]}),ie.has(s.id)&&e.jsx("div",{className:"px-2 pb-2 pt-1 border-t border-dark-700",children:ee[s.id]?ee[s.id].length>0?e.jsx("div",{className:"space-y-0.5",children:ee[s.id].map(a=>e.jsxs("div",{className:"flex items-center justify-between text-xs py-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-primary-400 font-medium",children:[a.quantity,"x"]}),e.jsx("span",{className:"text-dark-300",children:a.menu_item_name||"Prodotto"})]}),e.jsxs("span",{className:"text-dark-400",children:["€",(a.price*a.quantity).toFixed(2)]})]},a.id))}):e.jsx("p",{className:"text-dark-500 text-xs text-center py-1",children:"Vuoto"}):e.jsx("div",{className:"flex justify-center py-1",children:e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-t-2 border-b-2 border-primary-500"})})})]},s.id))})]}),e.jsxs("div",{className:"md:col-span-2 mt-4 md:mt-0",children:[e.jsx("h3",{className:"font-semibold text-white mb-2 text-sm lg:block hidden",children:"Azioni"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:Cs,className:"btn-primary flex items-center justify-center gap-1.5 text-sm py-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Nuova"})," Comanda"]}),e.jsxs("button",{onClick:_s,className:"btn-secondary flex items-center justify-center gap-1.5 text-sm py-2",children:[e.jsx(pa,{className:"w-4 h-4"}),"Trasferisci"]}),e.jsxs("button",{onClick:Ts,className:"btn-secondary flex items-center justify-center gap-1.5 text-sm py-2",children:[e.jsx(da,{className:"w-4 h-4"}),"Dividi"]}),e.jsxs("button",{onClick:$s,className:"btn-secondary flex items-center justify-center gap-1.5 text-sm py-2",children:[e.jsx(ua,{className:"w-4 h-4"}),"Stato"]}),e.jsxs("button",{onClick:Ss,className:"btn-primary bg-emerald-600 hover:bg-emerald-700 flex items-center justify-center gap-1.5 text-sm py-2.5 col-span-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Chiudi Conto"]})]})]})]})]})}),e.jsx(y,{isOpen:ts,onClose:()=>A(!1),title:"Chiudi Conto",size:g.method==="cash"&&l&&l.total>0?"2xl":"md",children:l&&e.jsxs("div",{className:g.method==="cash"&&l.total>0?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsxs("p",{className:"text-3xl font-bold text-primary-400",children:["€",l.total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>I({...g,method:"cash"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${g.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(B,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>I({...g,method:"card"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${g.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(te,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>I({...g,method:"online"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${g.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Online"})]})]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac",checked:g.smac,onChange:s=>I({...g,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac",className:"text-white",children:"SMAC passato"})]}),(g.method!=="cash"||l.total===0)&&e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Fe,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>A(!1),className:"btn-secondary",children:"Annulla"})]})]}),g.method==="cash"&&l.total>0&&e.jsxs("div",{className:"mt-6 md:mt-0 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:u.customerGives,onChange:s=>S({...u,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{type:"button",onClick:()=>S({...u,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),u.customerGives&&parseFloat(u.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsxs("span",{className:"text-white",children:["€",l.total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(u.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Math.max(0,parseFloat(u.customerGives)-l.total).toFixed(2)]})]}),parseFloat(u.customerGives)<l.total&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",(l.total-parseFloat(u.customerGives)).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:Fe,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>A(!1),className:"btn-secondary",children:"Annulla"})]})]})]})}),e.jsx(y,{isOpen:as,onClose:()=>X(!1),title:"Trasferisci Tavolo",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-400",children:"Seleziona il nuovo tavolo:"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 max-h-64 overflow-y-auto",children:E.filter(s=>s.id!==l?.table_id&&Q(s.id)==="available").map(s=>e.jsxs("button",{onClick:()=>Ps(s.id),className:"p-4 bg-dark-900 rounded-xl hover:bg-dark-800 transition-colors text-center",children:[e.jsx("p",{className:"font-semibold text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.capacity," posti"]})]},s.id))}),E.filter(s=>s.id!==l?.table_id&&Q(s.id)==="available").length===0&&e.jsx("p",{className:"text-center text-dark-400 py-4",children:"Nessun tavolo libero disponibile"}),e.jsx("button",{onClick:()=>X(!1),className:"btn-secondary w-full",children:"Annulla"})]})}),e.jsx(y,{isOpen:ns,onClose:()=>H(!1),title:"Dividi Conto",size:"3xl",children:l&&e.jsxs("div",{className:"md:grid md:grid-cols-5 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-white",children:["€",l.total.toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-emerald-400",children:["€",(l.total-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),l.total>0&&e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,(l.total-p)/l.total*100)}%`}})}),$.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-64 overflow-y-auto",children:$.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(B,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(te,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(pe,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"text-white",children:["€",s.amount.toFixed(2)]}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-sm",children:["- ",s.notes]})]}),F&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]},s.id))})]})]}),e.jsxs("div",{className:"md:col-span-3 mt-6 md:mt-0",children:[p>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>z("manual"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${R==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>z("romana"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${R==="romana"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Alla Romana"})]}),e.jsxs("button",{onClick:()=>z("items"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${R==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Per Consumazione"})]})]}),R==="romana"&&e.jsxs("div",{className:"p-4 border border-primary-500/30 bg-primary-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-primary-400"}),"Dividi alla Romana"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Dividi il conto equamente tra le persone. Specifica quante persone stanno pagando ora."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone totali al tavolo"}),e.jsx("input",{type:"number",min:"1",value:j.totalPeople,onChange:s=>oe({...j,totalPeople:s.target.value}),className:"input",placeholder:l.covers.toString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone che pagano ora"}),e.jsx("input",{type:"number",min:"1",max:j.totalPeople,value:j.payingPeople,onChange:s=>oe({...j,payingPeople:s.target.value}),className:"input",placeholder:"Es. 2"})]})]}),j.totalPeople&&j.payingPeople&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Quota per persona:"}),e.jsxs("span",{className:"text-white font-medium",children:["€",(p/(parseInt(j.totalPeople)||1)).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-dark-400",children:["Totale da pagare (",j.payingPeople," pers.):"]}),e.jsxs("span",{className:"text-primary-400 font-bold text-lg",children:["€",Ee().toFixed(2)]})]})]}),e.jsx("button",{onClick:zs,disabled:!j.totalPeople||!j.payingPeople,className:"btn-primary w-full",children:"Applica Calcolo"})]}),R==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-400"}),"Paga per Consumazione"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare. I prodotti già pagati non vengono mostrati."}),e.jsx("div",{className:"max-h-64 sm:max-h-80 overflow-y-auto space-y-2",children:w.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:ye.length===0?"Nessun prodotto ordinato":"Tutti i prodotti sono stati pagati"}):w.map(s=>{const a=P[s.id]||0,t=a>0;return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${t?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",s.price.toFixed(2)," cad. • Rimasti ",s.remainingQty," pz",s.remainingQty<s.quantity&&e.jsxs("span",{className:"text-emerald-400 ml-1",children:["(",s.quantity-s.remainingQty," già pagati)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Rs(s.id),className:`px-2 py-1 text-xs rounded transition-colors ${a===s.remainingQty?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:"Tutti"}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>Ms(s.id),disabled:a===0,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"-"})}),e.jsx("span",{className:`w-8 text-center font-bold ${t?"text-blue-400":"text-dark-500"}`,children:a}),e.jsx("button",{onClick:()=>Es(s.id),disabled:a>=s.remainingQty,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"+"})})]})]})]}),t&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-dark-600 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-dark-400",children:[a,"/",s.remainingQty," selezionati"]}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:["€",(s.price*a).toFixed(2)]})]})]},s.id)})}),Object.keys(P).length>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Prodotti selezionati:"}),e.jsxs("span",{className:"text-white",children:[Object.values(P).reduce((s,a)=>s+a,0)," pz"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-dark-400",children:"Totale:"}),e.jsxs("span",{className:"text-blue-400 font-bold text-lg",children:["€",ce().toFixed(2)]})]}),ce()>p&&e.jsxs("p",{className:"text-xs text-amber-400 mt-2",children:["Nota: il totale supera il rimanente, verrà addebitato €",p.toFixed(2)]})]}),e.jsx("button",{onClick:As,disabled:Object.keys(P).length===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),R==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-white",children:"Pagamento manuale"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo da incassare"}),e.jsx("input",{type:"number",step:"0.01",value:x.amount,onChange:s=>b({...x,amount:s.target.value}),className:"input",placeholder:`Max €${p.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note (opzionale)"}),e.jsx("input",{type:"text",value:x.notes,onChange:s=>b({...x,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>b({...x,amount:p.toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Tutto (€",p.toFixed(2),")"]}),e.jsxs("button",{onClick:()=>b({...x,amount:(p/2).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Metà (€",(p/2).toFixed(2),")"]}),l.covers>1&&e.jsxs("button",{onClick:()=>b({...x,amount:(p/l.covers).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["1/",l.covers," (€",(p/l.covers).toFixed(2),")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{b({...x,method:"cash"}),S({customerGives:"",showChange:!0})},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${x.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(B,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>{b({...x,method:"card"}),S({customerGives:"",showChange:!1})},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${x.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(te,{className:"w-4 h-4"})," Carta"]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"split_smac",checked:x.smac,onChange:s=>b({...x,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsxs("label",{htmlFor:"split_smac",className:"text-white cursor-pointer flex-1",children:[e.jsx("span",{className:"font-medium",children:"SMAC passato"}),e.jsx("p",{className:"text-xs text-dark-400",children:"Spunta se questo pagamento è già stato dichiarato con tessera SMAC"})]})]}),x.method==="cash"&&x.amount&&parseFloat(x.amount)>0&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:u.customerGives,onChange:s=>S({...u,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{onClick:()=>S({...u,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),u.customerGives&&parseFloat(u.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Da incassare:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(x.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(u.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Fs().toFixed(2)]})]}),parseFloat(u.customerGives)<parseFloat(x.amount)&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",(parseFloat(x.amount)-parseFloat(u.customerGives)).toFixed(2)]})]})]}),e.jsx("button",{onClick:Os,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),p===0&&e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(me,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h4",{className:"text-xl font-bold text-emerald-400 mb-2",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400",children:"Il conto è stato completamente pagato."})]}),e.jsx("button",{onClick:()=>H(!1),className:"btn-secondary w-full",children:"Chiudi"})]})]})}),e.jsx(y,{isOpen:ls,onClose:()=>le(!1),title:"Stato del Conto",size:"2xl",children:l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["€",l.total.toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:["€",(l.total-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-6",children:[$.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:["Pagamenti effettuati (",$.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 md:max-h-80 overflow-y-auto",children:$.map((s,a)=>e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(B,{className:"w-5 h-5 text-emerald-400"}),s.payment_method==="card"&&e.jsx(te,{className:"w-5 h-5 text-blue-400"}),s.payment_method==="online"&&e.jsx(pe,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"font-semibold text-white",children:["Pagamento #",a+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-primary-400",children:["€",s.amount.toFixed(2)]}),F&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-sm text-dark-400 space-y-1",children:[e.jsxs("p",{children:["Metodo: ",s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online"]}),e.jsxs("p",{children:["Data: ",new Date(s.paid_at).toLocaleString("it-IT")]}),s.notes&&e.jsxs("p",{children:["Note: ",s.notes]})]}),s.paid_items&&s.paid_items.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Prodotti pagati:"}),e.jsx("div",{className:"space-y-1",children:s.paid_items.map((t,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-300",children:[t.quantity,"x ",t.menu_item_name]}),e.jsxs("span",{className:"text-dark-400",children:["€",(t.price*t.quantity).toFixed(2)]})]},n))})]}),e.jsxs("button",{onClick:()=>Ds(s),className:"mt-3 w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Stampa Scontrino"]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-dark-900 rounded-xl text-center",children:[e.jsx(ja,{className:"w-12 h-12 mx-auto mb-3 text-dark-600"}),e.jsx("p",{className:"text-dark-400",children:"Nessun pagamento ancora effettuato"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:w.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:"Prodotti ancora da pagare"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-80 overflow-y-auto",children:w.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsxs("span",{className:"text-primary-400",children:["€",(s.price*s.remainingQty).toFixed(2)]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>le(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(y,{isOpen:rs,onClose:()=>re(!1),title:"Scontrino",size:"sm",children:c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:c.shop_info.name}),c.shop_info.address&&e.jsx("p",{className:"text-xs",children:c.shop_info.address}),c.shop_info.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",c.shop_info.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",c.date," ",c.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:c.items.map((s,a)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsxs("span",{children:["€",s.total.toFixed(2)]})]},a))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsxs("span",{children:["€",c.total.toFixed(2)]})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",c.payment_method==="cash"?"Contanti":c.payment_method==="card"?"Carta":"Online"]}),F&&c.smac_passed&&e.jsx("p",{children:"SMAC: Sì"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Gs,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>re(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{Ma as Tables};
