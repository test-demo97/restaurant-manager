import{d as u,i as X,r as c,j as e,M as Z,K as I,J as O,e as ee,B as se,s as V,a3 as D,P as te,x as ae,Y as ce,a2 as ne,q as ie}from"./index-BOmTwSxR.js";import{u as le}from"./useCurrency-BZHudE-G.js";const re=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],je=u("list-checks",re);const de=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],oe=u("shuffle",de);const me=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ge=u("square-check-big",me);const xe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ne=u("square",xe);function be({isOpen:j,onClose:l,sessionId:n,orderId:S,onViewOrder:_,onEditOrder:M,onDeleteOrder:q,onOpenSplit:g,onOpenBillStatus:N,onAddOrder:b,onTransfer:f,onCloseSession:E}){const{formatPrice:i}=le(),{smacEnabled:H}=X(),[y,P]=c.useState([]),[U,T]=c.useState({}),[J,$]=c.useState([]),[L,k]=c.useState(0),[s,v]=c.useState(null),[K,z]=c.useState(!1),[R,w]=c.useState(!1),[m,W]=c.useState(0),[x,Y]=c.useState(0);return c.useEffect(()=>{if(!j)return;async function t(){z(!0);try{if(n){const a=await ae(n);P(a);const r={};await Promise.all(a.map(async o=>{const d=await ce(o.id);r[o.id]=d})),T(r);const C=await ne(n);$(C);const B=await D(n);k(B);const h=await V(n);v(h);try{const d=(await ie())?.cover_charge||0,p=h?.covers||0;if(W(d),Y(p),d>0&&p>0){const A=a.reduce((G,Q)=>G+Q.total,0)+d*p,F=Math.abs((h?.total||0)-A)<.01||(h?.total||0)>=A-.01;w(F&&d>0&&p>0)}else w(!1)}catch(o){console.error("Error loading settings for cover:",o)}}else S&&(P([]),T({}),$([]),k(0),v(null))}catch(a){console.error("Error loading session details:",a)}finally{z(!1)}}t()},[j,n,S]),e.jsx(Z,{isOpen:j,onClose:l,title:s?`${s.table_name} - Conto`:"Dettagli Conto",size:"lg",children:K?e.jsx("div",{className:"flex items-center justify-center h-40",children:"Loading..."}):e.jsxs("div",{className:"space-y-4",children:[s&&e.jsx("div",{className:`rounded-xl p-3 text-center border ${s.status==="open"?"bg-primary-500/10 border-primary-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:e.jsxs("span",{className:`font-medium ${s.status==="open"?"text-primary-400":"text-emerald-400"}`,children:[s.status==="open"?"Conto Aperto":"Conto Chiuso",y.length>1&&` - ${y.length} comande`]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tipo"}),e.jsx("p",{className:"font-medium text-white",children:s?s.order_type||"Al Tavolo":""}),H&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"SMAC"}),e.jsx("p",{className:"font-medium text-white text-sm px-2 py-1 rounded bg-dark-800 inline-block",children:J.filter(t=>t.smac_passed).length?"SÃ¬":"No"})]}),s?.customer_name&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Cliente"}),e.jsx("p",{className:"font-medium text-white",children:s.customer_name})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Stato"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:`badge-${s?.status==="open"?"primary":"success"}`,children:s?.status})}),s?.table_name&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tavolo"}),e.jsx("p",{className:"font-medium text-white",children:s.table_name})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Comande del conto"}),e.jsx("div",{className:"space-y-3",children:y.map(t=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-dark-700 px-2 py-1 rounded text-dark-300",children:["#",t.order_number||t.id]}),e.jsxs("span",{className:"font-medium text-white",children:["Comanda ",t.order_number||t.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"badge-secondary",children:t.status}),e.jsx("span",{className:"font-bold text-primary-400",children:i(t.total)})]})]}),e.jsx("div",{className:"space-y-1 pl-2 border-l-2 border-dark-700",children:(U[t.id]||[]).map(a=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-white",children:[a.quantity,"x ",a.menu_item_name]})}),e.jsx("span",{className:"text-dark-300",children:i(a.price*a.quantity)})]},a.id))}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 pt-2 border-t border-dark-700",children:[_&&e.jsx("button",{onClick:()=>_(t),className:"btn-ghost btn-sm px-2 py-1",title:"Visualizza comanda",children:e.jsx(I,{className:"w-4 h-4"})}),M&&e.jsx("button",{onClick:()=>M(t),className:"btn-ghost btn-sm px-2 py-1",title:"Modifica comanda",children:e.jsx(O,{className:"w-4 h-4"})}),q&&e.jsx("button",{onClick:()=>q(t.id,n??void 0),className:"btn-ghost btn-sm px-2 py-1 text-red-400",title:"Elimina",children:e.jsx(ee,{className:"w-4 h-4"})})]})]},t.id))})]}),R&&m>0&&x>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Voci aggiuntive"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"text-sm text-white",children:[x,"x Coperto"]}),e.jsx("div",{className:"text-sm text-primary-400 font-semibold",children:i(m*x)})]})]}),e.jsx("div",{className:"p-3 bg-dark-900 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:i(s?.total||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:i((s?.total||0)-L)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:i(L)})]})]})}),s&&m>0&&x>0&&e.jsx("div",{className:"p-3 bg-dark-900 rounded-xl",children:e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:async t=>{const a=t.target.checked;if(w(a),!!s?.id)try{await se(s.id,a);const r=await V(s.id);v(r);const C=await D(s.id);k(C)}catch(r){console.error("Error toggling cover:",r)}}}),e.jsxs("span",{className:"ml-1",children:["Applica coperto (",i(m)," / ospite)"]})]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 flex-wrap",children:[typeof b=="function"&&e.jsxs("button",{onClick:()=>{b&&b(),l()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"})," Nuova Comanda"]}),typeof f=="function"&&e.jsxs("button",{onClick:()=>{f&&f(),l()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"})," Trasferisci"]}),typeof g=="function"&&e.jsx("button",{onClick:()=>{g&&g(),l()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:"Dividi Conto"}),typeof N=="function"&&e.jsx("button",{onClick:()=>{N&&N(),l()},className:"px-4 py-3 rounded-xl bg-dark-800 hover:bg-dark-700 flex items-center gap-2",children:"Stato Conto"}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>{E?E():l()},className:"px-4 py-3 rounded-xl bg-amber-500 text-dark-900 font-semibold",children:"Chiudi Conto"})]})]})})}export{je as L,ge as S,Ne as a,be as b};
