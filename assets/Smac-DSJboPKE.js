import{d as E,u as R,r as x,D as G,t as p,j as e,R as V,c as j,v as k,h as q,F as J,G as P}from"./index-BquBvcMa.js";import{C as X}from"./calendar-V2fC83ra.js";import{C as B}from"./chevron-up-CmD5EClk.js";import{C as Q}from"./chevron-down-BzU6ycnE.js";const U=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],A=E("file-check",U);const H=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]],K=E("file-x",H);async function M(m,u){if(J&&P){const{error:l}=await P.from("orders").update({smac_passed:u}).eq("id",m);if(l)throw l}else{const l="kebab_",d=JSON.parse(localStorage.getItem(l+"orders")||"[]"),n=d.findIndex(g=>g.id===m);n!==-1&&(d[n].smac_passed=u,localStorage.setItem(l+"orders",JSON.stringify(d)))}}function se(){R();const[m,u]=x.useState([]),[l,d]=x.useState(!0),[n,g]=x.useState(new Date().toISOString().split("T")[0]),[o,N]=x.useState("all"),[T,$]=x.useState(new Set);x.useEffect(()=>{f()},[n]);async function f(){d(!0);try{const s=await G(n);u(s.filter(a=>a.status!=="cancelled"))}catch(s){console.error("Error loading orders:",s),p("Errore nel caricamento ordini","error")}finally{d(!1)}}const c=(()=>{const s={},a=[];m.forEach(t=>{t.session_id?(s[t.session_id]||(s[t.session_id]=[]),s[t.session_id].push(t)):a.push(t)});const i=[];return Object.entries(s).forEach(([t,r])=>{const b=r[0],z=r.reduce((w,v)=>w+v.total,0),L=b.smac_passed;i.push({type:"session",sessionId:Number(t),orders:r.sort((w,v)=>(w.order_number||0)-(v.order_number||0)),total:z,tableName:b.table_name,customerName:b.customer_name,smacPassed:L})}),a.forEach(t=>{i.push({type:"single",orders:[t],total:t.total,tableName:t.table_name,customerName:t.customer_name,smacPassed:t.smac_passed})}),i.sort((t,r)=>new Date(r.orders[0].created_at).getTime()-new Date(t.orders[0].created_at).getTime())})(),S=c.filter(s=>o==="passed"?s.smacPassed:o==="not_passed"?!s.smacPassed:!0),y=c.filter(s=>s.smacPassed).reduce((s,a)=>s+a.total,0),C=c.filter(s=>!s.smacPassed).reduce((s,a)=>s+a.total,0),_=c.filter(s=>s.smacPassed).length,h=c.filter(s=>!s.smacPassed).length;function D(s){$(a=>{const i=new Set(a);return i.has(s)?i.delete(s):i.add(s),i})}async function O(s){try{const a=!s.smacPassed;for(const i of s.orders)await M(i.id,a);p(a?"SMAC registrata":"SMAC rimossa","success"),f()}catch(a){console.error("Error updating SMAC:",a),p("Errore nell'aggiornamento","error")}}async function F(){if(confirm(`Segnare tutti i ${h} ordini/conti come SMAC passata?`))try{for(const s of m.filter(a=>!a.smac_passed))await M(s.id,!0);p(`${h} ordini/conti segnati come SMAC passata`,"success"),f()}catch(s){console.error("Error updating SMAC:",s),p("Errore nell'aggiornamento","error")}}const I=s=>new Date(s).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Dichiarazioni SMAC"}),e.jsx("p",{className:"text-dark-400 mt-1 text-xs sm:text-sm",children:"Gestione SMAC per la dichiarazione fiscale"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:f,className:"btn-secondary p-2 sm:px-4 sm:py-2",children:e.jsx(V,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),h>0&&e.jsxs("button",{onClick:F,className:"btn-primary text-xs sm:text-sm flex-1 sm:flex-none justify-center",children:[e.jsx(j,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Segna Tutti come"})," Passati"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[e.jsx(X,{className:"w-5 h-5 text-dark-400 hidden sm:block"}),e.jsx("input",{type:"date",value:n,onChange:s=>g(s.target.value),className:"input w-auto text-sm sm:text-base"}),e.jsx("span",{className:"text-dark-400 text-sm sm:text-base hidden sm:inline",children:I(n)})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Totali"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:c.length}),e.jsxs("p",{className:"text-xs text-dark-500",children:[m.length," comande"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(A,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card glow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"SMAC Passata"}),e.jsxs("p",{className:"stat-value text-emerald-400 text-lg sm:text-2xl",children:["€",y.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-500",children:[_," conti"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(j,{className:"w-4 h-4 sm:w-6 sm:h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Non Passata"}),e.jsxs("p",{className:"stat-value text-amber-400 text-lg sm:text-2xl",children:["€",C.toFixed(0)]}),e.jsxs("p",{className:"text-xs text-dark-500",children:[h," conti"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(k,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Incasso"}),e.jsxs("p",{className:"stat-value text-lg sm:text-2xl",children:["€",(y+C).toFixed(0)]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(A,{className:"w-4 h-4 sm:w-6 sm:h-6 text-primary-400"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:[e.jsxs("button",{onClick:()=>N("all"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${o==="all"?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Tutti (",c.length,")"]}),e.jsx("button",{onClick:()=>N("passed"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${o==="passed"?"bg-emerald-500 text-white":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:e.jsxs("span",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(j,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Passata (",_,")"]})}),e.jsx("button",{onClick:()=>N("not_passed"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${o==="not_passed"?"bg-amber-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:e.jsxs("span",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(k,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Non Passata (",h,")"]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white text-sm sm:text-base",children:"Ordini del Giorno"})}),e.jsx("div",{className:"divide-y divide-dark-700",children:S.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center text-dark-400",children:[e.jsx(K,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Nessun ordine trovato per questa data"})]}):S.map(s=>{const a=s.type==="session"&&s.orders.length>1,i=a&&T.has(s.sessionId),t=s.orders[0];return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between p-3 sm:p-4 hover:bg-dark-900/50 transition-colors gap-2 ${a?"cursor-pointer":""}`,onClick:a?()=>D(s.sessionId):void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[a&&e.jsx("div",{className:"w-5 sm:w-6",children:i?e.jsx(B,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"}):e.jsx(Q,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),e.jsx("div",{className:`w-8 h-8 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center ${s.smacPassed?"bg-emerald-500/20":"bg-amber-500/20"}`,children:s.smacPassed?e.jsx(j,{className:"w-4 h-4 sm:w-6 sm:h-6 text-emerald-400"}):e.jsx(k,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm sm:text-base truncate",children:a?e.jsxs(e.Fragment,{children:["Conto - ",s.tableName,e.jsxs("span",{className:"text-xs text-dark-400 ml-1 sm:ml-2",children:["(",s.orders.length,"c)"]})]}):`#${t.id}`}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-3 text-xs sm:text-sm text-dark-400",children:[e.jsx("span",{children:t.order_type==="dine_in"?`T.${s.tableName||t.table_id}`:t.order_type==="takeaway"?"Asporto":"Domicilio"}),e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"hidden sm:inline",children:t.payment_method==="cash"?"Contanti":t.payment_method==="card"?"Carta":"Online"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-base sm:text-xl font-bold text-primary-400",children:["€",s.total.toFixed(2)]}),e.jsx("p",{className:`text-xs sm:text-sm ${s.smacPassed?"text-emerald-400":"text-amber-400"}`,children:s.smacPassed?"Passata":"Non Passata"})]}),e.jsx("button",{onClick:r=>{r.stopPropagation(),O(s)},className:`p-2 sm:p-3 rounded-xl transition-all ${s.smacPassed?"bg-emerald-500 text-white hover:bg-emerald-600":"bg-dark-700 text-dark-300 hover:bg-amber-500 hover:text-dark-900"}`,title:s.smacPassed?"Rimuovi SMAC":"Segna come SMAC passata",children:e.jsx(q,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),a&&i&&e.jsx("div",{className:"bg-dark-900/30 border-t border-dark-700",children:s.orders.map(r=>e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 py-2 sm:py-3 pl-10 sm:pl-20 border-b border-dark-800 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:"text-dark-500",children:"└"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs sm:text-sm text-dark-300",children:["#",r.id,r.order_number&&e.jsxs("span",{className:"text-dark-500 ml-1",children:["(C",r.order_number,")"]})]}),e.jsx("p",{className:"text-xs text-dark-500",children:new Date(r.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-dark-300",children:["€",r.total.toFixed(2)]})]},r.id))})]},s.type==="session"?`session-${s.sessionId}`:`order-${t.id}`)})})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3 sm:p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-400 mb-2 text-sm sm:text-base",children:"Cos'è la SMAC?"}),e.jsxs("p",{className:"text-xs sm:text-sm text-dark-300",children:["La ",e.jsx("strong",{children:"SMAC"})," (Carta Servizi) è il sistema di San Marino per la tracciabilità delle transazioni commerciali. Quando un cliente presenta la sua carta SMAC al momento del pagamento, l'importo viene registrato per beneficiare di detrazioni fiscali."]})]})]})}export{se as Smac};
