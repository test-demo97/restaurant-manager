import{l as Fa,k as za,i as Ea,r as l,p as hs,ai as us,q as Fe,t as o,aj as ze,j as e,P as Ma,U as le,J as Ee,e as Ra,ak as gs,K as Aa,X as fs,M as N,al as bs,am as js,f as ie,O as oe,N as vs,B as ce,s as Me,a3 as W,an as Oa,ao as $a,ap as Da,aq as Ga,y as Ia,a1 as Re,a2 as Ae,a4 as Oe,x as Ns,Y as ys,ar as qa,ab as Qa,aa as La}from"./index-BXDN7nMf.js";import{u as Ba}from"./useCurrency-CLhcENHk.js";import{S as Ua,a as Va,b as Wa,L as ws}from"./SessionDetailsModal-1x5ryBiA.js";import{u as Ja}from"./useDemoGuard-DRKNfyvG.js";import{C as $e}from"./calendar-DYpSHTt3.js";import{F as ks}from"./file-text-BLmLjhfJ.js";import{C as Cs}from"./clock-7x4f2kNm.js";import{L as de}from"./link-2-B6r5OKE2.js";import{M as Ka}from"./message-square-CepFFosD.js";import{B as J}from"./banknote-CewwdmPh.js";import{G as De}from"./globe-hMwsdNlM.js";import{P as Ss}from"./printer-Cgq0TxNG.js";function ct(){const{formatPrice:me}=Ba(),_s=Fa(),{isDemo:Ps}=Ja(),{user:Ge}=za(),{smacEnabled:F}=Ea(),[z,Ie]=l.useState([]),[K,qe]=l.useState([]),[xe,Qe]=l.useState([]),[Ts,Le]=l.useState(!0),[Fs,X]=l.useState(!1),[Be,w]=l.useState(!1),[zs,E]=l.useState(!1),[Es,Y]=l.useState(!1),[r,pe]=l.useState(null),[Ms,Rs]=l.useState([]),[$,he]=l.useState([]),[p,D]=l.useState(0),[k,ue]=l.useState([]),[Ue,As]=l.useState(0),[H,Os]=l.useState(0),[ge,fe]=l.useState(!1),[M,R]=l.useState("manual"),[h,v]=l.useState({paymentMethod:"cash",amount:"",change:0,notes:"",smac:!1}),[g,_]=l.useState({paymentMethod:"cash",amount:"",change:0,customerGives:"",showChange:!1}),[Ve,$s]=l.useState(0),[Ds,be]=l.useState(!1),[We,Je]=l.useState([]),[P,Z]=l.useState({name:"",capacity:1}),[i,y]=l.useState({customer_name:"",phone:"",date:"",time:"",guests:1,notes:"",table_ids:[]}),[ee,se]=l.useState(null),[A,je]=l.useState(null),[Ke,Gs]=l.useState(null),[C,G]=l.useState({covers:"2",customer_name:"",customer_phone:""}),[b,I]=l.useState({method:"cash",smac:!1}),[Xe,Is]=l.useState(null),[Ye,He]=l.useState(!1),[qs,Ze]=l.useState(!1),[Qs,q]=l.useState(!1),[Ls,ae]=l.useState(!1),[Bs,ve]=l.useState(!1),[Us,Ne]=l.useState(!1),[d,Vs]=l.useState(null),[es,ss]=l.useState([]),[T,Q]=l.useState({}),[f,ye]=l.useState({totalPeople:"",payingPeople:""}),[S,Ws]=l.useState(new Date().toISOString().split("T")[0]),[Js,te]=l.useState(!1),[Ks,ne]=l.useState(!1),[x,as]=l.useState(null),[Xs,we]=l.useState(!1),[ts,ns]=l.useState([]),[Ys,O]=l.useState(!1),[Hs,L]=l.useState([]),[rs,ke]=l.useState(null),[Ce,Se]=l.useState(null);l.useEffect(()=>{j()},[S]),l.useEffect(()=>{const s=()=>{(async()=>{try{const[a,t]=await Promise.all([hs(),us(S)]);Ie(a),qe(t);const n=await ze();Qe(n||[])}catch(a){console.error("Error refreshing tables on update event",a)}})()};return window.addEventListener("orders-updated",s),window.addEventListener("table-sessions-updated",s),window.addEventListener("reservations-updated",s),window.addEventListener("tables-updated",s),window.addEventListener("settings-updated",s),()=>{window.removeEventListener("orders-updated",s),window.removeEventListener("table-sessions-updated",s),window.removeEventListener("reservations-updated",s),window.removeEventListener("tables-updated",s),window.removeEventListener("settings-updated",s)}},[S]);const B=()=>!Ps||Ge&&Ge.role==="admin",j=async()=>{try{const[s,a,t]=await Promise.all([hs(),us(S),Fe()]);Ie(s),qe(a),Is(t),He((t?.cover_charge||0)>0),Le(!1)}catch(s){console.error("Error loading data:",s),o("Errore nel caricamento dati","error"),Le(!1)}};l.useEffect(()=>{(async()=>{try{const s=await ze();Qe(s||[])}catch(s){console.error("Error loading active sessions",s)}})()},[]);function ls(s){return K.find(a=>(a.table_ids||[a.table_id]).includes(s))||null}function U(s){return xe.find(n=>n.table_id===s&&n.status==="open")?"occupied":ls(s)?"reserved":"available"}function Zs(s){s&&y({...i,table_ids:[s],date:S}),w(!0)}function is(s){s?(Z({name:s.name,capacity:s.capacity}),se(s)):(Z({name:"",capacity:1}),se(null)),te(!0)}function ea(){y({...i,date:S}),w(!0)}async function sa(s){try{await Oa(s),await j(),o("Tavolo eliminato","success")}catch(a){console.error(a),o("Errore eliminazione tavolo","error")}}function aa(s){const a=i.table_ids||[];a.includes(s)?y({...i,table_ids:a.filter(t=>t!==s)}):y({...i,table_ids:[...a,s]})}async function ta(){try{ee?(await Da(ee.id,P),o("Tavolo aggiornato","success")):(await Ga({name:P.name,capacity:P.capacity}),o("Tavolo creato","success")),te(!1),se(null),await j()}catch(s){console.error(s),o("Errore salvataggio tavolo","error")}}async function na(){try{const s={table_ids:i.table_ids,table_id:i.table_ids&&i.table_ids.length>0?i.table_ids[0]:0,date:i.date,time:i.time,customer_name:i.customer_name,phone:i.phone,guests:i.guests,notes:i.notes,status:"confirmed"};await bs(s),w(!1),await j(),o("Prenotazione creata","success")}catch(s){console.error(s);const a=s;a&&a.conflicts&&Array.isArray(a.conflicts)&&a.conflicts.length>0?(L(a.conflicts),ke({table_ids:i.table_ids,table_id:i.table_ids&&i.table_ids.length>0?i.table_ids[0]:0,date:i.date,time:i.time,customer_name:i.customer_name,phone:i.phone,guests:i.guests,notes:i.notes,status:"confirmed"}),O(!0)):o("Errore creazione prenotazione","error")}}async function ra(){try{if(!A)return;await js(A.id,i),w(!1),await j(),o("Prenotazione aggiornata","success")}catch(s){console.error(s);const a=s;a&&a.conflicts&&Array.isArray(a.conflicts)&&a.conflicts.length>0?(L(a.conflicts),Se({id:A.id,updates:i}),O(!0)):o("Errore aggiornamento prenotazione","error")}}function la(s){as(s),ne(!0)}function ia(s){const a=K.filter(t=>(t.table_ids||[t.table_id]).includes(s));ns(a),we(!0)}function os(s){je(s),y({customer_name:s.customer_name||"",phone:s.phone||"",date:s.date||S,time:s.time||"",guests:s.guests||1,notes:s.notes||"",table_ids:s.table_ids||(s.table_id?[s.table_id]:[])}),w(!0)}async function _e(s){try{await $a(s),await j(),o("Prenotazione cancellata","success")}catch(a){console.error(a),o("Errore cancellazione prenotazione","error")}}const oa=async s=>{try{await ce(s.id);const[a,t,n]=await Promise.all([Ns(s.id),Ae(s.id),W(s.id)]),c=(await ze()).find(u=>u.id===s.id);pe(c||s),Rs(a),he(t),D(n),E(!0)}catch(a){console.error("Error loading session details:",a),o("Errore nel caricamento dettagli","error")}};function ca(){try{const s=i.table_ids||[];return z.filter(a=>s.includes(a.id)).reduce((a,t)=>a+(t.capacity||0),0)}catch{return 0}}async function da(){if(B()&&Ke)try{const s=await Ia(Ke,parseInt(C.covers)||1,C.customer_name||void 0,C.customer_phone||void 0);if(Ye&&s&&s.id)try{await ce(s.id,!0)}catch(a){console.error("Error applying cover on new session:",a)}o("Conto aperto","success"),X(!1),j()}catch(s){console.error("Error opening session:",s),o("Errore nell'apertura conto","error")}}function ma(){r&&_s(`/orders/new?table=${r.table_id}&session=${r.id}`)}async function xa(){if(!B()||!r)return;if((r?.total??0)===0){if(window.confirm("Vuoi chiudere questo conto a €0.00?"))try{await Re(r.id,"cash",!1,!1),o("Conto chiuso","success"),E(!1),j()}catch(n){console.error("Error closing session:",n),o("Errore nella chiusura","error")}return}const a=(await Fe()).cover_charge||0;if(a>0&&(r?.covers??0)>0){const t=a*(r?.covers??0);$s(t);const n=!!ge;be(n),re(n)}else re(!1)}function re(s){be(s),Ze(!1),I({method:"cash",smac:!1}),_(a=>({...a,customerGives:"",showChange:!1})),q(!0)}async function cs(){if(B()&&r)try{await Re(r.id,b.method,b.smac,Ds),o("Conto chiuso","success"),q(!1),E(!1),j()}catch(s){console.error("Error closing session:",s),o("Errore nella chiusura","error")}}function pa(){r&&ae(!0)}async function ha(s){if(B()&&r)try{await qa(r.id,s),o("Tavolo trasferito","success"),ae(!1),E(!1),j()}catch(a){console.error("Error transferring table:",a),o("Errore nel trasferimento","error")}}async function ua(){if(r){v(s=>({...s,amount:"",method:"cash",notes:"",smac:!1})),R("manual"),Q({}),ye({totalPeople:(r?.covers??0).toString(),payingPeople:""}),_(s=>({...s,customerGives:"",showChange:!1}));try{const s=[];for(const n of Ms)(await ys(n.id)).forEach(c=>{s.push({...c,order_number:n.order_number||1})});ss(s);const a=await Oe(r.id),t=s.map(n=>({...n,remainingQty:n.quantity-(a[n.id]||0)})).filter(n=>n.remainingQty>0);ue(t)}catch(s){console.error("Error loading items:",s)}Y(!0)}}async function ga(s,a){try{await ce(s,a);const t=await Me(s);pe(m=>m&&{...m,total:t?.total??m.total});const n=await W(s);D(n),fe(a),be(a),o("Totale aggiornato","success")}catch(t){console.error("Error updating session total with cover (tables):",t),o("Errore nell'applicazione del coperto","error")}}function fa(){const s=parseFloat(g.customerGives)||0,a=parseFloat(h.amount)||0;return Math.max(0,s-a)}function ds(){if(!r)return 0;const s=parseInt(f.totalPeople)||1,a=parseInt(f.payingPeople)||1,t=p/s;return Math.min(t*a,p)}function Pe(){return Object.entries(T).reduce((s,[a,t])=>{const n=k.find(m=>m.id===Number(a));return n&&t>0?s+n.price*t:s},0)}function ba(s){const a=k.find(t=>t.id===s);a&&Q(t=>{const n=t[s]||0;return n<a.remainingQty?{...t,[s]:n+1}:t})}function ja(s){Q(a=>{const t=a[s]||0;if(t>0){const n=t-1;if(n===0){const{[s]:m,...c}=a;return c}return{...a,[s]:n}}return a})}function va(s){const a=k.find(t=>t.id===s);a&&Q(t=>{if((t[s]||0)===a.remainingQty){const{[s]:m,...c}=t;return c}else return{...t,[s]:a.remainingQty}})}function Na(){const s=ds();s>0&&(v(a=>({...a,amount:s.toFixed(2),notes:`Alla romana (${f.payingPeople}/${f.totalPeople} persone)`})),R("manual"))}function ya(){const s=Pe();if(s>0&&s<=p){const a=Object.entries(T).map(([n,m])=>{const c=k.find(u=>u.id===Number(n));return c?`${m}x ${c.menu_item_name}`:""}).filter(Boolean).join(", "),t=Object.entries(T).map(([n,m])=>{const c=k.find(u=>u.id===Number(n));return c?{order_item_id:c.id,quantity:m,menu_item_name:c.menu_item_name,price:c.price}:null}).filter(n=>n!==null);Je(t),v(n=>({...n,amount:Math.min(s,p).toFixed(2),notes:a.length>40?a.substring(0,40)+"...":a})),R("manual"),Q({})}}async function wa(){if(!B())return;if(!r){o("Sessione non trovata","error");return}const s=parseFloat(h.amount);if(isNaN(s)||s<=0){o("Inserisci un importo valido","warning");return}if(s>p+.01){o("Importo superiore al rimanente","warning");return}try{await Qa(r.id,s,h.method??"cash",h.notes||void 0,h.smac,We.length>0?We:void 0);const[a,t,n]=await Promise.all([Ae(r.id),W(r.id),Oe(r.id)]);he(a),D(t);const m=es.map(c=>({...c,remainingQty:c.quantity-(n[c.id]||0)})).filter(c=>c.remainingQty>0);if(ue(m),v(c=>({...c,amount:"",method:"cash",notes:"",smac:!1})),Je([]),o("Pagamento aggiunto","success"),t<=.01)try{await Re(r.id,"split",!1),o("Conto saldato e chiuso","success"),Y(!1),E(!1),j()}catch(c){console.error("Error closing session:",c),o("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(a){console.error("Error adding payment:",a),o("Errore nell'aggiunta pagamento","error")}}async function ka(){if(r)try{const[s,a,t]=await Promise.all([Ae(r.id),W(r.id),Oe(r.id)]),n=await Ns(r.id),m=[];for(const u of n)(await ys(u.id)).forEach(V=>{m.push({...V,order_number:u.order_number||1})});const c=m.map(u=>({...u,remainingQty:u.quantity-(t[u.id]||0)})).filter(u=>u.remainingQty>0);try{const u=await Me(r.id),xs=await Fe(),V=u?.covers||0,Te=xs.cover_charge||0,ps=n.reduce((Pa,Ta)=>Pa+Ta.total,0)+Te*V,_a=Math.abs((u?.total||0)-ps)<.01||(u?.total||0)>=ps-.01;As(V),Os(Te),fe(_a&&Te>0&&V>0)}catch(u){console.error("Error loading session info for bill status modal (tables):",u)}ss(m),he(s),D(a),ue(c),ve(!0)}catch(s){console.error("Error loading bill status (tables):",s),o("Errore nel caricamento stato conto","error")}}async function Ca(s){try{const a=await La(s);a&&(Vs(a),Ne(!0))}catch(a){console.error("Error generating receipt:",a),o("Errore nella generazione scontrino","error")}}function Sa(){if(!d)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${d?.shop_info?.name??""}</div>
            ${d?.shop_info?.address?`<div>${d.shop_info.address}</div>`:""}
            ${d?.shop_info?.phone?`<div>Tel: ${d.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${d?.date??""} ${d?.time??""}</div>
          <div class="divider"></div>
          ${(d?.items||[]).map(t=>`
            <div class="item">
              <span>${t.quantity}x ${t.name}</span>
              <span>€${t.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>€${(d?.total??0).toFixed(2)}</span>
          </div>
          <div>Pagamento: ${d?.payment_method==="cash"?"Contanti":d?.payment_method==="card"?"Carta":"Online"}</div>
          ${F&&d?.smac_passed?"<div>SMAC: Sì</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,a=window.open("","_blank");a&&(a.document.write(s),a.document.close(),a.print())}if(Ts)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});const ms=s=>{const a=U(s),t=xe.find(m=>m.table_id===s)||null,n=ls(s);a==="occupied"?t&&oa(t):(a==="available"||a==="reserved")&&(Gs(s),G(n?{covers:n.guests?.toString()||"2",customer_name:n.customer_name||"",customer_phone:n.phone||""}:{covers:"2",customer_name:"",customer_phone:""}),X(!0))};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Tavoli e Prenotazioni"}),e.jsx("p",{className:"text-dark-400 mt-1 text-sm sm:text-base",children:"Gestisci tavoli e prenotazioni"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>ea(),className:"btn-secondary flex-1 sm:flex-none",children:[e.jsx($e,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Prenotazione"})]}),e.jsxs("button",{onClick:()=>is(),className:"btn-primary flex-1 sm:flex-none",children:[e.jsx(Ma,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Tavolo"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx($e,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"}),e.jsx("input",{type:"date",value:S,onChange:s=>Ws(s.target.value),className:"input w-auto text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-emerald-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Disponibile"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Occupato"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-amber-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Prenotato"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-1 sm:gap-3",children:z.map(s=>{const a=U(s.id),t=xe.find(n=>n.table_id===s.id);return e.jsxs("div",{onClick:()=>ms(s.id),className:`
                group relative
                ${a==="available"?"table-available cursor-pointer hover:scale-105":""}
                ${a==="occupied"?"table-occupied cursor-pointer hover:scale-105":""}
                ${a==="reserved"?"table-reserved cursor-pointer hover:scale-105":""}
                  transform scale-90 pt-6 sm:pt-8 p-2 sm:p-3 transition-transform flex flex-col justify-between min-h-[110px]
              `,children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-center w-full mt-8 sm:mt-10",children:s.name}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(le,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:s.capacity})]}),t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs space-y-1 text-center",children:[e.jsxs("p",{className:"flex items-center justify-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),t.covers," coperti"]}),e.jsxs("p",{className:"font-semibold text-base sm:text-lg",children:["€",t.total.toFixed(2)]})]}),(a==="available"||a==="reserved")&&e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-1",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),ms(s.id)},className:"text-[10px] sm:text-xs font-medium text-emerald-400 hover:text-emerald-300",children:"Apri Conto"}),e.jsx("button",{onClick:n=>{n.stopPropagation(),Zs(s.id)},className:"block text-[10px] sm:text-xs underline hover:no-underline",children:"Prenota"})]}),e.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 flex gap-2 transition-colors",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),ia(s.id)},className:"p-2 bg-dark-800 rounded hover:bg-dark-700",title:"Visualizza prenotazioni",children:e.jsx(ks,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),is(s)},className:"p-2 bg-dark-800 rounded hover:bg-dark-700",title:"Modifica tavolo",children:e.jsx(Ee,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),sa(s.id)},className:"p-2 bg-dark-800 rounded hover:bg-red-500/20",title:"Elimina tavolo",children:e.jsx(Ra,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]},s.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white text-sm sm:text-base",children:["Prenotazioni per ",new Date(S).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"})]})}),e.jsx("div",{className:"card-body",children:K.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4 text-sm",children:"Nessuna prenotazione per questa data"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:K.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 bg-dark-900 rounded-xl gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Cs,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm sm:text-base truncate",children:s.customer_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 sm:gap-x-3 gap-y-0.5 text-xs sm:text-sm text-dark-400",children:[e.jsx("span",{children:s.time}),e.jsxs("span",{className:"flex items-center gap-1",children:[s.table_ids&&s.table_ids.length>1&&e.jsx(de,{className:"w-3 h-3 text-primary-400"}),s.table_name]}),e.jsxs("span",{children:[s.guests," ospiti"]})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-dark-400",children:[e.jsx(gs,{className:"w-3 h-3"}),s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:`badge text-xs ${s.status==="confirmed"?"badge-success":"badge-danger"}`,children:s.status==="confirmed"?"Confermata":"Annullata"}),e.jsx("button",{onClick:()=>la(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Visualizza dettagli",children:e.jsx(Aa,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),e.jsx("button",{onClick:()=>os(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Modifica",children:e.jsx(Ee,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),s.status==="confirmed"&&e.jsx("button",{onClick:()=>_e(s.id),className:"p-1.5 sm:p-2 hover:bg-red-500/20 rounded-lg transition-colors",title:"Annulla",children:e.jsx(fs,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-400"})})]})]},s.id))})})]}),e.jsx(N,{isOpen:Js,onClose:()=>{te(!1),se(null)},title:ee?"Modifica Tavolo":"Nuovo Tavolo",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Tavolo"}),e.jsx("input",{type:"text",value:P.name,onChange:s=>Z({...P,name:s.target.value}),className:"input",placeholder:"Es. Tavolo 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Capacità (posti)"}),e.jsx("input",{type:"number",min:"1",value:P.capacity,onChange:s=>Z({...P,capacity:Number(s.target.value)}),className:"input"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:ta,className:"btn-primary flex-1",children:ee?"Salva":"Crea"}),e.jsx("button",{onClick:()=>te(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(N,{isOpen:Be,onClose:()=>{w(!1),je(null)},title:A?"Modifica Prenotazione":"Nuova Prenotazione",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:i.date,onChange:s=>y({...i,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ora"}),e.jsx("input",{type:"time",value:i.time,onChange:s=>y({...i,time:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>y({...i,phone:s.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ospiti"}),e.jsx("input",{type:"number",min:"1",value:i.guests,onChange:s=>y({...i,guests:Number(s.target.value)}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente *"}),e.jsx("input",{type:"text",value:i.customer_name,onChange:s=>y({...i,customer_name:s.target.value}),className:"input",placeholder:"Nome e cognome"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"label mb-0",children:[e.jsx(de,{className:"w-4 h-4 inline mr-1"}),"Tavoli"]}),e.jsxs("span",{className:"text-xs text-dark-400",children:["Capacità totale: ",e.jsx("span",{className:"text-primary-400 font-semibold",children:ca()})," posti"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 max-h-32 overflow-y-auto p-2 bg-dark-900 rounded-xl",children:z.map(s=>{const a=i.table_ids.includes(s.id),t=U(s.id),n=t==="available"||Be&&(t==="occupied"||t==="reserved");return e.jsxs("button",{type:"button",onClick:()=>n&&aa(s.id),disabled:!n,className:`p-3 rounded-lg border-2 text-sm flex items-center gap-2 transition-all ${a?"border-primary-500 bg-primary-500/10 text-white":n?"border-dark-600 text-dark-300 hover:border-dark-500":"border-dark-700 text-dark-500 opacity-50 cursor-not-allowed"}`,children:[a?e.jsx(Ua,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(Va,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:s.name}),e.jsxs("span",{className:"text-xs text-dark-400 flex-shrink-0",children:[s.capacity,"p"]})]},s.id)})}),i.table_ids.length>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-2 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"Tavoli uniti: ",z.filter(s=>i.table_ids.includes(s.id)).map(s=>s.name).join(" + ")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:i.notes,onChange:s=>y({...i,notes:s.target.value}),className:"input resize-none h-16",placeholder:"Note aggiuntive..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:A?ra:na,className:"btn-primary flex-1",children:A?"Salva Modifiche":"Crea Prenotazione"}),e.jsx("button",{onClick:()=>{w(!1),je(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(N,{isOpen:Ks,onClose:()=>ne(!1),title:"Dettagli Prenotazione",size:"md",children:x&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:`badge text-lg px-4 py-2 ${x?.status==="confirmed"?"badge-success":x?.status==="cancelled"?"badge-danger":"badge-secondary"}`,children:x?.status==="confirmed"?"Confermata":x?.status==="cancelled"?"Annullata":"Completata"})}),e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-500/20 flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:x?.customer_name}),x?.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-dark-400",children:[e.jsx(gs,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${x?.phone}`,className:"hover:text-primary-400",children:x?.phone})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx($e,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(x?.date??"").toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(Cs,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ora"}),e.jsx("p",{className:"font-semibold text-white",children:x?.time})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(le,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ospiti"}),e.jsxs("p",{className:"font-semibold text-white",children:[x?.guests," persone"]})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(de,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:(x?.table_ids?.length??0)>1?"Tavoli Uniti":"Tavolo"}),e.jsx("p",{className:"font-semibold text-white",children:x?.table_name}),(x?.table_ids?.length??0)>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-1",children:[x?.table_ids?.length??0," tavoli"]})]})]}),x?.notes&&e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ka,{className:"w-4 h-4 text-dark-400"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Note"})]}),e.jsx("p",{className:"text-white",children:x?.notes})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>x&&os(x),className:"btn-secondary flex-1",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Modifica"]}),x?.status==="confirmed"&&e.jsxs("button",{onClick:()=>{x&&(_e(x.id),ne(!1))},className:"btn-danger",children:[e.jsx(fs,{className:"w-5 h-5"}),"Annulla"]})]})]})}),e.jsx(N,{isOpen:Xs,onClose:()=>we(!1),title:"Prenotazioni tavolo",size:"sm",children:e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:ts.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4",children:"Nessuna prenotazione per questo tavolo oggi"}):e.jsx("div",{className:"space-y-2",children:ts.map(s=>e.jsxs("div",{className:"p-2 sm:p-3 bg-dark-900 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-white text-sm truncate",children:s.customer_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:[s.time," • ",s.guests," ospiti"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{as(s),ne(!0),we(!1)},className:"btn-secondary py-1 px-2 text-xs",children:"Dettagli"}),e.jsx("button",{onClick:()=>{_e(s.id),ns(a=>a.filter(t=>t.id!==s.id))},className:"btn-danger py-1 px-2 text-xs",children:"Annulla"})]})]},s.id))})})}),e.jsx(N,{isOpen:Ys,onClose:()=>O(!1),title:"Conflitto Prenotazioni",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-300",children:"Attenzione: ci sono prenotazioni vicine per questo tavolo nelle seguenti fasce orarie. Vuoi procedere comunque?"}),e.jsx("div",{className:"space-y-2",children:Hs.map(s=>e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.customer_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.date," • ",s.time," • ",s.guests," ospiti"]})]}),e.jsxs("div",{className:"text-sm text-dark-400",children:["Tavoli: ",s.table_names||(s.table_ids||[s.table_id]).join(", ")]})]},s.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-secondary flex-1",onClick:()=>{O(!1),L([]),ke(null),Se(null)},children:"Annulla"}),e.jsx("button",{className:"btn-primary flex-1",onClick:async()=>{try{rs?(await bs(rs,{force:!0}),w(!1),O(!1),ke(null),L([]),await j(),o("Prenotazione creata (forzata)","success")):Ce&&(await js(Ce.id,Ce.updates,{force:!0}),w(!1),O(!1),Se(null),L([]),await j(),o("Prenotazione aggiornata (forzata)","success"))}catch(s){console.error("Errore forzando prenotazione:",s),o("Errore durante la conferma forzata","error")}},children:"Conferma e Salva"})]})]})}),e.jsx(N,{isOpen:Fs,onClose:()=>X(!1),title:"Apri Conto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Numero Coperti"}),e.jsx("input",{type:"number",min:"1",value:C.covers,onChange:s=>G({...C,covers:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente (opzionale)"}),e.jsx("input",{type:"text",value:C.customer_name,onChange:s=>G({...C,customer_name:s.target.value}),className:"input",placeholder:"Es. Marco Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono (opzionale)"}),e.jsx("input",{type:"tel",value:C.customer_phone,onChange:s=>G({...C,customer_phone:s.target.value}),className:"input",placeholder:"+39..."})]}),(Xe?.cover_charge||0)>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"open_session_apply_cover_tables",type:"checkbox",checked:Ye,onChange:s=>He(s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"open_session_apply_cover_tables",className:"text-white text-sm",children:["Applica coperto (",me(Xe?.cover_charge??0)," / ospite)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:da,className:"btn-primary flex-1",children:"Apri Conto"}),e.jsx("button",{onClick:()=>X(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(Wa,{isOpen:zs,onClose:()=>E(!1),sessionId:r?.id??void 0,onAddOrder:()=>ma(),onTransfer:()=>pa(),onOpenSplit:()=>ua(),onOpenBillStatus:()=>ka(),onCloseSession:()=>xa()}),e.jsx(N,{isOpen:qs,onClose:()=>Ze(!1),title:"Coperto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Coperto da applicare"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:["€",Ve.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["(",r?.covers||0," coperti × €",(Ve/(r?.covers||1)).toFixed(2),")"]})]}),e.jsx("p",{className:"text-center text-dark-300",children:"Vuoi applicare il coperto a questo conto?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>re(!0),className:"btn-primary py-3",children:"Sì, applica"}),e.jsx("button",{onClick:()=>re(!1),className:"btn-secondary py-3",children:"No, senza coperto"})]})]})}),e.jsx(N,{isOpen:Qs,onClose:()=>q(!1),title:"Chiudi Conto",size:b.method==="cash"&&(r?.total??0)>0?"2xl":"md",children:r&&e.jsxs("div",{className:b.method==="cash"&&(r?.total??0)>0?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsxs("p",{className:"text-3xl font-bold text-primary-400",children:["€",(r?.total??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>I({...b,method:"cash"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${b.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(J,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>I({...b,method:"card"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${b.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ie,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>I({...b,method:"online"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${b.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(De,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Online"})]})]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac",checked:b.smac,onChange:s=>I({...b,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac",className:"text-white",children:"SMAC passato"})]}),(b.method!=="cash"||(r?.total??0)===0)&&e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:cs,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>q(!1),className:"btn-secondary",children:"Annulla"})]})]}),b.method==="cash"&&(r?.total??0)>0&&e.jsxs("div",{className:"mt-6 md:mt-0 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:g.customerGives,onChange:s=>_({...g,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{type:"button",onClick:()=>_({...g,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),g.customerGives&&parseFloat(g.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsxs("span",{className:"text-white",children:["€",(r?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(g.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Math.max(0,parseFloat(g.customerGives)-(r?.total??0)).toFixed(2)]})]}),parseFloat(g.customerGives)<(r?.total??0)&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",((r?.total??0)-parseFloat(g.customerGives)).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:cs,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>q(!1),className:"btn-secondary",children:"Annulla"})]})]})]})}),e.jsx(N,{isOpen:Ls,onClose:()=>ae(!1),title:"Trasferisci Tavolo",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-400",children:"Seleziona il nuovo tavolo:"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 max-h-64 overflow-y-auto",children:z.filter(s=>s.id!==r?.table_id&&U(s.id)==="available").map(s=>e.jsxs("button",{onClick:()=>ha(s.id),className:"p-4 bg-dark-900 rounded-xl hover:bg-dark-800 transition-colors text-center",children:[e.jsx("p",{className:"font-semibold text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.capacity," posti"]})]},s.id))}),z.filter(s=>s.id!==r?.table_id&&U(s.id)==="available").length===0&&e.jsx("p",{className:"text-center text-dark-400 py-4",children:"Nessun tavolo libero disponibile"}),e.jsx("button",{onClick:()=>ae(!1),className:"btn-secondary w-full",children:"Annulla"})]})}),e.jsx(N,{isOpen:Es,onClose:()=>Y(!1),title:"Dividi Conto",size:"3xl",children:r&&e.jsxs("div",{className:"md:grid md:grid-cols-5 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-white",children:["€",(r?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-emerald-400",children:["€",((r?.total??0)-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),(r?.total??0)>0&&e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,((r?.total??0)-p)/(r?.total??1)*100)}%`}})}),$.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-64 overflow-y-auto",children:$.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(J,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(ie,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(De,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"text-white",children:["€",s.amount.toFixed(2)]}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-sm",children:["- ",s.notes]})]}),F&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]},s.id))})]})]}),e.jsxs("div",{className:"md:col-span-3 mt-6 md:mt-0",children:[Ue>0&&H>0&&r&&e.jsxs("div",{className:"p-3 mb-3 bg-dark-900 rounded-xl flex items-center gap-3",children:[e.jsx("input",{id:"apply_cover_split_tables",type:"checkbox",checked:ge,onChange:s=>ga(r.id,s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"apply_cover_split_tables",className:"text-white",children:["Applica coperto (",me(H),")"]})]}),p>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R("manual"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${M==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>R("romana"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${M==="romana"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Alla Romana"})]}),e.jsxs("button",{onClick:()=>R("items"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${M==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ws,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Per Consumazione"})]})]}),M==="romana"&&e.jsxs("div",{className:"p-4 border border-primary-500/30 bg-primary-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-primary-400"}),"Dividi alla Romana"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Dividi il conto equamente tra le persone. Specifica quante persone stanno pagando ora."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone totali al tavolo"}),e.jsx("input",{type:"number",min:"1",value:f.totalPeople,onChange:s=>ye({...f,totalPeople:s.target.value}),className:"input",placeholder:r?.covers?.toString()??""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone che pagano ora"}),e.jsx("input",{type:"number",min:"1",max:f.totalPeople,value:f.payingPeople,onChange:s=>ye({...f,payingPeople:s.target.value}),className:"input",placeholder:"Es. 2"})]})]}),f.totalPeople&&f.payingPeople&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Quota per persona:"}),e.jsxs("span",{className:"text-white font-medium",children:["€",(p/(parseInt(f.totalPeople)||1)).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-dark-400",children:["Totale da pagare (",f.payingPeople," pers.):"]}),e.jsxs("span",{className:"text-primary-400 font-bold text-lg",children:["€",ds().toFixed(2)]})]})]}),e.jsx("button",{onClick:Na,disabled:!f.totalPeople||!f.payingPeople,className:"btn-primary w-full",children:"Applica Calcolo"})]}),M==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 text-blue-400"}),"Paga per Consumazione"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare. I prodotti già pagati non vengono mostrati."}),e.jsx("div",{className:"max-h-64 sm:max-h-80 overflow-y-auto space-y-2",children:k.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:es.length===0?"Nessun prodotto ordinato":"Tutti i prodotti sono stati pagati"}):k.map(s=>{const a=T[s.id]||0,t=a>0;return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${t?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",s.price.toFixed(2)," cad. • Rimasti ",s.remainingQty," pz",s.remainingQty<s.quantity&&e.jsxs("span",{className:"text-emerald-400 ml-1",children:["(",s.quantity-s.remainingQty," già pagati)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>va(s.id),className:`px-2 py-1 text-xs rounded transition-colors ${a===s.remainingQty?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:"Tutti"}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>ja(s.id),disabled:a===0,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"-"})}),e.jsx("span",{className:`w-8 text-center font-bold ${t?"text-blue-400":"text-dark-500"}`,children:a}),e.jsx("button",{onClick:()=>ba(s.id),disabled:a>=s.remainingQty,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"+"})})]})]})]}),t&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-dark-600 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-dark-400",children:[a,"/",s.remainingQty," selezionati"]}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:["€",(s.price*a).toFixed(2)]})]})]},s.id)})}),Object.keys(T).length>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Prodotti selezionati:"}),e.jsxs("span",{className:"text-white",children:[Object.values(T).reduce((s,a)=>s+a,0)," pz"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-dark-400",children:"Totale:"}),e.jsxs("span",{className:"text-blue-400 font-bold text-lg",children:["€",Pe().toFixed(2)]})]}),Pe()>p&&e.jsxs("p",{className:"text-xs text-amber-400 mt-2",children:["Nota: il totale supera il rimanente, verrà addebitato €",p.toFixed(2)]})]}),e.jsx("button",{onClick:ya,disabled:Object.keys(T).length===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),M==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-white",children:"Pagamento manuale"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo da incassare"}),e.jsx("input",{type:"number",step:"0.01",value:h.amount,onChange:s=>v({...h,amount:s.target.value}),className:"input",placeholder:`Max €${p.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note (opzionale)"}),e.jsx("input",{type:"text",value:h.notes,onChange:s=>v({...h,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>v({...h,amount:p.toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Tutto (€",p.toFixed(2),")"]}),e.jsxs("button",{onClick:()=>v({...h,amount:(p/2).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Metà (€",(p/2).toFixed(2),")"]}),(r?.covers??0)>1&&e.jsxs("button",{onClick:()=>v({...h,amount:(p/(r?.covers??1)).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["1/",r?.covers??0," (€",(p/(r?.covers??1)).toFixed(2),")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{v(s=>({...s,method:"cash"})),_(s=>({...s,customerGives:"",showChange:!0}))},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${h.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(J,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>{v(s=>({...s,method:"card"})),_(s=>({...s,customerGives:"",showChange:!1}))},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${h.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(ie,{className:"w-4 h-4"})," Carta"]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"split_smac",checked:h.smac,onChange:s=>v({...h,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsxs("label",{htmlFor:"split_smac",className:"text-white cursor-pointer flex-1",children:[e.jsx("span",{className:"font-medium",children:"SMAC passato"}),e.jsx("p",{className:"text-xs text-dark-400",children:"Spunta se questo pagamento è già stato dichiarato con tessera SMAC"})]})]}),h.method==="cash"&&h.amount&&parseFloat(h.amount)>0&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:g.customerGives,onChange:s=>_({...g,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{onClick:()=>_({...g,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),g.customerGives&&parseFloat(g.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Da incassare:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(h.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(g.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",fa().toFixed(2)]})]}),parseFloat(g.customerGives)<parseFloat(h.amount)&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",(parseFloat(h.amount)-parseFloat(g.customerGives)).toFixed(2)]})]})]}),e.jsx("button",{onClick:wa,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),p===0&&e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(vs,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h4",{className:"text-xl font-bold text-emerald-400 mb-2",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400",children:"Il conto è stato completamente pagato."})]}),e.jsx("button",{onClick:()=>Y(!1),className:"btn-secondary w-full",children:"Chiudi"})]})]})}),e.jsx(N,{isOpen:Bs,onClose:()=>ve(!1),title:"Stato del Conto",size:"2xl",children:r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["€",(r?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:["€",((r?.total??0)-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),Ue>0&&H>0&&r&&e.jsxs("div",{className:"p-3 mt-3 bg-dark-900 rounded-xl flex items-center gap-3",children:[e.jsx("input",{id:"apply_cover_bill_tables",type:"checkbox",checked:ge,onChange:async s=>{const a=s.target.checked;if(!r)return;const t=r.id;try{await ce(t,a);const n=await Me(t);pe(n||r);const m=await W(t);D(m),fe(a),o("Totale aggiornato","success")}catch(n){console.error("Error toggling cover (tables):",n),o("Errore nell'applicazione del coperto","error")}},className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"apply_cover_bill_tables",className:"text-white",children:["Applica coperto (",me(H)," / ospite)"]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-6",children:[$.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:["Pagamenti effettuati (",$.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 md:max-h-80 overflow-y-auto",children:$.map((s,a)=>e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(J,{className:"w-5 h-5 text-emerald-400"}),s.payment_method==="card"&&e.jsx(ie,{className:"w-5 h-5 text-blue-400"}),s.payment_method==="online"&&e.jsx(De,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"font-semibold text-white",children:["Pagamento #",a+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-primary-400",children:["€",s.amount.toFixed(2)]}),F&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-sm text-dark-400 space-y-1",children:[e.jsxs("p",{children:["Metodo: ",s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online"]}),e.jsxs("p",{children:["Data: ",new Date(s.paid_at).toLocaleString("it-IT")]}),s.notes&&e.jsxs("p",{children:["Note: ",s.notes]})]}),s.paid_items&&s.paid_items.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Prodotti pagati:"}),e.jsx("div",{className:"space-y-1",children:s.paid_items.map((t,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-300",children:[t.quantity,"x ",t.menu_item_name]}),e.jsxs("span",{className:"text-dark-400",children:["€",(t.price*t.quantity).toFixed(2)]})]},n))})]}),e.jsxs("button",{onClick:()=>Ca(s),className:"mt-3 w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4"}),"Stampa Scontrino"]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-dark-900 rounded-xl text-center",children:[e.jsx(ks,{className:"w-12 h-12 mx-auto mb-3 text-dark-600"}),e.jsx("p",{className:"text-dark-400",children:"Nessun pagamento ancora effettuato"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:k.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:"Prodotti ancora da pagare"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-80 overflow-y-auto",children:k.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsxs("span",{className:"text-primary-400",children:["€",(s.price*s.remainingQty).toFixed(2)]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(vs,{className:"w-12 h-12 mx-auto mb-3 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>ve(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(N,{isOpen:Us,onClose:()=>Ne(!1),title:"Scontrino",size:"sm",children:d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:d?.shop_info?.name}),d?.shop_info?.address&&e.jsx("p",{className:"text-xs",children:d?.shop_info?.address}),d?.shop_info?.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",d?.shop_info?.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",d?.date," ",d?.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:(d?.items||[]).map((s,a)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsxs("span",{children:["€",s.total.toFixed(2)]})]},a))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsxs("span",{children:["€",(d?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",d?.payment_method==="cash"?"Contanti":d?.payment_method==="card"?"Carta":"Online"]}),F&&d?.smac_passed&&e.jsx("p",{children:"SMAC: Sì"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Sa,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Ss,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>Ne(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{ct as Tables,ct as default};
