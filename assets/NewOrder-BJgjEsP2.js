import{d as ls,j as e,U as ke,S as ae,P as is,e as os,f as cs,h as ye,u as ds,i as xs,k as ms,l as us,m as ps,r as n,n as hs,o as fs,p as bs,q as qe,s as $e,t as u,X as js,M as Me,v as gs,w as Ns,x as ze,y as vs,z as ys,A as ks,B as Pe}from"./index-DlwzvMJs.js";import{C as Ve}from"./clock-Be8V2WBc.js";import{M as Ee}from"./message-square-BNimbRBY.js";import{M as we}from"./minus-DYmGgUGR.js";import{B as ws}from"./banknote-CISDn-gD.js";import{S as Cs}from"./smartphone-Dua92HIW.js";import{u as Ss}from"./useCurrency-BeQWT6-C.js";import{u as _s}from"./useDemoGuard-DvQLN8mP.js";import{C as Os}from"./chevron-up-ZRkMaT0t.js";const Ts=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],As=ls("bike",Ts);function De({isMobile:f=!1,orderType:g,setOrderType:q,selectedTable:re,setSelectedTable:$,onTableSelect:M,tables:Y,customerName:ne,setCustomerName:G,customerPhone:le,setCustomerPhone:Q,cart:N,cartItemsCount:k,cartTotal:z,ivaRate:X,ivaAmount:H,ivaIncluded:b=!0,grandTotal:w,expandedItemId:j,setExpandedItemId:P,notes:x,setNotes:C,paymentMethod:p,setPaymentMethod:v,smacPassed:d,setSmacPassed:y,smacEnabled:E=!0,isSubmitting:J,clearCart:F,updateQuantity:S,removeFromCart:I,updateItemNotes:_,submitOrder:D,isSessionOrder:O=!1,sessionTableName:V}){return e.jsxs("div",{className:`flex flex-col ${f?"h-full":""}`,children:[O&&e.jsx("div",{className:"p-3 bg-primary-500/10 border-b border-primary-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-white",children:V}),e.jsx("p",{className:"text-sm text-primary-400",children:"Aggiungi al conto"})]}),e.jsx("div",{className:"px-3 py-1 bg-primary-500/20 rounded-lg",children:e.jsx("span",{className:"text-sm font-medium text-primary-400",children:"Conto Aperto"})})]})}),!O&&e.jsxs("div",{className:"p-3 border-b border-dark-700",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>q("dine_in"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${g==="dine_in"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(ke,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Tavolo"})]}),e.jsxs("button",{onClick:()=>q("takeaway"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${g==="takeaway"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Ve,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Asporto"})]}),e.jsxs("button",{onClick:()=>q("delivery"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${g==="delivery"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(As,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Domicilio"})]})]}),g==="dine_in"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-dark-400 mb-2",children:"Seleziona tavolo:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(a=>e.jsx("button",{onClick:()=>M?M(a.id):$(a.id),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${re===a.id?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:a.name},a.id))})]}),(g==="takeaway"||g==="delivery")&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Nome cliente",value:ne,onChange:a=>G(a.target.value),className:"input py-2.5 text-base"}),e.jsx("input",{type:"tel",placeholder:"Telefono",value:le,onChange:a=>Q(a.target.value),className:"input py-2.5 text-base"})]})]}),e.jsxs("div",{className:"px-3 py-2 bg-dark-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary-400"}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[k," articoli"]})]}),N.length>0&&e.jsx("button",{onClick:F,className:"text-xs text-red-400 hover:text-red-300 transition-colors px-2 py-1",children:"Svuota"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 min-h-[150px]",children:N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-dark-400 py-8",children:[e.jsx(ae,{className:"w-12 h-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Carrello vuoto"}),e.jsx("p",{className:"text-xs mt-1",children:"Tocca un prodotto per aggiungerlo"})]}):e.jsx("div",{className:"space-y-2",children:N.map(a=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white text-sm truncate",children:a.name}),e.jsxs("p",{className:"text-xs text-primary-400 mt-0.5",children:["â‚¬",a.price.toFixed(2)," Ã— ",a.quantity," = â‚¬",(a.price*a.quantity).toFixed(2)]}),a.notes&&j!==a.id&&e.jsxs("p",{className:"text-xs text-amber-400 mt-1 truncate",children:["ðŸ“ ",a.notes]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>P(j===a.id?null:a.id),className:`w-9 h-9 rounded-lg flex items-center justify-center transition-colors ${j===a.id||a.notes?"bg-amber-500/20 text-amber-400":"bg-dark-700 text-dark-400 hover:bg-dark-600"}`,children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(a.id,-1),className:"w-9 h-9 rounded-lg bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors",children:e.jsx(we,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center text-base font-semibold",children:a.quantity}),e.jsx("button",{onClick:()=>S(a.id,1),className:"w-9 h-9 rounded-lg bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors",children:e.jsx(is,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(a.id),className:"w-9 h-9 ml-1 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors flex items-center justify-center",children:e.jsx(os,{className:"w-4 h-4"})})]})]}),j===a.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-xs text-amber-400 font-medium",children:"Note / Variazioni"})]}),e.jsx("input",{type:"text",value:a.notes||"",onChange:m=>_(a.id,m.target.value),placeholder:"Es: senza cipolla, piccante...",className:"w-full bg-dark-800 border border-dark-600 rounded-lg px-3 py-2 text-sm text-white placeholder-dark-500 focus:outline-none focus:border-amber-500"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:["Senza cipolla","Piccante","Extra salsa","Ben cotto"].map(m=>e.jsxs("button",{onClick:()=>{const T=a.notes||"",ie=T?`${T}, ${m}`:m;_(a.id,ie)},className:"px-2.5 py-1 text-xs bg-dark-700 text-dark-300 rounded-lg hover:bg-dark-600 transition-colors",children:["+ ",m]},m))})]})]},a.id))})}),N.length>0&&e.jsxs("div",{className:"border-t border-dark-700 bg-dark-800",children:[e.jsx("div",{className:"px-3 py-2 border-b border-dark-700",children:e.jsx("input",{type:"text",placeholder:"Note ordine (opzionale)...",value:x,onChange:a=>C(a.target.value),className:"input py-2.5 text-base"})}),!O&&e.jsxs("div",{className:"px-3 py-3 flex items-center gap-2 border-b border-dark-700",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs("button",{onClick:()=>v("cash"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${p==="cash"?"bg-emerald-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(ws,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>v("card"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${p==="card"?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(cs,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Carta"})]}),e.jsxs("button",{onClick:()=>v("online"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${p==="online"?"bg-purple-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Cs,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Online"})]})]}),E&&e.jsxs("button",{onClick:()=>y(!d),className:`flex items-center gap-1.5 px-4 py-2 rounded-xl transition-all ${d?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[d&&e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"SMAC"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-1",children:O?e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white",children:[e.jsx("span",{children:"Totale Comanda"}),e.jsxs("span",{className:"text-primary-400",children:["â‚¬",z.toFixed(2)]})]}):b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white",children:[e.jsx("span",{children:"Totale"}),e.jsxs("span",{className:"text-primary-400",children:["â‚¬",w.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-dark-500",children:[e.jsxs("span",{children:["di cui IVA (",X,"%)"]}),e.jsxs("span",{children:["â‚¬",H.toFixed(2)]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-dark-400",children:[e.jsx("span",{children:"Subtotale"}),e.jsxs("span",{children:["â‚¬",z.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-dark-400",children:[e.jsxs("span",{children:["+ IVA (",X,"%)"]}),e.jsxs("span",{children:["â‚¬",H.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white pt-2",children:[e.jsx("span",{children:"Totale"}),e.jsxs("span",{className:"text-primary-400",children:["â‚¬",w.toFixed(2)]})]})]})}),e.jsx("div",{className:"p-3 pt-0 pb-safe",children:e.jsx("button",{onClick:D,disabled:N.length===0||J,className:"btn-primary w-full py-4 text-base font-semibold",children:J?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-dark-900"}):O?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5"}),"Invia Comanda - â‚¬",z.toFixed(2)]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5"}),"Conferma Ordine - â‚¬",w.toFixed(2)]})})})]}),N.length===0&&e.jsx("div",{className:"p-3 border-t border-dark-700 pb-safe",children:e.jsxs("button",{disabled:!0,className:"btn-primary w-full py-4 opacity-50 cursor-not-allowed text-base",children:[e.jsx(ae,{className:"w-5 h-5"}),"Aggiungi prodotti"]})})]})}function Rs(){ds();const{formatPrice:f}=Ss(),{smacEnabled:g}=xs(),{checkCanWrite:q}=_s(),{user:re}=ms(),$=us(),[M]=ps(),[Y,ne]=n.useState([]),[G,le]=n.useState([]),[Q,N]=n.useState([]),[k,z]=n.useState(null),[X,H]=n.useState(!0),[b,w]=n.useState(null),[j,P]=n.useState(null),[x,C]=n.useState([]),[p,v]=n.useState("dine_in"),[d,y]=n.useState(null),[E,J]=n.useState("cash"),[F,S]=n.useState(""),[I,_]=n.useState(""),[D,O]=n.useState(""),[V,a]=n.useState(!1),[m,T]=n.useState(!1),[ie,Ce]=n.useState(null),[Be,oe]=n.useState(!1),[Re,K]=n.useState(!1),[o,ce]=n.useState(null),[de,xe]=n.useState([]),[Z,me]=n.useState(null),[Ue,ee]=n.useState(!1),[B,ue]=n.useState(null),[c,se]=n.useState({covers:"2",customer_name:"",customer_phone:""}),[pe,Se]=n.useState(!1),he=M.get("session"),fe=M.get("table");n.useEffect(()=>{Le()},[he,fe]);async function Le(){try{const[s,t,l,r]=await Promise.all([hs(),fs(),bs(),qe()]);if(ne(s),le(t),N(l),z(r),Se((r?.cover_charge||0)>0),s.length>0&&P(s[0].id),he){const L=parseInt(he),i=await $e(L);i&&(w(i),y(i.table_id),v("dine_in"),i.customer_name&&S(i.customer_name),i.customer_phone&&_(i.customer_phone))}else fe&&(y(parseInt(fe)),v("dine_in"))}catch(s){console.error("Error loading data:",s),u("Errore nel caricamento dati","error")}finally{H(!1)}}const _e=j?G.filter(s=>s.category_id===j&&s.available):G.filter(s=>s.available),A=x.reduce((s,t)=>s+t.price*t.quantity,0),R=x.reduce((s,t)=>s+t.quantity,0),be=k?.iva_rate||17,je=k?.iva_included!==!1,Oe=je?A-A/(1+be/100):A*(be/100),U=je?A:A+Oe;function Te(s){C(t=>t.find(r=>r.id===s.id)?t.map(r=>r.id===s.id?{...r,quantity:r.quantity+1}:r):[...t,{...s,quantity:1}]),u(`${s.name} aggiunto`,"success")}function ge(s,t){C(l=>l.map(r=>r.id===s?{...r,quantity:Math.max(0,r.quantity+t)}:r).filter(r=>r.quantity>0))}function We(s){C(t=>t.filter(l=>l.id!==s))}function Ye(s,t){C(l=>l.map(r=>r.id===s?{...r,notes:t}:r))}function Ge(){C([]),Ce(null)}async function Qe(s){if(b)return;const t=await Ns(s);if(t){const l=await ze(t.id);ce(t),xe(l),me(s),K(!0)}else y(s),w(null)}async function Xe(){!o||!Z||(w(o),y(Z),v("dine_in"),o.customer_name&&S(o.customer_name),o.customer_phone&&_(o.customer_phone),K(!1),ce(null),xe([]),me(null),u("Comanda associata al conto aperto","success"))}function He(){Z&&y(Z),K(!1),ce(null),xe([]),me(null)}async function Je(){if(q()){if(x.length===0){u("Aggiungi almeno un prodotto","warning");return}if(p==="dine_in"&&!d&&!b){u("Seleziona un tavolo","warning");return}if(p==="dine_in"&&d&&!b){const s={date:new Date().toISOString().split("T")[0],total:U,payment_method:E,order_type:p,table_id:d,notes:D||void 0,status:"pending",smac_passed:V,customer_name:F||void 0,customer_phone:I||void 0},t=x.map(r=>({menu_item_id:r.id,quantity:r.quantity,price:r.price,notes:r.notes})),l=Q.find(r=>r.id===d)?.name||`Tavolo ${d}`;se({covers:"2",customer_name:F||"",customer_phone:I||""}),ue({order:s,items:t,tableId:d,tableName:l}),ee(!0);return}await Ne()}}async function Ne(s,t,l){T(!0);try{const r=x.map(h=>({menu_item_id:h.id,quantity:h.quantity,price:h.price,notes:h.notes})),L=b||s,i=b?.id||t;let W;i&&(W=await ys(i));const es={date:new Date().toISOString().split("T")[0],total:L?A:U,payment_method:L?"cash":E,order_type:p,table_id:p==="dine_in"?d??void 0:void 0,notes:D||void 0,status:"pending",smac_passed:L?!1:V,customer_name:F||void 0,customer_phone:I||void 0,session_id:i,order_number:W,created_by:re?.name};if(await ks(es,r),i){let h=l;if(h===void 0)try{const[ve,ts]=await Promise.all([$e(i),qe()]),Fe=ve?.covers||0,Ie=ts.cover_charge||0,as=(await ze(i)).reduce((rs,ns)=>rs+ns.total,0)+Ie*Fe;h=Math.abs((ve?.total||0)-as)<.01&&Ie>0&&Fe>0}catch{h=!1}await Pe(i,h===void 0?!0:h);const ss=W&&W>1?`Comanda ${W} inviata!`:"Prima comanda inviata!";u(ss,"success"),$("/tables")}else t?(await Pe(t,l===void 0?pe:l),u("Ordine creato e conto aperto!","success"),$("/tables")):(u("Ordine creato con successo!","success"),$("/orders"))}catch(r){console.error("Error creating order:",r),u("Errore nella creazione dell'ordine","error")}finally{T(!1)}}async function Ke(){if(!B)return;const s=parseInt(c.covers)||1;if(s<1){u("Inserisci almeno 1 coperto","warning");return}T(!0);try{const t=await vs(B.tableId,s,c.customer_name||void 0,c.customer_phone||void 0);c.customer_name&&S(c.customer_name),c.customer_phone&&_(c.customer_phone),ee(!1),ue(null),await Ne(!0,t.id,pe)}catch(t){console.error("Error creating session:",t),u("Errore nell'apertura del conto","error"),T(!1)}}async function Ze(){B&&(ee(!1),ue(null),await Ne(!1))}if(X)return e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});const te=!!b,Ae={orderType:p,setOrderType:te?()=>{}:v,selectedTable:d,setSelectedTable:te?()=>{}:y,onTableSelect:te?void 0:Qe,tables:Q,customerName:F,setCustomerName:S,customerPhone:I,setCustomerPhone:_,cart:x,cartItemsCount:R,cartTotal:A,ivaRate:be,ivaAmount:Oe,ivaIncluded:je,grandTotal:U,expandedItemId:ie,setExpandedItemId:Ce,notes:D,setNotes:O,paymentMethod:E,setPaymentMethod:J,smacPassed:V,setSmacPassed:a,smacEnabled:g,isSubmitting:m,clearCart:Ge,updateQuantity:ge,removeFromCart:We,updateItemNotes:Ye,submitOrder:Je,isSessionOrder:te,sessionTableName:b?.table_name};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:flex gap-4 h-[calc(100vh-100px)]",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:Y.map(s=>e.jsx("button",{onClick:()=>P(s.id),className:`px-6 py-3 rounded-xl font-medium whitespace-nowrap transition-all ${j===s.id?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:s.name},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto pt-1",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 pt-2",children:_e.map(s=>{const t=x.find(l=>l.id===s.id);return e.jsxs("button",{onClick:()=>Te(s),className:"menu-item-card text-left relative overflow-visible",children:[t&&e.jsx("div",{className:"absolute -top-2.5 -right-2.5 w-7 h-7 bg-primary-500 rounded-full flex items-center justify-center text-sm font-bold text-dark-900 z-20 shadow-lg",children:t.quantity}),e.jsx("h3",{className:"font-semibold text-white mb-1 line-clamp-2",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-400 mb-2 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xl font-bold text-primary-400",children:f(s.price)}),t&&e.jsx("div",{onClick:l=>{l.stopPropagation(),ge(s.id,-1)},className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-red-500/20 flex items-center justify-center transition-colors cursor-pointer",children:e.jsx(we,{className:"w-4 h-4 text-red-400"})})]})]},s.id)})})})]}),e.jsx("div",{className:"w-[420px] flex flex-col bg-dark-800 rounded-2xl border border-dark-700",children:e.jsx(De,{...Ae})})]}),e.jsxs("div",{className:"lg:hidden flex flex-col h-[calc(100vh-120px)]",children:[e.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-2 -mx-3 px-3",children:Y.map(s=>e.jsx("button",{onClick:()=>P(s.id),className:`px-4 py-2.5 rounded-xl font-medium whitespace-nowrap transition-all text-sm ${j===s.id?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300"}`,children:s.name},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto -mx-3 px-3 pb-24 pt-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 pt-1",children:_e.map(s=>{const t=x.find(l=>l.id===s.id);return e.jsxs("button",{onClick:()=>Te(s),className:"relative bg-dark-800 rounded-xl p-3 text-left border border-dark-700 active:scale-[0.98] transition-transform overflow-visible",children:[t&&e.jsx("div",{className:"absolute -top-2.5 -right-2.5 w-6 h-6 bg-primary-500 rounded-full flex items-center justify-center text-xs font-bold text-dark-900 z-20 shadow-lg",children:t.quantity}),e.jsx("h3",{className:"font-semibold text-white text-sm line-clamp-2 mb-1",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("p",{className:"text-lg font-bold text-primary-400",children:f(s.price)}),t&&e.jsx("div",{onClick:l=>{l.stopPropagation(),ge(s.id,-1)},className:"w-7 h-7 rounded-lg bg-dark-700 active:bg-red-500/30 flex items-center justify-center transition-colors",children:e.jsx(we,{className:"w-3.5 h-3.5 text-red-400"})})]})]},s.id)})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-dark-900 border-t border-dark-700 lg:hidden z-30 safe-bottom",children:e.jsxs("button",{onClick:()=>oe(!0),className:"w-full flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"w-6 h-6 text-primary-400"}),R>0&&e.jsx("span",{className:"absolute -top-2 -right-2 w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center text-xs font-bold text-dark-900",children:R})]}),e.jsx("span",{className:"text-white font-medium",children:x.length===0?"Carrello vuoto":`${R} articoli`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-primary-400",children:f(U)}),e.jsx(Os,{className:"w-5 h-5 text-dark-400"})]})]})}),Be&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>oe(!1)}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-dark-800 rounded-t-3xl max-h-[90vh] flex flex-col animate-slide-up",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-12 h-1.5 bg-dark-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-700",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Il tuo ordine"}),e.jsx("button",{onClick:()=>oe(!1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(js,{className:"w-6 h-6 text-dark-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(De,{...Ae,isMobile:!0})})]})]})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
        .safe-bottom {
          padding-bottom: env(safe-area-inset-bottom, 0);
        }
        .pb-safe {
          padding-bottom: env(safe-area-inset-bottom, 12px);
        }
      `}),e.jsx(Me,{isOpen:Re,onClose:()=>K(!1),title:"Conto Aperto Rilevato",size:"md",children:o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:[e.jsx(gs,{className:"w-6 h-6 text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-400",children:"Questo tavolo ha giÃ  un conto aperto"}),e.jsx("p",{className:"text-sm text-dark-300 mt-1",children:"Vuoi aggiungere la comanda al conto esistente?"})]})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:o.table_name||`Tavolo ${o.table_id}`}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-dark-400",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Coperti"})]}),e.jsx("p",{className:"text-lg font-bold text-white",children:o.covers})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-dark-400",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Comande"})]}),e.jsx("p",{className:"text-lg font-bold text-white",children:de.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-lg font-bold text-primary-400",children:f(o.total)})]})]}),o.customer_name&&e.jsxs("p",{className:"mt-3 text-sm text-dark-400",children:["Cliente: ",e.jsx("span",{className:"text-white",children:o.customer_name})]}),de.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"text-sm text-dark-400 mb-2",children:"Comande esistenti:"}),e.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:de.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-300",children:["Comanda #",s.order_number||1]}),e.jsx("span",{className:"text-white",children:f(s.total)})]},s.id))})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:Xe,className:"btn-primary w-full py-3",children:"SÃ¬, aggiungi al conto"}),e.jsx("button",{onClick:He,className:"btn-secondary w-full",children:"No, crea ordine separato"})]})]})}),e.jsx(Me,{isOpen:Ue,onClose:()=>ee(!1),title:"Aprire un Conto?",size:"md",children:B&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary-500/10 border border-primary-500/30 rounded-xl",children:[e.jsx(ke,{className:"w-6 h-6 text-primary-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-primary-400",children:["Stai creando un ordine per ",B.tableName]}),e.jsx("p",{className:"text-sm text-dark-300 mt-1",children:"Vuoi aprire un conto per questo tavolo? CosÃ¬ potrai aggiungere altre comande in seguito."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Numero Coperti *"}),e.jsx("input",{type:"number",min:"1",value:c.covers,onChange:s=>se({...c,covers:s.target.value}),className:"input w-full",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Nome Cliente (opzionale)"}),e.jsx("input",{type:"text",value:c.customer_name,onChange:s=>se({...c,customer_name:s.target.value}),className:"input w-full",placeholder:"Es. Mario Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Telefono (opzionale)"}),e.jsx("input",{type:"tel",value:c.customer_phone,onChange:s=>se({...c,customer_phone:s.target.value}),className:"input w-full",placeholder:"Es. 333 1234567"})]}),k&&(k.cover_charge||0)>0&&e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("input",{id:"open_session_apply_cover",type:"checkbox",checked:pe,onChange:s=>Se(s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"open_session_apply_cover",className:"text-white text-sm",children:["Applica coperto (",f(k.cover_charge)," / ospite)"]})]})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-white mb-2",children:"Riepilogo Ordine"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-dark-400",children:[R," articoli"]}),e.jsx("span",{className:"text-xl font-bold text-primary-400",children:f(U)})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:Ke,disabled:m,className:"btn-primary w-full py-3",children:m?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-dark-900 mx-auto"}):"Apri Conto e Invia Ordine"}),e.jsx("button",{onClick:Ze,disabled:m,className:"btn-secondary w-full",children:"No, solo ordine singolo (senza conto)"})]})]})})]})}export{Rs as NewOrder};
