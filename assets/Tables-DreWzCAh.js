import{l as ca,k as da,i as ma,r as l,p as xa,ai as pa,t as o,aj as Je,j as e,P as ha,U as ee,J as ge,e as ua,ak as Ke,K as ga,X as Xe,M as y,f as se,O as ae,N as Ye,B as je,s as He,a3 as te,al as ja,am as ba,an as fa,ao as Na,ap as va,aq as ya,y as wa,a1 as be,q as Ze,a2 as fe,a4 as Ne,x as es,Y as ss,ar as ka,ab as Ca,aa as Sa}from"./index-BOmTwSxR.js";import{u as _a}from"./useCurrency-BZHudE-G.js";import{S as Pa,a as Ta,b as Fa,L as as}from"./SessionDetailsModal-BzGHk9AA.js";import{u as Ma}from"./useDemoGuard-CWj-SCB-.js";import{C as ve}from"./calendar-Bxd2WWco.js";import{L}from"./link-2-DzymNKie.js";import{C as ts}from"./clock-Ch2J9szw.js";import{M as za}from"./message-square-BvmSjEn-.js";import{B as U}from"./banknote-C0mb3cUR.js";import{G as ye}from"./globe-BJcdJQ99.js";import{P as rs}from"./printer-C1yU0Wy7.js";import{F as Ea}from"./file-text-BpGPHAw5.js";function Wa(){const{formatPrice:we}=_a(),ns=ca(),{isDemo:ls}=Ma(),{user:ke}=da(),{smacEnabled:F}=ma(),[M,is]=l.useState([]),[re,os]=l.useState([]),[ne,cs]=l.useState([]),[ds,Ce]=l.useState(!0),[ms,V]=l.useState(!1),[xs,S]=l.useState(!1),[ps,z]=l.useState(!1),[hs,W]=l.useState(!1),[n,Se]=l.useState(null),[us,gs]=l.useState([]),[R,le]=l.useState([]),[p,J]=l.useState(0),[w,ie]=l.useState([]),[js,bs]=l.useState(0),[_e,fs]=l.useState(0),[Pe,Te]=l.useState(!1),[E,A]=l.useState("manual"),[h,f]=l.useState({paymentMethod:"cash",amount:"",change:0,notes:"",smac:!1}),[g,C]=l.useState({paymentMethod:"cash",amount:"",change:0,customerGives:"",showChange:!1}),[Fe,Ns]=l.useState(0),[vs,Me]=l.useState(!1),[ze,Ee]=l.useState([]),[_,K]=l.useState({name:"",capacity:1}),[i,N]=l.useState({customer_name:"",phone:"",date:"",time:"",guests:1,notes:"",table_ids:[]}),[X]=l.useState(null),[O,oe]=l.useState(null),[Ae,ys]=l.useState(null),[k,$]=l.useState({covers:"2",customer_name:"",customer_phone:""}),[b,D]=l.useState({method:"cash",smac:!1}),[Re]=l.useState(null),[Oe,ws]=l.useState(!1),[ks,$e]=l.useState(!1),[Cs,G]=l.useState(!1),[Ss,Y]=l.useState(!1),[_s,ce]=l.useState(!1),[Ps,de]=l.useState(!1),[m,Ts]=l.useState(null),[De,Ge]=l.useState([]),[P,I]=l.useState({}),[j,me]=l.useState({totalPeople:"",payingPeople:""}),[T,Fs]=l.useState(new Date().toISOString().split("T")[0]),[Ms,H]=l.useState(!1),[zs,xe]=l.useState(!1),[x,Es]=l.useState(null);l.useEffect(()=>{v()},[T]);const Q=()=>!ls||ke&&ke.role==="admin",v=async()=>{try{const[s,a]=await Promise.all([xa(),pa(T)]);is(s),os(a),Ce(!1)}catch(s){console.error("Error loading data:",s),o("Errore nel caricamento dati","error"),Ce(!1)}};l.useEffect(()=>{(async()=>{try{const s=await Je();cs(s||[])}catch(s){console.error("Error loading active sessions",s)}})()},[]);function pe(s){return re.find(a=>(a.table_ids||[a.table_id]).includes(s))||null}function q(s){return ne.find(r=>r.table_id===s&&r.status==="open")?"occupied":pe(s)?"reserved":"available"}function As(s){s&&N({...i,table_ids:[s],date:T}),S(!0)}function Ie(s){K(s?{name:s.name,capacity:s.capacity}:{name:"",capacity:1}),H(!0)}function Rs(){N({...i,date:T}),S(!0)}async function Os(s){try{await ja(s),await v(),o("Tavolo eliminato","success")}catch(a){console.error(a),o("Errore eliminazione tavolo","error")}}function $s(s){const a=i.table_ids||[];a.includes(s)?N({...i,table_ids:a.filter(t=>t!==s)}):N({...i,table_ids:[...a,s]})}async function Ds(){try{X?(await fa(X.id,_),o("Tavolo aggiornato","success")):(await Na({name:_.name,capacity:_.capacity}),o("Tavolo creato","success")),H(!1),await v()}catch(s){console.error(s),o("Errore salvataggio tavolo","error")}}async function Gs(){try{const s={table_ids:i.table_ids,table_id:i.table_ids&&i.table_ids.length>0?i.table_ids[0]:0,date:i.date,time:i.time,customer_name:i.customer_name,phone:i.phone,guests:i.guests,notes:i.notes,status:"confirmed"};await ya(s),S(!1),await v(),o("Prenotazione creata","success")}catch(s){console.error(s),o("Errore creazione prenotazione","error")}}async function Is(){try{if(!O)return;await va(O.id,i),S(!1),await v(),o("Prenotazione aggiornata","success")}catch(s){console.error(s),o("Errore aggiornamento prenotazione","error")}}function Qs(s){Es(s),xe(!0)}function Qe(s){oe(s),N({customer_name:s.customer_name||"",phone:s.phone||"",date:s.date||T,time:s.time||"",guests:s.guests||1,notes:s.notes||"",table_ids:s.table_ids||(s.table_id?[s.table_id]:[])}),S(!0)}async function qe(s){try{await ba(s),await v(),o("Prenotazione cancellata","success")}catch(a){console.error(a),o("Errore cancellazione prenotazione","error")}}const qs=async s=>{try{await je(s.id);const[a,t,r]=await Promise.all([es(s.id),fe(s.id),te(s.id)]),d=(await Je()).find(u=>u.id===s.id);Se(d||s),gs(a),le(t),J(r),z(!0)}catch(a){console.error("Error loading session details:",a),o("Errore nel caricamento dettagli","error")}};function Bs(){try{const s=i.table_ids||[];return M.filter(a=>s.includes(a.id)).reduce((a,t)=>a+(t.capacity||0),0)}catch{return 0}}async function Ls(){if(Q()&&Ae)try{const s=await wa(Ae,parseInt(k.covers)||1,k.customer_name||void 0,k.customer_phone||void 0);if(Oe&&s&&s.id)try{await je(s.id,!0)}catch(a){console.error("Error applying cover on new session:",a)}o("Conto aperto","success"),V(!1),v()}catch(s){console.error("Error opening session:",s),o("Errore nell'apertura conto","error")}}function Us(){n&&ns(`/orders/new?table=${n.table_id}&session=${n.id}`)}async function Vs(){if(!Q()||!n)return;if((n?.total??0)===0){if(window.confirm("Vuoi chiudere questo conto a €0.00?"))try{await be(n.id,"cash",!1,!1),o("Conto chiuso","success"),z(!1),v()}catch(r){console.error("Error closing session:",r),o("Errore nella chiusura","error")}return}const a=(await Ze()).cover_charge||0;if(a>0&&(n?.covers??0)>0){const t=a*(n?.covers??0);Ns(t);const r=!!Pe;Me(r),Z(r)}else Z(!1)}function Z(s){Me(s),$e(!1),D({method:"cash",smac:!1}),C(a=>({...a,customerGives:"",showChange:!1})),G(!0)}async function Be(){if(Q()&&n)try{await be(n.id,b.method,b.smac,vs),o("Conto chiuso","success"),G(!1),z(!1),v()}catch(s){console.error("Error closing session:",s),o("Errore nella chiusura","error")}}function Ws(){n&&Y(!0)}async function Js(s){if(Q()&&n)try{await ka(n.id,s),o("Tavolo trasferito","success"),Y(!1),z(!1),v()}catch(a){console.error("Error transferring table:",a),o("Errore nel trasferimento","error")}}async function Ks(){if(n){f(s=>({...s,amount:"",method:"cash",notes:"",smac:!1})),A("manual"),I({}),me({totalPeople:(n?.covers??0).toString(),payingPeople:""}),C(s=>({...s,customerGives:"",showChange:!1}));try{const s=[];for(const r of us)(await ss(r.id)).forEach(d=>{s.push({...d,order_number:r.order_number||1})});Ge(s);const a=await Ne(n.id),t=s.map(r=>({...r,remainingQty:r.quantity-(a[r.id]||0)})).filter(r=>r.remainingQty>0);ie(t)}catch(s){console.error("Error loading items:",s)}W(!0)}}function Xs(){const s=parseFloat(g.customerGives)||0,a=parseFloat(h.amount)||0;return Math.max(0,s-a)}function Le(){if(!n)return 0;const s=parseInt(j.totalPeople)||1,a=parseInt(j.payingPeople)||1,t=p/s;return Math.min(t*a,p)}function he(){return Object.entries(P).reduce((s,[a,t])=>{const r=w.find(c=>c.id===Number(a));return r&&t>0?s+r.price*t:s},0)}function Ys(s){const a=w.find(t=>t.id===s);a&&I(t=>{const r=t[s]||0;return r<a.remainingQty?{...t,[s]:r+1}:t})}function Hs(s){I(a=>{const t=a[s]||0;if(t>0){const r=t-1;if(r===0){const{[s]:c,...d}=a;return d}return{...a,[s]:r}}return a})}function Zs(s){const a=w.find(t=>t.id===s);a&&I(t=>{if((t[s]||0)===a.remainingQty){const{[s]:c,...d}=t;return d}else return{...t,[s]:a.remainingQty}})}function ea(){const s=Le();s>0&&(f(a=>({...a,amount:s.toFixed(2),notes:`Alla romana (${j.payingPeople}/${j.totalPeople} persone)`})),A("manual"))}function sa(){const s=he();if(s>0&&s<=p){const a=Object.entries(P).map(([r,c])=>{const d=w.find(u=>u.id===Number(r));return d?`${c}x ${d.menu_item_name}`:""}).filter(Boolean).join(", "),t=Object.entries(P).map(([r,c])=>{const d=w.find(u=>u.id===Number(r));return d?{order_item_id:d.id,quantity:c,menu_item_name:d.menu_item_name,price:d.price}:null}).filter(r=>r!==null);Ee(t),f(r=>({...r,amount:Math.min(s,p).toFixed(2),notes:a.length>40?a.substring(0,40)+"...":a})),A("manual"),I({})}}async function aa(){if(!Q())return;if(!n){o("Sessione non trovata","error");return}const s=parseFloat(h.amount);if(isNaN(s)||s<=0){o("Inserisci un importo valido","warning");return}if(s>p+.01){o("Importo superiore al rimanente","warning");return}try{await Ca(n.id,s,h.method??"cash",h.notes||void 0,h.smac,ze.length>0?ze:void 0);const[a,t,r]=await Promise.all([fe(n.id),te(n.id),Ne(n.id)]);le(a),J(t);const c=De.map(d=>({...d,remainingQty:d.quantity-(r[d.id]||0)})).filter(d=>d.remainingQty>0);if(ie(c),f(d=>({...d,amount:"",method:"cash",notes:"",smac:!1})),Ee([]),o("Pagamento aggiunto","success"),t<=.01)try{await be(n.id,"split",!1),o("Conto saldato e chiuso","success"),W(!1),z(!1),v()}catch(d){console.error("Error closing session:",d),o("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(a){console.error("Error adding payment:",a),o("Errore nell'aggiunta pagamento","error")}}async function ta(){if(n)try{const[s,a,t]=await Promise.all([fe(n.id),te(n.id),Ne(n.id)]),r=await es(n.id),c=[];for(const u of r)(await ss(u.id)).forEach(B=>{c.push({...B,order_number:u.order_number||1})});const d=c.map(u=>({...u,remainingQty:u.quantity-(t[u.id]||0)})).filter(u=>u.remainingQty>0);try{const u=await He(n.id),Ve=await Ze(),B=u?.covers||0,ue=Ve.cover_charge||0,We=r.reduce((ia,oa)=>ia+oa.total,0)+ue*B,la=Math.abs((u?.total||0)-We)<.01||(u?.total||0)>=We-.01;bs(B),fs(ue),Te(la&&ue>0&&B>0)}catch(u){console.error("Error loading session info for bill status modal (tables):",u)}Ge(c),le(s),J(a),ie(d),ce(!0)}catch(s){console.error("Error loading bill status (tables):",s),o("Errore nel caricamento stato conto","error")}}async function ra(s){try{const a=await Sa(s);a&&(Ts(a),de(!0))}catch(a){console.error("Error generating receipt:",a),o("Errore nella generazione scontrino","error")}}function na(){if(!m)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${m?.shop_info?.name??""}</div>
            ${m?.shop_info?.address?`<div>${m.shop_info.address}</div>`:""}
            ${m?.shop_info?.phone?`<div>Tel: ${m.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${m?.date??""} ${m?.time??""}</div>
          <div class="divider"></div>
          ${(m?.items||[]).map(t=>`
            <div class="item">
              <span>${t.quantity}x ${t.name}</span>
              <span>€${t.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>€${(m?.total??0).toFixed(2)}</span>
          </div>
          <div>Pagamento: ${m?.payment_method==="cash"?"Contanti":m?.payment_method==="card"?"Carta":"Online"}</div>
          ${F&&m?.smac_passed?"<div>SMAC: Sì</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,a=window.open("","_blank");a&&(a.document.write(s),a.document.close(),a.print())}if(ds)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});const Ue=s=>{const a=q(s),t=ne.find(c=>c.table_id===s)||null,r=pe(s);a==="occupied"?t&&qs(t):(a==="available"||a==="reserved")&&(ys(s),$(r?{covers:r.guests?.toString()||"2",customer_name:r.customer_name||"",customer_phone:r.phone||""}:{covers:"2",customer_name:"",customer_phone:""}),V(!0))};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Tavoli e Prenotazioni"}),e.jsx("p",{className:"text-dark-400 mt-1 text-sm sm:text-base",children:"Gestisci tavoli e prenotazioni"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>Rs(),className:"btn-secondary flex-1 sm:flex-none",children:[e.jsx(ve,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Prenotazione"})]}),e.jsxs("button",{onClick:()=>Ie(),className:"btn-primary flex-1 sm:flex-none",children:[e.jsx(ha,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Tavolo"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(ve,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"}),e.jsx("input",{type:"date",value:T,onChange:s=>Fs(s.target.value),className:"input w-auto text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-emerald-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Disponibile"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Occupato"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-amber-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Prenotato"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-2 sm:gap-4",children:M.map(s=>{const a=q(s.id),t=ne.find(c=>c.table_id===s.id),r=pe(s.id);return e.jsxs("div",{onClick:()=>Ue(s.id),className:`
                group relative
                ${a==="available"?"table-available cursor-pointer hover:scale-105":""}
                ${a==="occupied"?"table-occupied cursor-pointer hover:scale-105":""}
                ${a==="reserved"?"table-reserved cursor-pointer hover:scale-105":""}
                p-3 sm:p-4 transition-transform
              `,children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ee,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:s.capacity})]}),t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),t.covers," coperti"]}),e.jsxs("p",{className:"font-semibold text-base sm:text-lg",children:["€",t.total.toFixed(2)]}),t.customer_name&&e.jsx("p",{className:"truncate",children:t.customer_name})]}),r&&!t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs",children:[e.jsx("p",{className:"truncate",children:r.customer_name}),e.jsx("p",{children:r.time}),r.table_ids&&r.table_ids.length>1&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-amber-400",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsxs("span",{children:[r.table_ids.length," tavoli"]})]})]}),a==="available"&&e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-1",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),Ue(s.id)},className:"text-[10px] sm:text-xs font-medium text-emerald-400 hover:text-emerald-300",children:"Apri Conto"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),As(s.id)},className:"block text-[10px] sm:text-xs underline hover:no-underline",children:"Prenota"})]}),e.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),Ie(s)},className:"p-1 bg-dark-800 rounded hover:bg-dark-700",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),Os(s.id)},className:"p-1 bg-dark-800 rounded hover:bg-red-500/20",children:e.jsx(ua,{className:"w-3 h-3"})})]})]},s.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white text-sm sm:text-base",children:["Prenotazioni per ",new Date(T).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"})]})}),e.jsx("div",{className:"card-body",children:re.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4 text-sm",children:"Nessuna prenotazione per questa data"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:re.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 bg-dark-900 rounded-xl gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ts,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm sm:text-base truncate",children:s.customer_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 sm:gap-x-3 gap-y-0.5 text-xs sm:text-sm text-dark-400",children:[e.jsx("span",{children:s.time}),e.jsxs("span",{className:"flex items-center gap-1",children:[s.table_ids&&s.table_ids.length>1&&e.jsx(L,{className:"w-3 h-3 text-primary-400"}),s.table_name]}),e.jsxs("span",{children:[s.guests," ospiti"]})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-dark-400",children:[e.jsx(Ke,{className:"w-3 h-3"}),s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:`badge text-xs ${s.status==="confirmed"?"badge-success":"badge-danger"}`,children:s.status==="confirmed"?"Confermata":"Annullata"}),e.jsx("button",{onClick:()=>Qs(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Visualizza dettagli",children:e.jsx(ga,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),e.jsx("button",{onClick:()=>Qe(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Modifica",children:e.jsx(ge,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),s.status==="confirmed"&&e.jsx("button",{onClick:()=>qe(s.id),className:"p-1.5 sm:p-2 hover:bg-red-500/20 rounded-lg transition-colors",title:"Annulla",children:e.jsx(Xe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-400"})})]})]},s.id))})})]}),e.jsx(y,{isOpen:Ms,onClose:()=>H(!1),title:X?"Modifica Tavolo":"Nuovo Tavolo",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Tavolo"}),e.jsx("input",{type:"text",value:_.name,onChange:s=>K({..._,name:s.target.value}),className:"input",placeholder:"Es. Tavolo 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Capacità (posti)"}),e.jsx("input",{type:"number",min:"1",value:_.capacity,onChange:s=>K({..._,capacity:Number(s.target.value)}),className:"input"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Ds,className:"btn-primary flex-1",children:X?"Salva":"Crea"}),e.jsx("button",{onClick:()=>H(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(y,{isOpen:xs,onClose:()=>{S(!1),oe(null)},title:O?"Modifica Prenotazione":"Nuova Prenotazione",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:i.date,onChange:s=>N({...i,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ora"}),e.jsx("input",{type:"time",value:i.time,onChange:s=>N({...i,time:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>N({...i,phone:s.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ospiti"}),e.jsx("input",{type:"number",min:"1",value:i.guests,onChange:s=>N({...i,guests:Number(s.target.value)}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente *"}),e.jsx("input",{type:"text",value:i.customer_name,onChange:s=>N({...i,customer_name:s.target.value}),className:"input",placeholder:"Nome e cognome"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"label mb-0",children:[e.jsx(L,{className:"w-4 h-4 inline mr-1"}),"Tavoli"]}),e.jsxs("span",{className:"text-xs text-dark-400",children:["Capacità totale: ",e.jsx("span",{className:"text-primary-400 font-semibold",children:Bs()})," posti"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 max-h-32 overflow-y-auto p-2 bg-dark-900 rounded-xl",children:M.map(s=>{const a=i.table_ids.includes(s.id),r=q(s.id)==="available";return e.jsxs("button",{type:"button",onClick:()=>r&&$s(s.id),disabled:!r,className:`p-3 rounded-lg border-2 text-sm flex items-center gap-2 transition-all ${a?"border-primary-500 bg-primary-500/10 text-white":r?"border-dark-600 text-dark-300 hover:border-dark-500":"border-dark-700 text-dark-500 opacity-50 cursor-not-allowed"}`,children:[a?e.jsx(Pa,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(Ta,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:s.name}),e.jsxs("span",{className:"text-xs text-dark-400 flex-shrink-0",children:[s.capacity,"p"]})]},s.id)})}),i.table_ids.length>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-2 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),"Tavoli uniti: ",M.filter(s=>i.table_ids.includes(s.id)).map(s=>s.name).join(" + ")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:i.notes,onChange:s=>N({...i,notes:s.target.value}),className:"input resize-none h-16",placeholder:"Note aggiuntive..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:O?Is:Gs,className:"btn-primary flex-1",children:O?"Salva Modifiche":"Crea Prenotazione"}),e.jsx("button",{onClick:()=>{S(!1),oe(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(y,{isOpen:zs,onClose:()=>xe(!1),title:"Dettagli Prenotazione",size:"md",children:x&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:`badge text-lg px-4 py-2 ${x?.status==="confirmed"?"badge-success":x?.status==="cancelled"?"badge-danger":"badge-secondary"}`,children:x?.status==="confirmed"?"Confermata":x?.status==="cancelled"?"Annullata":"Completata"})}),e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-500/20 flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:x?.customer_name}),x?.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-dark-400",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${x?.phone}`,className:"hover:text-primary-400",children:x?.phone})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ve,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(x?.date??"").toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ts,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ora"}),e.jsx("p",{className:"font-semibold text-white",children:x?.time})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ee,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ospiti"}),e.jsxs("p",{className:"font-semibold text-white",children:[x?.guests," persone"]})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(L,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:(x?.table_ids?.length??0)>1?"Tavoli Uniti":"Tavolo"}),e.jsx("p",{className:"font-semibold text-white",children:x?.table_name}),(x?.table_ids?.length??0)>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-1",children:[x?.table_ids?.length??0," tavoli"]})]})]}),x?.notes&&e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(za,{className:"w-4 h-4 text-dark-400"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Note"})]}),e.jsx("p",{className:"text-white",children:x?.notes})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>x&&Qe(x),className:"btn-secondary flex-1",children:[e.jsx(ge,{className:"w-5 h-5"}),"Modifica"]}),x?.status==="confirmed"&&e.jsxs("button",{onClick:()=>{x&&(qe(x.id),xe(!1))},className:"btn-danger",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Annulla"]})]})]})}),e.jsx(y,{isOpen:ms,onClose:()=>V(!1),title:"Apri Conto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Numero Coperti"}),e.jsx("input",{type:"number",min:"1",value:k.covers,onChange:s=>$({...k,covers:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente (opzionale)"}),e.jsx("input",{type:"text",value:k.customer_name,onChange:s=>$({...k,customer_name:s.target.value}),className:"input",placeholder:"Es. Marco Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono (opzionale)"}),e.jsx("input",{type:"tel",value:k.customer_phone,onChange:s=>$({...k,customer_phone:s.target.value}),className:"input",placeholder:"+39..."})]}),(Re?.cover_charge||0)>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"open_session_apply_cover_tables",type:"checkbox",checked:Oe,onChange:s=>ws(s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"open_session_apply_cover_tables",className:"text-white text-sm",children:["Applica coperto (",we(Re?.cover_charge??0)," / ospite)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Ls,className:"btn-primary flex-1",children:"Apri Conto"}),e.jsx("button",{onClick:()=>V(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(Fa,{isOpen:ps,onClose:()=>z(!1),sessionId:n?.id??void 0,onAddOrder:()=>Us(),onTransfer:()=>Ws(),onOpenSplit:()=>Ks(),onOpenBillStatus:()=>ta(),onCloseSession:()=>Vs()}),e.jsx(y,{isOpen:ks,onClose:()=>$e(!1),title:"Coperto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Coperto da applicare"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:["€",Fe.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["(",n?.covers||0," coperti × €",(Fe/(n?.covers||1)).toFixed(2),")"]})]}),e.jsx("p",{className:"text-center text-dark-300",children:"Vuoi applicare il coperto a questo conto?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>Z(!0),className:"btn-primary py-3",children:"Sì, applica"}),e.jsx("button",{onClick:()=>Z(!1),className:"btn-secondary py-3",children:"No, senza coperto"})]})]})}),e.jsx(y,{isOpen:Cs,onClose:()=>G(!1),title:"Chiudi Conto",size:b.method==="cash"&&(n?.total??0)>0?"2xl":"md",children:n&&e.jsxs("div",{className:b.method==="cash"&&(n?.total??0)>0?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsxs("p",{className:"text-3xl font-bold text-primary-400",children:["€",(n?.total??0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>D({...b,method:"cash"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${b.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(U,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>D({...b,method:"card"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${b.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(se,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>D({...b,method:"online"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${b.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ye,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Online"})]})]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac",checked:b.smac,onChange:s=>D({...b,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac",className:"text-white",children:"SMAC passato"})]}),(b.method!=="cash"||(n?.total??0)===0)&&e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Be,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>G(!1),className:"btn-secondary",children:"Annulla"})]})]}),b.method==="cash"&&(n?.total??0)>0&&e.jsxs("div",{className:"mt-6 md:mt-0 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:g.customerGives,onChange:s=>C({...g,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{type:"button",onClick:()=>C({...g,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),g.customerGives&&parseFloat(g.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsxs("span",{className:"text-white",children:["€",(n?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(g.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Math.max(0,parseFloat(g.customerGives)-(n?.total??0)).toFixed(2)]})]}),parseFloat(g.customerGives)<(n?.total??0)&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",((n?.total??0)-parseFloat(g.customerGives)).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:Be,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>G(!1),className:"btn-secondary",children:"Annulla"})]})]})]})}),e.jsx(y,{isOpen:Ss,onClose:()=>Y(!1),title:"Trasferisci Tavolo",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-400",children:"Seleziona il nuovo tavolo:"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 max-h-64 overflow-y-auto",children:M.filter(s=>s.id!==n?.table_id&&q(s.id)==="available").map(s=>e.jsxs("button",{onClick:()=>Js(s.id),className:"p-4 bg-dark-900 rounded-xl hover:bg-dark-800 transition-colors text-center",children:[e.jsx("p",{className:"font-semibold text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.capacity," posti"]})]},s.id))}),M.filter(s=>s.id!==n?.table_id&&q(s.id)==="available").length===0&&e.jsx("p",{className:"text-center text-dark-400 py-4",children:"Nessun tavolo libero disponibile"}),e.jsx("button",{onClick:()=>Y(!1),className:"btn-secondary w-full",children:"Annulla"})]})}),e.jsx(y,{isOpen:hs,onClose:()=>W(!1),title:"Dividi Conto",size:"3xl",children:n&&e.jsxs("div",{className:"md:grid md:grid-cols-5 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-white",children:["€",(n?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-emerald-400",children:["€",((n?.total??0)-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),(n?.total??0)>0&&e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,((n?.total??0)-p)/(n?.total??1)*100)}%`}})}),R.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-64 overflow-y-auto",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(U,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(se,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(ye,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"text-white",children:["€",s.amount.toFixed(2)]}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-sm",children:["- ",s.notes]})]}),F&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]},s.id))})]})]}),e.jsxs("div",{className:"md:col-span-3 mt-6 md:mt-0",children:[p>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>A("manual"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${E==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>A("romana"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${E==="romana"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Alla Romana"})]}),e.jsxs("button",{onClick:()=>A("items"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${E==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(as,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Per Consumazione"})]})]}),E==="romana"&&e.jsxs("div",{className:"p-4 border border-primary-500/30 bg-primary-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary-400"}),"Dividi alla Romana"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Dividi il conto equamente tra le persone. Specifica quante persone stanno pagando ora."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone totali al tavolo"}),e.jsx("input",{type:"number",min:"1",value:j.totalPeople,onChange:s=>me({...j,totalPeople:s.target.value}),className:"input",placeholder:n?.covers?.toString()??""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone che pagano ora"}),e.jsx("input",{type:"number",min:"1",max:j.totalPeople,value:j.payingPeople,onChange:s=>me({...j,payingPeople:s.target.value}),className:"input",placeholder:"Es. 2"})]})]}),j.totalPeople&&j.payingPeople&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Quota per persona:"}),e.jsxs("span",{className:"text-white font-medium",children:["€",(p/(parseInt(j.totalPeople)||1)).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-dark-400",children:["Totale da pagare (",j.payingPeople," pers.):"]}),e.jsxs("span",{className:"text-primary-400 font-bold text-lg",children:["€",Le().toFixed(2)]})]})]}),e.jsx("button",{onClick:ea,disabled:!j.totalPeople||!j.payingPeople,className:"btn-primary w-full",children:"Applica Calcolo"})]}),E==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-blue-400"}),"Paga per Consumazione"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare. I prodotti già pagati non vengono mostrati."}),e.jsx("div",{className:"max-h-64 sm:max-h-80 overflow-y-auto space-y-2",children:w.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:De.length===0?"Nessun prodotto ordinato":"Tutti i prodotti sono stati pagati"}):w.map(s=>{const a=P[s.id]||0,t=a>0;return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${t?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",s.price.toFixed(2)," cad. • Rimasti ",s.remainingQty," pz",s.remainingQty<s.quantity&&e.jsxs("span",{className:"text-emerald-400 ml-1",children:["(",s.quantity-s.remainingQty," già pagati)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Zs(s.id),className:`px-2 py-1 text-xs rounded transition-colors ${a===s.remainingQty?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:"Tutti"}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>Hs(s.id),disabled:a===0,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"-"})}),e.jsx("span",{className:`w-8 text-center font-bold ${t?"text-blue-400":"text-dark-500"}`,children:a}),e.jsx("button",{onClick:()=>Ys(s.id),disabled:a>=s.remainingQty,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"+"})})]})]})]}),t&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-dark-600 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-dark-400",children:[a,"/",s.remainingQty," selezionati"]}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:["€",(s.price*a).toFixed(2)]})]})]},s.id)})}),Object.keys(P).length>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Prodotti selezionati:"}),e.jsxs("span",{className:"text-white",children:[Object.values(P).reduce((s,a)=>s+a,0)," pz"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-dark-400",children:"Totale:"}),e.jsxs("span",{className:"text-blue-400 font-bold text-lg",children:["€",he().toFixed(2)]})]}),he()>p&&e.jsxs("p",{className:"text-xs text-amber-400 mt-2",children:["Nota: il totale supera il rimanente, verrà addebitato €",p.toFixed(2)]})]}),e.jsx("button",{onClick:sa,disabled:Object.keys(P).length===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),E==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-white",children:"Pagamento manuale"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo da incassare"}),e.jsx("input",{type:"number",step:"0.01",value:h.amount,onChange:s=>f({...h,amount:s.target.value}),className:"input",placeholder:`Max €${p.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note (opzionale)"}),e.jsx("input",{type:"text",value:h.notes,onChange:s=>f({...h,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>f({...h,amount:p.toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Tutto (€",p.toFixed(2),")"]}),e.jsxs("button",{onClick:()=>f({...h,amount:(p/2).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Metà (€",(p/2).toFixed(2),")"]}),(n?.covers??0)>1&&e.jsxs("button",{onClick:()=>f({...h,amount:(p/(n?.covers??1)).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["1/",n?.covers??0," (€",(p/(n?.covers??1)).toFixed(2),")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{f(s=>({...s,method:"cash"})),C(s=>({...s,customerGives:"",showChange:!0}))},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${h.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(U,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>{f(s=>({...s,method:"card"})),C(s=>({...s,customerGives:"",showChange:!1}))},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${h.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(se,{className:"w-4 h-4"})," Carta"]})]}),F&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"split_smac",checked:h.smac,onChange:s=>f({...h,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsxs("label",{htmlFor:"split_smac",className:"text-white cursor-pointer flex-1",children:[e.jsx("span",{className:"font-medium",children:"SMAC passato"}),e.jsx("p",{className:"text-xs text-dark-400",children:"Spunta se questo pagamento è già stato dichiarato con tessera SMAC"})]})]}),h.method==="cash"&&h.amount&&parseFloat(h.amount)>0&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:g.customerGives,onChange:s=>C({...g,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{onClick:()=>C({...g,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),g.customerGives&&parseFloat(g.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Da incassare:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(h.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(g.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Xs().toFixed(2)]})]}),parseFloat(g.customerGives)<parseFloat(h.amount)&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",(parseFloat(h.amount)-parseFloat(g.customerGives)).toFixed(2)]})]})]}),e.jsx("button",{onClick:aa,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),p===0&&e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ye,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h4",{className:"text-xl font-bold text-emerald-400 mb-2",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400",children:"Il conto è stato completamente pagato."})]}),e.jsx("button",{onClick:()=>W(!1),className:"btn-secondary w-full",children:"Chiudi"})]})]})}),e.jsx(y,{isOpen:_s,onClose:()=>ce(!1),title:"Stato del Conto",size:"2xl",children:n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["€",(n?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:["€",((n?.total??0)-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),js>0&&_e>0&&n&&e.jsxs("div",{className:"p-3 mt-3 bg-dark-900 rounded-xl flex items-center gap-3",children:[e.jsx("input",{id:"apply_cover_bill_tables",type:"checkbox",checked:Pe,onChange:async s=>{const a=s.target.checked;if(!n)return;const t=n.id;try{await je(t,a);const r=await He(t);Se(r||n);const c=await te(t);J(c),Te(a),o("Totale aggiornato","success")}catch(r){console.error("Error toggling cover (tables):",r),o("Errore nell'applicazione del coperto","error")}},className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"apply_cover_bill_tables",className:"text-white",children:["Applica coperto (",we(_e)," / ospite)"]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-6",children:[R.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:["Pagamenti effettuati (",R.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 md:max-h-80 overflow-y-auto",children:R.map((s,a)=>e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(U,{className:"w-5 h-5 text-emerald-400"}),s.payment_method==="card"&&e.jsx(se,{className:"w-5 h-5 text-blue-400"}),s.payment_method==="online"&&e.jsx(ye,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"font-semibold text-white",children:["Pagamento #",a+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-primary-400",children:["€",s.amount.toFixed(2)]}),F&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-sm text-dark-400 space-y-1",children:[e.jsxs("p",{children:["Metodo: ",s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online"]}),e.jsxs("p",{children:["Data: ",new Date(s.paid_at).toLocaleString("it-IT")]}),s.notes&&e.jsxs("p",{children:["Note: ",s.notes]})]}),s.paid_items&&s.paid_items.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Prodotti pagati:"}),e.jsx("div",{className:"space-y-1",children:s.paid_items.map((t,r)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-300",children:[t.quantity,"x ",t.menu_item_name]}),e.jsxs("span",{className:"text-dark-400",children:["€",(t.price*t.quantity).toFixed(2)]})]},r))})]}),e.jsxs("button",{onClick:()=>ra(s),className:"mt-3 w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Stampa Scontrino"]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-dark-900 rounded-xl text-center",children:[e.jsx(Ea,{className:"w-12 h-12 mx-auto mb-3 text-dark-600"}),e.jsx("p",{className:"text-dark-400",children:"Nessun pagamento ancora effettuato"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:w.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:"Prodotti ancora da pagare"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-80 overflow-y-auto",children:w.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsxs("span",{className:"text-primary-400",children:["€",(s.price*s.remainingQty).toFixed(2)]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(Ye,{className:"w-12 h-12 mx-auto mb-3 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>ce(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(y,{isOpen:Ps,onClose:()=>de(!1),title:"Scontrino",size:"sm",children:m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:m?.shop_info?.name}),m?.shop_info?.address&&e.jsx("p",{className:"text-xs",children:m?.shop_info?.address}),m?.shop_info?.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",m?.shop_info?.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",m?.date," ",m?.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:(m?.items||[]).map((s,a)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsxs("span",{children:["€",s.total.toFixed(2)]})]},a))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsxs("span",{children:["€",(m?.total??0).toFixed(2)]})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",m?.payment_method==="cash"?"Contanti":m?.payment_method==="card"?"Carta":"Online"]}),F&&m?.smac_passed&&e.jsx("p",{children:"SMAC: Sì"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:na,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>de(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{Wa as Tables,Wa as default};
