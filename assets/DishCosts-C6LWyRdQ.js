import{d as z,u as E,r,bp as P,t as F,j as e,R as U,C as h,T,O as A,K as w,M as V}from"./index-DlwzvMJs.js";import{u as I}from"./useRealtimeRefresh-D_zYWvIw.js";import{P as L}from"./percent-PPs9nTje.js";import{T as v}from"./trending-up-BQgpE5ic.js";import{T as y}from"./trending-down-BDpoEwpG.js";import{S as O}from"./search-CKtz0mE8.js";import{D as B}from"./dollar-sign-C4QV3whr.js";const Q=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],p=z("arrow-up-down",Q);function Y(){E();const[k,g]=r.useState(!0),[_,C]=r.useState([]),[t,M]=r.useState(null),[j,D]=r.useState(""),[i,S]=r.useState("margin"),[f,N]=r.useState("desc"),[a,$]=r.useState(null),[R,u]=r.useState(!1);r.useEffect(()=>{m()},[]);async function m(){g(!0);try{const{costs:s,summary:d}=await P();C(s),M(d)}catch(s){console.error("Error loading dish costs:",s),F("Errore nel caricamento costi","error")}finally{g(!1)}}I(m);const x=_.filter(s=>s.menu_item_name.toLowerCase().includes(j.toLowerCase())).sort((s,d)=>{let c=0;switch(i){case"name":c=s.menu_item_name.localeCompare(d.menu_item_name);break;case"margin":c=s.profit_margin_percent-d.profit_margin_percent;break;case"cost":c=s.ingredient_cost-d.ingredient_cost;break}return f==="asc"?c:-c});function l(s){return s>=70?"text-emerald-400":s>=50?"text-primary-400":s>=30?"text-amber-400":"text-red-400"}function n(s){return s>=70?"bg-emerald-500/20":s>=50?"bg-primary-500/20":s>=30?"bg-amber-500/20":"bg-red-500/20"}async function b(s){$(s),u(!0)}function o(s){i===s?N(f==="asc"?"desc":"asc"):(S(s),N("desc"))}return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Costo Piatti"}),e.jsx("p",{className:"text-dark-400 mt-1 text-sm sm:text-base",children:"Analisi costi e margini di profitto"})]}),e.jsxs("button",{onClick:m,className:"btn-secondary self-start sm:self-auto",children:[e.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"sm:inline",children:"Aggiorna"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Piatti Totali"}),e.jsx("p",{className:"stat-value text-xl sm:text-2xl",children:t?.totalDishes||0})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(h,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card glow-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Margine Medio"}),e.jsxs("p",{className:`stat-value text-xl sm:text-2xl ${l(t?.avgProfitMargin||0)}`,children:[t?.avgProfitMargin||0,"%"]})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(L,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm truncate",children:"Alto Margine"}),e.jsx("p",{className:"stat-value text-xl sm:text-2xl text-emerald-400",children:t?.highMarginDishes.length||0})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(v,{className:"w-5 h-5 sm:w-6 sm:h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm truncate",children:"Basso Margine"}),e.jsx("p",{className:"stat-value text-xl sm:text-2xl text-red-400",children:t?.lowMarginDishes.length||0})]}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-red-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-400"})})]})})]}),t&&t.dishesWithoutRecipe.length>0&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-amber-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-400",children:"Piatti senza ricetta"}),e.jsx("p",{className:"text-sm text-dark-300 mt-1",children:"I seguenti piatti non hanno ingredienti associati, quindi il costo non può essere calcolato:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:t.dishesWithoutRecipe.map(s=>e.jsx("span",{className:"px-2 py-1 bg-dark-700 rounded text-sm text-dark-300",children:s.name},s.id))}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Vai alla sezione Ricette per associare gli ingredienti."})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-dark-500"}),e.jsx("input",{type:"text",value:j,onChange:s=>D(s.target.value),placeholder:"Cerca piatto...",className:"input pl-10 w-full"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0 scrollbar-hide",children:[e.jsxs("button",{onClick:()=>o("name"),className:`px-3 py-1.5 sm:py-2 rounded-lg text-sm transition-colors flex items-center gap-1 whitespace-nowrap flex-shrink-0 ${i==="name"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:["Nome",i==="name"&&e.jsx(p,{className:"w-3 h-3 sm:w-4 sm:h-4"})]}),e.jsxs("button",{onClick:()=>o("margin"),className:`px-3 py-1.5 sm:py-2 rounded-lg text-sm transition-colors flex items-center gap-1 whitespace-nowrap flex-shrink-0 ${i==="margin"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:["Margine",i==="margin"&&e.jsx(p,{className:"w-3 h-3 sm:w-4 sm:h-4"})]}),e.jsxs("button",{onClick:()=>o("cost"),className:`px-3 py-1.5 sm:py-2 rounded-lg text-sm transition-colors flex items-center gap-1 whitespace-nowrap flex-shrink-0 ${i==="cost"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:["Costo",i==="cost"&&e.jsx(p,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(A,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Analisi Costi (",x.length," piatti)"]})}),e.jsx("div",{className:"md:hidden divide-y divide-dark-700",children:x.map(s=>e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${n(s.profit_margin_percent)} flex items-center justify-center flex-shrink-0`,children:e.jsx(h,{className:`w-5 h-5 ${l(s.profit_margin_percent)}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-500",children:[s.ingredients.length," ingredienti"]})]})]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-sm font-bold ${n(s.profit_margin_percent)} ${l(s.profit_margin_percent)} flex-shrink-0`,children:[s.profit_margin_percent,"%"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-[10px] text-dark-500 uppercase",children:"Prezzo"}),e.jsxs("p",{className:"text-sm font-semibold text-white",children:[s.selling_price.toFixed(2),"€"]})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-[10px] text-dark-500 uppercase",children:"Costo"}),e.jsxs("p",{className:"text-sm font-semibold text-dark-300",children:[s.ingredient_cost.toFixed(2),"€"]})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-[10px] text-dark-500 uppercase",children:"Profitto"}),e.jsxs("p",{className:`text-sm font-semibold ${s.profit_margin>=0?"text-emerald-400":"text-red-400"}`,children:[s.profit_margin.toFixed(2),"€"]})]})]}),e.jsxs("button",{onClick:()=>b(s),className:"w-full py-2 bg-dark-700 rounded-lg hover:bg-dark-600 transition-colors flex items-center justify-center gap-2 text-sm text-dark-300",children:[e.jsx(w,{className:"w-4 h-4"}),"Vedi dettaglio"]})]},s.menu_item_id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-dark-400 font-medium",children:"Piatto"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Prezzo"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Costo"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Profitto"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Margine"}),e.jsx("th",{className:"text-center py-3 px-4 text-dark-400 font-medium",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-800",children:x.map(s=>e.jsxs("tr",{className:"hover:bg-dark-900/50 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${n(s.profit_margin_percent)} flex items-center justify-center`,children:e.jsx(h,{className:`w-5 h-5 ${l(s.profit_margin_percent)}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-500",children:[s.ingredients.length," ingredienti"]})]})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"font-semibold text-white",children:[s.selling_price.toFixed(2)," EUR"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-dark-300",children:[s.ingredient_cost.toFixed(2)," EUR"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:`font-semibold ${s.profit_margin>=0?"text-emerald-400":"text-red-400"}`,children:[s.profit_margin.toFixed(2)," EUR"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm font-semibold ${n(s.profit_margin_percent)} ${l(s.profit_margin_percent)}`,children:[s.profit_margin_percent,"%"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("button",{onClick:()=>b(s),className:"p-2 bg-dark-700 rounded-lg hover:bg-dark-600 transition-colors",title:"Vedi dettaglio",children:e.jsx(w,{className:"w-4 h-4 text-dark-300"})})})]},s.menu_item_id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-emerald-400"}),"Migliori Margini"]})}),e.jsxs("div",{className:"divide-y divide-dark-700",children:[t?.highMarginDishes.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"font-bold text-emerald-400",children:[s.profit_margin_percent,"%"]})]},s.menu_item_id)),(!t?.highMarginDishes||t.highMarginDishes.length===0)&&e.jsx("p",{className:"p-4 text-center text-dark-400",children:"Nessun piatto con margine >60%"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-red-400"}),"Da Migliorare"]})}),e.jsxs("div",{className:"divide-y divide-dark-700",children:[t?.lowMarginDishes.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"font-bold text-red-400",children:[s.profit_margin_percent,"%"]})]},s.menu_item_id)),(!t?.lowMarginDishes||t.lowMarginDishes.length===0)&&e.jsx("p",{className:"p-4 text-center text-dark-400",children:"Nessun piatto con margine <40%"})]})]})]}),e.jsx(V,{isOpen:R,onClose:()=>u(!1),title:`Dettaglio: ${a?.menu_item_name}`,size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Prezzo Vendita"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[a.selling_price.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Costo Ingredienti"}),e.jsxs("p",{className:"text-xl font-bold text-amber-400",children:[a.ingredient_cost.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Profitto"}),e.jsxs("p",{className:`text-xl font-bold ${a.profit_margin>=0?"text-emerald-400":"text-red-400"}`,children:[a.profit_margin.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:`${n(a.profit_margin_percent)} rounded-xl p-4 text-center`,children:[e.jsx("p",{className:"text-dark-300 text-sm",children:"Margine"}),e.jsxs("p",{className:`text-xl font-bold ${l(a.profit_margin_percent)}`,children:[a.profit_margin_percent,"%"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Dettaglio Ingredienti"]}),e.jsx("div",{className:"bg-dark-800 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2 px-4 text-dark-400 text-sm",children:"Ingrediente"}),e.jsx("th",{className:"text-right py-2 px-4 text-dark-400 text-sm",children:"Quantità"}),e.jsx("th",{className:"text-right py-2 px-4 text-dark-400 text-sm",children:"Costo/Unità"}),e.jsx("th",{className:"text-right py-2 px-4 text-dark-400 text-sm",children:"Totale"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-700",children:a.ingredients.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-4 text-white",children:s.ingredient_name}),e.jsxs("td",{className:"py-2 px-4 text-right text-dark-300",children:[s.quantity," ",s.unit]}),e.jsxs("td",{className:"py-2 px-4 text-right text-dark-300",children:[s.unit_cost.toFixed(2)," EUR/",s.unit]}),e.jsxs("td",{className:"py-2 px-4 text-right font-semibold text-amber-400",children:[s.total_cost.toFixed(2)," EUR"]})]},s.ingredient_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t border-dark-600 bg-dark-900/50",children:[e.jsx("td",{colSpan:3,className:"py-2 px-4 text-right font-semibold text-white",children:"Costo Totale:"}),e.jsxs("td",{className:"py-2 px-4 text-right font-bold text-primary-400",children:[a.ingredient_cost.toFixed(2)," EUR"]})]})})]})})]}),a.profit_margin_percent<40&&e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-2",children:"Suggerimenti"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"• Considera di aumentare il prezzo di vendita"}),e.jsx("li",{children:"• Cerca fornitori con costi più bassi per gli ingredienti principali"}),e.jsx("li",{children:"• Valuta porzioni più piccole mantenendo il prezzo"}),e.jsx("li",{children:"• Sostituisci ingredienti costosi con alternative più economiche"})]})]}),a.profit_margin_percent>=70&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-emerald-400 mb-2",children:"Ottimo margine!"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Questo piatto ha un margine eccellente. Considera di promuoverlo di più o usarlo come base per varianti simili."})]})]})})]})}export{Y as DishCosts};
