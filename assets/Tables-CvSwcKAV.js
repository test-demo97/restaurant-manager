import{u as ca,i as da,l as ma,r as l,p as xa,aj as ha,ak as He,q as be,t as o,j as e,P as pa,U as ne,K as je,e as ua,al as Je,N as ga,X as Ye,M as w,f as le,Q as ie,O as Ze,B as fe,a4 as oe,am as ba,an as ja,ao as fa,ap as Na,aq as va,ar as ya,y as wa,a2 as Ne,$ as ve,a5 as ye,x as es,E as ss,a3 as ka,ac as Ca,ab as Sa}from"./index-DSWOYHLu.js";import{u as _a}from"./useCurrency-K5FWBxIB.js";import{S as Pa,a as Ta,b as Fa,L as as}from"./SessionDetailsModal-C3isDyGH.js";import{u as Ea}from"./useDemoGuard-CImgTONM.js";import{C as we}from"./calendar-BhKbQGce.js";import{L as B}from"./link-2-B1PeyGF1.js";import{C as ts}from"./clock-D9w2QYzn.js";import{M as Ma}from"./message-square-sCYTFEkf.js";import{B as U}from"./banknote-Cl4I6Jsp.js";import{G as ke}from"./globe-DenPGXQA.js";import{P as rs}from"./printer-BRnJrzGo.js";import{F as za}from"./file-text-CjKyAR8l.js";function Wa(){ca();const{smacEnabled:E}=da(),{formatPrice:ce}=_a(),{checkCanWrite:y}=Ea(),ns=ma(),[M,ls]=l.useState([]),[V,is]=l.useState([]),[Ce,os]=l.useState([]),[cs,ds]=l.useState(!0),[k,ms]=l.useState(new Date().toISOString().split("T")[0]),[xs,W]=l.useState(!1),[hs,P]=l.useState(!1),[ps,K]=l.useState(!1),[us,X]=l.useState(!1),[gs,z]=l.useState(!1),[bs,H]=l.useState(!1),[js,O]=l.useState(!1),[fs,J]=l.useState(!1),[Ns,de]=l.useState(!1),[vs,me]=l.useState(!1),[m,ys]=l.useState(null),[ws,Se]=l.useState(!1),[_e,ks]=l.useState(0),[Cs,Pe]=l.useState(!0),[Y,Te]=l.useState(null),[$,Z]=l.useState(null),[h,Ss]=l.useState(null),[Fe,_s]=l.useState(null),[n,Ee]=l.useState(null),[Ps,Ts]=l.useState([]),[I,xe]=l.useState([]),[p,ee]=l.useState(0),[Fs,Es]=l.useState(0),[Me,ze]=l.useState(!1),[Ae,Ms]=l.useState(0),[A,R]=l.useState("manual"),[Re,Oe]=l.useState([]),[C,he]=l.useState([]),[T,D]=l.useState({}),[b,pe]=l.useState({totalPeople:"",payingPeople:""}),[F,se]=l.useState({name:"",capacity:"4"}),[S,G]=l.useState({covers:"2",customer_name:"",customer_phone:""}),[ae,zs]=l.useState(null),[$e,Ie]=l.useState(!1),[j,Q]=l.useState({method:"cash",smac:!1}),[x,N]=l.useState({amount:"",method:"cash",notes:"",smac:!1}),[g,_]=l.useState({customerGives:"",showChange:!1}),[i,v]=l.useState({table_id:0,table_ids:[],date:new Date().toISOString().split("T")[0],time:"19:00",customer_name:"",phone:"",guests:"2",notes:""});l.useEffect(()=>{f()},[k]),l.useEffect(()=>{const s=()=>{f()};window.addEventListener("orders-updated",s);const a=setInterval(()=>{f()},3e4);return()=>{window.removeEventListener("orders-updated",s),clearInterval(a)}},[k]);async function f(){try{const[s,a,t,r]=await Promise.all([xa(),ha(k),He(),be()]);ls(s),is(a),os(t),zs(r),Ie((r?.cover_charge||0)>0)}catch(s){console.error("Error loading data:",s),o("Errore nel caricamento dati","error")}finally{ds(!1)}}function q(s){return Ce.some(r=>r.table_id===s)?"occupied":V.some(r=>r.status!=="confirmed"?!1:(r.table_ids||[r.table_id]).includes(s))?"reserved":"available"}function te(s){return Ce.find(a=>a.table_id===s)}function De(s){return V.find(a=>(a.table_ids||[a.table_id]).includes(s)&&a.status==="confirmed")}function Ge(s){s?(Te(s),se({name:s.name,capacity:s.capacity.toString()})):(Te(null),se({name:"",capacity:"4"})),W(!0)}function As(s){v({...i,table_id:s,table_ids:[s],date:k}),P(!0)}function Rs(){v({table_id:0,table_ids:[],date:k,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),P(!0)}function Os(s){v(a=>{const t=a.table_ids||[];if(t.includes(s)){const c=t.filter(d=>d!==s);return{...a,table_ids:c.length>0?c:[s],table_id:c.length>0?c[0]:s}}else return{...a,table_ids:[...t,s],table_id:a.table_id||s}})}function $s(){const s=i.table_ids||[];return M.filter(a=>s.includes(a.id)).reduce((a,t)=>a+t.capacity,0)}async function Is(){if(y()){if(!F.name.trim()){o("Inserisci un nome per il tavolo","warning");return}try{const s={name:F.name.trim(),capacity:parseInt(F.capacity)||4};Y?(await fa(Y.id,s),o("Tavolo aggiornato","success")):(await Na(s),o("Tavolo creato","success")),W(!1),f()}catch(s){console.error("Error saving table:",s),o("Errore nel salvataggio","error")}}}async function Ds(s){if(y()&&confirm("Sei sicuro di voler eliminare questo tavolo?"))try{await ba(s),o("Tavolo eliminato","success"),f()}catch(a){console.error("Error deleting table:",a),o("Errore nell'eliminazione","error")}}async function Gs(){if(y()){if(!i.customer_name.trim()){o("Inserisci il nome del cliente","warning");return}if(i.table_ids.length===0){o("Seleziona almeno un tavolo","warning");return}try{await ya({table_id:i.table_ids[0],table_ids:i.table_ids,date:i.date,time:i.time,customer_name:i.customer_name.trim(),phone:i.phone,guests:parseInt(i.guests)||2,notes:i.notes||void 0,status:"confirmed"}),o("Prenotazione creata","success"),P(!1),v({table_id:0,table_ids:[],date:k,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),f()}catch(s){console.error("Error creating reservation:",s),o("Errore nella creazione","error")}}}async function Qe(s){if(y()&&confirm("Annullare questa prenotazione?"))try{await ja(s),o("Prenotazione annullata","success"),f()}catch(a){console.error("Error cancelling reservation:",a),o("Errore nell'annullamento","error")}}function Qs(s){Ss(s),K(!0)}function qe(s){Z(s),v({table_id:s.table_id,table_ids:s.table_ids||[s.table_id],date:s.date,time:s.time,customer_name:s.customer_name,phone:s.phone||"",guests:s.guests.toString(),notes:s.notes||""}),K(!1),P(!0)}async function qs(){if(y()&&$){if(!i.customer_name.trim()){o("Inserisci il nome del cliente","warning");return}if(i.table_ids.length===0){o("Seleziona almeno un tavolo","warning");return}try{await va($.id,{table_id:i.table_ids[0],table_ids:i.table_ids,date:i.date,time:i.time,customer_name:i.customer_name.trim(),phone:i.phone,guests:parseInt(i.guests)||2,notes:i.notes||void 0}),o("Prenotazione aggiornata","success"),P(!1),Z(null),v({table_id:0,table_ids:[],date:k,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),f()}catch(s){console.error("Error updating reservation:",s),o("Errore nell'aggiornamento","error")}}}function Le(s){const a=q(s),t=te(s),r=De(s);a==="occupied"&&t?Ls(t):(a==="available"||a==="reserved")&&(_s(s),G(r?{covers:r.guests?.toString()||"2",customer_name:r.customer_name||"",customer_phone:r.phone||""}:{covers:"2",customer_name:"",customer_phone:""}),X(!0))}async function Ls(s){try{await fe(s.id);const[a,t,r]=await Promise.all([es(s.id),ve(s.id),oe(s.id)]),d=(await He()).find(u=>u.id===s.id);Ee(d||s),Ts(a),xe(t),ee(r),z(!0)}catch(a){console.error("Error loading session details:",a),o("Errore nel caricamento dettagli","error")}}async function Bs(){if(y()&&Fe)try{const s=await wa(Fe,parseInt(S.covers)||1,S.customer_name||void 0,S.customer_phone||void 0);if($e&&s&&s.id)try{await fe(s.id,!0)}catch(a){console.error("Error applying cover on new session:",a)}o("Conto aperto","success"),X(!1),f()}catch(s){console.error("Error opening session:",s),o("Errore nell'apertura conto","error")}}function Us(){n&&ns(`/orders/new?table=${n.table_id}&session=${n.id}`)}async function Vs(){if(!y()||!n)return;if(n.total===0){if(window.confirm("Vuoi chiudere questo conto a €0.00?"))try{await Ne(n.id,"cash",!1,!1),o("Conto chiuso","success"),z(!1),f()}catch(r){console.error("Error closing session:",r),o("Errore nella chiusura","error")}return}const a=(await be()).cover_charge||0;if(a>0&&n.covers>0){const t=a*n.covers;ks(t);const r=!!Me;Pe(r),re(r)}else re(!1)}function re(s){Pe(s),Se(!1),Q({method:"cash",smac:!1}),_({customerGives:"",showChange:!1}),O(!0)}async function Be(){if(y()&&n)try{await Ne(n.id,j.method,j.smac,Cs),o("Conto chiuso","success"),O(!1),z(!1),f()}catch(s){console.error("Error closing session:",s),o("Errore nella chiusura","error")}}function Ws(){n&&H(!0)}async function Ks(s){if(y()&&n)try{await ka(n.id,s),o("Tavolo trasferito","success"),H(!1),z(!1),f()}catch(a){console.error("Error transferring table:",a),o("Errore nel trasferimento","error")}}async function Xs(){if(n){N({amount:"",method:"cash",notes:"",smac:!1}),R("manual"),D({}),pe({totalPeople:n.covers.toString(),payingPeople:""}),_({customerGives:"",showChange:!1});try{const s=[];for(const r of Ps)(await ss(r.id)).forEach(d=>{s.push({...d,order_number:r.order_number||1})});Oe(s);const a=await ye(n.id),t=s.map(r=>({...r,remainingQty:r.quantity-(a[r.id]||0)})).filter(r=>r.remainingQty>0);he(t)}catch(s){console.error("Error loading items:",s)}J(!0)}}function Hs(){const s=parseFloat(g.customerGives)||0,a=parseFloat(x.amount)||0;return Math.max(0,s-a)}function Ue(){if(!n)return 0;const s=parseInt(b.totalPeople)||1,a=parseInt(b.payingPeople)||1,t=p/s;return Math.min(t*a,p)}function ue(){return Object.entries(T).reduce((s,[a,t])=>{const r=C.find(c=>c.id===Number(a));return r&&t>0?s+r.price*t:s},0)}function Js(s){const a=C.find(t=>t.id===s);a&&D(t=>{const r=t[s]||0;return r<a.remainingQty?{...t,[s]:r+1}:t})}function Ys(s){D(a=>{const t=a[s]||0;if(t>0){const r=t-1;if(r===0){const{[s]:c,...d}=a;return d}return{...a,[s]:r}}return a})}function Zs(s){const a=C.find(t=>t.id===s);a&&D(t=>{if((t[s]||0)===a.remainingQty){const{[s]:c,...d}=t;return d}else return{...t,[s]:a.remainingQty}})}function ea(){const s=Ue();s>0&&(N(a=>({...a,amount:s.toFixed(2),notes:`Alla romana (${b.payingPeople}/${b.totalPeople} persone)`})),R("manual"))}const[Ve,We]=l.useState([]);function sa(){const s=ue();if(s>0&&s<=p){const a=Object.entries(T).map(([r,c])=>{const d=C.find(u=>u.id===Number(r));return d?`${c}x ${d.menu_item_name}`:""}).filter(Boolean).join(", "),t=Object.entries(T).map(([r,c])=>{const d=C.find(u=>u.id===Number(r));return d?{order_item_id:d.id,quantity:c,menu_item_name:d.menu_item_name,price:d.price}:null}).filter(r=>r!==null);We(t),N(r=>({...r,amount:Math.min(s,p).toFixed(2),notes:a.length>40?a.substring(0,40)+"...":a})),R("manual"),D({})}}async function aa(){if(!y())return;if(!n){o("Sessione non trovata","error");return}const s=parseFloat(x.amount);if(isNaN(s)||s<=0){o("Inserisci un importo valido","warning");return}if(s>p+.01){o("Importo superiore al rimanente","warning");return}try{await Ca(n.id,s,x.method,x.notes||void 0,x.smac,Ve.length>0?Ve:void 0);const[a,t,r]=await Promise.all([ve(n.id),oe(n.id),ye(n.id)]);xe(a),ee(t);const c=Re.map(d=>({...d,remainingQty:d.quantity-(r[d.id]||0)})).filter(d=>d.remainingQty>0);if(he(c),N({amount:"",method:"cash",notes:"",smac:!1}),We([]),o("Pagamento aggiunto","success"),t<=.01)try{await Ne(n.id,"split",!1),o("Conto saldato e chiuso","success"),J(!1),z(!1),f()}catch(d){console.error("Error closing session:",d),o("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(a){console.error("Error adding payment:",a),o("Errore nell'aggiunta pagamento","error")}}async function ta(){if(n)try{const[s,a,t]=await Promise.all([ve(n.id),oe(n.id),ye(n.id)]),r=await es(n.id),c=[];for(const u of r)(await ss(u.id)).forEach(L=>{c.push({...L,order_number:u.order_number||1})});const d=c.map(u=>({...u,remainingQty:u.quantity-(t[u.id]||0)})).filter(u=>u.remainingQty>0);try{const u=await te(n.id),Ke=await be(),L=u?.covers||0,ge=Ke.cover_charge||0,Xe=r.reduce((ia,oa)=>ia+oa.total,0)+ge*L,la=Math.abs((u?.total||0)-Xe)<.01||(u?.total||0)>=Xe-.01;Es(L),Ms(ge),ze(la&&ge>0&&L>0)}catch(u){console.error("Error loading session info for bill status modal (tables):",u)}Oe(c),xe(s),ee(a),he(d),de(!0)}catch(s){console.error("Error loading bill status (tables):",s),o("Errore nel caricamento stato conto","error")}}async function ra(s){try{const a=await Sa(s);a&&(ys(a),me(!0))}catch(a){console.error("Error generating receipt:",a),o("Errore nella generazione scontrino","error")}}function na(){if(!m)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${m.shop_info.name}</div>
            ${m.shop_info.address?`<div>${m.shop_info.address}</div>`:""}
            ${m.shop_info.phone?`<div>Tel: ${m.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${m.date} ${m.time}</div>
          <div class="divider"></div>
          ${m.items.map(t=>`
            <div class="item">
              <span>${t.quantity}x ${t.name}</span>
              <span>€${t.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>€${m.total.toFixed(2)}</span>
          </div>
          <div>Pagamento: ${m.payment_method==="cash"?"Contanti":m.payment_method==="card"?"Carta":"Online"}</div>
          ${E&&m.smac_passed?"<div>SMAC: Sì</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,a=window.open("","_blank");a&&(a.document.write(s),a.document.close(),a.print())}return cs?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Tavoli"}),e.jsx("p",{className:"text-dark-400 mt-1 text-sm sm:text-base",children:"Gestisci tavoli e prenotazioni"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>Rs(),className:"btn-secondary flex-1 sm:flex-none",children:[e.jsx(we,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Prenotazione"})]}),e.jsxs("button",{onClick:()=>Ge(),className:"btn-primary flex-1 sm:flex-none",children:[e.jsx(pa,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Tavolo"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(we,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"}),e.jsx("input",{type:"date",value:k,onChange:s=>ms(s.target.value),className:"input w-auto text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-emerald-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Disponibile"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Occupato"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded bg-amber-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-dark-300",children:"Prenotato"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-2 sm:gap-4",children:M.map(s=>{const a=q(s.id),t=te(s.id),r=De(s.id);return e.jsxs("div",{onClick:()=>Le(s.id),className:`
                group relative
                ${a==="available"?"table-available cursor-pointer hover:scale-105":""}
                ${a==="occupied"?"table-occupied cursor-pointer hover:scale-105":""}
                ${a==="reserved"?"table-reserved cursor-pointer hover:scale-105":""}
                p-3 sm:p-4 transition-transform
              `,children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ne,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:s.capacity})]}),t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),t.covers," coperti"]}),e.jsxs("p",{className:"font-semibold text-base sm:text-lg",children:["€",t.total.toFixed(2)]}),t.customer_name&&e.jsx("p",{className:"truncate",children:t.customer_name})]}),r&&!t&&e.jsxs("div",{className:"mt-2 text-[10px] sm:text-xs",children:[e.jsx("p",{className:"truncate",children:r.customer_name}),e.jsx("p",{children:r.time}),r.table_ids&&r.table_ids.length>1&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-amber-400",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsxs("span",{children:[r.table_ids.length," tavoli"]})]})]}),a==="available"&&e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-1",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),Le(s.id)},className:"text-[10px] sm:text-xs font-medium text-emerald-400 hover:text-emerald-300",children:"Apri Conto"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),As(s.id)},className:"block text-[10px] sm:text-xs underline hover:no-underline",children:"Prenota"})]}),e.jsxs("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),Ge(s)},className:"p-1 bg-dark-800 rounded hover:bg-dark-700",children:e.jsx(je,{className:"w-3 h-3"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),Ds(s.id)},className:"p-1 bg-dark-800 rounded hover:bg-red-500/20",children:e.jsx(ua,{className:"w-3 h-3"})})]})]},s.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white text-sm sm:text-base",children:["Prenotazioni per ",new Date(k).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"})]})}),e.jsx("div",{className:"card-body",children:V.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4 text-sm",children:"Nessuna prenotazione per questa data"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:V.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 bg-dark-900 rounded-xl gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ts,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm sm:text-base truncate",children:s.customer_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 sm:gap-x-3 gap-y-0.5 text-xs sm:text-sm text-dark-400",children:[e.jsx("span",{children:s.time}),e.jsxs("span",{className:"flex items-center gap-1",children:[s.table_ids&&s.table_ids.length>1&&e.jsx(B,{className:"w-3 h-3 text-primary-400"}),s.table_name]}),e.jsxs("span",{children:[s.guests," ospiti"]})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-dark-400",children:[e.jsx(Je,{className:"w-3 h-3"}),s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:`badge text-xs ${s.status==="confirmed"?"badge-success":"badge-danger"}`,children:s.status==="confirmed"?"Confermata":"Annullata"}),e.jsx("button",{onClick:()=>Qs(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Visualizza dettagli",children:e.jsx(ga,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),e.jsx("button",{onClick:()=>qe(s),className:"p-1.5 sm:p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Modifica",children:e.jsx(je,{className:"w-4 h-4 sm:w-5 sm:h-5 text-dark-400"})}),s.status==="confirmed"&&e.jsx("button",{onClick:()=>Qe(s.id),className:"p-1.5 sm:p-2 hover:bg-red-500/20 rounded-lg transition-colors",title:"Annulla",children:e.jsx(Ye,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-400"})})]})]},s.id))})})]}),e.jsx(w,{isOpen:xs,onClose:()=>W(!1),title:Y?"Modifica Tavolo":"Nuovo Tavolo",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Tavolo"}),e.jsx("input",{type:"text",value:F.name,onChange:s=>se({...F,name:s.target.value}),className:"input",placeholder:"Es. Tavolo 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Capacità (posti)"}),e.jsx("input",{type:"number",min:"1",value:F.capacity,onChange:s=>se({...F,capacity:s.target.value}),className:"input"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Is,className:"btn-primary flex-1",children:Y?"Salva":"Crea"}),e.jsx("button",{onClick:()=>W(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(w,{isOpen:hs,onClose:()=>{P(!1),Z(null)},title:$?"Modifica Prenotazione":"Nuova Prenotazione",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:i.date,onChange:s=>v({...i,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ora"}),e.jsx("input",{type:"time",value:i.time,onChange:s=>v({...i,time:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>v({...i,phone:s.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ospiti"}),e.jsx("input",{type:"number",min:"1",value:i.guests,onChange:s=>v({...i,guests:s.target.value}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente *"}),e.jsx("input",{type:"text",value:i.customer_name,onChange:s=>v({...i,customer_name:s.target.value}),className:"input",placeholder:"Nome e cognome"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"label mb-0",children:[e.jsx(B,{className:"w-4 h-4 inline mr-1"}),"Tavoli"]}),e.jsxs("span",{className:"text-xs text-dark-400",children:["Capacità totale: ",e.jsx("span",{className:"text-primary-400 font-semibold",children:$s()})," posti"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 max-h-32 overflow-y-auto p-2 bg-dark-900 rounded-xl",children:M.map(s=>{const a=i.table_ids.includes(s.id),r=q(s.id)==="available";return e.jsxs("button",{type:"button",onClick:()=>r&&Os(s.id),disabled:!r,className:`p-3 rounded-lg border-2 text-sm flex items-center gap-2 transition-all ${a?"border-primary-500 bg-primary-500/10 text-white":r?"border-dark-600 text-dark-300 hover:border-dark-500":"border-dark-700 text-dark-500 opacity-50 cursor-not-allowed"}`,children:[a?e.jsx(Pa,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(Ta,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:s.name}),e.jsxs("span",{className:"text-xs text-dark-400 flex-shrink-0",children:[s.capacity,"p"]})]},s.id)})}),i.table_ids.length>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-2 flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),"Tavoli uniti: ",M.filter(s=>i.table_ids.includes(s.id)).map(s=>s.name).join(" + ")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:i.notes,onChange:s=>v({...i,notes:s.target.value}),className:"input resize-none h-16",placeholder:"Note aggiuntive..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:$?qs:Gs,className:"btn-primary flex-1",children:$?"Salva Modifiche":"Crea Prenotazione"}),e.jsx("button",{onClick:()=>{P(!1),Z(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(w,{isOpen:ps,onClose:()=>K(!1),title:"Dettagli Prenotazione",size:"md",children:h&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("span",{className:`badge text-lg px-4 py-2 ${h.status==="confirmed"?"badge-success":h.status==="cancelled"?"badge-danger":"badge-secondary"}`,children:h.status==="confirmed"?"Confermata":h.status==="cancelled"?"Annullata":"Completata"})}),e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-500/20 flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:h.customer_name}),h.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-dark-400",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${h.phone}`,className:"hover:text-primary-400",children:h.phone})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(we,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(h.date).toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"short"})})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ts,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ora"}),e.jsx("p",{className:"font-semibold text-white",children:h.time})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ne,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Ospiti"}),e.jsxs("p",{className:"font-semibold text-white",children:[h.guests," persone"]})]}),e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(B,{className:"w-6 h-6 text-primary-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dark-400",children:h.table_ids&&h.table_ids.length>1?"Tavoli Uniti":"Tavolo"}),e.jsx("p",{className:"font-semibold text-white",children:h.table_name}),h.table_ids&&h.table_ids.length>1&&e.jsxs("p",{className:"text-xs text-primary-400 mt-1",children:[h.table_ids.length," tavoli"]})]})]}),h.notes&&e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ma,{className:"w-4 h-4 text-dark-400"}),e.jsx("p",{className:"text-sm text-dark-400",children:"Note"})]}),e.jsx("p",{className:"text-white",children:h.notes})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>qe(h),className:"btn-secondary flex-1",children:[e.jsx(je,{className:"w-5 h-5"}),"Modifica"]}),h.status==="confirmed"&&e.jsxs("button",{onClick:()=>{Qe(h.id),K(!1)},className:"btn-danger",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Annulla"]})]})]})}),e.jsx(w,{isOpen:us,onClose:()=>X(!1),title:"Apri Conto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Numero Coperti"}),e.jsx("input",{type:"number",min:"1",value:S.covers,onChange:s=>G({...S,covers:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente (opzionale)"}),e.jsx("input",{type:"text",value:S.customer_name,onChange:s=>G({...S,customer_name:s.target.value}),className:"input",placeholder:"Es. Marco Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono (opzionale)"}),e.jsx("input",{type:"tel",value:S.customer_phone,onChange:s=>G({...S,customer_phone:s.target.value}),className:"input",placeholder:"+39..."})]}),ae&&(ae.cover_charge||0)>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"open_session_apply_cover_tables",type:"checkbox",checked:$e,onChange:s=>Ie(s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"open_session_apply_cover_tables",className:"text-white text-sm",children:["Applica coperto (",ce?ce(ae.cover_charge):ae.cover_charge," / ospite)"]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Bs,className:"btn-primary flex-1",children:"Apri Conto"}),e.jsx("button",{onClick:()=>X(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(Fa,{isOpen:gs,onClose:()=>z(!1),sessionId:n?.id??void 0,onAddOrder:()=>Us(),onTransfer:()=>Ws(),onOpenSplit:()=>Xs(),onOpenBillStatus:()=>ta(),onCloseSession:()=>Vs()}),e.jsx(w,{isOpen:ws,onClose:()=>Se(!1),title:"Coperto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Coperto da applicare"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:["€",_e.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["(",n?.covers||0," coperti × €",(_e/(n?.covers||1)).toFixed(2),")"]})]}),e.jsx("p",{className:"text-center text-dark-300",children:"Vuoi applicare il coperto a questo conto?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>re(!0),className:"btn-primary py-3",children:"Sì, applica"}),e.jsx("button",{onClick:()=>re(!1),className:"btn-secondary py-3",children:"No, senza coperto"})]})]})}),e.jsx(w,{isOpen:js,onClose:()=>O(!1),title:"Chiudi Conto",size:j.method==="cash"&&n&&n.total>0?"2xl":"md",children:n&&e.jsxs("div",{className:j.method==="cash"&&n.total>0?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsxs("p",{className:"text-3xl font-bold text-primary-400",children:["€",n.total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>Q({...j,method:"cash"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${j.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(U,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>Q({...j,method:"card"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${j.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(le,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>Q({...j,method:"online"}),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-colors ${j.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ke,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm",children:"Online"})]})]})]}),E&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac",checked:j.smac,onChange:s=>Q({...j,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac",className:"text-white",children:"SMAC passato"})]}),(j.method!=="cash"||n.total===0)&&e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Be,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>O(!1),className:"btn-secondary",children:"Annulla"})]})]}),j.method==="cash"&&n.total>0&&e.jsxs("div",{className:"mt-6 md:mt-0 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:g.customerGives,onChange:s=>_({...g,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{type:"button",onClick:()=>_({...g,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),g.customerGives&&parseFloat(g.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsxs("span",{className:"text-white",children:["€",n.total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(g.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Math.max(0,parseFloat(g.customerGives)-n.total).toFixed(2)]})]}),parseFloat(g.customerGives)<n.total&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",(n.total-parseFloat(g.customerGives)).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:Be,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>O(!1),className:"btn-secondary",children:"Annulla"})]})]})]})}),e.jsx(w,{isOpen:bs,onClose:()=>H(!1),title:"Trasferisci Tavolo",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-400",children:"Seleziona il nuovo tavolo:"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 max-h-64 overflow-y-auto",children:M.filter(s=>s.id!==n?.table_id&&q(s.id)==="available").map(s=>e.jsxs("button",{onClick:()=>Ks(s.id),className:"p-4 bg-dark-900 rounded-xl hover:bg-dark-800 transition-colors text-center",children:[e.jsx("p",{className:"font-semibold text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.capacity," posti"]})]},s.id))}),M.filter(s=>s.id!==n?.table_id&&q(s.id)==="available").length===0&&e.jsx("p",{className:"text-center text-dark-400 py-4",children:"Nessun tavolo libero disponibile"}),e.jsx("button",{onClick:()=>H(!1),className:"btn-secondary w-full",children:"Annulla"})]})}),e.jsx(w,{isOpen:fs,onClose:()=>J(!1),title:"Dividi Conto",size:"3xl",children:n&&e.jsxs("div",{className:"md:grid md:grid-cols-5 md:gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-white",children:["€",n.total.toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-emerald-400",children:["€",(n.total-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-sm lg:text-base font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),n.total>0&&e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,(n.total-p)/n.total*100)}%`}})}),I.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-64 overflow-y-auto",children:I.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(U,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(le,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(ke,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"text-white",children:["€",s.amount.toFixed(2)]}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-sm",children:["- ",s.notes]})]}),E&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]},s.id))})]})]}),e.jsxs("div",{className:"md:col-span-3 mt-6 md:mt-0",children:[p>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R("manual"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${A==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>R("romana"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${A==="romana"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Alla Romana"})]}),e.jsxs("button",{onClick:()=>R("items"),className:`flex-1 p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${A==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(as,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Per Consumazione"})]})]}),A==="romana"&&e.jsxs("div",{className:"p-4 border border-primary-500/30 bg-primary-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-primary-400"}),"Dividi alla Romana"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Dividi il conto equamente tra le persone. Specifica quante persone stanno pagando ora."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone totali al tavolo"}),e.jsx("input",{type:"number",min:"1",value:b.totalPeople,onChange:s=>pe({...b,totalPeople:s.target.value}),className:"input",placeholder:n.covers.toString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone che pagano ora"}),e.jsx("input",{type:"number",min:"1",max:b.totalPeople,value:b.payingPeople,onChange:s=>pe({...b,payingPeople:s.target.value}),className:"input",placeholder:"Es. 2"})]})]}),b.totalPeople&&b.payingPeople&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Quota per persona:"}),e.jsxs("span",{className:"text-white font-medium",children:["€",(p/(parseInt(b.totalPeople)||1)).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-dark-400",children:["Totale da pagare (",b.payingPeople," pers.):"]}),e.jsxs("span",{className:"text-primary-400 font-bold text-lg",children:["€",Ue().toFixed(2)]})]})]}),e.jsx("button",{onClick:ea,disabled:!b.totalPeople||!b.payingPeople,className:"btn-primary w-full",children:"Applica Calcolo"})]}),A==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-blue-400"}),"Paga per Consumazione"]}),e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare. I prodotti già pagati non vengono mostrati."}),e.jsx("div",{className:"max-h-64 sm:max-h-80 overflow-y-auto space-y-2",children:C.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:Re.length===0?"Nessun prodotto ordinato":"Tutti i prodotti sono stati pagati"}):C.map(s=>{const a=T[s.id]||0,t=a>0;return e.jsxs("div",{className:`p-3 rounded-lg border-2 transition-all ${t?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",s.price.toFixed(2)," cad. • Rimasti ",s.remainingQty," pz",s.remainingQty<s.quantity&&e.jsxs("span",{className:"text-emerald-400 ml-1",children:["(",s.quantity-s.remainingQty," già pagati)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Zs(s.id),className:`px-2 py-1 text-xs rounded transition-colors ${a===s.remainingQty?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:"Tutti"}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>Ys(s.id),disabled:a===0,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"-"})}),e.jsx("span",{className:`w-8 text-center font-bold ${t?"text-blue-400":"text-dark-500"}`,children:a}),e.jsx("button",{onClick:()=>Js(s.id),disabled:a>=s.remainingQty,className:"w-8 h-8 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors",children:e.jsx("span",{className:"text-lg font-bold text-white",children:"+"})})]})]})]}),t&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-dark-600 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-dark-400",children:[a,"/",s.remainingQty," selezionati"]}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:["€",(s.price*a).toFixed(2)]})]})]},s.id)})}),Object.keys(T).length>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Prodotti selezionati:"}),e.jsxs("span",{className:"text-white",children:[Object.values(T).reduce((s,a)=>s+a,0)," pz"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-dark-400",children:"Totale:"}),e.jsxs("span",{className:"text-blue-400 font-bold text-lg",children:["€",ue().toFixed(2)]})]}),ue()>p&&e.jsxs("p",{className:"text-xs text-amber-400 mt-2",children:["Nota: il totale supera il rimanente, verrà addebitato €",p.toFixed(2)]})]}),e.jsx("button",{onClick:sa,disabled:Object.keys(T).length===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),A==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-white",children:"Pagamento manuale"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo da incassare"}),e.jsx("input",{type:"number",step:"0.01",value:x.amount,onChange:s=>N({...x,amount:s.target.value}),className:"input",placeholder:`Max €${p.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note (opzionale)"}),e.jsx("input",{type:"text",value:x.notes,onChange:s=>N({...x,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>N({...x,amount:p.toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Tutto (€",p.toFixed(2),")"]}),e.jsxs("button",{onClick:()=>N({...x,amount:(p/2).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Metà (€",(p/2).toFixed(2),")"]}),n.covers>1&&e.jsxs("button",{onClick:()=>N({...x,amount:(p/n.covers).toFixed(2)}),className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["1/",n.covers," (€",(p/n.covers).toFixed(2),")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{N({...x,method:"cash"}),_({customerGives:"",showChange:!0})},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${x.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(U,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>{N({...x,method:"card"}),_({customerGives:"",showChange:!1})},className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${x.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(le,{className:"w-4 h-4"})," Carta"]})]}),E&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"split_smac",checked:x.smac,onChange:s=>N({...x,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsxs("label",{htmlFor:"split_smac",className:"text-white cursor-pointer flex-1",children:[e.jsx("span",{className:"font-medium",children:"SMAC passato"}),e.jsx("p",{className:"text-xs text-dark-400",children:"Spunta se questo pagamento è già stato dichiarato con tessera SMAC"})]})]}),x.method==="cash"&&x.amount&&parseFloat(x.amount)>0&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dà"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:g.customerGives,onChange:s=>_({...g,customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"€"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsxs("button",{onClick:()=>_({...g,customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:["€",s]},s))}),g.customerGives&&parseFloat(g.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Da incassare:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(x.amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dà:"}),e.jsxs("span",{className:"text-white",children:["€",parseFloat(g.customerGives).toFixed(2)]})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-400",children:["€",Hs().toFixed(2)]})]}),parseFloat(g.customerGives)<parseFloat(x.amount)&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["⚠️ Il cliente non ha dato abbastanza! Mancano €",(parseFloat(x.amount)-parseFloat(g.customerGives)).toFixed(2)]})]})]}),e.jsx("button",{onClick:aa,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),p===0&&e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ze,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h4",{className:"text-xl font-bold text-emerald-400 mb-2",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400",children:"Il conto è stato completamente pagato."})]}),e.jsx("button",{onClick:()=>J(!1),className:"btn-secondary w-full",children:"Chiudi"})]})]})}),e.jsx(w,{isOpen:Ns,onClose:()=>de(!1),title:"Stato del Conto",size:"2xl",children:n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["€",n.total.toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Pagato"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-400",children:["€",(n.total-p).toFixed(2)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Rimanente"}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["€",p.toFixed(2)]})]})]}),Fs>0&&Ae>0&&n&&e.jsxs("div",{className:"p-3 mt-3 bg-dark-900 rounded-xl flex items-center gap-3",children:[e.jsx("input",{id:"apply_cover_bill_tables",type:"checkbox",checked:Me,onChange:async s=>{const a=s.target.checked;try{await fe(n.id,a);const t=await te(n.id);Ee(t||n);const r=await oe(n.id);ee(r),ze(a),o("Totale aggiornato","success")}catch(t){console.error("Error toggling cover (tables):",t),o("Errore nell'applicazione del coperto","error")}},className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"apply_cover_bill_tables",className:"text-white",children:["Applica coperto (",ce(Ae)," / ospite)"]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-6",children:[I.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:["Pagamenti effettuati (",I.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 md:max-h-80 overflow-y-auto",children:I.map((s,a)=>e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(U,{className:"w-5 h-5 text-emerald-400"}),s.payment_method==="card"&&e.jsx(le,{className:"w-5 h-5 text-blue-400"}),s.payment_method==="online"&&e.jsx(ke,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"font-semibold text-white",children:["Pagamento #",a+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-primary-400",children:["€",s.amount.toFixed(2)]}),E&&s.smac_passed&&e.jsx("span",{className:"text-xs bg-primary-500/20 text-primary-400 px-2 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-sm text-dark-400 space-y-1",children:[e.jsxs("p",{children:["Metodo: ",s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online"]}),e.jsxs("p",{children:["Data: ",new Date(s.paid_at).toLocaleString("it-IT")]}),s.notes&&e.jsxs("p",{children:["Note: ",s.notes]})]}),s.paid_items&&s.paid_items.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Prodotti pagati:"}),e.jsx("div",{className:"space-y-1",children:s.paid_items.map((t,r)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-dark-300",children:[t.quantity,"x ",t.menu_item_name]}),e.jsxs("span",{className:"text-dark-400",children:["€",(t.price*t.quantity).toFixed(2)]})]},r))})]}),e.jsxs("button",{onClick:()=>ra(s),className:"mt-3 w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Stampa Scontrino"]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-dark-900 rounded-xl text-center",children:[e.jsx(za,{className:"w-12 h-12 mx-auto mb-3 text-dark-600"}),e.jsx("p",{className:"text-dark-400",children:"Nessun pagamento ancora effettuato"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:C.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-3",children:"Prodotti ancora da pagare"}),e.jsx("div",{className:"space-y-2 max-h-48 md:max-h-80 overflow-y-auto",children:C.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsxs("span",{className:"text-primary-400",children:["€",(s.price*s.remainingQty).toFixed(2)]})]},s.id))})]}):e.jsxs("div",{className:"p-6 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(Ze,{className:"w-12 h-12 mx-auto mb-3 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>de(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(w,{isOpen:vs,onClose:()=>me(!1),title:"Scontrino",size:"sm",children:m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:m.shop_info.name}),m.shop_info.address&&e.jsx("p",{className:"text-xs",children:m.shop_info.address}),m.shop_info.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",m.shop_info.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",m.date," ",m.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:m.items.map((s,a)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsxs("span",{children:["€",s.total.toFixed(2)]})]},a))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsxs("span",{children:["€",m.total.toFixed(2)]})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",m.payment_method==="cash"?"Contanti":m.payment_method==="card"?"Carta":"Online"]}),E&&m.smac_passed&&e.jsx("p",{children:"SMAC: Sì"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:na,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>me(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{Wa as Tables};
