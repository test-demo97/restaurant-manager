import{d as Dt,u as zt,k as Ft,i as qt,l as Rt,r as l,D as Lt,t as c,E as Be,F as ye,j as e,H as Gt,W as Kt,G as Bt,R as Qt,L as Ht,P as $s,e as P,I as Wt,c as qs,C as Vt,J as Q,K as Z,M as $,N as Qe,f as we,O as Ps,Q as Ut,V as Ms,Y as He,Z as Jt,_ as Yt,$ as Zt,a0 as Xt,s as X,x as We,a1 as Ve,q as Ue,a2 as Je,a3 as ke,a4 as Ye,a5 as As,a6 as ea,a7 as sa,a8 as Ds,a9 as ta,aa,B as na,ab as ra}from"./index-BOmTwSxR.js";import{u as ia}from"./useCurrency-BZHudE-G.js";import{S as ee,a as se,b as la,L as oa}from"./SessionDetailsModal-BzGHk9AA.js";import{u as da}from"./useDemoGuard-CWj-SCB-.js";import{C as Rs}from"./clock-Ch2J9szw.js";import{C as Ze}from"./chevron-down-CxgaeTSf.js";import{C as Xe}from"./chevron-right-CAiNyThT.js";import{C as zs}from"./calendar-Bxd2WWco.js";import{S as ca}from"./search-CRiiFTIM.js";import{M as ma}from"./minus-CYN3-SCJ.js";import{B as te}from"./banknote-C0mb3cUR.js";import{G as es}from"./globe-BJcdJQ99.js";import{P as ss}from"./printer-C1yU0Wy7.js";import{F as xa}from"./file-text-BpGPHAw5.js";const ha=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Fs=Dt("funnel",ha),k={pending:{labelKey:"orders.pending",icon:Rs,color:"badge-warning",next:"preparing"},preparing:{labelKey:"orders.preparing",icon:Vt,color:"badge-info",next:"ready"},ready:{labelKey:"orders.ready",icon:qs,color:"badge-success",next:"delivered"},delivered:{labelKey:"orders.completed",icon:Wt,color:"badge-success",next:null},cancelled:{labelKey:"orders.cancelled",icon:P,color:"badge-danger",next:null}},H={dine_in:"orders.dineIn",takeaway:"orders.takeaway",delivery:"orders.delivery"};function Ea(){const{t:h}=zt(),{formatPrice:m}=ia(),{checkCanWrite:ts}=da(),{user:W}=Ft(),{smacEnabled:M}=qt(),as=Rt(),[ae,Ls]=l.useState([]),[Gs,ns]=l.useState(!0),[rs]=l.useState(new Date().toISOString().split("T")[0]),[Ce,Ks]=l.useState(""),[x,Se]=l.useState(null),[Bs,q]=l.useState(!1),[_e,ne]=l.useState(!1),[V]=l.useState({}),[Qs,Hs]=l.useState({pending:new Set,preparing:new Set,ready:new Set,delivered:new Set}),[Ws,R]=l.useState(!1),[Vs,re]=l.useState(!1),[is,Us]=l.useState(null),[ls,Ee]=l.useState(""),[Js]=l.useState([]),[d,E]=l.useState({order_type:"dine_in",table_id:void 0,payment_method:"cash",customer_name:"",customer_phone:"",notes:"",smac_passed:!1,status:"pending",total:0,originalTotal:0}),[Ys,ie]=l.useState(!1),[le,oe]=l.useState([]),[os,ds]=l.useState("pending"),[cs,ms]=l.useState(""),[xs]=l.useState(new Set),[C,hs]=l.useState("today"),[ps,Zs]=l.useState([]),[Oe,Te]=l.useState([]),[Xs,us]=l.useState(!1),[de,Ie]=l.useState(()=>{const s=new Date;return s.setDate(s.getDate()-7),s.toISOString().split("T")[0]}),[ce,$e]=l.useState(new Date().toISOString().split("T")[0]),[Pe,et]=l.useState("all"),[j,S]=l.useState([]),[A,gs]=l.useState(""),[js,st]=l.useState(new Set),[tt]=l.useState(!1),[at,me]=l.useState(!1),[p,D]=l.useState(null),[y,U]=l.useState({method:"cash",smac:!1}),[O,J]=l.useState({customerGives:""}),[nt,bs]=l.useState(!1),[rt]=l.useState(0),[it]=l.useState(0),[lt]=l.useState(0),[ot,fs]=l.useState(!0),[dt,xe]=l.useState(!1),[ct,Me]=l.useState(!1),[mt,Ae]=l.useState(!1),[u,xt]=l.useState(null),[he,pe]=l.useState("manual"),[L,De]=l.useState([]),[_,ue]=l.useState(0),[ht,Ns]=l.useState([]),[T,ze]=l.useState([]),[G,ge]=l.useState({}),[f,I]=l.useState({amount:"",method:"cash",notes:"",smac:!1}),[vs,Fe]=l.useState([]),[ys,qe]=l.useState(0),[ws,je]=l.useState(!1),[be,Re]=l.useState(0),w=l.useCallback(async()=>{ns(!0);try{const s=await Lt(rs);Ls(s||[])}catch(s){console.error("Error loading orders:",s),c("Errore nel caricamento ordini","error")}finally{ns(!1)}},[rs]);l.useEffect(()=>{w();const s=()=>w();return window.addEventListener("orders-updated",s),()=>window.removeEventListener("orders-updated",s)},[w]),l.useEffect(()=>{if(!Be||!ye)return;let s=null;try{s=ye.channel("orders-realtime").on("postgres_changes",{event:"*",schema:"public",table:"orders"},a=>{window.dispatchEvent(new CustomEvent("orders-updated"))}),Promise.resolve(s.subscribe()).then(()=>ne(!0)).catch(()=>ne(!1))}catch(a){console.error("Realtime subscribe error:",a),ne(!1)}return()=>{try{s&&s.unsubscribe&&s.unsubscribe()}catch{}ne(!1)}},[]);async function v(){us(!0);try{const s=await Ut(de,ce);Zs(s),S([]);try{if(Be&&ye){const{data:a}=await ye.from("table_sessions").select("*").gte("created_at",`${de}T00:00:00`).lte("created_at",`${ce}T23:59:59`);Te(a||[])}else{const a=localStorage.getItem("kebab_table_sessions")||"[]",n=JSON.parse(a).filter(t=>{const r=t.created_at||t.date||"";return r&&r.slice(0,10)>=de&&r.slice(0,10)<=ce});Te(n||[])}}catch(a){console.error("Error loading history sessions:",a),Te([])}}catch(s){console.error("Error loading history:",s),c("Errore nel caricamento storico","error")}finally{us(!1)}}async function pt(){if(!is||!ts())return;const s=parseFloat(ls.replace(",","."))||0;try{await ea(is,s),c("Totale conto aggiornato","success"),re(!1),w(),C==="history"&&v()}catch(a){console.error("Error saving session total:",a),c("Errore nel salvataggio totale conto","error")}}async function fe(s){Se(s),ds(s.status),ms(s.notes||"");try{const a=await He(s.id);oe(a)}catch(a){console.error("Error loading order items:",a),oe([])}ie(!0)}async function ut(){if(x)try{await As(x.id,{status:os,notes:cs||void 0}),window.dispatchEvent(new CustomEvent("orders-updated")),c("Comanda modificata con successo","success"),ie(!1),w()}catch(s){console.error("Error updating order:",s),c("Errore nella modifica","error")}}async function ks(s,a){if(!(a<1))try{await sa(s,{quantity:a}),oe(n=>n.map(t=>t.id===s?{...t,quantity:a}:t)),x&&await Ds(x.id),window.dispatchEvent(new CustomEvent("orders-updated"))}catch(n){console.error("Error updating item quantity:",n),c("Errore nell'aggiornamento","error")}}async function gt(s){if(confirm("Sei sicuro di voler rimuovere questo prodotto dalla comanda?"))try{await ta(s),oe(a=>a.filter(n=>n.id!==s)),x&&await Ds(x.id),window.dispatchEvent(new CustomEvent("orders-updated")),c("Prodotto rimosso","success")}catch(a){console.error("Error deleting item:",a),c("Errore nella rimozione","error")}}async function jt(){if(x)try{await As(x.id,{order_type:d.order_type,table_id:d.order_type==="dine_in"?d.table_id:void 0,payment_method:d.payment_method,customer_name:d.customer_name||void 0,customer_phone:d.customer_phone||void 0,notes:d.notes||void 0,smac_passed:d.smac_passed,status:d.status,total:d.total}),c("Ordine modificato con successo","success"),R(!1),w(),C==="history"&&v()}catch(s){console.error("Error updating order:",s),c("Errore nella modifica","error")}}async function Cs(){if(x?.session_id)try{const s=await X(x.session_id),a=await We(x.session_id),n=s&&typeof s.total=="number"?s.total:a.reduce((g,N)=>g+N.total,0);if(s&&(s.total||0)===0){if(window.confirm("Vuoi chiudere questo conto a â‚¬0.00?"))try{await Ve(s.id,"cash",!1,!1),c("Conto chiuso con successo","success"),w(),C==="history"&&v()}catch(N){console.error("Error closing zero-total session from Orders:",N),c("Errore nella chiusura del conto","error")}return}D({id:x.session_id,total:n});const r=(await Ue()).cover_charge||0,i=s?.covers||0;qe(i),Re(r);const b=a.reduce((g,N)=>g+N.total,0)+r*i,o=Math.abs((s?.total||0)-b)<.01||(s?.total||0)>=b-.01;je(o&&r>0&&i>0),Le(o&&r>0&&i>0)}catch(s){console.error("Error loading session orders:",s),c("Errore nel caricamento del conto","error")}}function Le(s){fs(s),bs(!1),U({method:"cash",smac:!1}),J({customerGives:""}),R(!1),me(!0)}async function Ss(s,a){try{await na(s,a);const n=await X(s);D(r=>r&&{...r,total:n?.total??r.total});const t=await ke(s);ue(t),je(a),fs(a),c("Totale aggiornato","success")}catch(n){console.error("Error updating session total with cover:",n),c("Errore nell'applicazione del coperto","error")}}async function bt(){if(p)try{await Ve(p.id,y.method,y.smac,ot),x&&await Ms(x.id,"delivered",W?.name),c("Conto chiuso con successo","success"),me(!1),D(null),w(),C==="history"&&v()}catch(s){console.error("Error closing session:",s),c("Errore nella chiusura del conto","error")}}async function ft(){if(x?.session_id)try{const s=await We(x.session_id),a=s.reduce((o,g)=>o+g.total,0),[n,t,r]=await Promise.all([Je(x.session_id),ke(x.session_id),Ye(x.session_id)]),i=[];for(const o of s)(await He(o.id)).forEach(N=>{i.push({...N,order_number:o.order_number||1})});Ns(i),De(n),ue(t);const b=i.map(o=>({...o,remainingQty:o.quantity-(r[o.id]||0)})).filter(o=>o.remainingQty>0);ze(b);try{const o=await X(x.session_id),g=await Ue(),N=o?.covers||0,F=g.cover_charge||0,ve=s.reduce((Mt,At)=>Mt+At.total,0)+F*N,Pt=Math.abs((o?.total||0)-ve)<.01||(o?.total||0)>=ve-.01;qe(N),Re(F),je(Pt&&F>0&&N>0)}catch(o){console.error("Error loading session info for split modal:",o)}D({id:x.session_id,total:a}),I({amount:"",method:"cash",notes:"",smac:!1}),pe("manual"),ge({}),J({customerGives:""}),Fe([]),q(!1),xe(!0)}catch(s){console.error("Error loading split data:",s),c("Errore nel caricamento dati","error")}}async function Nt(){if(x?.session_id)try{const[s,a,n]=await Promise.all([Je(x.session_id),ke(x.session_id),Ye(x.session_id)]),t=await We(x.session_id),r=t.reduce((o,g)=>o+g.total,0);try{const o=await X(x.session_id),g=await Ue(),N=o?.covers||0,F=g.cover_charge||0,Ke=r+F*N,ve=Math.abs((o?.total||0)-Ke)<.01||(o?.total||0)>=Ke-.01;qe(N),Re(F),je(ve&&F>0&&N>0)}catch(o){console.error("Error loading session info for bill status modal:",o)}const i=[];for(const o of t)(await He(o.id)).forEach(N=>{i.push({...N,order_number:o.order_number||1})});Ns(i),De(s),ue(a),D({id:x.session_id,total:r});const b=i.map(o=>({...o,remainingQty:o.quantity-(n[o.id]||0)})).filter(o=>o.remainingQty>0);ze(b),q(!1),Me(!0)}catch(s){console.error("Error loading bill status:",s),c("Errore nel caricamento stato conto","error")}}function _s(){return Object.entries(G).reduce((s,[a,n])=>{const t=T.find(r=>r.id===Number(a));return t&&n>0?s+t.price*n:s},0)}function vt(s){const a=T.find(n=>n.id===s);a&&ge(n=>{const t=n[s]||0;return t<a.remainingQty?{...n,[s]:t+1}:n})}function yt(s){ge(a=>{const n=a[s]||0;if(n>0){const t=n-1;if(t===0){const{[s]:r,...i}=a;return i}return{...a,[s]:t}}return a})}function wt(){const s=_s();if(s>0&&s<=_){const a=Object.entries(G).map(([t,r])=>{const i=T.find(b=>b.id===Number(t));return i?`${r}x ${i.menu_item_name}`:""}).filter(Boolean).join(", "),n=Object.entries(G).map(([t,r])=>{const i=T.find(b=>b.id===Number(t));return i?{order_item_id:i.id,quantity:r,menu_item_name:i.menu_item_name,price:i.price}:null}).filter(t=>t!==null);Fe(n),I(t=>({...t,amount:Math.min(s,_).toFixed(2),notes:a.length>40?a.substring(0,40)+"...":a})),pe("manual"),ge({})}}function kt(){const s=parseFloat(O.customerGives)||0,a=parseFloat(f.amount)||0;return Math.max(0,s-a)}async function Ct(){if(!p){c("Sessione non trovata","error");return}const s=parseFloat(f.amount);if(isNaN(s)||s<=0){c("Inserisci un importo valido","warning");return}if(s>_+.01){c("Importo superiore al rimanente","warning");return}try{await ra(p.id,s,f.method,f.notes||void 0,f.smac,vs.length>0?vs:void 0);const[a,n,t]=await Promise.all([Je(p.id),ke(p.id),Ye(p.id)]);De(a),ue(n);const r=ht.map(i=>({...i,remainingQty:i.quantity-(t[i.id]||0)})).filter(i=>i.remainingQty>0);if(ze(r),I({amount:"",method:"cash",notes:"",smac:!1}),Fe([]),c("Pagamento aggiunto","success"),n<=.01)try{await Ve(p.id,"split",!1),c("Conto saldato e chiuso","success"),xe(!1),w(),C==="history"&&v()}catch(i){console.error("Error closing session:",i),c("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(a){console.error("Error adding payment:",a),c("Errore nell'aggiunta pagamento","error")}}async function Es(s){try{const a=await aa(s);a&&(xt(a),Ae(!0))}catch(a){console.error("Error generating receipt:",a),c("Errore nella generazione scontrino","error")}}function St(){if(!u)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${u.shop_info.name}</div>
            ${u.shop_info.address?`<div>${u.shop_info.address}</div>`:""}
            ${u.shop_info.phone?`<div>Tel: ${u.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${u.date} ${u.time}</div>
          <div class="divider"></div>
          ${u.items.map(n=>`
            <div class="item">
              <span>${n.quantity}x ${n.name}</span>
              <span>â‚¬${n.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>â‚¬${u.total.toFixed(2)}</span>
          </div>
          <div>Pagamento: ${u.payment_method==="cash"?"Contanti":u.payment_method==="card"?"Carta":"Online"}</div>
          ${M&&u.smac_passed?"<div>SMAC: SÃ¬</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,a=window.open("","_blank");a&&(a.document.write(s),a.document.close(),a.print())}function Ne(s){S(a=>a.includes(s)?a.filter(n=>n!==s):[...a,s])}function K(s){Se(s),q(!0)}function Ge(s){Se(s),E({order_type:s.order_type,table_id:s.table_id??void 0,payment_method:s.payment_method??"cash",customer_name:s.customer_name??"",customer_phone:s.customer_phone??"",notes:s.notes??"",smac_passed:s.smac_passed??!1,status:s.status,total:s.total??0,originalTotal:s.total??0}),R(!0)}async function _t(s){Us(s);try{const a=await X(s);Ee(String(a?.total??0))}catch(a){console.error("Error loading session for edit:",a),Ee("0")}re(!0)}async function B(s,a){if(confirm("Sei sicuro di eliminare questa comanda?"))try{await Xt(s,W?.name),c("Comanda eliminata","success"),w(),C==="history"&&v()}catch(n){console.error("Error deleting order:",n),c("Errore nell'eliminazione","error")}}async function Os(s){if(confirm("Sei sicuro di eliminare questo conto (sessione)?"))try{await Zt(s),c("Conto eliminato","success"),w(),C==="history"&&v()}catch(a){console.error("Error deleting session:",a),c("Errore nell'eliminazione conto","error")}}function Et(){as("/orders/new")}function Ot(){as("/tables")}async function Tt(s){const n=k[s.status]?.next;if(n)try{await Ms(s.id,n,W?.name),c("Stato aggiornato","success"),w()}catch(t){console.error("Error updating status:",t),c("Errore nell'aggiornamento stato","error")}}function Ts(){const s=Y.map(n=>n.id),a=s.every(n=>j.includes(n));S(a?n=>n.filter(t=>!s.includes(t)):n=>[...new Set([...n,...s])])}async function It(){if(ts()){if(j.length===0){c("Seleziona almeno un ordine","warning");return}if(A==="delete"){if(!confirm(`Sei sicuro di voler eliminare ${j.length} ordini?`))return;try{await Jt(j,W?.name),c(`${j.length} ordini eliminati`,"success"),S([]),v()}catch(s){console.error("Error deleting orders:",s),c("Errore nell'eliminazione","error")}}else if(A)try{await Yt(j,A,W?.name),c(`${j.length} ordini aggiornati a "${h(k[A]?.labelKey)||A}"`,"success"),S([]),v()}catch(s){console.error("Error updating orders:",s),c("Errore nell'aggiornamento","error")}gs("")}}const Y=ps.filter(s=>{if(Pe!=="all"&&s.status!==Pe)return!1;if(Ce){const a=Ce.toLowerCase();return s.id.toString().includes(a)||s.customer_name?.toLowerCase().includes(a)||s.table_name?.toLowerCase().includes(a)}return!0}),z=(()=>{const s={},a=[];Y.forEach(t=>{t.session_id?(s[t.session_id]||(s[t.session_id]=[]),s[t.session_id].push(t)):a.push(t)});const n=[];return Object.entries(s).forEach(([t,r])=>{const i=r[0],b=r.reduce((o,g)=>o+g.total,0);n.push({type:"session",sessionId:Number(t),orders:r.sort((o,g)=>(o.order_number||0)-(g.order_number||0)),total:b,tableName:i.table_name,customerName:i.customer_name,date:i.date,createdAt:i.created_at,sessionStatus:i.session_status})}),a.forEach(t=>{n.push({type:"single",orders:[t],total:t.total,tableName:t.table_name,customerName:t.customer_name,date:t.date,createdAt:t.created_at})}),Oe&&Oe.length>0&&Oe.forEach(t=>{const r=t.id||t.session_id;s[r]||n.push({type:"session",sessionId:Number(r),orders:[],total:t.total||0,tableName:t.table_name||t.tableName,customerName:t.customer_name||t.customerName,date:t.created_at||t.date||new Date().toISOString(),createdAt:t.created_at||t.date||new Date().toISOString(),sessionStatus:t.status||"open"})}),n.sort((t,r)=>new Date(r.createdAt).getTime()-new Date(t.createdAt).getTime())})();function Is(s){st(a=>{const n=new Set(a);return n.has(s)?n.delete(s):n.add(s),n})}const $t={pending:ae.filter(s=>s.status==="pending"),preparing:ae.filter(s=>s.status==="preparing"),ready:ae.filter(s=>s.status==="ready"),delivered:ae.filter(s=>s.status==="delivered")};return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white whitespace-nowrap",children:h("orders.title")}),e.jsxs("div",{className:"flex gap-1 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>hs("today"),className:`px-2 sm:px-3 py-1.5 rounded-lg font-medium transition-all flex items-center gap-1 text-xs sm:text-sm whitespace-nowrap ${C==="today"?"bg-primary-500/20 text-primary-400":"text-dark-400 hover:text-white hover:bg-dark-800"}`,children:[e.jsx(Rs,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:h("common.today")})]}),e.jsxs("button",{onClick:()=>{hs("history"),ps.length===0&&v()},className:`px-2 sm:px-3 py-1.5 rounded-lg font-medium transition-all flex items-center gap-1 text-xs sm:text-sm whitespace-nowrap ${C==="history"?"bg-primary-500/20 text-primary-400":"text-dark-400 hover:text-white hover:bg-dark-800"}`,children:[e.jsx(Gt,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:h("orders.history")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Be&&e.jsx("div",{className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs ${_e?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,title:_e?"Connesso in tempo reale":"Non connesso",children:_e?e.jsx(Kt,{className:"w-4 h-4"}):e.jsx(Bt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w,className:"btn-secondary p-2",title:"Aggiorna",children:e.jsx(Qt,{className:"w-4 h-4"})}),e.jsxs(Ht,{to:"/orders/new",className:"btn-primary py-1.5 px-3 text-sm",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:h("orders.newOrder")})]})]})]}),C==="today"&&e.jsx(e.Fragment,{children:Gs&&xs.size===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 sm:gap-4 items-start",children:["pending","preparing","ready","delivered"].map(s=>{const a=k[s],n=$t[s],t=a.icon;return e.jsxs("div",{className:"card self-start",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:h(a.labelKey)})]}),e.jsx("span",{className:a.color,children:n.length})]}),e.jsx("div",{className:"p-3 sm:p-4 space-y-2",children:n.length===0?e.jsx("p",{className:"text-dark-500 text-center py-4 text-sm",children:h("orders.noActiveOrders")}):n.map(r=>{const i=Qs[s]?.has(r.id)||!1,b=()=>{Hs(o=>{const g=new Set(o[s]||[]);return g.has(r.id)?g.delete(r.id):g.add(r.id),{...o,[s]:g}})};return e.jsxs("div",{className:`bg-dark-900 rounded-xl overflow-hidden ${xs.has(r.id)?"order-transitioning":""}`,children:[e.jsx("div",{onClick:b,className:"px-2 py-1.5 sm:px-3 sm:py-2 cursor-pointer hover:bg-dark-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 sm:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[e.jsxs("span",{className:"text-[10px] sm:text-xs font-mono bg-dark-700 px-1 sm:px-1.5 py-0.5 rounded text-dark-300 flex-shrink-0",children:["#",r.id]}),e.jsx("span",{className:"font-medium text-white text-xs sm:text-sm truncate",children:r.session_id?`${r.table_name}${r.customer_name?` - ${r.customer_name}`:""}${r.order_number?` - C${r.order_number}`:""}`:r.table_name?`${h(H[r.order_type])} - ${r.table_name}${r.customer_name?` - ${r.customer_name}`:""}`:r.customer_name?`${h(H[r.order_type])} - ${r.customer_name}`:`${h(H[r.order_type])}`})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[V[r.id]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-dark-400 hidden xs:inline",children:[V[r.id].length," item"]}),i?e.jsx(Ze,{className:"w-4 h-4 text-primary-400"}):e.jsx(Xe,{className:"w-4 h-4 text-dark-400"})]})]})}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ease-in-out ${i?"max-h-[500px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-2 pb-1.5 space-y-1",children:[V[r.id]&&V[r.id].length>0&&e.jsx("div",{className:"bg-dark-800 rounded p-1.5 mt-1",children:V[r.id].map(o=>e.jsxs("div",{className:"leading-snug mb-1 last:mb-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[e.jsxs("span",{className:"font-bold text-primary-400",children:[o.quantity,"x"]}),e.jsx("span",{className:"text-white truncate",children:o.menu_item_name})]}),o.notes&&e.jsxs("p",{className:"text-[10px] text-amber-400 ml-5 truncate",children:["âš ï¸ ",o.notes]})]},o.id))}),r.notes&&e.jsxs("p",{className:"text-[9px] text-dark-400 truncate",children:["ðŸ“ ",r.notes]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a.next&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),Tt(r)},className:"btn-success flex-1 text-[10px] py-1 px-2 rounded",children:[e.jsx(qs,{className:"w-3 h-3"}),e.jsx("span",{children:s==="pending"?"Prepara":s==="preparing"?"Pronto":"Consegna"})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),fe(r)},className:"btn-secondary p-1 rounded",title:"Modifica",children:e.jsx(Q,{className:"w-3 h-3"})})]})]})})]},r.id)})})]},s)})})}),C==="history"&&e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"card p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-end gap-3 sm:gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:contents",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.from")}),e.jsx("input",{type:"date",value:de,onChange:s=>Ie(s.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.to")}),e.jsx("input",{type:"date",value:ce,onChange:s=>$e(s.target.value),className:"input text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:contents gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.status")}),e.jsxs("select",{value:Pe,onChange:s=>et(s.target.value),className:"select text-sm",children:[e.jsx("option",{value:"all",children:h("common.all")}),e.jsx("option",{value:"pending",children:h("orders.pending")}),e.jsx("option",{value:"preparing",children:h("orders.preparing")}),e.jsx("option",{value:"ready",children:h("orders.ready")}),e.jsx("option",{value:"delivered",children:h("orders.completed")}),e.jsx("option",{value:"cancelled",children:h("orders.cancelled")})]})]}),e.jsxs("div",{className:"flex items-end gap-2 sm:hidden",children:[e.jsxs("button",{onClick:()=>{const s=new Date().toISOString().split("T")[0];Ie(s),$e(s),setTimeout(()=>v(),0)},className:"btn-secondary flex-1",children:[e.jsx(zs,{className:"w-4 h-4"}),e.jsx("span",{children:"Oggi"})]}),e.jsxs("button",{onClick:v,className:"btn-primary flex-1",children:[e.jsx(Fs,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtra"})]})]})]}),e.jsxs("div",{className:"flex-1 min-w-0 sm:min-w-[200px]",children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(ca,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"ID, cliente, tavolo...",value:Ce,onChange:s=>Ks(s.target.value),className:"input pl-10 text-sm"})]})]}),e.jsxs("button",{onClick:()=>{const s=new Date().toISOString().split("T")[0];Ie(s),$e(s),setTimeout(()=>v(),0)},className:"btn-secondary hidden sm:flex",children:[e.jsx(zs,{className:"w-4 h-4"}),e.jsx("span",{children:"Oggi"})]}),e.jsxs("button",{onClick:v,className:"btn-primary hidden sm:flex",children:[e.jsx(Fs,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtra"})]})]})}),j.length>0&&e.jsx("div",{className:"card p-3 sm:p-4 bg-primary-500/10 border border-primary-500/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("p",{className:"text-primary-400 font-medium text-sm sm:text-base",children:[j.length," ordini selezionati"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("select",{value:A,onChange:s=>gs(s.target.value),className:"select text-sm",children:[e.jsx("option",{value:"",children:"Seleziona azione..."}),e.jsx("option",{value:"pending",children:"Imposta In Attesa"}),e.jsx("option",{value:"preparing",children:"Imposta In Preparazione"}),e.jsx("option",{value:"ready",children:"Imposta Pronto"}),e.jsx("option",{value:"delivered",children:"Imposta Consegnato"}),e.jsx("option",{value:"cancelled",children:"Imposta Annullato"}),e.jsx("option",{value:"delete",children:"ðŸ—‘ï¸ Elimina"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:It,disabled:!A,className:"btn-primary flex-1 sm:flex-none disabled:opacity-50 text-sm",children:"Applica"}),e.jsx("button",{onClick:()=>S([]),className:"btn-secondary flex-1 sm:flex-none text-sm",children:"Deseleziona"})]})]})]})}),Xs?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1 mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[z.length," ordini/conti"]}),e.jsx("button",{onClick:Ts,className:"text-xs text-primary-400",children:Y.every(s=>j.includes(s.id))?"Deseleziona":"Seleziona tutti"})]}),z.length===0?e.jsx("div",{className:"card p-6 text-center text-dark-400",children:e.jsx("p",{className:"text-sm",children:"Nessun ordine trovato"})}):z.map(s=>{const a=s.type==="session",n=s.orders[0],t=a&&js.has(s.sessionId),r=s.orders.every(i=>j.includes(i.id));return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:`p-3 ${a?"cursor-pointer":""} ${r?"bg-primary-500/10":""}`,onClick:a?()=>Is(s.sessionId):void 0,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),a?S(r?b=>b.filter(o=>!s.orders.some(g=>g.id===o)):b=>[...new Set([...b,...s.orders.map(o=>o.id)])]):Ne(n.id)},className:"p-0.5 flex-shrink-0 mt-0.5",children:r||j.includes(n.id)?e.jsx(ee,{className:"w-4 h-4 text-primary-400"}):e.jsx(se,{className:"w-4 h-4 text-dark-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a&&(t?e.jsx(Ze,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(Xe,{className:"w-4 h-4 text-dark-400 flex-shrink-0"})),e.jsx("span",{className:"font-medium text-white text-sm truncate",children:a?`Conto - ${s.tableName}`:`#${n.id}`}),a&&e.jsxs("span",{className:"text-xs text-dark-400",children:["(",s.orders.length," com. #",s.orders.map(i=>i.id).join(", #"),")"]})]}),e.jsx("span",{className:"font-semibold text-primary-400 flex-shrink-0",children:m(s.total)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-400 flex-wrap",children:[e.jsx("span",{children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:h(H[n.order_type])}),s.tableName&&!a&&e.jsxs("span",{children:["â€¢ ",s.tableName]}),s.customerName&&e.jsxs("span",{className:"text-white",children:["â€¢ ",s.customerName]})]}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded flex-shrink-0 ${k[n.status]?.color||"badge-secondary"}`,children:a?s.sessionStatus==="open"?"Aperto":"Chiuso":h(k[n.status]?.labelKey)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 pt-2 border-t border-dark-700",children:[e.jsxs("button",{onClick:i=>{i.stopPropagation(),K(n)},className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),"Dettagli"]}),e.jsxs("button",{onClick:i=>{i.stopPropagation(),Ge(n)},className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(Q,{className:"w-3.5 h-3.5"}),"Modifica"]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),a&&s.sessionId?Os(s.sessionId):B(n.id,n.session_id)},className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg",children:e.jsx(P,{className:"w-4 h-4"})})]})]}),a&&t&&e.jsx("div",{className:"bg-dark-900/50 border-t border-dark-700 animate-fadeIn",children:s.orders.map(i=>e.jsxs("div",{className:`px-3 py-2 border-b border-dark-800 last:border-b-0 ${j.includes(i.id)?"bg-primary-500/10":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ne(i.id),className:"p-0.5",children:j.includes(i.id)?e.jsx(ee,{className:"w-3.5 h-3.5 text-primary-400"}):e.jsx(se,{className:"w-3.5 h-3.5 text-dark-500"})}),e.jsx("span",{className:"text-dark-500",children:"â””"}),e.jsxs("span",{className:"font-mono text-dark-300 text-xs",children:["#",i.id]}),e.jsxs("span",{className:"text-xs text-dark-500",children:["Comanda ",i.order_number||1]}),e.jsx("span",{className:"ml-auto text-xs text-dark-300",children:m(i.total)}),e.jsx("span",{className:`${k[i.status]?.color||"badge-secondary"} text-[10px]`,children:h(k[i.status]?.labelKey)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>K(i),className:"btn-ghost btn-sm px-3 py-2 flex-1",title:"Visualizza comanda",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2 text-xs",children:"Dettagli"})]}),e.jsxs("button",{onClick:()=>fe(i),className:"btn-ghost btn-sm px-3 py-2 flex-1",title:"Modifica comanda",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2 text-xs",children:"Modifica"})]}),e.jsx("button",{onClick:()=>B(i.id,i.session_id),className:"btn-ghost btn-sm px-3 py-2 text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(P,{className:"w-4 h-4"})})]})]},i.id))})]},a?`session-${s.sessionId}`:`single-${n.id}`)})]}),e.jsxs("div",{className:"card hidden sm:block",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-white",children:[z.length," ",z.length===1?"ordine/conto":"ordini/conti"," (",Y.length," comande)"]}),e.jsx("button",{onClick:Ts,className:"text-sm text-primary-400 hover:text-primary-300",children:Y.every(s=>j.includes(s.id))?"Deseleziona tutti":"Seleziona tutti"})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Tavolo/Cliente"}),e.jsx("th",{children:"Totale"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:z.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-dark-400",children:"Nessun ordine trovato per il periodo selezionato"})}):z.map(s=>{if(s.type==="single"){const t=s.orders[0];return e.jsxs("tr",{className:j.includes(t.id)?"bg-primary-500/10":"",children:[e.jsx("td",{children:e.jsx("button",{onClick:()=>Ne(t.id),className:"p-1",children:j.includes(t.id)?e.jsx(ee,{className:"w-5 h-5 text-primary-400"}):e.jsx(se,{className:"w-5 h-5 text-dark-400"})})}),e.jsx("td",{children:e.jsxs("span",{className:"font-mono text-white",children:["#",t.id]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:new Date(t.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("p",{className:"text-xs text-dark-400",children:new Date(t.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark-300",children:h(H[t.order_type])})}),e.jsx("td",{children:e.jsxs("div",{children:[t.table_name&&e.jsx("p",{className:"text-white",children:t.table_name}),t.customer_name&&e.jsx("p",{className:"text-sm text-dark-400",children:t.customer_name})]})}),e.jsx("td",{children:e.jsx("span",{className:"font-semibold text-primary-400",children:m(t.total)})}),e.jsx("td",{children:e.jsx("span",{className:k[t.status]?.color||"badge-secondary",children:h(k[t.status]?.labelKey)||t.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(t),className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Dettagli",children:e.jsx(Z,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("button",{onClick:()=>Ge(t),className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Modifica ordine",children:e.jsx(Q,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("button",{onClick:()=>B(t.id,t.session_id),className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2 text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(P,{className:"w-5 h-5 md:w-6 md:h-6"})})]})})]},`single-${t.id}`)}const a=js.has(s.sessionId),n=s.orders.every(t=>j.includes(t.id));return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`cursor-pointer hover:bg-dark-800/70 transition-colors ${n?"bg-primary-500/10":"bg-dark-800/30"}`,onClick:()=>Is(s.sessionId),children:[e.jsx("td",{children:e.jsx("button",{onClick:t=>{t.stopPropagation(),S(n?r=>r.filter(i=>!s.orders.some(b=>b.id===i)):r=>[...new Set([...r,...s.orders.map(i=>i.id)])])},className:"p-1",children:n?e.jsx(ee,{className:"w-5 h-5 text-primary-400"}):e.jsx(se,{className:"w-5 h-5 text-dark-400"})})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:a?e.jsx(Ze,{className:"w-4 h-4 text-primary-400"}):e.jsx(Xe,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Conto"}),e.jsxs("p",{className:"text-xs text-dark-400",children:[s.orders.length," comande (#",s.orders.map(t=>t.id).join(", #"),")"]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("p",{className:"text-xs text-dark-400",children:new Date(s.createdAt).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark-300",children:"Tavolo"})}),e.jsx("td",{children:e.jsxs("div",{children:[s.tableName&&e.jsx("p",{className:"text-white",children:s.tableName}),s.customerName&&e.jsx("p",{className:"text-sm text-dark-400",children:s.customerName}),e.jsx("p",{className:`text-xs ${s.sessionStatus==="open"?"text-primary-400":"text-emerald-400"}`,children:s.sessionStatus==="open"?"Conto Aperto":"Conto Chiuso"})]})}),e.jsx("td",{children:e.jsx("span",{className:"font-semibold text-primary-400",children:m(s.total)})}),e.jsx("td",{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.orders.reduce((t,r)=>(t[r.status]=(t[r.status]||0)+1,t),{})).map(([t,r])=>e.jsxs("span",{className:`${k[t]?.color||"badge-secondary"} text-xs`,children:[r,"x ",h(k[t]?.labelKey)||t]},t))})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),K(s.orders[0])},className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Dettagli conto",children:e.jsx(Z,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),s.sessionId?_t(s.sessionId):Ge(s.orders[0])},className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Modifica conto (sconti totale)",children:e.jsx(Q,{className:"w-5 h-5 md:w-6 md:h-6 -scale-y-100"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),s.sessionId&&Os(s.sessionId)},className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2 text-red-400 hover:text-red-300",title:"Elimina conto",children:e.jsx(P,{className:"w-5 h-5 md:w-6 md:h-6"})})]})})]},`session-${s.sessionId}`),a&&s.orders.map((t,r)=>e.jsxs("tr",{className:`border-l-2 border-primary-500/30 animate-fadeIn ${j.includes(t.id)?"bg-primary-500/10":"bg-dark-900/30"}`,children:[e.jsx("td",{children:e.jsx("button",{onClick:()=>Ne(t.id),className:"p-1 ml-6",children:j.includes(t.id)?e.jsx(ee,{className:"w-4 h-4 text-primary-400"}):e.jsx(se,{className:"w-4 h-4 text-dark-500"})})}),e.jsx("td",{children:e.jsxs("div",{className:"pl-8 flex items-center gap-3",children:[e.jsx("span",{className:"text-dark-600",children:r===s.orders.length-1?"â””":"â”œ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-dark-700 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-mono text-primary-400",children:["#",t.id]})}),e.jsxs("span",{className:"text-sm text-dark-300",children:["Comanda ",t.order_number||1]})]})]})}),e.jsx("td",{children:e.jsx("p",{className:"text-sm text-dark-400",children:new Date(t.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("span",{className:"font-medium text-dark-300",children:m(t.total)})}),e.jsx("td",{children:e.jsx("span",{className:`${k[t.status]?.color||"badge-secondary"} text-xs`,children:h(k[t.status]?.labelKey)||t.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(t),className:"btn-ghost btn-sm px-3 py-2",title:"Visualizza comanda",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>fe(t),className:"btn-ghost btn-sm px-3 py-2",title:"Modifica comanda",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>B(t.id,t.session_id),className:"btn-ghost btn-sm px-3 py-2 text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(P,{className:"w-5 h-5"})})]})})]},`order-${t.id}`))]})})})]})})]})]})]}),e.jsx(la,{isOpen:Bs,onClose:()=>q(!1),sessionId:x?.session_id??void 0,orderId:x?.id??void 0,onViewOrder:s=>{K(s)},onEditOrder:s=>{q(!1),fe(s)},onDeleteOrder:(s,a)=>{B(s),q(!1)},onOpenSplit:()=>{ft()},onOpenBillStatus:()=>{Nt()},onAddOrder:()=>Et(),onTransfer:()=>Ot(),onCloseSession:()=>Cs()}),e.jsx($,{isOpen:Ws,onClose:()=>R(!1),title:`Modifica Ordine #${x?.id}`,size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tipo Ordine"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["dine_in","takeaway","delivery"].map(s=>e.jsx("button",{type:"button",onClick:()=>E({...d,order_type:s}),className:`p-3 rounded-xl border-2 transition-all ${d.order_type===s?"border-primary-500 bg-primary-500/20 text-primary-400":"border-dark-600 hover:border-dark-500 text-dark-300"}`,children:h(H[s])},s))})]}),d.order_type==="dine_in"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tavolo"}),e.jsxs("select",{value:d.table_id||"",onChange:s=>E({...d,table_id:s.target.value?Number(s.target.value):void 0}),className:"select",children:[e.jsx("option",{value:"",children:"Seleziona tavolo"}),Js.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.capacity," posti)"]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente"}),e.jsx("input",{type:"text",value:d.customer_name,onChange:s=>E({...d,customer_name:s.target.value}),className:"input",placeholder:"Nome cliente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:d.customer_phone,onChange:s=>E({...d,customer_phone:s.target.value}),className:"input",placeholder:"Telefono"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo Pagamento"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["cash","card","online"].map(s=>e.jsx("button",{type:"button",onClick:()=>E({...d,payment_method:s}),className:`p-3 rounded-xl border-2 transition-all ${d.payment_method===s?"border-primary-500 bg-primary-500/20 text-primary-400":"border-dark-600 hover:border-dark-500 text-dark-300"}`,children:s==="cash"?"Contanti":s==="card"?"Carta":"Online"},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stato Ordine"}),e.jsxs("select",{value:d.status,onChange:s=>E({...d,status:s.target.value}),className:"select",children:[e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"}),e.jsx("option",{value:"cancelled",children:"Annullato"})]})]}),M&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac_edit",checked:d.smac_passed,onChange:s=>E({...d,smac_passed:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac_edit",className:"text-white cursor-pointer",children:"SMAC Passata"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("label",{className:"label mb-2",children:"Totale Ordine"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-400",children:"â‚¬"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:d.total,onChange:s=>E({...d,total:parseFloat(s.target.value)||0}),className:"input pl-8 text-lg font-semibold"})]})}),d.total!==d.originalTotal&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-dark-400",children:["Originale: ",m(d.originalTotal)]}),e.jsx("p",{className:`text-sm font-medium ${d.total<d.originalTotal?"text-emerald-400":"text-amber-400"}`,children:d.total<d.originalTotal?`Sconto: -${m(d.originalTotal-d.total)}`:`+${m(d.total-d.originalTotal)}`})]})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Modifica il totale per applicare sconti o arrotondamenti"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:d.notes,onChange:s=>E({...d,notes:s.target.value}),className:"input min-h-[80px]",placeholder:"Note aggiuntive..."})]}),x?.session_id&&x?.session_status==="open"&&!tt&&e.jsx("div",{className:"bg-primary-500/10 border border-primary-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Conto Aperto"}),e.jsxs("p",{className:"text-sm text-dark-400",children:["Totale: ",m(x.total)]})]}),e.jsxs("button",{onClick:Cs,className:"btn-primary bg-emerald-600 hover:bg-emerald-700 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Chiudi Conto"]})]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:jt,className:"btn-primary flex-1",children:"Salva Modifiche"}),e.jsx("button",{onClick:()=>R(!1),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:()=>{confirm("Sei sicuro di voler eliminare questa comanda? L'azione non puÃ² essere annullata.")&&(B(x.id,x?.session_id),R(!1))},className:"btn-danger",title:"Elimina comanda",children:e.jsx(P,{className:"w-5 h-5"})})]})]})}),e.jsx($,{isOpen:Vs,onClose:()=>re(!1),title:"Modifica Totale Conto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Totale Conto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-400",children:"â‚¬"}),e.jsx("input",{type:"text",value:ls,onChange:s=>Ee(s.target.value),className:"input pl-8 text-lg font-semibold"})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Inserisci il totale da impostare per questo conto."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:pt,className:"btn-primary flex-1",children:"Salva"}),e.jsx("button",{onClick:()=>re(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx($,{isOpen:Ys,onClose:()=>ie(!1),title:`Modifica Comanda #${x?.id}`,size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Prodotti nella Comanda"}),e.jsx("div",{className:"bg-dark-900 rounded-xl p-3 space-y-2 max-h-64 overflow-y-auto",children:le.length===0?e.jsx("p",{className:"text-dark-400 text-sm text-center py-2",children:"Nessun prodotto"}):le.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-dark-700 last:border-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"text-dark-400 text-sm ml-2",children:[m(s.price),"/cad"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ks(s.id,s.quantity-1),disabled:s.quantity<=1,className:"p-1.5 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ma,{className:"w-4 h-4 text-dark-300"})}),e.jsx("span",{className:"text-primary-400 font-bold w-8 text-center",children:s.quantity}),e.jsx("button",{onClick:()=>ks(s.id,s.quantity+1),className:"p-1.5 rounded-lg bg-dark-700 hover:bg-dark-600",children:e.jsx($s,{className:"w-4 h-4 text-dark-300"})}),e.jsx("span",{className:"text-dark-300 w-16 text-right",children:m(s.price*s.quantity)}),e.jsx("button",{onClick:()=>gt(s.id),className:"p-1.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400",title:"Rimuovi prodotto",children:e.jsx(P,{className:"w-4 h-4"})})]})]},s.id))}),le.length>0&&e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-dark-700",children:[e.jsx("span",{className:"text-dark-400",children:"Totale Comanda:"}),e.jsx("span",{className:"text-lg font-bold text-primary-400",children:m(le.reduce((s,a)=>s+a.price*a.quantity,0))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stato Comanda"}),e.jsxs("select",{value:os,onChange:s=>ds(s.target.value),className:"select",children:[e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"}),e.jsx("option",{value:"cancelled",children:"Annullato"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note Cucina"}),e.jsx("textarea",{value:cs,onChange:s=>ms(s.target.value),className:"input min-h-[60px]",placeholder:"Note per la cucina..."})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-blue-400 text-sm",children:"Modifica le quantitÃ  o rimuovi prodotti usando i pulsanti +/- e il cestino. Per sconti o totali personalizzati, usa Lista Ordini."})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:ut,className:"btn-primary flex-1",children:"Salva Modifiche"}),e.jsx("button",{onClick:()=>ie(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx($,{isOpen:nt,onClose:()=>bs(!1),title:"Coperto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Coperto da applicare"}),e.jsx("p",{className:"text-2xl font-bold text-primary-400",children:m(rt)}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["(",it," coperti Ã— ",m(lt),")"]})]}),e.jsx("p",{className:"text-center text-dark-300",children:"Vuoi applicare il coperto a questo conto?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>Le(!0),className:"btn-primary py-3",children:"SÃ¬, applica"}),e.jsx("button",{onClick:()=>Le(!1),className:"btn-secondary py-3",children:"No, senza coperto"})]})]})}),e.jsx($,{isOpen:at,onClose:()=>{me(!1),D(null)},title:"Chiudi Conto",size:y.method==="cash"?"2xl":"md",children:p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:y.method==="cash"?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsx("p",{className:"text-3xl font-bold text-primary-400",children:m(p.total)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>U({...y,method:"cash"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${y.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(te,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>U({...y,method:"card"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${y.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(we,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>U({...y,method:"online"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${y.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(es,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Online"})]})]})]}),M&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac_payment",checked:y.smac,onChange:s=>U({...y,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac_payment",className:"text-white",children:"SMAC passato"})]})]}),y.method==="cash"&&p.total>0&&e.jsxs("div",{className:"mt-4 md:mt-0 p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dÃ "}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:O.customerGives,onChange:s=>J({customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"â‚¬"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsx("button",{type:"button",onClick:()=>J({customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:m(s)},s))}),O.customerGives&&parseFloat(O.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsx("span",{className:"text-white",children:m(p.total)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dÃ :"}),e.jsx("span",{className:"text-white",children:m(parseFloat(O.customerGives))})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:m(Math.max(0,parseFloat(O.customerGives)-p.total))})]}),parseFloat(O.customerGives)<p.total&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["Mancano ",m(p.total-parseFloat(O.customerGives))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:bt,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>{me(!1),D(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx($,{isOpen:dt,onClose:()=>xe(!1),title:"Dividi Conto",size:"2xl",children:p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:m(p.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:m(p.total-_)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:m(_)})]})]}),p.total>0&&e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,(p.total-_)/p.total*100)}%`}})})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[L.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-40 lg:max-h-64 overflow-y-auto",children:L.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(te,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(we,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(es,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-white text-sm",children:m(s.amount)}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-xs",children:["- ",s.notes]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[M&&s.smac_passed&&e.jsx("span",{className:"text-[10px] bg-primary-500/20 text-primary-400 px-1.5 py-0.5 rounded-full",children:"SMAC"}),e.jsx("button",{onClick:()=>Es(s),className:"p-1 hover:bg-dark-700 rounded transition-colors",title:"Stampa scontrino",children:e.jsx(ss,{className:"w-3.5 h-3.5 text-dark-400"})})]})]},s.id))})]}),L.length===0&&e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl text-center text-dark-500 text-sm",children:"Nessun pagamento ancora effettuato"})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[ys>0&&be>0&&p&&e.jsxs("div",{className:"p-3 mb-3 bg-dark-900 rounded-xl flex items-center gap-3",children:[e.jsx("input",{id:"apply_cover_split",type:"checkbox",checked:ws,onChange:s=>Ss(p.id,s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"apply_cover_split",className:"text-white",children:["Applica coperto (",m(be)," / ospite)"]})]}),_>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>pe("manual"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${he==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(te,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>pe("items"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${he==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(oa,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Per Prodotto"})]})]}),he==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare."}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:T.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:"Tutti i prodotti sono stati pagati"}):T.map(s=>{const a=G[s.id]||0;return e.jsx("div",{className:`p-3 rounded-lg border-2 ${a>0?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:[m(s.price)," â€¢ ",s.remainingQty," rimasti"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>yt(s.id),disabled:a===0,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"-"}),e.jsx("span",{className:"w-8 text-center font-bold",children:a}),e.jsx("button",{onClick:()=>vt(s.id),disabled:a>=s.remainingQty,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"+"})]})]})},s.id)})}),Object.keys(G).length>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg flex justify-between",children:[e.jsx("span",{children:"Totale:"}),e.jsx("span",{className:"text-blue-400 font-bold",children:m(_s())})]}),e.jsx("button",{onClick:wt,disabled:Object.keys(G).length===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),he==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo"}),e.jsx("input",{type:"number",step:"0.01",value:f.amount,onChange:s=>I({...f,amount:s.target.value}),className:"input",placeholder:`Max â‚¬${_.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{type:"text",value:f.notes,onChange:s=>I({...f,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I({...f,method:"cash"}),className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${f.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(te,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>I({...f,method:"card"}),className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${f.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(we,{className:"w-4 h-4"})," Carta"]})]}),M&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"orders_split_smac",checked:f.smac,onChange:s=>I({...f,smac:s.target.checked}),className:"w-5 h-5"}),e.jsx("label",{htmlFor:"orders_split_smac",className:"text-white",children:"SMAC passato"})]}),f.method==="cash"&&f.amount&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsx("input",{type:"number",value:O.customerGives,onChange:s=>J({customerGives:s.target.value}),className:"input",placeholder:"Cliente dÃ  â‚¬..."}),O.customerGives&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg flex justify-between",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:m(kt())})]})]}),e.jsx("button",{onClick:Ct,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),_===0&&e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(Qe,{className:"w-10 h-10 mx-auto mb-2 text-emerald-400"}),e.jsx("h4",{className:"text-lg font-bold text-emerald-400 mb-1",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Il conto Ã¨ stato completamente pagato."})]})]})]}),e.jsx("button",{onClick:()=>xe(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx($,{isOpen:ct,onClose:()=>Me(!1),title:"Stato del Conto",size:"2xl",children:p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:m(p.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:m(p.total-_)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:m(_)})]})]}),ys>0&&be>0&&p&&e.jsxs("div",{className:"p-3 mt-3 bg-dark-900 rounded-xl flex items-center gap-3",children:[e.jsx("input",{id:"apply_cover_bill",type:"checkbox",checked:ws,onChange:s=>Ss(p.id,s.target.checked),className:"w-5 h-5"}),e.jsxs("label",{htmlFor:"apply_cover_bill",className:"text-white",children:["Applica coperto (",m(be)," / ospite)"]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsx("div",{children:L.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:["Pagamenti (",L.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 lg:max-h-72 overflow-y-auto",children:L.map((s,a)=>e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(te,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(we,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(es,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"font-medium text-white text-sm",children:["#",a+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-primary-400",children:m(s.amount)}),M&&s.smac_passed&&e.jsx("span",{className:"text-[10px] bg-primary-500/20 text-primary-400 px-1.5 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-xs text-dark-400",children:[new Date(s.paid_at).toLocaleString("it-IT"),s.notes&&` â€¢ ${s.notes}`]}),s.paid_items&&s.paid_items.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-700 space-y-0.5",children:s.paid_items.map((n,t)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-dark-300",children:[n.quantity,"x ",n.menu_item_name]}),e.jsx("span",{className:"text-dark-400",children:m(n.price*n.quantity)})]},t))}),e.jsxs("button",{onClick:()=>Es(s),className:"mt-2 w-full btn-secondary text-xs py-1.5 flex items-center justify-center gap-1",children:[e.jsx(ss,{className:"w-3.5 h-3.5"}),"Stampa"]})]},s.id))})]}):e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(xa,{className:"w-10 h-10 mx-auto mb-2 text-dark-600"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Nessun pagamento effettuato"})]})}),e.jsx("div",{className:"mt-4 md:mt-0",children:T.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:["Da pagare (",T.length,")"]}),e.jsx("div",{className:"space-y-1.5 max-h-48 lg:max-h-72 overflow-y-auto",children:T.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsx("span",{className:"text-primary-400 font-medium",children:m(s.price*s.remainingQty)})]},s.id))})]}):e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(Qe,{className:"w-10 h-10 mx-auto mb-2 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>Me(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx($,{isOpen:mt,onClose:()=>Ae(!1),title:"Scontrino",size:"sm",children:u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:u.shop_info.name}),u.shop_info.address&&e.jsx("p",{className:"text-xs",children:u.shop_info.address}),u.shop_info.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",u.shop_info.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",u.date," ",u.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:u.items.map((s,a)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsx("span",{children:m(s.total)})]},a))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsx("span",{children:m(u.total)})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",u.payment_method==="cash"?"Contanti":u.payment_method==="card"?"Carta":"Online"]}),M&&u.smac_passed&&e.jsx("p",{children:"SMAC: SÃ¬"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:St,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>Ae(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{Ea as Orders};
