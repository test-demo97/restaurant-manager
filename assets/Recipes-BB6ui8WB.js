import{u as B,r,o as G,as as K,aI as W,t as i,j as e,C as N,h as M,v as R,J as v,aJ as O,e as V,P as X,aK as Y,aL as Z,aM as ee}from"./index-CSC5BhIu.js";import{S as se}from"./search-5ONjMD3X.js";function re(){B();const[m,q]=r.useState([]),[x,z]=r.useState([]),[j,L]=r.useState([]),[T,A]=r.useState(!0),[l,b]=r.useState(null),[w,P]=r.useState(""),[o,y]=r.useState(!1),[h,k]=r.useState(""),[p,I]=r.useState("");r.useEffect(()=>{g()},[]);async function g(){try{const[s,t,a]=await Promise.all([G(),K(),W()]);q(s),z(t),L(a),s.length>0&&!l&&b(s[0].id)}catch(s){console.error("Error loading data:",s),i("Errore nel caricamento dati","error")}finally{A(!1)}}const C=m.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())),d=j.filter(s=>s.menu_item_id===l),c=m.find(s=>s.id===l),S=x.filter(s=>!d.some(t=>t.ingredient_id===s.id));async function Q(){if(!l||!h||!p){i("Seleziona ingrediente e quantità","warning");return}try{await ee({menu_item_id:l,ingredient_id:Number(h),quantity:parseFloat(p)}),i("Ingrediente aggiunto alla ricetta","success"),k(""),I(""),g()}catch(s){console.error("Error adding ingredient:",s),i("Errore nell'aggiunta","error")}}async function $(s,t){try{await Y(s,{quantity:t}),i("Quantità aggiornata","success"),g()}catch(a){console.error("Error updating quantity:",a),i("Errore nell'aggiornamento","error")}}async function H(s){try{await Z(s),i("Ingrediente rimosso","success"),g()}catch(t){console.error("Error removing ingredient:",t),i("Errore nella rimozione","error")}}const u=d.reduce((s,t)=>{const a=x.find(n=>n.id===t.ingredient_id);return s+(a?a.cost*t.quantity:0)},0);if(T)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});function D(s){b(s),y(!0)}function J(){y(!1)}const _=m.filter(s=>j.some(t=>t.menu_item_id===s.id)).length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(N,{className:"w-6 h-6 text-primary-400"}),"Gestione Ricette"]}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Collega ingredienti ai piatti per calcolo scorte e costi"})]}),e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-emerald-500/20 rounded-lg",children:[e.jsx(M,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"text-emerald-400 font-medium",children:_}),e.jsx("span",{className:"text-dark-400 hidden sm:inline",children:"con ricetta"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-amber-500/20 rounded-lg",children:[e.jsx(R,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-amber-400 font-medium",children:m.length-_}),e.jsx("span",{className:"text-dark-400 hidden sm:inline",children:"senza"})]})]})]}),e.jsxs("div",{className:"lg:grid lg:grid-cols-12 lg:gap-4 lg:h-[calc(100vh-180px)]",children:[e.jsxs("div",{className:`lg:col-span-4 bg-dark-800 rounded-xl border border-dark-700 flex flex-col ${o?"hidden lg:flex":"flex"}`,style:{minHeight:o?void 0:"calc(100vh - 180px)"},children:[e.jsx("div",{className:"p-3 border-b border-dark-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"Cerca piatto...",value:w,onChange:s=>P(s.target.value),className:"input pl-9 py-2.5 text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:C.length===0?e.jsxs("div",{className:"p-6 text-center text-dark-400",children:[e.jsx(v,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nessun piatto trovato"})]}):C.map(s=>{const t=j.filter(f=>f.menu_item_id===s.id),a=t.length>0,n=t.reduce((f,E)=>{const F=x.find(U=>U.id===E.ingredient_id);return f+(F?F.cost*E.quantity:0)},0);return e.jsx("button",{onClick:()=>D(s.id),className:`w-full p-3 sm:p-4 text-left border-b border-dark-700 transition-colors ${l===s.id?"bg-primary-500/20 border-l-4 border-l-primary-500":"hover:bg-dark-700 active:bg-dark-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-sm text-dark-400",children:["€",s.price.toFixed(2)]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-dark-600",children:"•"}),e.jsxs("span",{className:`text-xs ${s.price-n>0?"text-emerald-400":"text-red-400"}`,children:["Margine €",(s.price-n).toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded",children:[t.length," ing."]}):e.jsx("span",{className:"text-xs bg-amber-500/20 text-amber-400 px-2 py-1 rounded",children:"Da fare"})})]})},s.id)})}),e.jsx("div",{className:"p-3 border-t border-dark-700 text-xs text-dark-400 hidden sm:block",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(M,{className:"w-3 h-3 text-emerald-500"}),e.jsx("span",{children:"Con ricetta"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(R,{className:"w-3 h-3 text-amber-500"}),e.jsx("span",{children:"Senza ricetta"})]})]})})]}),e.jsx("div",{className:`lg:col-span-8 bg-dark-800 rounded-xl border border-dark-700 flex flex-col ${o?"flex":"hidden lg:flex"}`,style:{minHeight:o?"calc(100vh - 180px)":void 0},children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-dark-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:J,className:"lg:hidden p-2 -ml-2 text-dark-400 hover:text-white hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-primary-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-white truncate",children:c.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs sm:text-sm text-dark-400",children:[e.jsxs("span",{children:["Prezzo: ",e.jsxs("span",{className:"text-white",children:["€",c.price.toFixed(2)]})]}),e.jsxs("span",{children:["Costo: ",e.jsxs("span",{className:"text-white",children:["€",u.toFixed(2)]})]}),e.jsxs("span",{className:u>0?c.price-u>0?"text-emerald-400":"text-red-400":"",children:["Margine: €",(c.price-u).toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-dark-300 mb-3",children:["Ingredienti nella ricetta (",d.length,")"]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-dark-400",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:"Nessun ingrediente"}),e.jsx("p",{className:"text-sm mt-1",children:"Usa il form qui sotto per aggiungere ingredienti"})]}):e.jsx("div",{className:"space-y-2",children:d.map(s=>{const t=x.find(n=>n.id===s.ingredient_id),a=t?t.cost*s.quantity:0;return e.jsx("div",{className:"p-3 bg-dark-900 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(v,{className:"w-5 h-5 text-dark-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:s.ingredient_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",t?.cost.toFixed(2),"/",s.unit," → ",e.jsxs("span",{className:"text-primary-400",children:["€",a.toFixed(3)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 pl-8 sm:pl-0",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-1 sm:flex-none",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.quantity,onChange:n=>$(s.id,parseFloat(n.target.value)||0),className:"w-20 sm:w-24 bg-dark-800 border border-dark-600 rounded-lg px-3 py-2 text-sm text-center"}),e.jsx("span",{className:"text-sm text-dark-400 w-10",children:s.unit})]}),e.jsx("button",{onClick:()=>H(s.id),className:"p-2.5 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",children:e.jsx(V,{className:"w-4 h-4"})})]})]})},s.id)})})]}),e.jsxs("div",{className:"p-4 border-t border-dark-700 bg-dark-900/50",children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300 mb-3",children:"Aggiungi ingrediente"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:h,onChange:s=>k(s.target.value?Number(s.target.value):""),className:"input flex-1 py-2.5 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona ingrediente..."}),S.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,") - €",s.cost.toFixed(2)]},s.id))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Quantità",value:p,onChange:s=>I(s.target.value),className:"input flex-1 sm:w-28 py-2.5 text-sm"}),e.jsxs("button",{onClick:Q,disabled:!h||!p,className:"btn-primary px-4 py-2.5 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"sm:hidden",children:"Aggiungi"})]})]})]}),S.length===0&&e.jsx("p",{className:"text-xs text-amber-400 mt-2",children:"Tutti gli ingredienti sono già nella ricetta"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-dark-400 p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-16 h-16 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium",children:"Seleziona un piatto"}),e.jsx("p",{className:"text-sm mt-1",children:"Clicca su un piatto dalla lista per modificare la ricetta"})]})})})]})]})}export{re as Recipes};
