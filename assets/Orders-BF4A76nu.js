import{d as ya,u as wa,k as ka,i as Ca,r as i,D as Sa,E as H,t as p,F as Ns,G as pe,j as e,H as _a,W as Oa,I as Pa,R as Ea,L as $a,P as fs,e as L,J as Ta,c as Ge,C as Ia,K as W,N as ue,M,O as je,f as ge,Q as De,V as Aa,Y as vs,Z as Ma,_ as Da,x as be,$ as Ne,p as za,a0 as Fa,B as Ra,a1 as ze,a2 as Fe,q as qa,s as La,a3 as ys,a4 as Ka,a5 as ws,a6 as Ga,a7 as ks,a8 as Ba,a9 as Qa}from"./index-BP0TVsm5.js";import{u as Ha}from"./useCurrency-xMqiDiDJ.js";import{u as Wa}from"./useDemoGuard-BJoSrPxu.js";import{C as _s}from"./clock-Do-4Ajo7.js";import{C as Re}from"./chevron-down-CpFrdbwl.js";import{C as qe}from"./chevron-right-Zeo8Ppur.js";import{C as Cs}from"./calendar-ixF2_BIP.js";import{S as Va}from"./search-ByNraucg.js";import{S as se,a as ae,b as Ua,L as Ja}from"./square-BXGirSPY.js";import{C as Ya}from"./clipboard-list-CTZf65U8.js";import{M as Za}from"./minus-m9kd0Ngn.js";import{B as te}from"./banknote-B9eTj8Za.js";import{G as Le}from"./globe-CB4Rrgrn.js";import{P as Ke}from"./printer-D_KC1EMh.js";import{F as Xa}from"./file-text-BZGrC64J.js";const et=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ss=ya("funnel",et),b={pending:{labelKey:"orders.pending",icon:_s,color:"badge-warning",next:"preparing"},preparing:{labelKey:"orders.preparing",icon:Ia,color:"badge-info",next:"ready"},ready:{labelKey:"orders.ready",icon:Ge,color:"badge-success",next:"delivered"},delivered:{labelKey:"orders.completed",icon:Ta,color:"badge-success",next:null},cancelled:{labelKey:"orders.cancelled",icon:L,color:"badge-danger",next:null}},q={dine_in:"orders.dineIn",takeaway:"orders.takeaway",delivery:"orders.delivery"};function jt(){const{t:h}=wa(),{formatPrice:o}=Ha(),{checkCanWrite:fe}=Wa(),{user:V}=ka(),{smacEnabled:_}=Ca(),[ne,Os]=i.useState([]),[Ps,Be]=i.useState(!0),[Qe]=i.useState(new Date().toISOString().split("T")[0]),[ve,Es]=i.useState(""),[r,ye]=i.useState(null),[$s,Ts]=i.useState([]),[Is,D]=i.useState(!1),[we,As]=i.useState(!1),[U,Ms]=i.useState({}),[Ds,He]=i.useState({pending:new Set,preparing:new Set,ready:new Set,delivered:new Set}),[zs,z]=i.useState(!1),[We,Fs]=i.useState([]),[c,O]=i.useState({order_type:"dine_in",table_id:void 0,payment_method:"cash",customer_name:"",customer_phone:"",notes:"",smac_passed:!1,status:"pending",total:0,originalTotal:0}),[Rs,le]=i.useState(!1),[re,ie]=i.useState([]),[Ve,Ue]=i.useState("pending"),[Je,Ye]=i.useState(""),[A,Ze]=i.useState("today"),[Xe,qs]=i.useState([]),[Ls,es]=i.useState(!1),[ss,ke]=i.useState(()=>{const s=new Date;return s.setDate(s.getDate()-7),s.toISOString().split("T")[0]}),[as,Ce]=i.useState(new Date().toISOString().split("T")[0]),[Se,Ks]=i.useState("all"),[g,w]=i.useState([]),[F,ts]=i.useState(""),[P,ns]=i.useState([]),[Gs,ls]=i.useState({}),[rs,Bs]=i.useState(new Set),[Qs,Hs]=i.useState(!1),[Ws,de]=i.useState(!1),[j,K]=i.useState(null),[f,J]=i.useState({method:"cash",smac:!1}),[E,Y]=i.useState({customerGives:""}),[Vs,_e]=i.useState(!1),[Us,Js]=i.useState(0),[Ys,Zs]=i.useState(0),[Xs,ea]=i.useState(0),[sa,is]=i.useState(!0),[aa,oe]=i.useState(!1),[ta,Oe]=i.useState(!1),[na,Pe]=i.useState(!1),[u,la]=i.useState(null),[G,B]=i.useState("manual"),[$,Z]=i.useState([]),[v,Ee]=i.useState(0),[ra,ds]=i.useState([]),[T,$e]=i.useState([]),[Q,ce]=i.useState({}),[y,Te]=i.useState({totalPeople:"",payingPeople:""}),[N,I]=i.useState({amount:"",method:"cash",notes:"",smac:!1}),[os,Ie]=i.useState([]),k=i.useCallback(async()=>{Be(!0);try{const s=await Sa(Qe);Os(s);const t=s.filter(a=>a.status!=="cancelled"),n={};await Promise.all(t.map(async a=>{const d=await H(a.id);n[a.id]=d})),Ms(n)}catch(s){console.error("Error loading orders:",s),p("Errore nel caricamento ordini","error")}finally{Be(!1)}},[Qe]);i.useEffect(()=>{k()},[k]),i.useEffect(()=>{if(!Ns||!pe)return;const s=pe.channel("orders-realtime").on("postgres_changes",{event:"*",schema:"public",table:"orders"},t=>{console.log("Realtime update:",t),k()}).subscribe(t=>{console.log("Realtime status:",t),As(t==="SUBSCRIBED")});return()=>{pe&&pe.removeChannel(s)}},[k]);async function cs(s){if(!fe())return;const t=b[s.status];if(t.next)try{await vs(s.id,t.next,V?.name),He(n=>{const a={...n},d=s.status,l=t.next;return a[d]?.has(s.id)&&(a[d]=new Set(a[d]),a[d].delete(s.id),a[l]=new Set(a[l]||[]),a[l].add(s.id)),a}),p(`Ordine #${s.id} aggiornato`,"success"),k()}catch(n){console.error("Error updating order:",n),p("Errore nell'aggiornamento","error")}}async function X(s,t){if(fe()&&confirm("Sei sicuro di voler eliminare questo ordine?"))try{await Fa(s,V?.name),t&&await Ra(t),p("Ordine eliminato","success"),k(),A==="history"&&C()}catch(n){console.error("Error deleting order:",n),p("Errore nell'eliminazione","error")}}async function me(s){ye(s);try{const t=await H(s.id);if(Ts(t),s.session_id){const n=await be(s.session_id);ns(n);const a={};await Promise.all(n.map(async l=>{const x=await H(l.id);a[l.id]=x})),ls(a);const d=await Ne(s.session_id);Z(d)}else ns([]),ls({}),Z([]);D(!0)}catch(t){console.error("Error loading order items:",t),p("Errore nel caricamento dettagli","error")}}async function xe(s,t=!1){if(ye(s),Hs(t),O({order_type:s.order_type,table_id:s.table_id,payment_method:s.payment_method,customer_name:s.customer_name||"",customer_phone:s.customer_phone||"",notes:s.notes||"",smac_passed:s.smac_passed,status:s.status,total:s.total,originalTotal:s.total}),We.length===0)try{const n=await za();Fs(n)}catch(n){console.error("Error loading tables:",n)}z(!0)}async function ms(s){ye(s),Ue(s.status),Ye(s.notes||"");try{const t=await H(s.id);ie(t)}catch(t){console.error("Error loading order items:",t),ie([])}le(!0)}async function ia(){if(r)try{await ys(r.id,{status:Ve,notes:Je||void 0}),p("Comanda modificata con successo","success"),le(!1),k()}catch(s){console.error("Error updating order:",s),p("Errore nella modifica","error")}}async function xs(s,t){if(!(t<1))try{await Ka(s,{quantity:t}),ie(n=>n.map(a=>a.id===s?{...a,quantity:t}:a)),r&&await ws(r.id)}catch(n){console.error("Error updating item quantity:",n),p("Errore nell'aggiornamento","error")}}async function da(s){if(confirm("Sei sicuro di voler rimuovere questo prodotto dalla comanda?"))try{await Ga(s),ie(t=>t.filter(n=>n.id!==s)),r&&await ws(r.id),p("Prodotto rimosso","success")}catch(t){console.error("Error deleting item:",t),p("Errore nella rimozione","error")}}async function oa(){if(r)try{await ys(r.id,{order_type:c.order_type,table_id:c.order_type==="dine_in"?c.table_id:void 0,payment_method:c.payment_method,customer_name:c.customer_name||void 0,customer_phone:c.customer_phone||void 0,notes:c.notes||void 0,smac_passed:c.smac_passed,status:c.status,total:c.total}),p("Ordine modificato con successo","success"),z(!1),k(),A==="history"&&C()}catch(s){console.error("Error updating order:",s),p("Errore nella modifica","error")}}async function hs(){if(r?.session_id)try{const t=(await be(r.session_id)).reduce((x,m)=>x+m.total,0);K({id:r.session_id,total:t});const n=await qa(),a=await La(r.session_id),d=n.cover_charge||0,l=a?.covers||0;if(d>0&&l>0){const x=d*l;Js(x),Zs(l),ea(d),is(!0),z(!1),_e(!0)}else Ae(!1)}catch(s){console.error("Error loading session orders:",s),p("Errore nel caricamento del conto","error")}}function Ae(s){is(s),_e(!1),J({method:"cash",smac:!1}),Y({customerGives:""}),z(!1),de(!0)}async function ca(){if(j)try{await ks(j.id,f.method,f.smac,sa),r&&await vs(r.id,"delivered",V?.name),p("Conto chiuso con successo","success"),de(!1),K(null),k(),A==="history"&&C()}catch(s){console.error("Error closing session:",s),p("Errore nella chiusura del conto","error")}}async function ma(){if(r?.session_id)try{const s=await be(r.session_id),t=s.reduce((m,S)=>m+S.total,0),[n,a,d]=await Promise.all([Ne(r.session_id),ze(r.session_id),Fe(r.session_id)]),l=[];for(const m of s)(await H(m.id)).forEach(Me=>{l.push({...Me,order_number:m.order_number||1})});ds(l),Z(n),Ee(a);const x=l.map(m=>({...m,remainingQty:m.quantity-(d[m.id]||0)})).filter(m=>m.remainingQty>0);$e(x),K({id:r.session_id,total:t}),I({amount:"",method:"cash",notes:"",smac:!1}),B("manual"),ce({}),Te({totalPeople:"",payingPeople:""}),Y({customerGives:""}),Ie([]),D(!1),oe(!0)}catch(s){console.error("Error loading split data:",s),p("Errore nel caricamento dati","error")}}async function xa(){if(r?.session_id)try{const[s,t,n]=await Promise.all([Ne(r.session_id),ze(r.session_id),Fe(r.session_id)]),a=await be(r.session_id),d=a.reduce((m,S)=>m+S.total,0),l=[];for(const m of a)(await H(m.id)).forEach(Me=>{l.push({...Me,order_number:m.order_number||1})});ds(l),Z(s),Ee(t),K({id:r.session_id,total:d});const x=l.map(m=>({...m,remainingQty:m.quantity-(n[m.id]||0)})).filter(m=>m.remainingQty>0);$e(x),D(!1),Oe(!0)}catch(s){console.error("Error loading bill status:",s),p("Errore nel caricamento stato conto","error")}}function ps(){return Object.entries(Q).reduce((s,[t,n])=>{const a=T.find(d=>d.id===Number(t));return a&&n>0?s+a.price*n:s},0)}function ha(s){const t=T.find(n=>n.id===s);t&&ce(n=>{const a=n[s]||0;return a<t.remainingQty?{...n,[s]:a+1}:n})}function pa(s){ce(t=>{const n=t[s]||0;if(n>0){const a=n-1;if(a===0){const{[s]:d,...l}=t;return l}return{...t,[s]:a}}return t})}function us(){if(!j)return 0;const s=parseInt(y.totalPeople)||1,t=parseInt(y.payingPeople)||1,n=v/s;return Math.min(n*t,v)}function ua(){const s=us();s>0&&(I(t=>({...t,amount:s.toFixed(2),notes:`Alla romana (${y.payingPeople}/${y.totalPeople} persone)`})),B("manual"))}function ja(){const s=ps();if(s>0&&s<=v){const t=Object.entries(Q).map(([a,d])=>{const l=T.find(x=>x.id===Number(a));return l?`${d}x ${l.menu_item_name}`:""}).filter(Boolean).join(", "),n=Object.entries(Q).map(([a,d])=>{const l=T.find(x=>x.id===Number(a));return l?{order_item_id:l.id,quantity:d,menu_item_name:l.menu_item_name,price:l.price}:null}).filter(a=>a!==null);Ie(n),I(a=>({...a,amount:Math.min(s,v).toFixed(2),notes:t.length>40?t.substring(0,40)+"...":t})),B("manual"),ce({})}}function ga(){const s=parseFloat(E.customerGives)||0,t=parseFloat(N.amount)||0;return Math.max(0,s-t)}async function ba(){if(!j){p("Sessione non trovata","error");return}const s=parseFloat(N.amount);if(isNaN(s)||s<=0){p("Inserisci un importo valido","warning");return}if(s>v+.01){p("Importo superiore al rimanente","warning");return}try{await Qa(j.id,s,N.method,N.notes||void 0,N.smac,os.length>0?os:void 0);const[t,n,a]=await Promise.all([Ne(j.id),ze(j.id),Fe(j.id)]);Z(t),Ee(n);const d=ra.map(l=>({...l,remainingQty:l.quantity-(a[l.id]||0)})).filter(l=>l.remainingQty>0);if($e(d),I({amount:"",method:"cash",notes:"",smac:!1}),Ie([]),p("Pagamento aggiunto","success"),n<=.01)try{await ks(j.id,"split",!1),p("Conto saldato e chiuso","success"),oe(!1),k(),A==="history"&&C()}catch(l){console.error("Error closing session:",l),p("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(t){console.error("Error adding payment:",t),p("Errore nell'aggiunta pagamento","error")}}async function js(s){try{const t=await Ba(s);t&&(la(t),Pe(!0))}catch(t){console.error("Error generating receipt:",t),p("Errore nella generazione scontrino","error")}}function Na(){if(!u)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${u.shop_info.name}</div>
            ${u.shop_info.address?`<div>${u.shop_info.address}</div>`:""}
            ${u.shop_info.phone?`<div>Tel: ${u.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${u.date} ${u.time}</div>
          <div class="divider"></div>
          ${u.items.map(n=>`
            <div class="item">
              <span>${n.quantity}x ${n.name}</span>
              <span>â‚¬${n.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>â‚¬${u.total.toFixed(2)}</span>
          </div>
          <div>Pagamento: ${u.payment_method==="cash"?"Contanti":u.payment_method==="card"?"Carta":"Online"}</div>
          ${_&&u.smac_passed?"<div>SMAC: SÃ¬</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,t=window.open("","_blank");t&&(t.document.write(s),t.document.close(),t.print())}async function C(){es(!0);try{const s=await Aa(ss,as);qs(s),w([])}catch(s){console.error("Error loading history:",s),p("Errore nel caricamento storico","error")}finally{es(!1)}}function he(s){w(t=>t.includes(s)?t.filter(n=>n!==s):[...t,s])}function gs(){const s=ee.map(n=>n.id),t=s.every(n=>g.includes(n));w(t?n=>n.filter(a=>!s.includes(a)):n=>[...new Set([...n,...s])])}async function fa(){if(fe()){if(g.length===0){p("Seleziona almeno un ordine","warning");return}if(F==="delete"){if(!confirm(`Sei sicuro di voler eliminare ${g.length} ordini?`))return;try{await Ma(g,V?.name),p(`${g.length} ordini eliminati`,"success"),w([]),C()}catch(s){console.error("Error deleting orders:",s),p("Errore nell'eliminazione","error")}}else if(F)try{await Da(g,F,V?.name),p(`${g.length} ordini aggiornati a "${h(b[F]?.labelKey)||F}"`,"success"),w([]),C()}catch(s){console.error("Error updating orders:",s),p("Errore nell'aggiornamento","error")}ts("")}}const ee=Xe.filter(s=>{if(Se!=="all"&&s.status!==Se)return!1;if(ve){const t=ve.toLowerCase();return s.id.toString().includes(t)||s.customer_name?.toLowerCase().includes(t)||s.table_name?.toLowerCase().includes(t)}return!0}),R=(()=>{const s={},t=[];ee.forEach(a=>{a.session_id?(s[a.session_id]||(s[a.session_id]=[]),s[a.session_id].push(a)):t.push(a)});const n=[];return Object.entries(s).forEach(([a,d])=>{const l=d[0],x=d.reduce((m,S)=>m+S.total,0);n.push({type:"session",sessionId:Number(a),orders:d.sort((m,S)=>(m.order_number||0)-(S.order_number||0)),total:x,tableName:l.table_name,customerName:l.customer_name,date:l.date,createdAt:l.created_at,sessionStatus:l.session_status})}),t.forEach(a=>{n.push({type:"single",orders:[a],total:a.total,tableName:a.table_name,customerName:a.customer_name,date:a.date,createdAt:a.created_at})}),n.sort((a,d)=>new Date(d.createdAt).getTime()-new Date(a.createdAt).getTime())})();function bs(s){Bs(t=>{const n=new Set(t);return n.has(s)?n.delete(s):n.add(s),n})}const va={pending:ne.filter(s=>s.status==="pending"),preparing:ne.filter(s=>s.status==="preparing"),ready:ne.filter(s=>s.status==="ready"),delivered:ne.filter(s=>s.status==="delivered")};return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white whitespace-nowrap",children:h("orders.title")}),e.jsxs("div",{className:"flex gap-1 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>Ze("today"),className:`px-2 sm:px-3 py-1.5 rounded-lg font-medium transition-all flex items-center gap-1 text-xs sm:text-sm whitespace-nowrap ${A==="today"?"bg-primary-500/20 text-primary-400":"text-dark-400 hover:text-white hover:bg-dark-800"}`,children:[e.jsx(_s,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:h("common.today")})]}),e.jsxs("button",{onClick:()=>{Ze("history"),Xe.length===0&&C()},className:`px-2 sm:px-3 py-1.5 rounded-lg font-medium transition-all flex items-center gap-1 text-xs sm:text-sm whitespace-nowrap ${A==="history"?"bg-primary-500/20 text-primary-400":"text-dark-400 hover:text-white hover:bg-dark-800"}`,children:[e.jsx(_a,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:h("orders.history")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Ns&&e.jsx("div",{className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs ${we?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,title:we?"Connesso in tempo reale":"Non connesso",children:we?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(Pa,{className:"w-4 h-4"})}),e.jsx("button",{onClick:k,className:"btn-secondary p-2",title:"Aggiorna",children:e.jsx(Ea,{className:"w-4 h-4"})}),e.jsxs($a,{to:"/orders/new",className:"btn-primary py-1.5 px-3 text-sm",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:h("orders.newOrder")})]})]})]}),A==="today"&&e.jsx(e.Fragment,{children:Ps?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 sm:gap-4 items-start",children:["pending","preparing","ready","delivered"].map(s=>{const t=b[s],n=va[s];return e.jsxs("div",{className:"card self-start",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:h(t.labelKey)})]}),e.jsx("span",{className:t.color,children:n.length})]}),e.jsx("div",{className:"p-3 sm:p-4 space-y-2",children:n.length===0?e.jsx("p",{className:"text-dark-500 text-center py-4 text-sm",children:h("orders.noActiveOrders")}):n.map(a=>{const d=Ds[s]?.has(a.id)||!1,l=()=>{He(x=>{const m=new Set(x[s]||[]);return m.has(a.id)?m.delete(a.id):m.add(a.id),{...x,[s]:m}})};return e.jsxs("div",{className:"bg-dark-900 rounded-xl overflow-hidden",children:[e.jsx("div",{onClick:l,className:"px-2 py-1.5 sm:px-3 sm:py-2 cursor-pointer hover:bg-dark-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 sm:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[e.jsxs("span",{className:"text-[10px] sm:text-xs font-mono bg-dark-700 px-1 sm:px-1.5 py-0.5 rounded text-dark-300 flex-shrink-0",children:["#",a.id]}),e.jsx("span",{className:"font-medium text-white text-xs sm:text-sm truncate",children:a.session_id?`${a.table_name}${a.customer_name?` - ${a.customer_name}`:""}${a.order_number?` - C${a.order_number}`:""}`:a.table_name?`${h(q[a.order_type])} - ${a.table_name}${a.customer_name?` - ${a.customer_name}`:""}`:a.customer_name?`${h(q[a.order_type])} - ${a.customer_name}`:`${h(q[a.order_type])}`})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[U[a.id]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-dark-400 hidden xs:inline",children:[U[a.id].length," item"]}),d?e.jsx(Re,{className:"w-4 h-4 text-primary-400"}):e.jsx(qe,{className:"w-4 h-4 text-dark-400"})]})]})}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ease-in-out ${d?"max-h-[500px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-2 pb-1.5 space-y-1",children:[U[a.id]&&U[a.id].length>0&&e.jsx("div",{className:"bg-dark-800 rounded p-1.5 mt-1",children:U[a.id].map(x=>e.jsxs("div",{className:"leading-snug mb-1 last:mb-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[e.jsxs("span",{className:"font-bold text-primary-400",children:[x.quantity,"x"]}),e.jsx("span",{className:"text-white truncate",children:x.menu_item_name})]}),x.notes&&e.jsxs("p",{className:"text-[10px] text-amber-400 ml-5 truncate",children:["âš ï¸ ",x.notes]})]},x.id))}),a.notes&&e.jsxs("p",{className:"text-[9px] text-dark-400 truncate",children:["ðŸ“ ",a.notes]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.next&&e.jsxs("button",{onClick:x=>{x.stopPropagation(),cs(a)},className:"btn-success flex-1 text-[10px] py-1 px-2 rounded",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{children:s==="pending"?"Prepara":s==="preparing"?"Pronto":"Consegna"})]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),ms(a)},className:"btn-secondary p-1 rounded",title:"Modifica",children:e.jsx(W,{className:"w-3 h-3"})})]})]})})]},a.id)})})]},s)})})}),A==="history"&&e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"card p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-end gap-3 sm:gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:contents",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.from")}),e.jsx("input",{type:"date",value:ss,onChange:s=>ke(s.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.to")}),e.jsx("input",{type:"date",value:as,onChange:s=>Ce(s.target.value),className:"input text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:contents gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.status")}),e.jsxs("select",{value:Se,onChange:s=>Ks(s.target.value),className:"select text-sm",children:[e.jsx("option",{value:"all",children:h("common.all")}),e.jsx("option",{value:"pending",children:h("orders.pending")}),e.jsx("option",{value:"preparing",children:h("orders.preparing")}),e.jsx("option",{value:"ready",children:h("orders.ready")}),e.jsx("option",{value:"delivered",children:h("orders.completed")}),e.jsx("option",{value:"cancelled",children:h("orders.cancelled")})]})]}),e.jsxs("div",{className:"flex items-end gap-2 sm:hidden",children:[e.jsxs("button",{onClick:()=>{const s=new Date().toISOString().split("T")[0];ke(s),Ce(s),setTimeout(()=>C(),0)},className:"btn-secondary flex-1",children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsx("span",{children:"Oggi"})]}),e.jsxs("button",{onClick:C,className:"btn-primary flex-1",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtra"})]})]})]}),e.jsxs("div",{className:"flex-1 min-w-0 sm:min-w-[200px]",children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:h("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(Va,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"ID, cliente, tavolo...",value:ve,onChange:s=>Es(s.target.value),className:"input pl-10 text-sm"})]})]}),e.jsxs("button",{onClick:()=>{const s=new Date().toISOString().split("T")[0];ke(s),Ce(s),setTimeout(()=>C(),0)},className:"btn-secondary hidden sm:flex",children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsx("span",{children:"Oggi"})]}),e.jsxs("button",{onClick:C,className:"btn-primary hidden sm:flex",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtra"})]})]})}),g.length>0&&e.jsx("div",{className:"card p-3 sm:p-4 bg-primary-500/10 border border-primary-500/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("p",{className:"text-primary-400 font-medium text-sm sm:text-base",children:[g.length," ordini selezionati"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("select",{value:F,onChange:s=>ts(s.target.value),className:"select text-sm",children:[e.jsx("option",{value:"",children:"Seleziona azione..."}),e.jsx("option",{value:"pending",children:"Imposta In Attesa"}),e.jsx("option",{value:"preparing",children:"Imposta In Preparazione"}),e.jsx("option",{value:"ready",children:"Imposta Pronto"}),e.jsx("option",{value:"delivered",children:"Imposta Consegnato"}),e.jsx("option",{value:"cancelled",children:"Imposta Annullato"}),e.jsx("option",{value:"delete",children:"ðŸ—‘ï¸ Elimina"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:fa,disabled:!F,className:"btn-primary flex-1 sm:flex-none disabled:opacity-50 text-sm",children:"Applica"}),e.jsx("button",{onClick:()=>w([]),className:"btn-secondary flex-1 sm:flex-none text-sm",children:"Deseleziona"})]})]})]})}),Ls?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1 mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[R.length," ordini/conti"]}),e.jsx("button",{onClick:gs,className:"text-xs text-primary-400",children:ee.every(s=>g.includes(s.id))?"Deseleziona":"Seleziona tutti"})]}),R.length===0?e.jsx("div",{className:"card p-6 text-center text-dark-400",children:e.jsx("p",{className:"text-sm",children:"Nessun ordine trovato"})}):R.map(s=>{const t=s.type==="session"&&s.orders.length>1,n=s.orders[0],a=t&&rs.has(s.sessionId),d=s.orders.every(l=>g.includes(l.id));return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:`p-3 ${t?"cursor-pointer":""} ${d?"bg-primary-500/10":""}`,onClick:t?()=>bs(s.sessionId):void 0,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),t?w(d?x=>x.filter(m=>!s.orders.some(S=>S.id===m)):x=>[...new Set([...x,...s.orders.map(m=>m.id)])]):he(n.id)},className:"p-0.5 flex-shrink-0 mt-0.5",children:d||g.includes(n.id)?e.jsx(se,{className:"w-4 h-4 text-primary-400"}):e.jsx(ae,{className:"w-4 h-4 text-dark-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t&&(a?e.jsx(Re,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(qe,{className:"w-4 h-4 text-dark-400 flex-shrink-0"})),e.jsx("span",{className:"font-medium text-white text-sm truncate",children:t?`Conto - ${s.tableName}`:`#${n.id}`}),t&&e.jsxs("span",{className:"text-xs text-dark-400",children:["(",s.orders.length," com. #",s.orders.map(l=>l.id).join(", #"),")"]})]}),e.jsx("span",{className:"font-semibold text-primary-400 flex-shrink-0",children:o(s.total)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-400 flex-wrap",children:[e.jsx("span",{children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:h(q[n.order_type])}),s.tableName&&!t&&e.jsxs("span",{children:["â€¢ ",s.tableName]}),s.customerName&&e.jsxs("span",{className:"text-white",children:["â€¢ ",s.customerName]})]}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded flex-shrink-0 ${b[n.status]?.color||"badge-secondary"}`,children:t?s.sessionStatus==="open"?"Aperto":"Chiuso":h(b[n.status]?.labelKey)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 pt-2 border-t border-dark-700",children:[e.jsxs("button",{onClick:l=>{l.stopPropagation(),me(n)},className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),"Dettagli"]}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:l=>{l.stopPropagation(),xe(n)},className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(W,{className:"w-3.5 h-3.5"}),"Modifica"]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),X(n.id,n.session_id)},className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg",children:e.jsx(L,{className:"w-4 h-4"})})]})]})]}),t&&a&&e.jsx("div",{className:"bg-dark-900/50 border-t border-dark-700 animate-fadeIn",children:s.orders.map(l=>e.jsx("div",{className:`px-3 py-2 border-b border-dark-800 last:border-b-0 ${g.includes(l.id)?"bg-primary-500/10":""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>he(l.id),className:"p-0.5",children:g.includes(l.id)?e.jsx(se,{className:"w-3.5 h-3.5 text-primary-400"}):e.jsx(ae,{className:"w-3.5 h-3.5 text-dark-500"})}),e.jsx("span",{className:"text-dark-500",children:"â””"}),e.jsxs("span",{className:"font-mono text-dark-300 text-xs",children:["#",l.id]}),e.jsxs("span",{className:"text-xs text-dark-500",children:["C",l.order_number||1]}),e.jsx("span",{className:"ml-auto text-xs text-dark-300",children:o(l.total)}),e.jsx("span",{className:`${b[l.status]?.color||"badge-secondary"} text-[10px]`,children:h(b[l.status]?.labelKey)})]})},l.id))})]},t?`session-${s.sessionId}`:`single-${n.id}`)})]}),e.jsxs("div",{className:"card hidden sm:block",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-white",children:[R.length," ",R.length===1?"ordine/conto":"ordini/conti"," (",ee.length," comande)"]}),e.jsx("button",{onClick:gs,className:"text-sm text-primary-400 hover:text-primary-300",children:ee.every(s=>g.includes(s.id))?"Deseleziona tutti":"Seleziona tutti"})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Tavolo/Cliente"}),e.jsx("th",{children:"Totale"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-dark-400",children:"Nessun ordine trovato per il periodo selezionato"})}):R.map(s=>{if(s.type==="single"||s.orders.length===1){const a=s.orders[0];return e.jsxs("tr",{className:g.includes(a.id)?"bg-primary-500/10":"",children:[e.jsx("td",{children:e.jsx("button",{onClick:()=>he(a.id),className:"p-1",children:g.includes(a.id)?e.jsx(se,{className:"w-5 h-5 text-primary-400"}):e.jsx(ae,{className:"w-5 h-5 text-dark-400"})})}),e.jsx("td",{children:e.jsxs("span",{className:"font-mono text-white",children:["#",a.id]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:new Date(a.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("p",{className:"text-xs text-dark-400",children:new Date(a.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark-300",children:h(q[a.order_type])})}),e.jsx("td",{children:e.jsxs("div",{children:[a.table_name&&e.jsx("p",{className:"text-white",children:a.table_name}),a.customer_name&&e.jsx("p",{className:"text-sm text-dark-400",children:a.customer_name})]})}),e.jsx("td",{children:e.jsx("span",{className:"font-semibold text-primary-400",children:o(a.total)})}),e.jsx("td",{children:e.jsx("span",{className:b[a.status]?.color||"badge-secondary",children:h(b[a.status]?.labelKey)||a.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>me(a),className:"btn-ghost btn-sm",title:"Dettagli",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>xe(a),className:"btn-ghost btn-sm",title:"Modifica",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(a.id,a.session_id),className:"btn-ghost btn-sm text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(L,{className:"w-4 h-4"})})]})})]},`single-${a.id}`)}const t=rs.has(s.sessionId),n=s.orders.every(a=>g.includes(a.id));return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`cursor-pointer hover:bg-dark-800/70 transition-colors ${n?"bg-primary-500/10":"bg-dark-800/30"}`,onClick:()=>bs(s.sessionId),children:[e.jsx("td",{children:e.jsx("button",{onClick:a=>{a.stopPropagation(),w(n?d=>d.filter(l=>!s.orders.some(x=>x.id===l)):d=>[...new Set([...d,...s.orders.map(l=>l.id)])])},className:"p-1",children:n?e.jsx(se,{className:"w-5 h-5 text-primary-400"}):e.jsx(ae,{className:"w-5 h-5 text-dark-400"})})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:t?e.jsx(Re,{className:"w-4 h-4 text-primary-400"}):e.jsx(qe,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Conto"}),e.jsxs("p",{className:"text-xs text-dark-400",children:[s.orders.length," comande (#",s.orders.map(a=>a.id).join(", #"),")"]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("p",{className:"text-xs text-dark-400",children:new Date(s.createdAt).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark-300",children:"Tavolo"})}),e.jsx("td",{children:e.jsxs("div",{children:[s.tableName&&e.jsx("p",{className:"text-white",children:s.tableName}),s.customerName&&e.jsx("p",{className:"text-sm text-dark-400",children:s.customerName}),e.jsx("p",{className:`text-xs ${s.sessionStatus==="open"?"text-primary-400":"text-emerald-400"}`,children:s.sessionStatus==="open"?"Conto Aperto":"Conto Chiuso"})]})}),e.jsx("td",{children:e.jsx("span",{className:"font-semibold text-primary-400",children:o(s.total)})}),e.jsx("td",{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.orders.reduce((a,d)=>(a[d.status]=(a[d.status]||0)+1,a),{})).map(([a,d])=>e.jsxs("span",{className:`${b[a]?.color||"badge-secondary"} text-xs`,children:[d,"x ",h(b[a]?.labelKey)||a]},a))})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),me(s.orders[0])},className:"btn-ghost btn-sm",title:"Dettagli conto",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),xe(s.orders[0])},className:"btn-ghost btn-sm",title:"Modifica conto (sconti totale)",children:e.jsx(W,{className:"w-4 h-4"})})]})})]},`session-${s.sessionId}`),t&&s.orders.map((a,d)=>e.jsxs("tr",{className:`border-l-2 border-primary-500/30 animate-fadeIn ${g.includes(a.id)?"bg-primary-500/10":"bg-dark-900/30"}`,children:[e.jsx("td",{children:e.jsx("button",{onClick:()=>he(a.id),className:"p-1 ml-6",children:g.includes(a.id)?e.jsx(se,{className:"w-4 h-4 text-primary-400"}):e.jsx(ae,{className:"w-4 h-4 text-dark-500"})})}),e.jsx("td",{children:e.jsxs("div",{className:"pl-8 flex items-center gap-3",children:[e.jsx("span",{className:"text-dark-600",children:d===s.orders.length-1?"â””":"â”œ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-dark-700 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-mono text-primary-400",children:["#",a.id]})}),e.jsxs("span",{className:"text-sm text-dark-300",children:["Comanda ",a.order_number||1]})]})]})}),e.jsx("td",{children:e.jsx("p",{className:"text-sm text-dark-400",children:new Date(a.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("span",{className:"font-medium text-dark-300",children:o(a.total)})}),e.jsx("td",{children:e.jsx("span",{className:`${b[a.status]?.color||"badge-secondary"} text-xs`,children:h(b[a.status]?.labelKey)||a.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>me(a),className:"btn-ghost btn-sm",title:"Visualizza comanda",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ms(a),className:"btn-ghost btn-sm",title:"Modifica comanda",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(a.id,a.session_id),className:"btn-ghost btn-sm text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(L,{className:"w-4 h-4"})})]})})]},`order-${a.id}`))]})})})]})})]})]})]}),e.jsx(M,{isOpen:Is,onClose:()=>D(!1),title:r?.session_id?`${r.table_name} - Conto${P.length>1?` (${P.length} comande)`:""}`:`Ordine #${r?.id}`,size:"lg",children:r&&e.jsxs("div",{className:"space-y-4",children:[r.session_id&&e.jsx("div",{className:`rounded-xl p-3 text-center border ${r.session_status==="open"?"bg-primary-500/10 border-primary-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:e.jsxs("span",{className:`font-medium ${r.session_status==="open"?"text-primary-400":"text-emerald-400"}`,children:[r.session_status==="open"?"Conto Aperto":"Conto Chiuso",P.length>1&&` - ${P.length} comande`]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:h("common.type")}),e.jsx("p",{className:"font-medium text-white",children:h(q[r.order_type])})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:h("common.status")}),e.jsx("span",{className:b[r.status].color,children:h(b[r.status].labelKey)})]}),r.table_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tavolo"}),e.jsx("p",{className:"font-medium text-white",children:r.table_name})]}),r.customer_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Cliente"}),e.jsx("p",{className:"font-medium text-white",children:r.customer_name})]}),!r.session_id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Pagamento"}),e.jsx("p",{className:"font-medium text-white capitalize",children:r.payment_method==="cash"?"Contanti":r.payment_method==="card"?"Carta":"Online"})]}),_&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"SMAC"}),e.jsx("p",{className:"font-medium text-white",children:r.smac_passed?"SÃ¬":"No"})]})]}),r.session_id&&_&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"SMAC"}),e.jsx("p",{className:"font-medium text-white",children:(()=>{const s=$.filter(a=>a.smac_passed);if(s.length===0)return"No";const t=s.reduce((a,d)=>a+d.amount,0),n=P.reduce((a,d)=>a+d.total,0);return t>=n?"SÃ¬ (Totale)":`SÃ¬ (${o(t)})`})()})]})]}),r.session_id&&P.length>1?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Comande del conto"}),P.map(s=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-dark-700 px-2 py-1 rounded text-dark-300",children:["#",s.id]}),e.jsxs("span",{className:"font-medium text-white",children:["Comanda ",s.order_number||1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:b[s.status]?.color||"badge-secondary",children:h(b[s.status]?.labelKey)||s.status}),e.jsx("span",{className:"font-bold text-primary-400",children:o(s.total)})]})]}),e.jsx("div",{className:"space-y-1 pl-2 border-l-2 border-dark-700",children:(Gs[s.id]||[]).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-white",children:[t.quantity,"x ",t.menu_item_name]}),t.notes&&e.jsxs("span",{className:"text-amber-400 ml-2",children:["âš ï¸ ",t.notes]})]}),e.jsx("span",{className:"text-dark-300",children:o(t.price*t.quantity)})]},t.id))}),s.notes&&e.jsxs("p",{className:"text-xs text-dark-400 mt-2 italic",children:["ðŸ“ ",s.notes]})]},s.id))]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400 mb-2",children:"Prodotti"}),e.jsx("div",{className:"space-y-2",children:$s.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-white",children:[s.quantity,"x ",s.menu_item_name]}),s.notes&&e.jsx("p",{className:"text-sm text-dark-400",children:s.notes})]}),e.jsx("p",{className:"font-medium text-primary-400",children:o(s.price*s.quantity)})]},s.id))})]}),r.notes&&!r.session_id&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400 mb-2",children:"Note"}),e.jsx("p",{className:"p-3 bg-dark-900 rounded-xl text-white",children:r.notes})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-700",children:[e.jsx("span",{className:"text-lg font-semibold text-white",children:r.session_id&&P.length>1?"Totale Conto":"Totale"}),e.jsx("span",{className:"text-2xl font-bold text-primary-400",children:o(r.session_id&&P.length>1?P.reduce((s,t)=>s+t.total,0):r.total)})]}),r.session_id&&$.length>0&&e.jsxs("div",{className:"pt-4 border-t border-dark-700",children:[e.jsxs("p",{className:"text-sm text-dark-400 mb-3",children:["Riepilogo Pagamenti ",$.length>1&&e.jsx("span",{className:"text-amber-400",children:"(Pagamento Diviso)"})]}),e.jsx("div",{className:"space-y-2",children:$.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-mono bg-dark-700 px-2 py-1 rounded text-dark-400",children:["#",t+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:o(s.amount)}),e.jsxs("p",{className:"text-xs text-dark-400",children:[s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online",s.notes&&` â€¢ ${s.notes}`]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:_&&e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${s.smac_passed?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:["SMAC ",s.smac_passed?"âœ“":"âœ—"]})})]},s.id))})]}),r.session_id&&r.session_status==="open"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-4 border-t border-dark-700",children:[e.jsxs("button",{onClick:ma,className:"btn-secondary flex items-center justify-center gap-2",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Dividi Conto"]}),e.jsxs("button",{onClick:xa,className:"btn-secondary flex items-center justify-center gap-2",children:[e.jsx(Ya,{className:"w-4 h-4"}),"Stato Conto"]}),e.jsxs("button",{onClick:hs,className:"btn-primary bg-emerald-600 hover:bg-emerald-700 flex items-center justify-center gap-2 col-span-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Chiudi Conto"]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>{D(!1),xe(r)},className:"btn-secondary flex-1",children:[e.jsx(W,{className:"w-5 h-5"}),"Modifica"]}),b[r.status].next&&e.jsxs("button",{onClick:()=>{cs(r),D(!1)},className:"btn-success flex-1",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Avanza Stato"]}),e.jsx("button",{onClick:()=>{X(r.id,r.session_id),D(!1)},className:"btn-danger",children:e.jsx(L,{className:"w-5 h-5"})})]})]})}),e.jsx(M,{isOpen:zs,onClose:()=>z(!1),title:`Modifica Ordine #${r?.id}`,size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tipo Ordine"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["dine_in","takeaway","delivery"].map(s=>e.jsx("button",{type:"button",onClick:()=>O({...c,order_type:s}),className:`p-3 rounded-xl border-2 transition-all ${c.order_type===s?"border-primary-500 bg-primary-500/20 text-primary-400":"border-dark-600 hover:border-dark-500 text-dark-300"}`,children:h(q[s])},s))})]}),c.order_type==="dine_in"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tavolo"}),e.jsxs("select",{value:c.table_id||"",onChange:s=>O({...c,table_id:s.target.value?Number(s.target.value):void 0}),className:"select",children:[e.jsx("option",{value:"",children:"Seleziona tavolo"}),We.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.capacity," posti)"]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente"}),e.jsx("input",{type:"text",value:c.customer_name,onChange:s=>O({...c,customer_name:s.target.value}),className:"input",placeholder:"Nome cliente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:c.customer_phone,onChange:s=>O({...c,customer_phone:s.target.value}),className:"input",placeholder:"Telefono"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo Pagamento"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["cash","card","online"].map(s=>e.jsx("button",{type:"button",onClick:()=>O({...c,payment_method:s}),className:`p-3 rounded-xl border-2 transition-all ${c.payment_method===s?"border-primary-500 bg-primary-500/20 text-primary-400":"border-dark-600 hover:border-dark-500 text-dark-300"}`,children:s==="cash"?"Contanti":s==="card"?"Carta":"Online"},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stato Ordine"}),e.jsxs("select",{value:c.status,onChange:s=>O({...c,status:s.target.value}),className:"select",children:[e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"}),e.jsx("option",{value:"cancelled",children:"Annullato"})]})]}),_&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac_edit",checked:c.smac_passed,onChange:s=>O({...c,smac_passed:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac_edit",className:"text-white cursor-pointer",children:"SMAC Passata"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("label",{className:"label mb-2",children:"Totale Ordine"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-400",children:"â‚¬"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.total,onChange:s=>O({...c,total:parseFloat(s.target.value)||0}),className:"input pl-8 text-lg font-semibold"})]})}),c.total!==c.originalTotal&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-dark-400",children:["Originale: ",o(c.originalTotal)]}),e.jsx("p",{className:`text-sm font-medium ${c.total<c.originalTotal?"text-emerald-400":"text-amber-400"}`,children:c.total<c.originalTotal?`Sconto: -${o(c.originalTotal-c.total)}`:`+${o(c.total-c.originalTotal)}`})]})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Modifica il totale per applicare sconti o arrotondamenti"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:c.notes,onChange:s=>O({...c,notes:s.target.value}),className:"input min-h-[80px]",placeholder:"Note aggiuntive..."})]}),r?.session_id&&r?.session_status==="open"&&!Qs&&e.jsx("div",{className:"bg-primary-500/10 border border-primary-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Conto Aperto"}),e.jsxs("p",{className:"text-sm text-dark-400",children:["Totale: ",o(r.total)]})]}),e.jsxs("button",{onClick:hs,className:"btn-primary bg-emerald-600 hover:bg-emerald-700 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Chiudi Conto"]})]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:oa,className:"btn-primary flex-1",children:"Salva Modifiche"}),e.jsx("button",{onClick:()=>z(!1),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:()=>{confirm("Sei sicuro di voler eliminare questa comanda? L'azione non puÃ² essere annullata.")&&(X(r.id,r?.session_id),z(!1))},className:"btn-danger",title:"Elimina comanda",children:e.jsx(L,{className:"w-5 h-5"})})]})]})}),e.jsx(M,{isOpen:Rs,onClose:()=>le(!1),title:`Modifica Comanda #${r?.id}`,size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Prodotti nella Comanda"}),e.jsx("div",{className:"bg-dark-900 rounded-xl p-3 space-y-2 max-h-64 overflow-y-auto",children:re.length===0?e.jsx("p",{className:"text-dark-400 text-sm text-center py-2",children:"Nessun prodotto"}):re.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-dark-700 last:border-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"text-dark-400 text-sm ml-2",children:[o(s.price),"/cad"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>xs(s.id,s.quantity-1),disabled:s.quantity<=1,className:"p-1.5 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Za,{className:"w-4 h-4 text-dark-300"})}),e.jsx("span",{className:"text-primary-400 font-bold w-8 text-center",children:s.quantity}),e.jsx("button",{onClick:()=>xs(s.id,s.quantity+1),className:"p-1.5 rounded-lg bg-dark-700 hover:bg-dark-600",children:e.jsx(fs,{className:"w-4 h-4 text-dark-300"})}),e.jsx("span",{className:"text-dark-300 w-16 text-right",children:o(s.price*s.quantity)}),e.jsx("button",{onClick:()=>da(s.id),className:"p-1.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400",title:"Rimuovi prodotto",children:e.jsx(L,{className:"w-4 h-4"})})]})]},s.id))}),re.length>0&&e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-dark-700",children:[e.jsx("span",{className:"text-dark-400",children:"Totale Comanda:"}),e.jsx("span",{className:"text-lg font-bold text-primary-400",children:o(re.reduce((s,t)=>s+t.price*t.quantity,0))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stato Comanda"}),e.jsxs("select",{value:Ve,onChange:s=>Ue(s.target.value),className:"select",children:[e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"}),e.jsx("option",{value:"cancelled",children:"Annullato"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note Cucina"}),e.jsx("textarea",{value:Je,onChange:s=>Ye(s.target.value),className:"input min-h-[60px]",placeholder:"Note per la cucina..."})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-blue-400 text-sm",children:"Modifica le quantitÃ  o rimuovi prodotti usando i pulsanti +/- e il cestino. Per sconti o totali personalizzati, usa Lista Ordini."})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:ia,className:"btn-primary flex-1",children:"Salva Modifiche"}),e.jsx("button",{onClick:()=>le(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(M,{isOpen:Vs,onClose:()=>_e(!1),title:"Coperto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Coperto da applicare"}),e.jsx("p",{className:"text-2xl font-bold text-primary-400",children:o(Us)}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["(",Ys," coperti Ã— ",o(Xs),")"]})]}),e.jsx("p",{className:"text-center text-dark-300",children:"Vuoi applicare il coperto a questo conto?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>Ae(!0),className:"btn-primary py-3",children:"SÃ¬, applica"}),e.jsx("button",{onClick:()=>Ae(!1),className:"btn-secondary py-3",children:"No, senza coperto"})]})]})}),e.jsx(M,{isOpen:Ws,onClose:()=>{de(!1),K(null)},title:"Chiudi Conto",size:f.method==="cash"?"2xl":"md",children:j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:f.method==="cash"?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsx("p",{className:"text-3xl font-bold text-primary-400",children:o(j.total)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>J({...f,method:"cash"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${f.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(te,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>J({...f,method:"card"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${f.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ge,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>J({...f,method:"online"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${f.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(Le,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Online"})]})]})]}),_&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac_payment",checked:f.smac,onChange:s=>J({...f,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac_payment",className:"text-white",children:"SMAC passato"})]})]}),f.method==="cash"&&j.total>0&&e.jsxs("div",{className:"mt-4 md:mt-0 p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dÃ "}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:E.customerGives,onChange:s=>Y({customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"â‚¬"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsx("button",{type:"button",onClick:()=>Y({customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:o(s)},s))}),E.customerGives&&parseFloat(E.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsx("span",{className:"text-white",children:o(j.total)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dÃ :"}),e.jsx("span",{className:"text-white",children:o(parseFloat(E.customerGives))})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:o(Math.max(0,parseFloat(E.customerGives)-j.total))})]}),parseFloat(E.customerGives)<j.total&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["Mancano ",o(j.total-parseFloat(E.customerGives))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:ca,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>{de(!1),K(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(M,{isOpen:aa,onClose:()=>oe(!1),title:"Dividi Conto",size:"2xl",children:j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:o(j.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:o(j.total-v)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:o(v)})]})]}),j.total>0&&e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,(j.total-v)/j.total*100)}%`}})})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[$.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-40 lg:max-h-64 overflow-y-auto",children:$.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(te,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(ge,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(Le,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-white text-sm",children:o(s.amount)}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-xs",children:["- ",s.notes]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[_&&s.smac_passed&&e.jsx("span",{className:"text-[10px] bg-primary-500/20 text-primary-400 px-1.5 py-0.5 rounded-full",children:"SMAC"}),e.jsx("button",{onClick:()=>js(s),className:"p-1 hover:bg-dark-700 rounded transition-colors",title:"Stampa scontrino",children:e.jsx(Ke,{className:"w-3.5 h-3.5 text-dark-400"})})]})]},s.id))})]}),$.length===0&&e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl text-center text-dark-500 text-sm",children:"Nessun pagamento ancora effettuato"})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[v>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>B("manual"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${G==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(te,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>B("romana"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${G==="romana"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(De,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Alla Romana"})]}),e.jsxs("button",{onClick:()=>B("items"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${G==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(Ja,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Per Prodotto"})]})]}),G==="romana"&&e.jsxs("div",{className:"p-4 border border-primary-500/30 bg-primary-500/5 rounded-xl space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Persone totali"}),e.jsx("input",{type:"number",min:"1",value:y.totalPeople,onChange:s=>Te({...y,totalPeople:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Pagano ora"}),e.jsx("input",{type:"number",min:"1",value:y.payingPeople,onChange:s=>Te({...y,payingPeople:s.target.value}),className:"input"})]})]}),y.totalPeople&&y.payingPeople&&e.jsx("div",{className:"p-3 bg-dark-900 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale da pagare:"}),e.jsx("span",{className:"text-primary-400 font-bold text-lg",children:o(us())})]})}),e.jsx("button",{onClick:ua,disabled:!y.totalPeople||!y.payingPeople,className:"btn-primary w-full",children:"Applica Calcolo"})]}),G==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare."}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:T.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:"Tutti i prodotti sono stati pagati"}):T.map(s=>{const t=Q[s.id]||0;return e.jsx("div",{className:`p-3 rounded-lg border-2 ${t>0?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:[o(s.price)," â€¢ ",s.remainingQty," rimasti"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>pa(s.id),disabled:t===0,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"-"}),e.jsx("span",{className:"w-8 text-center font-bold",children:t}),e.jsx("button",{onClick:()=>ha(s.id),disabled:t>=s.remainingQty,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"+"})]})]})},s.id)})}),Object.keys(Q).length>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg flex justify-between",children:[e.jsx("span",{children:"Totale:"}),e.jsx("span",{className:"text-blue-400 font-bold",children:o(ps())})]}),e.jsx("button",{onClick:ja,disabled:Object.keys(Q).length===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),G==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo"}),e.jsx("input",{type:"number",step:"0.01",value:N.amount,onChange:s=>I({...N,amount:s.target.value}),className:"input",placeholder:`Max â‚¬${v.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{type:"text",value:N.notes,onChange:s=>I({...N,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I({...N,method:"cash"}),className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${N.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(te,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>I({...N,method:"card"}),className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${N.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(ge,{className:"w-4 h-4"})," Carta"]})]}),_&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"orders_split_smac",checked:N.smac,onChange:s=>I({...N,smac:s.target.checked}),className:"w-5 h-5"}),e.jsx("label",{htmlFor:"orders_split_smac",className:"text-white",children:"SMAC passato"})]}),N.method==="cash"&&N.amount&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsx("input",{type:"number",value:E.customerGives,onChange:s=>Y({customerGives:s.target.value}),className:"input",placeholder:"Cliente dÃ  â‚¬..."}),E.customerGives&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg flex justify-between",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:o(ga())})]})]}),e.jsx("button",{onClick:ba,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),v===0&&e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(je,{className:"w-10 h-10 mx-auto mb-2 text-emerald-400"}),e.jsx("h4",{className:"text-lg font-bold text-emerald-400 mb-1",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Il conto Ã¨ stato completamente pagato."})]})]})]}),e.jsx("button",{onClick:()=>oe(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(M,{isOpen:ta,onClose:()=>Oe(!1),title:"Stato del Conto",size:"2xl",children:j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:o(j.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:o(j.total-v)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:o(v)})]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsx("div",{children:$.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:["Pagamenti (",$.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 lg:max-h-72 overflow-y-auto",children:$.map((s,t)=>e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(te,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(ge,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(Le,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"font-medium text-white text-sm",children:["#",t+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-primary-400",children:o(s.amount)}),_&&s.smac_passed&&e.jsx("span",{className:"text-[10px] bg-primary-500/20 text-primary-400 px-1.5 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-xs text-dark-400",children:[new Date(s.paid_at).toLocaleString("it-IT"),s.notes&&` â€¢ ${s.notes}`]}),s.paid_items&&s.paid_items.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-700 space-y-0.5",children:s.paid_items.map((n,a)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-dark-300",children:[n.quantity,"x ",n.menu_item_name]}),e.jsx("span",{className:"text-dark-400",children:o(n.price*n.quantity)})]},a))}),e.jsxs("button",{onClick:()=>js(s),className:"mt-2 w-full btn-secondary text-xs py-1.5 flex items-center justify-center gap-1",children:[e.jsx(Ke,{className:"w-3.5 h-3.5"}),"Stampa"]})]},s.id))})]}):e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(Xa,{className:"w-10 h-10 mx-auto mb-2 text-dark-600"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Nessun pagamento effettuato"})]})}),e.jsx("div",{className:"mt-4 md:mt-0",children:T.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:["Da pagare (",T.length,")"]}),e.jsx("div",{className:"space-y-1.5 max-h-48 lg:max-h-72 overflow-y-auto",children:T.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsx("span",{className:"text-primary-400 font-medium",children:o(s.price*s.remainingQty)})]},s.id))})]}):e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(je,{className:"w-10 h-10 mx-auto mb-2 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>Oe(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(M,{isOpen:na,onClose:()=>Pe(!1),title:"Scontrino",size:"sm",children:u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:u.shop_info.name}),u.shop_info.address&&e.jsx("p",{className:"text-xs",children:u.shop_info.address}),u.shop_info.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",u.shop_info.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",u.date," ",u.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:u.items.map((s,t)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsx("span",{children:o(s.total)})]},t))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsx("span",{children:o(u.total)})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",u.payment_method==="cash"?"Contanti":u.payment_method==="card"?"Carta":"Online"]}),_&&u.smac_passed&&e.jsx("p",{children:"SMAC: SÃ¬"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Na,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>Pe(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{jt as Orders};
