import{d as Q,u as Ne,k as ge,r as o,aN as fe,aO as le,t as p,j as e,aP as D,Q as O,aQ as de,P as ie,U as ve,K as ye,e as be,M as q,aR as we,aS as ke,aT as _e,aU as Se}from"./index-CraoOkNm.js";import{C as w}from"./calendar-CTpBwHKA.js";import{C as me}from"./clock-0nzEDMOT.js";import{D as Ce}from"./dollar-sign-ClIxD3--.js";const De=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],re=Q("chevron-left",De);const Ee=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ne=Q("chevron-right",Ee);const Me=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],ce=Q("euro",Me);function $e(){Ne();const{user:k,hasPermission:E}=ge(),v=E("staff.full"),[c,z]=o.useState([]),[_,A]=o.useState([]),[y,G]=o.useState(!0),[d,M]=o.useState(X(new Date)),[g,m]=o.useState(!1),[W,b]=o.useState(!1),[T,S]=o.useState(!1),[l,C]=o.useState(null),[H,V]=o.useState(null),[P,K]=o.useState(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`}),[Y,xe]=o.useState([]),[B,J]=o.useState(!1),[i,j]=o.useState({name:"",role:"",hourly_rate:"",phone:"",email:"",active:!0}),[r,N]=o.useState({employee_id:0,date:new Date().toISOString().split("T")[0],start_time:"09:00",end_time:"17:00",shift_type:"worked",notes:""});function X(s){const t=[],a=new Date(s);a.setDate(a.getDate()-a.getDay()+1);for(let n=0;n<7;n++){const u=new Date(a);u.setDate(a.getDate()+n),t.push(u.toISOString().split("T")[0])}return t}function F(s){const t=new Date(d[0]);t.setDate(t.getDate()+s*7),M(X(t))}const x=!v&&k?.employee_id?c.find(s=>s.id===k.employee_id):null;o.useEffect(()=>{I()},[d]);async function I(){try{const[s,t]=await Promise.all([fe(),le(d[0],d[6])]);z(s),A(t)}catch(s){console.error("Error loading data:",s),p("Errore nel caricamento dati","error")}finally{G(!1)}}function Z(s){s?(C(s),j({name:s.name,role:s.role,hourly_rate:s.hourly_rate.toString(),phone:s.phone||"",email:s.email||"",active:s.active})):(C(null),j({name:"",role:"",hourly_rate:"",phone:"",email:"",active:!0})),m(!0)}function ee(s,t){N({employee_id:s||c[0]?.id||0,date:t||new Date().toISOString().split("T")[0],start_time:"09:00",end_time:"17:00",shift_type:"worked",notes:""}),b(!0)}async function R(s){const t=v?s||c[0]?.id||null:k?.employee_id||null;V(t),S(!0),t&&await $(t,P)}async function $(s,t){J(!0);try{const[a,n]=t.split("-").map(Number),u=`${a}-${String(n).padStart(2,"0")}-01`,L=new Date(a,n,0).toISOString().split("T")[0],U=(await le(u,L)).filter(h=>h.employee_id===s);xe(U)}catch(a){console.error("Error loading month shifts:",a),p("Errore nel caricamento turni","error")}finally{J(!1)}}function se(s,t){const a=c.find(h=>h.id===s);if(!a)return{totalHours:0,totalPay:0,workedDays:0,sickDays:0,vacationDays:0};const n=t.filter(h=>h.shift_type==="worked"&&h.status!=="absent"),u=t.filter(h=>h.shift_type==="sick"),L=t.filter(h=>h.shift_type==="vacation"),f=n.reduce((h,je)=>h+je.hours_worked,0),U=f*a.hourly_rate;return{totalHours:f,totalPay:U,workedDays:n.length,sickDays:u.length,vacationDays:L.length}}async function he(){if(!i.name.trim()||!i.role.trim()){p("Compila nome e ruolo","warning");return}try{const s={name:i.name.trim(),role:i.role.trim(),hourly_rate:parseFloat(i.hourly_rate)||10,phone:i.phone||void 0,email:i.email||void 0,active:i.active};l?(await ke(l.id,s),p("Dipendente aggiornato","success")):(await _e(s),p("Dipendente aggiunto","success")),m(!1),I()}catch(s){console.error("Error saving employee:",s),p("Errore nel salvataggio","error")}}async function ue(s){if(confirm("Sei sicuro di voler eliminare questo dipendente?"))try{await we(s),p("Dipendente eliminato","success"),I()}catch(t){console.error("Error deleting employee:",t),p("Errore nell'eliminazione","error")}}async function pe(){if(!r.employee_id){p("Seleziona un dipendente","warning");return}try{const[s,t]=r.start_time.split(":").map(Number),[a,n]=r.end_time.split(":").map(Number),u=s*60+t;let f=(a*60+n-u)/60;f<0&&(f+=24),await Se({employee_id:r.employee_id,date:r.date,hours_worked:f,status:"scheduled",shift_type:r.shift_type,notes:r.notes||void 0,start_time:r.start_time,end_time:r.end_time}),p("Turno aggiunto","success"),b(!1),I()}catch(s){console.error("Error saving shift:",s),p("Errore nel salvataggio","error")}}function te(s,t){return _.find(a=>a.employee_id===s&&a.date===t)}const ae=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"];if(y)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});if(!v){if(!x)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-2",children:[e.jsx(D,{className:"w-8 h-8 text-primary-400"}),"I Miei Turni"]}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Visualizza i tuoi turni e calcola la paga"})]}),e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(D,{className:"w-16 h-16 mx-auto text-dark-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Account non collegato"}),e.jsxs("p",{className:"text-dark-400",children:["Il tuo account non è collegato a nessun dipendente.",e.jsx("br",{}),"Contatta un amministratore per collegare il tuo profilo."]})]})]});const s=_.filter(t=>t.employee_id===x.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-white flex items-center gap-2",children:[e.jsx(D,{className:"w-7 h-7 text-primary-400"}),"I Miei Turni"]}),e.jsxs("p",{className:"text-dark-400 mt-1",children:["Ciao ",x.name,"!"]})]}),e.jsxs("button",{onClick:()=>R(x.id),className:"btn-primary",children:[e.jsx(O,{className:"w-5 h-5"}),"Calcola Paga"]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary-500/20 flex items-center justify-center",children:e.jsx(D,{className:"w-8 h-8 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:x.name}),e.jsx("p",{className:"text-primary-400",children:x.role}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-sm text-dark-400",children:[e.jsx(ce,{className:"w-4 h-4"}),x.hourly_rate.toFixed(2),"/ora"]})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"I Miei Turni"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F(-1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-dark-300 min-w-[140px] text-center",children:[new Date(d[0]).toLocaleDateString("it-IT",{day:"numeric",month:"short"})," - ",new Date(d[6]).toLocaleDateString("it-IT",{day:"numeric",month:"short"})]}),e.jsx("button",{onClick:()=>F(1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(ne,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:d.map((t,a)=>{const n=te(x.id,t),u=t===new Date().toISOString().split("T")[0];return e.jsxs("div",{className:`p-3 rounded-xl text-center ${u?"ring-2 ring-primary-500":""} ${n?"bg-dark-900":"bg-dark-800"}`,children:[e.jsx("div",{className:"text-xs text-dark-400 font-medium",children:ae[a]}),e.jsx("div",{className:`text-lg font-bold ${u?"text-primary-400":"text-white"}`,children:new Date(t).getDate()}),n?e.jsxs("div",{className:`mt-2 p-2 rounded-lg text-xs ${n.shift_type==="worked"?"bg-emerald-500/20 text-emerald-400":n.shift_type==="sick"?"bg-red-500/20 text-red-400":n.shift_type==="vacation"?"bg-blue-500/20 text-blue-400":"bg-amber-500/20 text-amber-400"}`,children:[e.jsxs("div",{className:"font-medium",children:[n.start_time," - ",n.end_time]}),e.jsxs("div",{className:"text-[10px] opacity-75 mt-0.5",children:[n.hours_worked,"h"]})]}):e.jsx("div",{className:"mt-2 p-2 text-xs text-dark-500",children:"Riposo"})]},t)})})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(me,{className:"w-6 h-6 mx-auto text-primary-400 mb-2"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[s.filter(t=>t.shift_type==="worked").reduce((t,a)=>t+a.hours_worked,0),"h"]}),e.jsx("div",{className:"text-xs text-dark-400",children:"Ore questa settimana"})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(de,{className:"w-6 h-6 mx-auto text-emerald-400 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s.filter(t=>t.shift_type==="worked").length}),e.jsx("div",{className:"text-xs text-dark-400",children:"Giorni lavorativi"})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(w,{className:"w-6 h-6 mx-auto text-blue-400 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s.filter(t=>t.shift_type==="vacation").length}),e.jsx("div",{className:"text-xs text-dark-400",children:"Ferie"})]}),e.jsxs("div",{className:"card p-4 text-center",children:[e.jsx(ce,{className:"w-6 h-6 mx-auto text-amber-400 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:(s.filter(t=>t.shift_type==="worked").reduce((t,a)=>t+a.hours_worked,0)*x.hourly_rate).toFixed(0)}),e.jsx("div",{className:"text-xs text-dark-400",children:"Paga settimana"})]})]}),e.jsx(oe,{isOpen:T,onClose:()=>S(!1),employees:[x],selectedEmployee:x.id,onEmployeeChange:()=>{},month:P,onMonthChange:async t=>{K(t),await $(x.id,t)},shifts:Y,loading:B,calculatePay:se,canSelectEmployee:!1})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Personale"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Gestisci dipendenti e turni"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>R(),className:"btn-secondary",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Calcola Paga"})]}),e.jsxs("button",{onClick:()=>ee(),className:"btn-secondary",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuovo Turno"})]}),e.jsxs("button",{onClick:()=>Z(),className:"btn-primary",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuovo Dipendente"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Dipendenti (",c.length,")"]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 md:grid-cols-3 gap-4",children:c.map(s=>e.jsxs("div",{className:`bg-dark-900 rounded-xl p-4 ${s.active?"":"opacity-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white truncate",children:s.name}),e.jsx("p",{className:"text-sm text-primary-400",children:s.role}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-dark-400",children:[e.jsx(Ce,{className:"w-4 h-4"}),"€",s.hourly_rate.toFixed(2),"/ora"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>R(s.id),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",title:"Calcola paga",children:e.jsx(O,{className:"w-4 h-4 text-dark-400"})}),e.jsx("button",{onClick:()=>Z(s),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4 text-dark-400"})}),e.jsx("button",{onClick:()=>ue(s.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:e.jsx(be,{className:"w-4 h-4 text-red-400"})})]})]}),!s.active&&e.jsx("span",{className:"badge-danger mt-2",children:"Inattivo"})]},s.id))})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Turni Settimanali"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F(-1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-dark-300 min-w-[140px] text-center",children:[new Date(d[0]).toLocaleDateString("it-IT",{day:"numeric",month:"short"})," - ",new Date(d[6]).toLocaleDateString("it-IT",{day:"numeric",month:"short"})]}),e.jsx("button",{onClick:()=>F(1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(ne,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-dark-300 uppercase tracking-wider bg-dark-900 sticky left-0",children:"Dipendente"}),d.map((s,t)=>e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-semibold text-dark-300 uppercase tracking-wider bg-dark-900 min-w-[90px]",children:[e.jsx("div",{children:ae[t]}),e.jsx("div",{className:"text-dark-500 font-normal",children:new Date(s).getDate()})]},s))]})}),e.jsx("tbody",{children:c.filter(s=>s.active).map(s=>e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsxs("td",{className:"px-4 py-3 sticky left-0 bg-dark-800",children:[e.jsx("p",{className:"font-medium text-white",children:s.name}),e.jsx("p",{className:"text-xs text-dark-400",children:s.role})]}),d.map(t=>{const a=te(s.id,t);return e.jsx("td",{className:"px-2 py-2 text-center",children:a?e.jsxs("div",{className:`p-2 rounded-lg text-xs ${a.shift_type==="worked"?"bg-emerald-500/20 text-emerald-400":a.shift_type==="sick"?"bg-red-500/20 text-red-400":a.shift_type==="vacation"?"bg-blue-500/20 text-blue-400":"bg-amber-500/20 text-amber-400"}`,children:[e.jsxs("div",{className:"font-medium",children:[a.start_time," - ",a.end_time]}),e.jsxs("div",{className:"text-[10px] opacity-75",children:[a.hours_worked,"h"]})]}):e.jsx("button",{onClick:()=>ee(s.id,t),className:"w-full p-2 rounded-lg border-2 border-dashed border-dark-600 hover:border-primary-500 hover:bg-dark-700 transition-colors text-dark-500 hover:text-primary-400",children:e.jsx(ie,{className:"w-4 h-4 mx-auto"})})},t)})]},s.id))})]})})]}),e.jsx(q,{isOpen:g,onClose:()=>{m(!1),C(null),j({name:"",role:"",hourly_rate:"",phone:"",email:"",active:!0})},title:l?"Modifica Dipendente":"Nuovo Dipendente",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome *"}),e.jsx("input",{type:"text",value:i.name,onChange:s=>j({...i,name:s.target.value}),className:"input",placeholder:"Nome completo"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ruolo *"}),e.jsx("input",{type:"text",value:i.role,onChange:s=>j({...i,role:s.target.value}),className:"input",placeholder:"Es. Cuoco"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tariffa Oraria (€)"}),e.jsx("input",{type:"number",step:"0.01",value:i.hourly_rate,onChange:s=>j({...i,hourly_rate:s.target.value}),className:"input",placeholder:"10.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>j({...i,phone:s.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",value:i.email,onChange:s=>j({...i,email:s.target.value}),className:"input",placeholder:"email@esempio.com"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:"Attivo"}),e.jsx("button",{type:"button",onClick:()=>j({...i,active:!i.active}),className:`relative w-14 h-8 rounded-full transition-colors ${i.active?"bg-emerald-500":"bg-dark-600"}`,children:e.jsx("span",{className:`absolute top-1 w-6 h-6 bg-white rounded-full transition-transform ${i.active?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:he,className:"btn-primary flex-1",children:l?"Salva":"Aggiungi"}),e.jsx("button",{onClick:()=>m(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(q,{isOpen:W,onClose:()=>{b(!1),N({employee_id:c[0]?.id||0,date:new Date().toISOString().split("T")[0],start_time:"09:00",end_time:"17:00",shift_type:"worked",notes:""})},title:"Nuovo Turno",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Dipendente *"}),e.jsx("select",{value:r.employee_id,onChange:s=>N({...r,employee_id:parseInt(s.target.value)}),className:"select",children:c.filter(s=>s.active).map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.role]},s.id))})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("label",{className:"label",children:"Data *"}),e.jsx("input",{type:"date",value:r.date,onChange:s=>N({...r,date:s.target.value}),className:"input"})]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-4 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Inizio"}),e.jsx("input",{type:"time",value:r.start_time,onChange:s=>N({...r,start_time:s.target.value}),className:"input"})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("label",{className:"label",children:"Fine"}),e.jsx("input",{type:"time",value:r.end_time,onChange:s=>N({...r,end_time:s.target.value}),className:"input"})]}),e.jsxs("div",{className:"mt-4 md:mt-0 md:col-span-2",children:[e.jsx("label",{className:"label",children:"Tipo Turno"}),e.jsxs("select",{value:r.shift_type,onChange:s=>N({...r,shift_type:s.target.value}),className:"select",children:[e.jsx("option",{value:"worked",children:"Lavorativo"}),e.jsx("option",{value:"vacation",children:"Ferie"}),e.jsx("option",{value:"sick",children:"Malattia"}),e.jsx("option",{value:"other",children:"Altro"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:r.notes,onChange:s=>N({...r,notes:s.target.value}),className:"input resize-none h-16",placeholder:"Note opzionali..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:pe,className:"btn-primary flex-1",children:"Salva Turno"}),e.jsx("button",{onClick:()=>b(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(oe,{isOpen:T,onClose:()=>S(!1),employees:c.filter(s=>s.active),selectedEmployee:H,onEmployeeChange:async s=>{V(s),s&&await $(s,P)},month:P,onMonthChange:async s=>{K(s),H&&await $(H,s)},shifts:Y,loading:B,calculatePay:se,canSelectEmployee:!0})]})}function oe({isOpen:k,onClose:E,employees:v,selectedEmployee:c,onEmployeeChange:z,month:_,onMonthChange:A,shifts:y,loading:G,calculatePay:d,canSelectEmployee:M}){const g=v.find(l=>l.id===c),m=c?d(c,y):null,W=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],[b,T]=_.split("-").map(Number),S=`${W[T-1]} ${b}`;return e.jsx(q,{isOpen:k,onClose:E,title:"Calcola Paga",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[M&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Dipendente"}),e.jsxs("select",{value:c||"",onChange:l=>z(parseInt(l.target.value)),className:"select",children:[e.jsx("option",{value:"",children:"Seleziona..."}),v.map(l=>e.jsxs("option",{value:l.id,children:[l.name," - ",l.role]},l.id))]})]}),e.jsxs("div",{className:M?"":"sm:col-span-2",children:[e.jsx("label",{className:"label",children:"Mese"}),e.jsx("input",{type:"month",value:_,onChange:l=>A(l.target.value),className:"input"})]})]}),G?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-500"})}):g&&m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-dark-900 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-500/20 flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:g.name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[g.role," - €",g.hourly_rate.toFixed(2),"/ora"]})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300 mb-3",children:S}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4 text-center",children:[e.jsx(me,{className:"w-5 h-5 mx-auto text-primary-400 mb-2"}),e.jsx("div",{className:"text-xl font-bold text-white",children:m.totalHours.toFixed(1)}),e.jsx("div",{className:"text-xs text-dark-400",children:"Ore lavorate"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4 text-center",children:[e.jsx(de,{className:"w-5 h-5 mx-auto text-emerald-400 mb-2"}),e.jsx("div",{className:"text-xl font-bold text-white",children:m.workedDays}),e.jsx("div",{className:"text-xs text-dark-400",children:"Giorni lavoro"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4 text-center",children:[e.jsx(w,{className:"w-5 h-5 mx-auto text-blue-400 mb-2"}),e.jsx("div",{className:"text-xl font-bold text-white",children:m.vacationDays}),e.jsx("div",{className:"text-xs text-dark-400",children:"Giorni ferie"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4 text-center",children:[e.jsx(w,{className:"w-5 h-5 mx-auto text-red-400 mb-2"}),e.jsx("div",{className:"text-xl font-bold text-white",children:m.sickDays}),e.jsx("div",{className:"text-xs text-dark-400",children:"Giorni malattia"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary-500/20 to-primary-600/10 rounded-xl p-6 border border-primary-500/30",children:[e.jsx("h3",{className:"text-sm font-medium text-primary-300 mb-4",children:"Calcolo Paga Lorda"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-dark-300",children:[e.jsx("span",{children:"Ore lavorate"}),e.jsxs("span",{className:"text-white",children:[m.totalHours.toFixed(1)," h"]})]}),e.jsxs("div",{className:"flex justify-between text-dark-300",children:[e.jsx("span",{children:"Tariffa oraria"}),e.jsxs("span",{className:"text-white",children:["€ ",g.hourly_rate.toFixed(2)]})]}),e.jsx("div",{className:"border-t border-primary-500/30 my-3"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-medium text-white",children:"Totale Lordo"}),e.jsxs("span",{className:"text-2xl font-bold text-primary-400",children:["€ ",m.totalPay.toFixed(2)]})]})]})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-dark-300 mb-3",children:["Dettaglio Turni (",y.length,")"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:y.sort((l,C)=>l.date.localeCompare(C.date)).map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-900 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${l.shift_type==="worked"?"bg-emerald-500":l.shift_type==="sick"?"bg-red-500":l.shift_type==="vacation"?"bg-blue-500":"bg-amber-500"}`}),e.jsx("span",{className:"text-dark-400",children:new Date(l.date).toLocaleDateString("it-IT",{weekday:"short",day:"numeric"})}),e.jsxs("span",{className:"text-white",children:[l.start_time," - ",l.end_time]})]}),e.jsxs("span",{className:"text-dark-300",children:[l.hours_worked,"h"]})]},l.id))})]})]}):e.jsxs("div",{className:"text-center py-8 text-dark-400",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Seleziona un dipendente e un mese per calcolare la paga"})]}),e.jsx("button",{onClick:E,className:"btn-primary w-full",children:"Chiudi"})]})})}export{$e as Staff};
