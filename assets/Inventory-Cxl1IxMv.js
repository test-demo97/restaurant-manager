import{d as Ye,u as We,r as a,aq as Ze,b as es,ar as ss,as as ts,at as as,au as is,av as ns,t as i,j as e,R as rs,P as ee,J as se,Q as te,T as je,K as ae,aw as Ne,e as U,ax as be,S as ve,N as fe,ay as ls,M as N,X as ds,az as cs,aA as os,aB as ms,aC as xs,aD as hs,aE as us,aF as ps,aG as gs,aH as ye,aI as js}from"./index-BJIwM2QH.js";import{T as Ns}from"./trending-down-BY6wymOL.js";import{D as ie}from"./dollar-sign-BDHyFSa_.js";import{C as bs}from"./clock-B1r53-dz.js";import{A as vs}from"./arrow-right-pAh-UTYf.js";const fs=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],M=Ye("truck",fs);function Cs(){We();const[L,we]=a.useState([]),[u,ke]=a.useState([]),[p,_e]=a.useState([]),[k,Se]=a.useState([]),[_,Ce]=a.useState([]),[b,Ie]=a.useState(null),[qe,Fe]=a.useState(!0),[v,R]=a.useState("inventory"),[P,ne]=a.useState("all"),[Ee,A]=a.useState(!1),[Me,z]=a.useState(!1),[Ae,S]=a.useState(!1),[ze,B]=a.useState(!1),[h,$e]=a.useState(null),[f,V]=a.useState(null),[Te,G]=a.useState([]),[m,$]=a.useState({name:"",unit:"kg",cost:""}),[C,re]=a.useState(""),[I,K]=a.useState("add"),[l,g]=a.useState({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1}),[c,q]=a.useState([]),[d,T]=a.useState({ingredient_id:0,quantity:"",unit_cost:""}),[o,H]=a.useState({cost_calculation_method:"fixed",moving_avg_months:3}),[Oe,O]=a.useState(!1),[De,D]=a.useState(!1),[y,le]=a.useState(null),[J,X]=a.useState(""),[Qe,Q]=a.useState(!1),[r,de]=a.useState(null),[ce,F]=a.useState(""),[w,Y]=a.useState("manual");a.useEffect(()=>{x()},[]);async function x(){try{const[s,t,n,W,j,Z,Xe]=await Promise.all([Ze(),es(),ss(),ts(),as(),is(),ns()]);we(s),ke(t),_e(n),Se(W),Ce(j),Ie(Z),H(Xe)}catch(s){console.error("Error loading data:",s),i("Errore nel caricamento dati","error")}finally{Fe(!1)}}async function Ue(){try{await ps(o),i("Impostazioni salvate","success"),O(!1)}catch(s){console.error("Error saving settings:",s),i("Errore nel salvataggio","error")}}const oe={fixed:"Costo Fisso",last:"Ultimo Costo",weighted_avg:"Media Ponderata",moving_avg:"Media Mobile"},Le={fixed:"Il costo unitario non cambia mai automaticamente. Devi aggiornarlo manualmente.",last:"Il costo unitario viene aggiornato con il costo dell'ultima fornitura.",weighted_avg:"Il costo viene calcolato come media ponderata tra stock esistente e nuova fornitura.",moving_avg:"Il costo viene calcolato come media delle forniture degli ultimi N mesi."},E=p.filter(s=>s.days_until_reorder<7&&s.avg_daily_consumption>0),me=P==="low"?u:L;function xe(s){$e(s),re(""),K("add"),z(!0)}function he(s){const t=k.find(n=>n.id===s.ingredient_id);t&&(le(t),X(t.cost.toString()),D(!0))}async function Re(){if(!y||!J)return;const s=parseFloat(J);if(isNaN(s)||s<0){i("Inserisci un costo valido","warning");return}try{await js(y.id,s),i("Costo aggiornato con successo","success"),D(!1),le(null),X(""),x()}catch(t){console.error("Error updating cost:",t),i("Errore nell'aggiornamento del costo","error")}}function ue(s){de(s),F(s.threshold.toString()),Y(s.threshold_mode||"manual");const t=p.find(n=>n.ingredient_id===s.ingredient_id);t&&s.threshold_mode==="eoq"&&F(t.reorder_point.toString()),Q(!0)}async function Pe(){if(r)try{if(w==="manual"){const s=parseFloat(ce);if(isNaN(s)||s<0){i("Inserisci una soglia valida","warning");return}await gs(r.ingredient_id,s),await ye(r.ingredient_id,"manual")}else{const s=p.find(t=>t.ingredient_id===r.ingredient_id);if(!s||s.reorder_point===0){i("EOQ non disponibile: servono più dati di consumo","warning");return}await ye(r.ingredient_id,"eoq",s.reorder_point)}i("Soglia scorta aggiornata","success"),Q(!1),de(null),x()}catch(s){console.error("Error updating threshold:",s),i("Errore nell'aggiornamento della soglia","error")}}async function Be(){if(!m.name.trim()){i("Inserisci un nome","warning");return}try{await ms({name:m.name.trim(),unit:m.unit,cost:parseFloat(m.cost)||0}),i("Ingrediente aggiunto","success"),A(!1),$({name:"",unit:"kg",cost:""}),x()}catch(s){console.error("Error adding ingredient:",s),i("Errore nell'aggiunta","error")}}async function Ve(){if(!h||!C){i("Inserisci una quantità","warning");return}const s=parseFloat(C);if(isNaN(s)||s<0){i("Inserisci un valore numerico valido","warning");return}try{const t=I==="add"?h.quantity+s:s;await xs(h.ingredient_id,t),i("Quantità aggiornata","success"),z(!1),x()}catch(t){console.error("Error updating quantity:",t),i("Errore nell'aggiornamento","error")}}function Ge(){if(!d.ingredient_id||!d.quantity||!d.unit_cost){i("Compila tutti i campi","warning");return}const s=k.find(t=>t.id===d.ingredient_id);if(s){if(c.some(t=>t.ingredient_id===d.ingredient_id)){i("Ingrediente già aggiunto","warning");return}q([...c,{ingredient_id:d.ingredient_id,ingredient_name:s.name,unit:s.unit,quantity:parseFloat(d.quantity),unit_cost:parseFloat(d.unit_cost)}]),T({ingredient_id:0,quantity:"",unit_cost:""})}}function Ke(s){q(c.filter(t=>t.ingredient_id!==s))}async function He(){if(c.length===0){i("Aggiungi almeno un ingrediente","warning");return}try{if(await hs({date:l.date,supplier_name:l.supplier_name||void 0,notes:l.notes||void 0},c.map(s=>({ingredient_id:s.ingredient_id,quantity:s.quantity,unit_cost:s.unit_cost}))),l.createAsInvoice){const s=c.reduce((j,Z)=>j+Z.unit_cost,0),t=c.map(j=>`${j.ingredient_name} (${j.quantity} ${j.unit})`).join(", "),n=new Date,W=`FORN-${n.getFullYear()}${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}-${Date.now().toString().slice(-4)}`;await us({date:l.date,invoice_number:W,supplier_name:l.supplier_name||"Fornitore",description:t.length>200?t.substring(0,197)+"...":t,amount:s,vat_amount:0,total:s,category:"supplies",paid:!1,notes:l.notes||"Fattura generata automaticamente da fornitura inventario"}),i("Fornitura registrata e fattura creata","success")}else i("Fornitura registrata con successo","success");S(!1),g({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1}),q([]),x()}catch(s){console.error("Error creating supply:",s),i("Errore nella creazione fornitura","error")}}async function pe(s){try{const t=await cs(s.id);V(s),G(t),B(!0)}catch(t){console.error("Error loading supply items:",t),i("Errore nel caricamento dettagli","error")}}async function ge(s){if(confirm("Sei sicuro di voler eliminare questa fornitura? Le quantità verranno sottratte dall'inventario."))try{await os(s),i("Fornitura eliminata","success"),x()}catch(t){console.error("Error deleting supply:",t),i("Errore nell'eliminazione","error")}}const Je=c.reduce((s,t)=>s+t.unit_cost,0);return qe?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white",children:"Inventario"}),e.jsx("p",{className:"text-dark-400 text-xs sm:text-sm",children:"Gestisci scorte e ottimizza riordini"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x,className:"btn-secondary btn-sm p-2",children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>S(!0),className:"btn-primary btn-sm text-xs sm:text-sm",children:[e.jsx(M,{className:"w-4 h-4"}),"Fornitura"]}),e.jsxs("button",{onClick:()=>A(!0),className:"btn-secondary btn-sm text-xs sm:text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Ingrediente"})]})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 border-b border-dark-700 pb-2 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:[e.jsxs("button",{onClick:()=>R("inventory"),className:`px-3 sm:px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap text-xs sm:text-sm ${v==="inventory"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(se,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),"Scorte"]}),e.jsxs("button",{onClick:()=>R("supplies"),className:`px-3 sm:px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap text-xs sm:text-sm ${v==="supplies"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(M,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),"Forniture",_.length>0&&e.jsx("span",{className:"ml-1 sm:ml-2 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:_.length})]}),e.jsxs("button",{onClick:()=>R("eoq"),className:`px-3 sm:px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap text-xs sm:text-sm ${v==="eoq"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(te,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"EOQ & "}),"Riordini",E.length>0&&e.jsx("span",{className:"ml-1 sm:ml-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:E.length})]})]}),v==="inventory"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Tot. Ingredienti"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:L.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(se,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Scorte Basse"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:u.length})]}),e.jsx("div",{className:`w-8 h-8 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${u.length>0?"bg-red-500/20":"bg-emerald-500/20"}`,children:e.jsx(je,{className:`w-4 h-4 sm:w-6 sm:h-6 ${u.length>0?"text-red-400":"text-emerald-400"}`})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Riordina (7gg)"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:E.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ns,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})})]}),u.length>0&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[e.jsx(je,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-red-400 text-sm sm:text-base",children:"Attenzione: Scorte Basse"}),e.jsx("p",{className:"text-xs sm:text-sm text-dark-300 truncate",children:u.map(s=>s.ingredient_name).join(", ")})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:[e.jsxs("button",{onClick:()=>ne("all"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${P==="all"?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Tutti (",L.length,")"]}),e.jsxs("button",{onClick:()=>ne("low"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${P==="low"?"bg-red-500 text-white":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Scorte Basse (",u.length,")"]})]}),e.jsx("div",{className:"sm:hidden space-y-2",children:me.map(s=>{const t=s.quantity<=s.threshold;return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-white text-sm",children:s.ingredient_name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${t?"bg-red-500/20 text-red-400":"bg-emerald-500/20 text-emerald-400"}`,children:t?"Basso":"OK"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`font-semibold ${t?"text-red-400":"text-white"}`,children:[s.quantity.toFixed(2)," ",s.unit]}),e.jsxs("span",{className:"text-dark-500 text-xs",children:["Soglia: ",s.threshold," ",s.threshold_mode==="eoq"&&e.jsx("span",{className:"text-primary-400",children:"(EOQ)"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>xe(s),className:"p-2 bg-dark-700 rounded-lg",title:"Aggiorna quantità",children:e.jsx(ae,{className:"w-4 h-4 text-dark-300"})}),e.jsx("button",{onClick:()=>he(s),className:"p-2 bg-dark-700 rounded-lg",title:"Modifica costo",children:e.jsx(ie,{className:"w-4 h-4 text-dark-300"})}),e.jsx("button",{onClick:()=>ue(s),className:`p-2 bg-dark-700 rounded-lg ${s.threshold_mode==="eoq"?"ring-1 ring-primary-500":""}`,title:"Soglia scorta",children:e.jsx(Ne,{className:`w-4 h-4 ${s.threshold_mode==="eoq"?"text-primary-400":"text-dark-300"}`})}),e.jsx("button",{onClick:()=>{window.confirm(`Eliminare ${s.ingredient_name}?`)&&be(s.id).then(()=>{x(),i("Ingrediente eliminato","success")}).catch(n=>{console.error("Errore eliminazione:",n),i("Errore nell'eliminazione","error")})},className:"p-2 bg-red-500/20 rounded-lg",title:"Elimina ingrediente",children:e.jsx(U,{className:"w-4 h-4 text-red-400"})})]})]})]},s.id)})}),e.jsx("div",{className:"card hidden sm:block",children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingrediente"}),e.jsx("th",{children:"Quantità"}),e.jsx("th",{children:"Unità"}),e.jsx("th",{children:"Soglia"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:me.map(s=>{const t=s.quantity<=s.threshold;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name})}),e.jsx("td",{children:e.jsx("p",{className:`font-semibold ${t?"text-red-400":"text-white"}`,children:s.quantity.toFixed(2)})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-300",children:s.unit})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400",children:s.threshold})}),e.jsx("td",{children:e.jsx("span",{className:t?"badge-danger":"badge-success",children:t?"Basso":"OK"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>xe(s),className:"btn-secondary btn-sm",title:"Aggiorna quantità",children:[e.jsx(ae,{className:"w-4 h-4"}),"Qtà"]}),e.jsx("button",{onClick:()=>he(s),className:"btn-ghost btn-sm",title:"Modifica costo unitario",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ue(s),className:`btn-ghost btn-sm ${s.threshold_mode==="eoq"?"text-primary-400":""}`,title:`Soglia scorta (${s.threshold_mode==="eoq"?"EOQ":"Manuale"})`,children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{window.confirm(`Eliminare ${s.ingredient_name}?`)&&be(s.id).then(()=>{x(),i("Ingrediente eliminato","success")}).catch(n=>{console.error("Errore eliminazione:",n),i("Errore nell'eliminazione","error")})},className:"btn-danger btn-sm",title:"Elimina ingrediente",children:e.jsx(U,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})]}),v==="supplies"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Tot. Forniture"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:b?.suppliesCount||0})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Speso Totale"}),e.jsxs("p",{className:"stat-value text-lg sm:text-2xl",children:["€",b?.totalSpent.toFixed(0)||"0"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ve,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Media Fornitura"}),e.jsxs("p",{className:"stat-value text-lg sm:text-2xl",children:["€",b?.avgSupplyCost.toFixed(0)||"0"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(te,{className:"w-4 h-4 sm:w-6 sm:h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Ingredienti"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:k.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(se,{className:"w-4 h-4 sm:w-6 sm:h-6 text-purple-400"})})]})})]}),b&&b.topIngredients.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white text-sm sm:text-base",children:"Top Ingredienti Acquistati"})}),e.jsx("div",{className:"p-3 sm:p-4",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3",children:b.topIngredients.map((s,t)=>e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2 sm:p-3",children:[e.jsx("p",{className:"font-medium text-white text-xs sm:text-sm truncate",children:s.ingredient_name}),e.jsxs("p",{className:"text-primary-400 font-semibold text-sm sm:text-base",children:["€",s.total_cost.toFixed(2)]}),e.jsxs("p",{className:"text-dark-400 text-xs",children:["Qty: ",s.quantity.toFixed(2)]})]},t))})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white text-sm sm:text-base",children:"Storico Forniture"}),e.jsxs("button",{onClick:()=>S(!0),className:"btn-primary btn-sm text-xs sm:text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuova"})," Fornitura"]})]}),_.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center",children:[e.jsx(M,{className:"w-10 h-10 sm:w-12 sm:h-12 text-dark-500 mx-auto mb-3"}),e.jsx("p",{className:"text-dark-400 text-sm sm:text-base",children:"Nessuna fornitura registrata"}),e.jsx("p",{className:"text-dark-500 text-xs sm:text-sm mt-1",children:'Clicca su "Nuova Fornitura" per registrare la prima'})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:hidden divide-y divide-dark-700",children:_.map(s=>e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-white text-sm",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})}),e.jsxs("p",{className:"font-semibold text-primary-400",children:["€",s.total_cost.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("p",{className:"text-dark-400 text-xs truncate",children:s.supplier_name||"Fornitore non spec."})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>pe(s),className:"p-2 bg-dark-700 rounded-lg",title:"Visualizza",children:e.jsx(fe,{className:"w-4 h-4 text-dark-300"})}),e.jsx("button",{onClick:()=>ge(s.id),className:"p-2 bg-red-500/20 rounded-lg",title:"Elimina",children:e.jsx(U,{className:"w-4 h-4 text-red-400"})})]})]})]},s.id))}),e.jsx("div",{className:"table-container hidden sm:block",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Fornitore"}),e.jsx("th",{children:"Totale"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:_.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-300",children:s.supplier_name||"-"})}),e.jsx("td",{children:e.jsxs("p",{className:"font-semibold text-primary-400",children:["€",s.total_cost.toFixed(2)]})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400 text-sm truncate max-w-[200px]",children:s.notes||"-"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>pe(s),className:"btn-secondary btn-sm",title:"Visualizza dettagli",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ge(s.id),className:"btn-danger btn-sm",title:"Elimina",children:e.jsx(U,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]})]}),v==="eoq"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Calcolo Costo Unitario Ingredienti"}),e.jsxs("p",{className:"text-sm text-dark-400",children:["Metodo: ",e.jsx("span",{className:"text-primary-400",children:oe[o.cost_calculation_method]}),o.cost_calculation_method==="moving_avg"&&e.jsxs("span",{className:"text-dark-500",children:[" (",o.moving_avg_months," mesi)"]})]})]})]}),e.jsxs("button",{onClick:()=>O(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Configura"]})]})}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-400 mb-2",children:"Cos'è l'EOQ?"}),e.jsxs("p",{className:"text-sm text-dark-300",children:["L'",e.jsx("strong",{children:"Economic Order Quantity"})," (EOQ) è la quantità ottimale da ordinare che minimizza i costi totali (costo ordine + costo stoccaggio). Il sistema analizza i consumi storici per calcolare automaticamente quando e quanto riordinare."]})]}),E.length>0&&e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"w-5 h-5 text-amber-400"}),e.jsx("h3",{className:"font-semibold text-amber-400",children:"Da riordinare nei prossimi 7 giorni"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 md:grid-cols-3 gap-3",children:E.map(s=>e.jsxs("div",{className:"bg-dark-800 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm",children:[e.jsx(bs,{className:"w-3 h-3 text-amber-400"}),e.jsx("span",{className:"text-amber-400",children:s.days_until_reorder===0?"Oggi!":`${s.days_until_reorder} giorni`})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-dark-400",children:[e.jsxs("span",{children:["Ordina: ",s.eoq.toFixed(1)]}),e.jsx(vs,{className:"w-3 h-3"}),e.jsx("span",{className:"text-emerald-400",children:"Risparmio ottimale"})]})]},s.ingredient_id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white",children:"Analisi EOQ Ingredienti"})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingrediente"}),e.jsx("th",{children:"Stock Attuale"}),e.jsx("th",{children:"Consumo/Giorno"}),e.jsx("th",{children:"EOQ"}),e.jsx("th",{children:"Punto Riordino"}),e.jsx("th",{children:"Giorni al Riordino"}),e.jsx("th",{children:"Ordini/Anno"})]})}),e.jsx("tbody",{children:p.map(s=>{const t=s.days_until_reorder<7&&s.avg_daily_consumption>0,n=s.avg_daily_consumption===0;return e.jsxs("tr",{className:t?"bg-amber-500/10":"",children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name})}),e.jsx("td",{children:e.jsx("p",{className:`font-semibold ${s.current_stock<=s.reorder_point?"text-red-400":"text-white"}`,children:s.current_stock.toFixed(2)})}),e.jsx("td",{children:n?e.jsx("span",{className:"text-dark-500 text-sm",children:"Nessun dato"}):e.jsx("p",{className:"text-dark-300",children:s.avg_daily_consumption.toFixed(3)})}),e.jsx("td",{children:n?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-primary-400 font-semibold",children:s.eoq.toFixed(1)})}),e.jsx("td",{children:n?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-dark-300",children:s.reorder_point.toFixed(1)})}),e.jsx("td",{children:n?e.jsx("span",{className:"text-dark-500",children:"-"}):s.days_until_reorder===1/0?e.jsx("span",{className:"badge-success",children:"OK"}):e.jsxs("span",{className:`font-semibold ${s.days_until_reorder<3?"text-red-400":s.days_until_reorder<7?"text-amber-400":"text-emerald-400"}`,children:[s.days_until_reorder," gg"]})}),e.jsx("td",{children:n?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-dark-400",children:s.order_frequency.toFixed(1)})})]},s.ingredient_id)})})]})})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Legenda"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"EOQ"}),": Quantità ottimale da ordinare"]}),e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Punto Riordino"}),": Stock al quale effettuare l'ordine"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Scorta Sicurezza"}),": Buffer per evitare stockout"]}),e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Ordini/Anno"}),": Frequenza ordini stimata"]})]})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-3",children:"* I calcoli si basano sui consumi degli ultimi 30 giorni. Più ordini elabori, più precisi saranno i dati."})]})]}),e.jsx(N,{isOpen:Ee,onClose:()=>A(!1),title:"Aggiungi Ingrediente",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Ingrediente *"}),e.jsx("input",{type:"text",value:m.name,onChange:s=>$({...m,name:s.target.value}),className:"input",placeholder:"Es. Carne Kebab"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unità di Misura"}),e.jsxs("select",{value:m.unit,onChange:s=>$({...m,unit:s.target.value}),className:"select",children:[e.jsx("option",{value:"kg",children:"Chilogrammi (kg)"}),e.jsx("option",{value:"g",children:"Grammi (g)"}),e.jsx("option",{value:"lt",children:"Litri (lt)"}),e.jsx("option",{value:"ml",children:"Millilitri (ml)"}),e.jsx("option",{value:"pz",children:"Pezzi (pz)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Costo Unitario (€)"}),e.jsx("input",{type:"number",step:"0.01",value:m.cost,onChange:s=>$({...m,cost:s.target.value}),className:"input",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Be,className:"btn-primary flex-1",children:"Aggiungi"}),e.jsx("button",{onClick:()=>A(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(N,{isOpen:Me,onClose:()=>z(!1),title:`Aggiorna ${h?.ingredient_name}`,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Quantità attuale"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[h?.quantity.toFixed(2)," ",h?.unit]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Modalità"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>K("add"),className:`py-2 rounded-xl font-medium transition-all ${I==="add"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300"}`,children:"Aggiungi"}),e.jsx("button",{onClick:()=>K("set"),className:`py-2 rounded-xl font-medium transition-all ${I==="set"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300"}`,children:"Imposta"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:I==="add"?"Quantità da aggiungere":"Nuova quantità"}),e.jsx("input",{type:"number",step:"0.01",value:C,onChange:s=>re(s.target.value),className:"input",placeholder:"0.00"})]}),I==="add"&&C&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-emerald-400",children:["Nuova quantità: ",((h?.quantity||0)+parseFloat(C||"0")).toFixed(2)," ",h?.unit]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Ve,className:"btn-primary flex-1",children:"Aggiorna"}),e.jsx("button",{onClick:()=>z(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(N,{isOpen:Ae,onClose:()=>{S(!1),q([]),g({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1})},title:"Nuova Fornitura",size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data Fornitura *"}),e.jsx("input",{type:"date",value:l.date,onChange:s=>g({...l,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fornitore"}),e.jsx("input",{type:"text",value:l.supplier_name,onChange:s=>g({...l,supplier_name:s.target.value}),className:"input",placeholder:"Es. Fornitore S.r.l."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{type:"text",value:l.notes,onChange:s=>g({...l,notes:s.target.value}),className:"input",placeholder:"Note opzionali sulla fornitura"})]}),e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Aggiungi Ingrediente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ingrediente"}),e.jsxs("select",{value:d.ingredient_id,onChange:s=>{const t=k.find(n=>n.id===Number(s.target.value));T({...d,ingredient_id:Number(s.target.value),unit_cost:t?.cost?.toString()||""})},className:"select",children:[e.jsx("option",{value:0,children:"Seleziona ingrediente..."}),k.filter(s=>!c.some(t=>t.ingredient_id===s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label",children:"Quantità"}),e.jsx("input",{type:"number",step:"0.01",value:d.quantity,onChange:s=>T({...d,quantity:s.target.value}),className:"input",placeholder:"0.00"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label",children:"Costo Totale (€)"}),e.jsx("input",{type:"number",step:"0.01",value:d.unit_cost,onChange:s=>T({...d,unit_cost:s.target.value}),className:"input",placeholder:"0.00"})]}),e.jsx("button",{onClick:Ge,className:"btn-primary h-[42px] px-4",title:"Aggiungi ingrediente",children:e.jsx(ee,{className:"w-5 h-5"})})]})]})]}),c.length>0&&e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Ingredienti nella Fornitura"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-900 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"font-semibold text-primary-400",children:[s.unit_cost.toFixed(2)," €"]}),e.jsx("button",{onClick:()=>Ke(s.ingredient_id),className:"text-red-400 hover:text-red-300 p-1",children:e.jsx(ds,{className:"w-5 h-5"})})]})]},s.ingredient_id))}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"font-semibold text-white",children:"Totale Fornitura"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:[Je.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsxs("button",{onClick:He,disabled:c.length===0,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(M,{className:"w-4 h-4"}),"Registra Fornitura"]}),e.jsx("button",{onClick:()=>{S(!1),q([]),g({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1})},className:"btn-secondary",children:"Annulla"})]}),e.jsx("div",{className:"bg-dark-900 rounded-xl p-4",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.createAsInvoice,onChange:s=>g({...l,createAsInvoice:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"Crea fattura automaticamente"}),e.jsx("p",{className:"text-xs text-dark-400 mt-0.5",children:"Aggiunge questa fornitura come fattura nella sezione Ammin. & Report"})]})]})}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-blue-400",children:[e.jsx("strong",{children:"Nota:"})," Quando registri una fornitura, le quantità vengono automaticamente aggiunte all'inventario e i costi degli ingredienti vengono aggiornati.",l.createAsInvoice&&e.jsx("span",{className:"block mt-1",children:`Una fattura con categoria "Forniture" verrà creata automaticamente. Potrai modificare l'IVA e altri dettagli in seguito.`})]})})]})}),e.jsx(N,{isOpen:ze,onClose:()=>{B(!1),V(null),G([])},title:"Dettaglio Fornitura",size:"md",children:f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(f.date).toLocaleDateString("it-IT",{day:"2-digit",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Fornitore"}),e.jsx("p",{className:"font-semibold text-white",children:f.supplier_name||"Non specificato"})]})]}),f.notes&&e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Note"}),e.jsx("p",{className:"text-white",children:f.notes})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Articoli"}),e.jsx("div",{className:"space-y-2",children:Te.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-900 rounded-lg px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.quantity," ",s.unit," x ",s.unit_cost.toFixed(2)," €/",s.unit]})]}),e.jsxs("p",{className:"font-semibold text-primary-400",children:[(s.total_cost||s.quantity*s.unit_cost).toFixed(2)," €"]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:"Totale"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:[f.total_cost.toFixed(2)," €"]})]}),e.jsx("div",{className:"pt-4 border-t border-dark-700",children:e.jsx("button",{onClick:()=>{B(!1),V(null),G([])},className:"btn-secondary w-full",children:"Chiudi"})})]})}),e.jsx(N,{isOpen:Oe,onClose:()=>O(!1),title:"Impostazioni Costo Ingredienti",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Calcolo del Costo Unitario"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:["fixed","last","weighted_avg","moving_avg"].map(s=>e.jsxs("button",{onClick:()=>H({...o,cost_calculation_method:s}),className:`w-full p-4 rounded-xl border-2 text-left transition-all ${o.cost_calculation_method===s?"border-primary-500 bg-primary-500/10":"border-dark-600 hover:border-dark-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${o.cost_calculation_method===s?"text-primary-400":"text-white"}`,children:oe[s]}),o.cost_calculation_method===s&&e.jsx("span",{className:"text-primary-400 text-sm",children:"✓"})]}),e.jsx("p",{className:"text-sm text-dark-400 mt-1",children:Le[s]})]},s))})]}),o.cost_calculation_method==="moving_avg"&&e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("label",{className:"label",children:"Periodo Media Mobile"}),e.jsx("p",{className:"text-sm text-dark-400 mb-3",children:"Seleziona il numero di mesi da considerare per la media mobile (ultimi forniture nell'ultimo anno)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"12",value:o.moving_avg_months,onChange:s=>H({...o,moving_avg_months:parseInt(s.target.value)}),className:"flex-1 h-2 bg-dark-700 rounded-lg appearance-none cursor-pointer accent-primary-500"}),e.jsxs("div",{className:"bg-dark-800 px-4 py-2 rounded-lg min-w-[80px] text-center",children:[e.jsx("span",{className:"text-xl font-bold text-primary-400",children:o.moving_avg_months}),e.jsx("span",{className:"text-dark-400 text-sm ml-1",children:"mesi"})]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-dark-500 mt-2",children:[e.jsx("span",{children:"1 mese"}),e.jsx("span",{children:"6 mesi"}),e.jsx("span",{children:"12 mesi"})]})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-blue-400",children:[e.jsx("strong",{children:"Nota:"})," Il metodo selezionato verrà applicato automaticamente quando registri nuove forniture. I costi esistenti non verranno ricalcolati retroattivamente."]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsx("button",{onClick:Ue,className:"btn-primary flex-1",children:"Salva Impostazioni"}),e.jsx("button",{onClick:()=>O(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(N,{isOpen:Qe,onClose:()=>Q(!1),title:`Soglia Scorta - ${r?.ingredient_name}`,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-dark-400",children:"Quantità attuale:"}),e.jsxs("span",{className:"text-white font-semibold",children:[r?.quantity.toFixed(2)," ",r?.unit]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Soglia attuale:"}),e.jsxs("span",{className:`font-semibold ${r?.threshold_mode==="eoq"?"text-primary-400":"text-amber-400"}`,children:[r?.threshold.toFixed(2)," ",r?.unit,e.jsxs("span",{className:"text-xs ml-1",children:["(",r?.threshold_mode==="eoq"?"EOQ":"Manuale",")"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Modalità Soglia"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{Y("manual"),F(r?.threshold.toString()||"10")},className:`p-3 rounded-xl border-2 transition-all ${w==="manual"?"border-amber-500 bg-amber-500/10":"border-dark-600 hover:border-dark-500"}`,children:[e.jsx(ae,{className:"w-5 h-5 mx-auto mb-1 text-amber-400"}),e.jsx("div",{className:"text-sm font-medium",children:"Manuale"}),e.jsx("div",{className:"text-xs text-dark-400",children:"Imposti tu"})]}),e.jsxs("button",{onClick:()=>{Y("eoq");const s=p.find(t=>t.ingredient_id===r?.ingredient_id);s&&F(s.reorder_point.toString())},className:`p-3 rounded-xl border-2 transition-all ${w==="eoq"?"border-primary-500 bg-primary-500/10":"border-dark-600 hover:border-dark-500"}`,children:[e.jsx(te,{className:"w-5 h-5 mx-auto mb-1 text-primary-400"}),e.jsx("div",{className:"text-sm font-medium",children:"EOQ"}),e.jsx("div",{className:"text-xs text-dark-400",children:"Auto-calcolata"})]})]})]}),w==="manual"&&e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Soglia Scorta (",r?.unit,")"]}),e.jsx("input",{type:"text",inputMode:"decimal",value:ce,onChange:s=>{const t=s.target.value;(t===""||/^\d*\.?\d*$/.test(t))&&F(t)},className:"input",placeholder:"10"}),e.jsx("p",{className:"text-xs text-dark-500 mt-1",children:"Riceverai un avviso quando la quantità scende sotto questa soglia"})]}),w==="eoq"&&e.jsx("div",{className:"space-y-3",children:(()=>{const s=p.find(t=>t.ingredient_id===r?.ingredient_id);return!s||s.reorder_point===0?e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-amber-400",children:[e.jsx("strong",{children:"EOQ non disponibile"}),e.jsx("br",{}),"Servono più dati di consumo e ordini per calcolare automaticamente la soglia ottimale."]})}):e.jsxs("div",{className:"bg-primary-500/10 border border-primary-500/30 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-400 text-sm",children:"Punto di riordino:"}),e.jsxs("span",{className:"text-primary-400 font-bold",children:[s.reorder_point.toFixed(2)," ",r?.unit]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-400 text-sm",children:"Scorta sicurezza:"}),e.jsxs("span",{className:"text-white",children:[s.safety_stock.toFixed(2)," ",r?.unit]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-dark-400 text-sm",children:"Consumo medio/giorno:"}),e.jsxs("span",{className:"text-white",children:[s.avg_daily_consumption.toFixed(2)," ",r?.unit]})]}),e.jsx("p",{className:"text-xs text-primary-300 pt-2 border-t border-primary-500/30",children:"La soglia verrà aggiornata automaticamente in base ai consumi"})]})})()}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsx("button",{onClick:Pe,className:"btn-primary flex-1",disabled:w==="eoq"&&!p.find(s=>s.ingredient_id===r?.ingredient_id)?.reorder_point,children:"Salva"}),e.jsx("button",{onClick:()=>Q(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(N,{isOpen:De,onClose:()=>D(!1),title:`Modifica Costo - ${y?.name}`,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-dark-400",children:"Costo attuale:"}),e.jsxs("span",{className:"text-white font-semibold",children:["€",y?.cost.toFixed(2),"/",y?.unit]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Nuovo Costo Unitario (€/",y?.unit,")"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:J,onChange:s=>X(s.target.value),className:"input",placeholder:"0.00"})]})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-amber-400",children:[e.jsx("strong",{children:"Attenzione:"})," Questa modifica influenzerà il calcolo del costo dei piatti che utilizzano questo ingrediente."]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsx("button",{onClick:Re,className:"btn-primary flex-1",children:"Conferma Modifica"}),e.jsx("button",{onClick:()=>D(!1),className:"btn-secondary",children:"Annulla"})]})]})})]})}export{Cs as Inventory};
