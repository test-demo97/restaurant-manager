const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DlwzvMJs.js","assets/index-B4UUNmqQ.css"])))=>i.map(i=>d[i]);
import{d as Gt,u as Kt,k as Qt,i as Bt,l as Ht,r as o,D as Vt,_ as Wt,t as p,E as Ze,F as Oe,j as e,H as Ut,W as Jt,G as Yt,R as Xt,L as Zt,P as Fs,e as L,I as ea,c as Bs,C as sa,J as X,K as ie,M as F,N as es,f as Ie,O as Ls,Q as B,x as le,V as ta,Y as qs,Z as aa,$ as na,a0 as ra,a1 as ia,s as Te,a2 as ss,q as ts,a3 as as,a4 as ns,a5 as rs,a6 as Rs,a7 as la,a8 as oa,a9 as Gs,aa as da,ab as ca,ac as ma}from"./index-DlwzvMJs.js";import{u as xa}from"./useCurrency-BeQWT6-C.js";import{S as oe,a as de,b as ha,L as pa}from"./SessionDetailsModal-n8HBYYV4.js";import{u as ua}from"./useDemoGuard-DvQLN8mP.js";import{C as Hs}from"./clock-Be8V2WBc.js";import{C as is}from"./chevron-down-CUFTXCmx.js";import{C as ls}from"./chevron-right-A21ed9a4.js";import{C as Ks}from"./calendar-CLndiYrK.js";import{S as ga}from"./search-CKtz0mE8.js";import{M as ja}from"./minus-DYmGgUGR.js";import{B as ce}from"./banknote-CISDn-gD.js";import{G as os}from"./globe-CqaEG_LP.js";import{P as ds}from"./printer-Bp5hlnmn.js";import{F as ba}from"./file-text-DyR65ehk.js";const fa=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Qs=Gt("funnel",fa),C={pending:{labelKey:"orders.pending",icon:Hs,color:"badge-warning",next:"preparing"},preparing:{labelKey:"orders.preparing",icon:sa,color:"badge-info",next:"ready"},ready:{labelKey:"orders.ready",icon:Bs,color:"badge-success",next:"delivered"},delivered:{labelKey:"orders.completed",icon:ea,color:"badge-success",next:null},cancelled:{labelKey:"orders.cancelled",icon:L,color:"badge-danger",next:null}},Z={dine_in:"orders.dineIn",takeaway:"orders.takeaway",delivery:"orders.delivery"};function Ma(){const{t:g}=Kt(),{formatPrice:x}=xa(),{checkCanWrite:cs}=ua(),{user:ee}=Qt(),{smacEnabled:q}=Bt(),ms=Ht(),[M,Vs]=o.useState([]),[Ws,xs]=o.useState(!0),[hs]=o.useState(new Date().toISOString().split("T")[0]),[Pe,Us]=o.useState(""),[h,$e]=o.useState(null),[Js,H]=o.useState(!1),[Ae,me]=o.useState(!1),[P,xe]=o.useState({}),[ps,he]=o.useState({}),us="kebab_expanded_orders_v1",[pe,Ys]=o.useState(()=>{try{const s=localStorage.getItem(us);if(s){const t=JSON.parse(s||"{}");return{pending:new Set(t.pending||[]),preparing:new Set(t.preparing||[]),ready:new Set(t.ready||[]),delivered:new Set(t.delivered||[])}}}catch{}return{pending:new Set,preparing:new Set,ready:new Set,delivered:new Set}}),Xs=s=>{try{const t={pending:Array.from(s.pending||[]),preparing:Array.from(s.preparing||[]),ready:Array.from(s.ready||[]),delivered:Array.from(s.delivered||[])};localStorage.setItem(us,JSON.stringify(t))}catch{}},[Zs,V]=o.useState(!1),[et,ue]=o.useState(!1),[gs,st]=o.useState(null),[js,Me]=o.useState(""),[tt]=o.useState([]),[c,I]=o.useState({order_type:"dine_in",table_id:void 0,payment_method:"cash",customer_name:"",customer_phone:"",notes:"",smac_passed:!1,status:"pending",total:0,originalTotal:0}),[at,ge]=o.useState(!1),[je,be]=o.useState([]),[bs,fs]=o.useState("pending"),[Ns,vs]=o.useState(""),[ys]=o.useState(new Set),[E,ws]=o.useState("today"),[ks,nt]=o.useState([]),[De,ze]=o.useState([]),[rt,Ss]=o.useState(!1),[fe,Fe]=o.useState(()=>{const s=new Date;return s.setDate(s.getDate()-7),s.toISOString().split("T")[0]}),[Ne,Le]=o.useState(new Date().toISOString().split("T")[0]),[qe,it]=o.useState("all"),[N,O]=o.useState([]),[R,_s]=o.useState(""),[Cs,lt]=o.useState(new Set),[ot]=o.useState(!1),[dt,ve]=o.useState(!1),[b,W]=o.useState(null),[S,se]=o.useState({method:"cash",smac:!1}),[T,te]=o.useState({customerGives:""}),[ct,Es]=o.useState(!1),[mt]=o.useState(0),[xt]=o.useState(0),[ht]=o.useState(0),[pt,ut]=o.useState(!0),[gt,ye]=o.useState(!1),[jt,Re]=o.useState(!1),[bt,Ge]=o.useState(!1),[j,ft]=o.useState(null),[we,ke]=o.useState("manual"),[G,Ke]=o.useState([]),[D,Qe]=o.useState(0),[Nt,Os]=o.useState([]),[$,Be]=o.useState([]),[ae,Se]=o.useState({}),[w,A]=o.useState({amount:"",method:"cash",notes:"",smac:!1}),[Is,He]=o.useState([]),[K,Ve]=o.useState(0),[Na,We]=o.useState(!1),[U,Ue]=o.useState(0),[v,_e]=o.useState(0),_=o.useCallback(async()=>{xs(!0);try{let t=await Vt(hs)||[];try{const r=await(await Wt(async()=>{const{getActiveSessions:a}=await import("./index-DlwzvMJs.js").then(n=>n.bx);return{getActiveSessions:a}},__vite__mapDeps([0,1]))).getActiveSessions();if(r&&r.length>0){const a=r.filter(n=>!(t||[]).some(i=>i.session_id===n.id)).map(n=>({id:-n.id,date:n.opened_at||new Date().toISOString(),total:n.total||0,payment_method:"cash",order_type:"dine_in",pickup_time:null,table_id:n.table_id,notes:"",status:"pending",smac_passed:!1,customer_name:n.customer_name||"",customer_phone:n.customer_phone||"",created_at:n.opened_at||new Date().toISOString(),session_id:n.id,table_name:n.table_name||n.tableName||"",__is_session_placeholder:!0,session_status:n.status||"open"}));t=[...t,...a]}}catch(r){console.error("Error loading active sessions for orders list:",r)}Vs(t)}catch(s){console.error("Error loading orders:",s),p("Errore nel caricamento ordini","error")}finally{xs(!1)}},[hs]);o.useEffect(()=>{_();const s=()=>_();return window.addEventListener("orders-updated",s),window.addEventListener("table-sessions-updated",s),()=>{window.removeEventListener("orders-updated",s),window.removeEventListener("table-sessions-updated",s)}},[_]),o.useEffect(()=>{let s=!0;const t=["pending","preparing","ready","delivered"];async function r(){for(const a of t){const n=pe[a];if(!(!n||n.size===0))for(const i of Array.from(n)){const u=String(i);if(ps[u]||P[u]&&P[u].length>0)continue;const l=M.find(d=>d.id===i);if(l)try{he(m=>({...m,[u]:!0}));let d=await B(l.id);if((d||[]).length===0&&l.session_id)try{const m=await le(l.session_id);d=(await Promise.all((m||[]).map(y=>B(y.id)))).flat(),console.debug("Orders: aggregated items for persisted expanded session",l.session_id,"count",d.length)}catch(m){console.error("Error aggregating session child items on mount:",m)}if(!s)return;xe(m=>({...m,[u]:d||[]}))}catch(d){console.error("Error loading expanded order items on mount:",d),xe(m=>({...m,[u]:[]}))}finally{if(!s)return;he(d=>({...d,[u]:!1}))}}}}return M&&M.length>0&&r(),()=>{s=!1}},[M,pe]),o.useEffect(()=>{if(!Ze||!Oe)return;let s=null;try{s=Oe.channel("orders-realtime").on("postgres_changes",{event:"*",schema:"public",table:"orders"},t=>{window.dispatchEvent(new CustomEvent("orders-updated"))}),Promise.resolve(s.subscribe()).then(()=>me(!0)).catch(()=>me(!1))}catch(t){console.error("Realtime subscribe error:",t),me(!1)}return()=>{try{s&&s.unsubscribe&&s.unsubscribe()}catch{}me(!1)}},[]);async function k(){Ss(!0);try{const s=await ta(fe,Ne);nt(s),O([]);try{if(Ze&&Oe){const{data:t}=await Oe.from("table_sessions").select("*").gte("created_at",`${fe}T00:00:00`).lte("created_at",`${Ne}T23:59:59`);ze(t||[])}else{const t=localStorage.getItem("kebab_table_sessions")||"[]",r=JSON.parse(t).filter(a=>{const n=a.created_at||a.date||"";return n&&n.slice(0,10)>=fe&&n.slice(0,10)<=Ne});ze(r||[])}}catch(t){console.error("Error loading history sessions:",t),ze([])}}catch(s){console.error("Error loading history:",s),p("Errore nel caricamento storico","error")}finally{Ss(!1)}}async function vt(){if(!gs||!cs())return;const s=parseFloat(js.replace(",","."))||0;try{await la(gs,s),p("Totale conto aggiornato","success"),ue(!1),_(),E==="history"&&k()}catch(t){console.error("Error saving session total:",t),p("Errore nel salvataggio totale conto","error")}}async function Ce(s){if(s&&s.__is_session_placeholder&&s.session_id){Xe(s.session_id);return}$e(s),fs(s.status),vs(s.notes||"");try{const t=await B(s.id);be(t)}catch(t){console.error("Error loading order items:",t),be([])}ge(!0)}async function yt(){if(h)try{await Rs(h.id,{status:bs,notes:Ns||void 0}),window.dispatchEvent(new CustomEvent("orders-updated")),p("Comanda modificata con successo","success"),ge(!1),_()}catch(s){console.error("Error updating order:",s),p("Errore nella modifica","error")}}async function Ts(s,t){if(!(t<1))try{await oa(s,{quantity:t}),be(r=>r.map(a=>a.id===s?{...a,quantity:t}:a)),h&&await Gs(h.id),window.dispatchEvent(new CustomEvent("orders-updated"))}catch(r){console.error("Error updating item quantity:",r),p("Errore nell'aggiornamento","error")}}async function wt(s){if(confirm("Sei sicuro di voler rimuovere questo prodotto dalla comanda?"))try{await da(s),be(t=>t.filter(r=>r.id!==s)),h&&await Gs(h.id),window.dispatchEvent(new CustomEvent("orders-updated")),p("Prodotto rimosso","success")}catch(t){console.error("Error deleting item:",t),p("Errore nella rimozione","error")}}async function kt(){if(h)try{await Rs(h.id,{order_type:c.order_type,table_id:c.order_type==="dine_in"?c.table_id:void 0,payment_method:c.payment_method,customer_name:c.customer_name||void 0,customer_phone:c.customer_phone||void 0,notes:c.notes||void 0,smac_passed:c.smac_passed,status:c.status,total:c.total}),p("Ordine modificato con successo","success"),V(!1),_(),E==="history"&&k()}catch(s){console.error("Error updating order:",s),p("Errore nella modifica","error")}}async function Ps(){if(h?.session_id)try{const s=await Te(h.session_id),t=await le(h.session_id),r=s&&typeof s.total=="number"?s.total:t.reduce((d,m)=>d+m.total,0);if(s&&(s.total||0)===0){if(window.confirm("Vuoi chiudere questo conto a â‚¬0.00?"))try{await ss(s.id,"cash",!1,!1),p("Conto chiuso con successo","success"),_(),E==="history"&&k()}catch(m){console.error("Error closing zero-total session from Orders:",m),p("Errore nella chiusura del conto","error")}return}W({id:h.session_id,total:r});const n=(await ts()).cover_charge||0,i=s?.covers||0;Ve(i),Ue(n);const u=t.reduce((d,m)=>d+m.total,0)+n*i,l=Math.abs((s?.total||0)-u)<.01||(s?.total||0)>=u-.01;We(l&&n>0&&i>0),Je(l&&n>0&&i>0)}catch(s){console.error("Error loading session orders:",s),p("Errore nel caricamento del conto","error")}}function Je(s){ut(s),Es(!1),se({method:"cash",smac:!1}),te({customerGives:""}),V(!1),ve(!0)}async function St(){if(b)try{await ss(b.id,S.method,S.smac,pt),h&&await qs(h.id,"delivered",ee?.name),p("Conto chiuso con successo","success"),ve(!1),W(null),_(),E==="history"&&k()}catch(s){console.error("Error closing session:",s),p("Errore nella chiusura del conto","error")}}async function _t(){if(h?.session_id)try{const s=await le(h.session_id),t=s.reduce((l,d)=>l+d.total,0),[r,a,n]=await Promise.all([as(h.session_id),ns(h.session_id),rs(h.session_id)]),i=[];for(const l of s)(await B(l.id)).forEach(m=>{i.push({...m,order_number:l.order_number||1})});Os(i),Ke(r),Qe(a);const u=i.map(l=>({...l,remainingQty:l.quantity-(n[l.id]||0)})).filter(l=>l.remainingQty>0);Be(u);try{const l=await Te(h.session_id),d=await ts(),m=l?.covers||0,f=d.cover_charge||0,z=s.reduce((qt,Rt)=>qt+Rt.total,0)+f*m,re=Math.abs((l?.total||0)-z)<.01||(l?.total||0)>=z-.01;Ve(m),Ue(f),We(re&&f>0&&m>0);const Lt=re&&(l?.total||0)>0?l?.total||t:t+f*m;W({id:h.session_id,total:Lt})}catch(l){console.error("Error loading session info for split modal:",l)}A({amount:"",method:"cash",notes:"",smac:!1}),ke("manual"),Se({}),_e(0),te({customerGives:""}),He([]),H(!1),ye(!0)}catch(s){console.error("Error loading split data:",s),p("Errore nel caricamento dati","error")}}async function Ct(){if(h?.session_id)try{const[s,t,r]=await Promise.all([as(h.session_id),ns(h.session_id),rs(h.session_id)]),a=await le(h.session_id),n=a.reduce((l,d)=>l+d.total,0);try{const l=await Te(h.session_id),d=await ts(),m=l?.covers||0,f=d.cover_charge||0,y=n+f*m,z=Math.abs((l?.total||0)-y)<.01||(l?.total||0)>=y-.01;Ve(m),Ue(f),We(z&&f>0&&m>0)}catch(l){console.error("Error loading session info for bill status modal:",l)}const i=[];for(const l of a)(await B(l.id)).forEach(m=>{i.push({...m,order_number:l.order_number||1})});Os(i),Ke(s),Qe(t),W({id:h.session_id,total:n});const u=i.map(l=>({...l,remainingQty:l.quantity-(r[l.id]||0)})).filter(l=>l.remainingQty>0);Be(u),H(!1),Re(!0)}catch(s){console.error("Error loading bill status:",s),p("Errore nel caricamento stato conto","error")}}function $s(){return Object.entries(ae).reduce((s,[t,r])=>{const a=$.find(n=>n.id===Number(t));return a&&r>0?s+a.price*r:s},0)}function Et(s){const t=$.find(r=>r.id===s);t&&Se(r=>{const a=r[s]||0;return a<t.remainingQty?{...r,[s]:a+1}:r})}function Ot(s){Se(t=>{const r=t[s]||0;if(r>0){const a=r-1;if(a===0){const{[s]:n,...i}=t;return i}return{...t,[s]:a}}return t})}function It(){const s=$s(),t=(v||0)*(U||0),r=s+t;if(r>0&&r<=D){const a=Object.entries(ae).map(([u,l])=>{const d=$.find(m=>m.id===Number(u));return d?`${l}x ${d.menu_item_name}`:""}).filter(Boolean);v&&v>0&&a.push(`${v}x Coperto`);const n=a.join(", "),i=Object.entries(ae).map(([u,l])=>{const d=$.find(m=>m.id===Number(u));return d?{order_item_id:d.id,quantity:l,menu_item_name:d.menu_item_name,price:d.price}:null}).filter(u=>u!==null);v&&v>0&&i.push({order_item_id:void 0,quantity:v,menu_item_name:"Coperto",price:U}),He(i),A(u=>({...u,amount:Math.min(r,D).toFixed(2),notes:n.length>40?n.substring(0,40)+"...":n})),ke("manual"),Se({}),_e(0)}}function Tt(){const s=parseFloat(T.customerGives)||0,t=parseFloat(w.amount)||0;return Math.max(0,s-t)}async function Pt(){if(!b){p("Sessione non trovata","error");return}const s=parseFloat(w.amount);if(isNaN(s)||s<=0){p("Inserisci un importo valido","warning");return}if(s>D+.01){p("Importo superiore al rimanente","warning");return}try{await ma(b.id,s,w.method,w.notes||void 0,w.smac,Is.length>0?Is:void 0);const[t,r,a]=await Promise.all([as(b.id),ns(b.id),rs(b.id)]);Ke(t),Qe(r);const n=Nt.map(i=>({...i,remainingQty:i.quantity-(a[i.id]||0)})).filter(i=>i.remainingQty>0);if(Be(n),A({amount:"",method:"cash",notes:"",smac:!1}),He([]),p("Pagamento aggiunto","success"),r<=.01)try{await ss(b.id,"split",!1),p("Conto saldato e chiuso","success"),ye(!1),_(),E==="history"&&k()}catch(i){console.error("Error closing session:",i),p("Pagamento aggiunto, ma errore nella chiusura automatica","warning")}}catch(t){console.error("Error adding payment:",t),p("Errore nell'aggiunta pagamento","error")}}async function As(s){try{const t=await ca(s);t&&(ft(t),Ge(!0))}catch(t){console.error("Error generating receipt:",t),p("Errore nella generazione scontrino","error")}}function $t(){if(!j)return;const s=`
      <html>
        <head>
          <title>Scontrino</title>
          <style>
            body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .shop-name { font-size: 18px; font-weight: bold; }
            .divider { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-weight: bold; font-size: 16px; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="shop-name">${j.shop_info.name}</div>
            ${j.shop_info.address?`<div>${j.shop_info.address}</div>`:""}
            ${j.shop_info.phone?`<div>Tel: ${j.shop_info.phone}</div>`:""}
          </div>
          <div class="divider"></div>
          <div>Data: ${j.date} ${j.time}</div>
          <div class="divider"></div>
          ${j.items.map(r=>`
            <div class="item">
              <span>${r.quantity}x ${r.name}</span>
              <span>â‚¬${r.total.toFixed(2)}</span>
            </div>
          `).join("")}
          <div class="divider"></div>
          <div class="item total">
            <span>TOTALE</span>
            <span>â‚¬${j.total.toFixed(2)}</span>
          </div>
          <div>Pagamento: ${j.payment_method==="cash"?"Contanti":j.payment_method==="card"?"Carta":"Online"}</div>
          ${q&&j.smac_passed?"<div>SMAC: SÃ¬</div>":""}
          <div class="divider"></div>
          <div class="footer">Grazie e arrivederci!</div>
        </body>
      </html>
    `,t=window.open("","_blank");t&&(t.document.write(s),t.document.close(),t.print())}function Ee(s){O(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])}function J(s){$e(s),H(!0)}function Ye(s){if(s&&s.__is_session_placeholder&&s.session_id){Xe(s.session_id);return}$e(s),I({order_type:s.order_type,table_id:s.table_id??void 0,payment_method:s.payment_method??"cash",customer_name:s.customer_name??"",customer_phone:s.customer_phone??"",notes:s.notes??"",smac_passed:s.smac_passed??!1,status:s.status,total:s.total??0,originalTotal:s.total??0}),V(!0)}async function Xe(s){st(s);try{const t=await Te(s);Me(String(t?.total??0))}catch(t){console.error("Error loading session for edit:",t),Me("0")}ue(!0)}async function Y(s,t){if(confirm("Sei sicuro di eliminare questa comanda?"))try{await ia(s,ee?.name),p("Comanda eliminata","success"),_(),E==="history"&&k()}catch(r){console.error("Error deleting order:",r),p("Errore nell'eliminazione","error")}}async function Ms(s){if(confirm("Sei sicuro di eliminare questo conto (sessione)?"))try{await ra(s),p("Conto eliminato","success"),_(),E==="history"&&k()}catch(t){console.error("Error deleting session:",t),p("Errore nell'eliminazione conto","error")}}function At(){ms("/orders/new")}function Mt(){ms("/tables")}async function Dt(s){const r=C[s.status]?.next;if(r)try{await qs(s.id,r,ee?.name),p("Stato aggiornato","success"),_()}catch(a){console.error("Error updating status:",a),p("Errore nell'aggiornamento stato","error")}}function Ds(){const s=ne.map(r=>r.id),t=s.every(r=>N.includes(r));O(t?r=>r.filter(a=>!s.includes(a)):r=>[...new Set([...r,...s])])}async function zt(){if(cs()){if(N.length===0){p("Seleziona almeno un ordine","warning");return}if(R==="delete"){if(!confirm(`Sei sicuro di voler eliminare ${N.length} ordini?`))return;try{await aa(N,ee?.name),p(`${N.length} ordini eliminati`,"success"),O([]),k()}catch(s){console.error("Error deleting orders:",s),p("Errore nell'eliminazione","error")}}else if(R)try{await na(N,R,ee?.name),p(`${N.length} ordini aggiornati a "${g(C[R]?.labelKey)||R}"`,"success"),O([]),k()}catch(s){console.error("Error updating orders:",s),p("Errore nell'aggiornamento","error")}_s("")}}const ne=ks.filter(s=>{if(qe!=="all"&&s.status!==qe)return!1;if(Pe){const t=Pe.toLowerCase();return s.id.toString().includes(t)||s.customer_name?.toLowerCase().includes(t)||s.table_name?.toLowerCase().includes(t)}return!0}),Q=(()=>{const s={},t=[];ne.forEach(a=>{a.session_id?(s[a.session_id]||(s[a.session_id]=[]),s[a.session_id].push(a)):t.push(a)});const r=[];return Object.entries(s).forEach(([a,n])=>{const i=n[0],u=n.reduce((l,d)=>l+d.total,0);r.push({type:"session",sessionId:Number(a),orders:n.sort((l,d)=>(l.order_number||0)-(d.order_number||0)),total:u,tableName:i.table_name,customerName:i.customer_name,date:i.date,createdAt:i.created_at,sessionStatus:i.session_status})}),t.forEach(a=>{r.push({type:"single",orders:[a],total:a.total,tableName:a.table_name,customerName:a.customer_name,date:a.date,createdAt:a.created_at})}),De&&De.length>0&&De.forEach(a=>{const n=a.id||a.session_id;s[n]||r.push({type:"session",sessionId:Number(n),orders:[],total:a.total||0,tableName:a.table_name||a.tableName,customerName:a.customer_name||a.customerName,date:a.created_at||a.date||new Date().toISOString(),createdAt:a.created_at||a.date||new Date().toISOString(),sessionStatus:a.status||"open"})}),r.sort((a,n)=>new Date(n.createdAt).getTime()-new Date(a.createdAt).getTime())})();function zs(s){lt(t=>{const r=new Set(t);return r.has(s)?r.delete(s):r.add(s),r})}const Ft={pending:M.filter(s=>s.status==="pending"),preparing:M.filter(s=>s.status==="preparing"),ready:M.filter(s=>s.status==="ready"),delivered:M.filter(s=>s.status==="delivered")};return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white whitespace-nowrap",children:g("orders.title")}),e.jsxs("div",{className:"flex gap-1 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>ws("today"),className:`px-2 sm:px-3 py-1.5 rounded-lg font-medium transition-all flex items-center gap-1 text-xs sm:text-sm whitespace-nowrap ${E==="today"?"bg-primary-500/20 text-primary-400":"text-dark-400 hover:text-white hover:bg-dark-800"}`,children:[e.jsx(Hs,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:g("common.today")})]}),e.jsxs("button",{onClick:()=>{ws("history"),ks.length===0&&k()},className:`px-2 sm:px-3 py-1.5 rounded-lg font-medium transition-all flex items-center gap-1 text-xs sm:text-sm whitespace-nowrap ${E==="history"?"bg-primary-500/20 text-primary-400":"text-dark-400 hover:text-white hover:bg-dark-800"}`,children:[e.jsx(Ut,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:g("orders.history")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Ze&&e.jsx("div",{className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs ${Ae?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,title:Ae?"Connesso in tempo reale":"Non connesso",children:Ae?e.jsx(Jt,{className:"w-4 h-4"}):e.jsx(Yt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:_,className:"btn-secondary p-2",title:"Aggiorna",children:e.jsx(Xt,{className:"w-4 h-4"})}),e.jsxs(Zt,{to:"/orders/new",className:"btn-primary py-1.5 px-3 text-sm",children:[e.jsx(Fs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:g("orders.newOrder")})]})]})]}),E==="today"&&e.jsx(e.Fragment,{children:Ws&&ys.size===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 sm:gap-4 items-start",children:["pending","preparing","ready","delivered"].map(s=>{const t=C[s],r=Ft[s],a=t.icon;return e.jsxs("div",{className:"card self-start",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"font-semibold text-sm sm:text-base",children:g(t.labelKey)})]}),e.jsx("span",{className:t.color,children:r.length})]}),e.jsx("div",{className:"p-3 sm:p-4 space-y-2",children:r.length===0?e.jsx("p",{className:"text-dark-500 text-center py-4 text-sm",children:g("orders.noActiveOrders")}):r.map(n=>{const i=pe[s]?.has(n.id)||!1,u=async()=>{const d=!(pe[s]?.has(n.id)||!1);Ys(f=>{const y=new Set(f[s]||[]);d?y.add(n.id):y.delete(n.id);const z={...f,[s]:y};try{Xs(z)}catch{}return z});const m=String(n.id);if(d&&!(P[m]&&P[m].length>0))try{he(y=>({...y,[m]:!0})),console.debug("Orders: expanding",n.id,"status",s,"session_id",n.session_id);let f=await B(n.id);if((f||[]).length===0&&n.session_id)try{const y=await le(n.session_id);f=(await Promise.all((y||[]).map(re=>B(re.id)))).flat(),console.debug("Aggregated items from session",n.session_id,"count",f.length)}catch(y){console.error("Error aggregating session child items:",y)}xe(y=>({...y,[m]:f||[]}))}catch(f){console.error("Error loading order items for expand:",f),xe(y=>({...y,[m]:[]}))}finally{he(f=>({...f,[m]:!1}))}};return e.jsxs("div",{className:`bg-dark-900 rounded-xl overflow-hidden ${ys.has(n.id)?"order-transitioning":""}`,children:[e.jsx("div",{onClick:u,className:"px-2 py-1.5 sm:px-3 sm:py-2 cursor-pointer hover:bg-dark-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 sm:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[e.jsxs("span",{className:"text-[10px] sm:text-xs font-mono bg-dark-700 px-1 sm:px-1.5 py-0.5 rounded text-dark-300 flex-shrink-0",children:["#",n.id]}),e.jsx("span",{className:"font-medium text-white text-xs sm:text-sm truncate",children:n.session_id?`${n.table_name}${n.customer_name?` - ${n.customer_name}`:""}${n.order_number?` - C${n.order_number}`:""}`:n.table_name?`${g(Z[n.order_type])} - ${n.table_name}${n.customer_name?` - ${n.customer_name}`:""}`:n.customer_name?`${g(Z[n.order_type])} - ${n.customer_name}`:`${g(Z[n.order_type])}`})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[P[String(n.id)]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-dark-400 hidden xs:inline",children:[P[String(n.id)].length," item"]}),i?e.jsx(is,{className:"w-4 h-4 text-primary-400"}):e.jsx(ls,{className:"w-4 h-4 text-dark-400"})]})]})}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ease-in-out ${i?"max-h-[500px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-2 pb-1.5 space-y-1",children:[ps[String(n.id)]?e.jsx("div",{className:"py-2 text-center text-sm text-dark-400",children:"Caricamentoâ€¦"}):P[String(n.id)]&&P[String(n.id)].length>0?e.jsx("div",{className:"bg-dark-800 rounded p-1.5 mt-1",children:P[String(n.id)].map(l=>e.jsxs("div",{className:"leading-snug mb-1 last:mb-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[e.jsxs("span",{className:"font-bold text-primary-400",children:[l.quantity,"x"]}),e.jsx("span",{className:"text-white truncate",children:l.menu_item_name})]}),l.notes&&e.jsxs("p",{className:"text-[10px] text-amber-400 ml-5 truncate",children:["âš ï¸ ",l.notes]})]},l.id))}):null,n.notes&&e.jsxs("p",{className:"text-[9px] text-dark-400 truncate",children:["ðŸ“ ",n.notes]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.next&&e.jsxs("button",{onClick:l=>{l.stopPropagation(),Dt(n)},className:"btn-success flex-1 text-[10px] py-1 px-2 rounded",children:[e.jsx(Bs,{className:"w-3 h-3"}),e.jsx("span",{children:s==="pending"?"Prepara":s==="preparing"?"Pronto":"Consegna"})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),Ce(n)},className:"btn-secondary p-1 rounded",title:"Modifica",children:e.jsx(X,{className:"w-3 h-3"})})]})]})})]},n.id)})})]},s)})})}),E==="history"&&e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"card p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-end gap-3 sm:gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:contents",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:g("common.from")}),e.jsx("input",{type:"date",value:fe,onChange:s=>Fe(s.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:g("common.to")}),e.jsx("input",{type:"date",value:Ne,onChange:s=>Le(s.target.value),className:"input text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:contents gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:g("common.status")}),e.jsxs("select",{value:qe,onChange:s=>it(s.target.value),className:"select text-sm",children:[e.jsx("option",{value:"all",children:g("common.all")}),e.jsx("option",{value:"pending",children:g("orders.pending")}),e.jsx("option",{value:"preparing",children:g("orders.preparing")}),e.jsx("option",{value:"ready",children:g("orders.ready")}),e.jsx("option",{value:"delivered",children:g("orders.completed")}),e.jsx("option",{value:"cancelled",children:g("orders.cancelled")})]})]}),e.jsxs("div",{className:"flex items-end gap-2 sm:hidden",children:[e.jsxs("button",{onClick:()=>{const s=new Date().toISOString().split("T")[0];Fe(s),Le(s),setTimeout(()=>k(),0)},className:"btn-secondary flex-1",children:[e.jsx(Ks,{className:"w-4 h-4"}),e.jsx("span",{children:"Oggi"})]}),e.jsxs("button",{onClick:k,className:"btn-primary flex-1",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtra"})]})]})]}),e.jsxs("div",{className:"flex-1 min-w-0 sm:min-w-[200px]",children:[e.jsx("label",{className:"label text-xs sm:text-sm",children:g("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(ga,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"ID, cliente, tavolo...",value:Pe,onChange:s=>Us(s.target.value),className:"input pl-10 text-sm"})]})]}),e.jsxs("button",{onClick:()=>{const s=new Date().toISOString().split("T")[0];Fe(s),Le(s),setTimeout(()=>k(),0)},className:"btn-secondary hidden sm:flex",children:[e.jsx(Ks,{className:"w-4 h-4"}),e.jsx("span",{children:"Oggi"})]}),e.jsxs("button",{onClick:k,className:"btn-primary hidden sm:flex",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtra"})]})]})}),N.length>0&&e.jsx("div",{className:"card p-3 sm:p-4 bg-primary-500/10 border border-primary-500/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("p",{className:"text-primary-400 font-medium text-sm sm:text-base",children:[N.length," ordini selezionati"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[e.jsxs("select",{value:R,onChange:s=>_s(s.target.value),className:"select text-sm",children:[e.jsx("option",{value:"",children:"Seleziona azione..."}),e.jsx("option",{value:"pending",children:"Imposta In Attesa"}),e.jsx("option",{value:"preparing",children:"Imposta In Preparazione"}),e.jsx("option",{value:"ready",children:"Imposta Pronto"}),e.jsx("option",{value:"delivered",children:"Imposta Consegnato"}),e.jsx("option",{value:"cancelled",children:"Imposta Annullato"}),e.jsx("option",{value:"delete",children:"ðŸ—‘ï¸ Elimina"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:zt,disabled:!R,className:"btn-primary flex-1 sm:flex-none disabled:opacity-50 text-sm",children:"Applica"}),e.jsx("button",{onClick:()=>O([]),className:"btn-secondary flex-1 sm:flex-none text-sm",children:"Deseleziona"})]})]})]})}),rt?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1 mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-white",children:[Q.length," ordini/conti"]}),e.jsx("button",{onClick:Ds,className:"text-xs text-primary-400",children:ne.every(s=>N.includes(s.id))?"Deseleziona":"Seleziona tutti"})]}),Q.length===0?e.jsx("div",{className:"card p-6 text-center text-dark-400",children:e.jsx("p",{className:"text-sm",children:"Nessun ordine trovato"})}):Q.map(s=>{const t=s.type==="session",r=s.orders[0],a=t&&Cs.has(s.sessionId),n=s.orders.every(i=>N.includes(i.id));return e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:`p-3 ${t?"cursor-pointer":""} ${n?"bg-primary-500/10":""}`,onClick:t?()=>zs(s.sessionId):void 0,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),t?O(n?u=>u.filter(l=>!s.orders.some(d=>d.id===l)):u=>[...new Set([...u,...s.orders.map(l=>l.id)])]):Ee(r.id)},className:"p-0.5 flex-shrink-0 mt-0.5",children:n||N.includes(r.id)?e.jsx(oe,{className:"w-4 h-4 text-primary-400"}):e.jsx(de,{className:"w-4 h-4 text-dark-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t&&(a?e.jsx(is,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}):e.jsx(ls,{className:"w-4 h-4 text-dark-400 flex-shrink-0"})),e.jsx("span",{className:"font-medium text-white text-sm truncate",children:t?`Conto - ${s.tableName}`:`#${r.id}`}),t&&e.jsxs("span",{className:"text-xs text-dark-400",children:["(",s.orders.length," com. #",s.orders.map(i=>i.id).join(", #"),")"]})]}),e.jsx("span",{className:"font-semibold text-primary-400 flex-shrink-0",children:x(s.total)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-dark-400 flex-wrap",children:[e.jsx("span",{children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:g(Z[r.order_type])}),s.tableName&&!t&&e.jsxs("span",{children:["â€¢ ",s.tableName]}),s.customerName&&e.jsxs("span",{className:"text-white",children:["â€¢ ",s.customerName]})]}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded flex-shrink-0 ${C[r.status]?.color||"badge-secondary"}`,children:t?s.sessionStatus==="open"?"Aperto":"Chiuso":g(C[r.status]?.labelKey)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 pt-2 border-t border-dark-700",children:[e.jsxs("button",{onClick:i=>{i.stopPropagation(),J(r)},className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(ie,{className:"w-3.5 h-3.5"}),"Dettagli"]}),e.jsxs("button",{onClick:i=>{i.stopPropagation(),Ye(r)},className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(X,{className:"w-3.5 h-3.5"}),"Modifica"]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),t&&s.sessionId?Ms(s.sessionId):Y(r.id,r.session_id)},className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg",children:e.jsx(L,{className:"w-4 h-4"})})]})]}),t&&a&&e.jsx("div",{className:"bg-dark-900/50 border-t border-dark-700 animate-fadeIn",children:s.orders.map(i=>e.jsxs("div",{className:`px-3 py-2 border-b border-dark-800 last:border-b-0 ${N.includes(i.id)?"bg-primary-500/10":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ee(i.id),className:"p-0.5",children:N.includes(i.id)?e.jsx(oe,{className:"w-3.5 h-3.5 text-primary-400"}):e.jsx(de,{className:"w-3.5 h-3.5 text-dark-500"})}),e.jsx("span",{className:"text-dark-500",children:"â””"}),e.jsxs("span",{className:"font-mono text-dark-300 text-xs",children:["#",i.id]}),e.jsxs("span",{className:"text-xs text-dark-500",children:["Comanda ",i.order_number||1]}),e.jsx("span",{className:"ml-auto text-xs text-dark-300",children:x(i.total)}),e.jsx("span",{className:`${C[i.status]?.color||"badge-secondary"} text-[10px]`,children:g(C[i.status]?.labelKey)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>J(i),className:"btn-ghost btn-sm px-3 py-2 flex-1",title:"Visualizza comanda",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2 text-xs",children:"Dettagli"})]}),e.jsxs("button",{onClick:()=>Ce(i),className:"btn-ghost btn-sm px-3 py-2 flex-1",title:"Modifica comanda",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2 text-xs",children:"Modifica"})]}),e.jsx("button",{onClick:()=>Y(i.id,i.session_id),className:"btn-ghost btn-sm px-3 py-2 text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(L,{className:"w-4 h-4"})})]})]},i.id))})]}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsxs("button",{onClick:()=>{const i=K||1,u=(b?.total??0)/i;A(l=>({...l,amount:u.toFixed(2),notes:`Alla romana (${i} pers.)`}))},className:"px-3 py-1 text-sm bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:["Alla Romana (â‚¬",b?(b.total/(K||1)).toFixed(2):"0.00",")"]})})]},t?`session-${s.sessionId}`:`single-${r.id}`)})]}),e.jsxs("div",{className:"card hidden sm:block",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-white",children:[Q.length," ",Q.length===1?"ordine/conto":"ordini/conti"," (",ne.length," comande)"]}),e.jsx("button",{onClick:Ds,className:"text-sm text-primary-400 hover:text-primary-300",children:ne.every(s=>N.includes(s.id))?"Deseleziona tutti":"Seleziona tutti"})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Tavolo/Cliente"}),e.jsx("th",{children:"Totale"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:Q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-dark-400",children:"Nessun ordine trovato per il periodo selezionato"})}):Q.map(s=>{if(s.type==="single"){const a=s.orders[0];return e.jsxs("tr",{className:N.includes(a.id)?"bg-primary-500/10":"",children:[e.jsx("td",{children:e.jsx("button",{onClick:()=>Ee(a.id),className:"p-1",children:N.includes(a.id)?e.jsx(oe,{className:"w-5 h-5 text-primary-400"}):e.jsx(de,{className:"w-5 h-5 text-dark-400"})})}),e.jsx("td",{children:e.jsxs("span",{className:"font-mono text-white",children:["#",a.id]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:new Date(a.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("p",{className:"text-xs text-dark-400",children:new Date(a.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark-300",children:g(Z[a.order_type])})}),e.jsx("td",{children:e.jsxs("div",{children:[a.table_name&&e.jsx("p",{className:"text-white",children:a.table_name}),a.customer_name&&e.jsx("p",{className:"text-sm text-dark-400",children:a.customer_name})]})}),e.jsx("td",{children:e.jsx("span",{className:"font-semibold text-primary-400",children:x(a.total)})}),e.jsx("td",{children:e.jsx("span",{className:C[a.status]?.color||"badge-secondary",children:g(C[a.status]?.labelKey)||a.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(a),className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Dettagli",children:e.jsx(ie,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("button",{onClick:()=>Ye(a),className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Modifica ordine",children:e.jsx(X,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("button",{onClick:()=>Y(a.id,a.session_id),className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2 text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(L,{className:"w-5 h-5 md:w-6 md:h-6"})})]})})]},`single-${a.id}`)}const t=Cs.has(s.sessionId),r=s.orders.every(a=>N.includes(a.id));return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`cursor-pointer hover:bg-dark-800/70 transition-colors ${r?"bg-primary-500/10":"bg-dark-800/30"}`,onClick:()=>zs(s.sessionId),children:[e.jsx("td",{children:e.jsx("button",{onClick:a=>{a.stopPropagation(),O(r?n=>n.filter(i=>!s.orders.some(u=>u.id===i)):n=>[...new Set([...n,...s.orders.map(i=>i.id)])])},className:"p-1",children:r?e.jsx(oe,{className:"w-5 h-5 text-primary-400"}):e.jsx(de,{className:"w-5 h-5 text-dark-400"})})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:t?e.jsx(is,{className:"w-4 h-4 text-primary-400"}):e.jsx(ls,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Conto"}),e.jsxs("p",{className:"text-xs text-dark-400",children:[s.orders.length," comande (#",s.orders.map(a=>a.id).join(", #"),")"]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("p",{className:"text-xs text-dark-400",children:new Date(s.createdAt).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark-300",children:"Tavolo"})}),e.jsx("td",{children:e.jsxs("div",{children:[s.tableName&&e.jsx("p",{className:"text-white",children:s.tableName}),s.customerName&&e.jsx("p",{className:"text-sm text-dark-400",children:s.customerName}),e.jsx("p",{className:`text-xs ${s.sessionStatus==="open"?"text-primary-400":"text-emerald-400"}`,children:s.sessionStatus==="open"?"Conto Aperto":"Conto Chiuso"})]})}),e.jsx("td",{children:e.jsx("span",{className:"font-semibold text-primary-400",children:x(s.total)})}),e.jsx("td",{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.orders.reduce((a,n)=>(a[n.status]=(a[n.status]||0)+1,a),{})).map(([a,n])=>e.jsxs("span",{className:`${C[a]?.color||"badge-secondary"} text-xs`,children:[n,"x ",g(C[a]?.labelKey)||a]},a))})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),J(s.orders[0])},className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Dettagli conto",children:e.jsx(ie,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),s.sessionId?Xe(s.sessionId):Ye(s.orders[0])},className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2",title:"Modifica conto (sconti totale)",children:e.jsx(X,{className:"w-5 h-5 md:w-6 md:h-6 -scale-y-100"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),s.sessionId&&Ms(s.sessionId)},className:"btn-ghost btn-sm px-2 py-1 md:px-3 md:py-2 text-red-400 hover:text-red-300",title:"Elimina conto",children:e.jsx(L,{className:"w-6 h-6 md:w-7 md:h-7"})})]})})]},`session-${s.sessionId}`),t&&s.orders.map((a,n)=>e.jsxs("tr",{className:`border-l-2 border-primary-500/30 animate-fadeIn ${N.includes(a.id)?"bg-primary-500/10":"bg-dark-900/30"}`,children:[e.jsx("td",{children:e.jsx("button",{onClick:()=>Ee(a.id),className:"p-1 ml-6",children:N.includes(a.id)?e.jsx(oe,{className:"w-4 h-4 text-primary-400"}):e.jsx(de,{className:"w-4 h-4 text-dark-500"})})}),e.jsx("td",{children:e.jsxs("div",{className:"pl-8 flex items-center gap-3",children:[e.jsx("span",{className:"text-dark-600",children:n===s.orders.length-1?"â””":"â”œ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-dark-700 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-mono text-primary-400",children:["#",a.id]})}),e.jsxs("span",{className:"text-sm text-dark-300",children:["Comanda ",a.order_number||1]})]})]})}),e.jsx("td",{children:e.jsx("p",{className:"text-sm text-dark-400",children:new Date(a.created_at).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("span",{className:"font-medium text-dark-300",children:x(a.total)})}),e.jsx("td",{children:e.jsx("span",{className:`${C[a.status]?.color||"badge-secondary"} text-xs`,children:g(C[a.status]?.labelKey)||a.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(a),className:"btn-ghost btn-sm px-3 py-2",title:"Visualizza comanda",children:e.jsx(ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Ce(a),className:"btn-ghost btn-sm px-3 py-2",title:"Modifica comanda",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Y(a.id,a.session_id),className:"btn-ghost btn-sm px-3 py-2 text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(L,{className:"w-5 h-5"})})]})})]},`order-${a.id}`))]})})})]})})]})]})]}),e.jsx(ha,{isOpen:Js,onClose:()=>H(!1),sessionId:h?.session_id??void 0,orderId:h?.id??void 0,onViewOrder:s=>{J(s)},onEditOrder:s=>{H(!1),Ce(s)},onDeleteOrder:(s,t)=>{Y(s),H(!1)},onOpenSplit:()=>{_t()},onOpenBillStatus:()=>{Ct()},onAddOrder:()=>At(),onTransfer:()=>Mt(),onCloseSession:()=>Ps()}),e.jsx(F,{isOpen:Zs,onClose:()=>V(!1),title:`Modifica Ordine #${h?.id}`,size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tipo Ordine"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["dine_in","takeaway","delivery"].map(s=>e.jsx("button",{type:"button",onClick:()=>I({...c,order_type:s}),className:`p-3 rounded-xl border-2 transition-all ${c.order_type===s?"border-primary-500 bg-primary-500/20 text-primary-400":"border-dark-600 hover:border-dark-500 text-dark-300"}`,children:g(Z[s])},s))})]}),c.order_type==="dine_in"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tavolo"}),e.jsxs("select",{value:c.table_id||"",onChange:s=>I({...c,table_id:s.target.value?Number(s.target.value):void 0}),className:"select",children:[e.jsx("option",{value:"",children:"Seleziona tavolo"}),tt.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.capacity," posti)"]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente"}),e.jsx("input",{type:"text",value:c.customer_name,onChange:s=>I({...c,customer_name:s.target.value}),className:"input",placeholder:"Nome cliente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:c.customer_phone,onChange:s=>I({...c,customer_phone:s.target.value}),className:"input",placeholder:"Telefono"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo Pagamento"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["cash","card","online"].map(s=>e.jsx("button",{type:"button",onClick:()=>I({...c,payment_method:s}),className:`p-3 rounded-xl border-2 transition-all ${c.payment_method===s?"border-primary-500 bg-primary-500/20 text-primary-400":"border-dark-600 hover:border-dark-500 text-dark-300"}`,children:s==="cash"?"Contanti":s==="card"?"Carta":"Online"},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stato Ordine"}),e.jsxs("select",{value:c.status,onChange:s=>I({...c,status:s.target.value}),className:"select",children:[e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"}),e.jsx("option",{value:"cancelled",children:"Annullato"})]})]}),q&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac_edit",checked:c.smac_passed,onChange:s=>I({...c,smac_passed:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac_edit",className:"text-white cursor-pointer",children:"SMAC Passata"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("label",{className:"label mb-2",children:"Totale Ordine"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-400",children:"â‚¬"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.total,onChange:s=>I({...c,total:parseFloat(s.target.value)||0}),className:"input pl-8 text-lg font-semibold"})]})}),c.total!==c.originalTotal&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-dark-400",children:["Originale: ",x(c.originalTotal)]}),e.jsx("p",{className:`text-sm font-medium ${c.total<c.originalTotal?"text-emerald-400":"text-amber-400"}`,children:c.total<c.originalTotal?`Sconto: -${x(c.originalTotal-c.total)}`:`+${x(c.total-c.originalTotal)}`})]})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Modifica il totale per applicare sconti o arrotondamenti"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:c.notes,onChange:s=>I({...c,notes:s.target.value}),className:"input min-h-[80px]",placeholder:"Note aggiuntive..."})]}),h?.session_id&&h?.session_status==="open"&&!ot&&e.jsx("div",{className:"bg-primary-500/10 border border-primary-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Conto Aperto"}),e.jsxs("p",{className:"text-sm text-dark-400",children:["Totale: ",x(h.total)]})]}),e.jsxs("button",{onClick:Ps,className:"btn-primary bg-emerald-600 hover:bg-emerald-700 flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Chiudi Conto"]})]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:kt,className:"btn-primary flex-1",children:"Salva Modifiche"}),e.jsx("button",{onClick:()=>V(!1),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:()=>{confirm("Sei sicuro di voler eliminare questa comanda? L'azione non puÃ² essere annullata.")&&(Y(h.id,h?.session_id),V(!1))},className:"btn-danger",title:"Elimina comanda",children:e.jsx(L,{className:"w-5 h-5"})})]})]})}),e.jsx(F,{isOpen:et,onClose:()=>ue(!1),title:"Modifica Totale Conto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Totale Conto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-400",children:"â‚¬"}),e.jsx("input",{type:"text",value:js,onChange:s=>Me(s.target.value),className:"input pl-8 text-lg font-semibold"})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Inserisci il totale da impostare per questo conto."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:vt,className:"btn-primary flex-1",children:"Salva"}),e.jsx("button",{onClick:()=>ue(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(F,{isOpen:at,onClose:()=>ge(!1),title:`Modifica Comanda #${h?.id}`,size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Prodotti nella Comanda"}),e.jsx("div",{className:"bg-dark-900 rounded-xl p-3 space-y-2 max-h-64 overflow-y-auto",children:je.length===0?e.jsx("p",{className:"text-dark-400 text-sm text-center py-2",children:"Nessun prodotto"}):je.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-dark-700 last:border-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"text-dark-400 text-sm ml-2",children:[x(s.price),"/cad"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ts(s.id,s.quantity-1),disabled:s.quantity<=1,className:"p-1.5 rounded-lg bg-dark-700 hover:bg-dark-600 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ja,{className:"w-4 h-4 text-dark-300"})}),e.jsx("span",{className:"text-primary-400 font-bold w-8 text-center",children:s.quantity}),e.jsx("button",{onClick:()=>Ts(s.id,s.quantity+1),className:"p-1.5 rounded-lg bg-dark-700 hover:bg-dark-600",children:e.jsx(Fs,{className:"w-4 h-4 text-dark-300"})}),e.jsx("span",{className:"text-dark-300 w-16 text-right",children:x(s.price*s.quantity)}),e.jsx("button",{onClick:()=>wt(s.id),className:"p-1.5 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400",title:"Rimuovi prodotto",children:e.jsx(L,{className:"w-4 h-4"})})]})]},s.id))}),je.length>0&&e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-dark-700",children:[e.jsx("span",{className:"text-dark-400",children:"Totale Comanda:"}),e.jsx("span",{className:"text-lg font-bold text-primary-400",children:x(je.reduce((s,t)=>s+t.price*t.quantity,0))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stato Comanda"}),e.jsxs("select",{value:bs,onChange:s=>fs(s.target.value),className:"select",children:[e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"}),e.jsx("option",{value:"cancelled",children:"Annullato"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note Cucina"}),e.jsx("textarea",{value:Ns,onChange:s=>vs(s.target.value),className:"input min-h-[60px]",placeholder:"Note per la cucina..."})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-blue-400 text-sm",children:"Modifica le quantitÃ  o rimuovi prodotti usando i pulsanti +/- e il cestino. Per sconti o totali personalizzati, usa Lista Ordini."})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:yt,className:"btn-primary flex-1",children:"Salva Modifiche"}),e.jsx("button",{onClick:()=>ge(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(F,{isOpen:ct,onClose:()=>Es(!1),title:"Coperto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Coperto da applicare"}),e.jsx("p",{className:"text-2xl font-bold text-primary-400",children:x(mt)}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["(",xt," coperti Ã— ",x(ht),")"]})]}),e.jsx("p",{className:"text-center text-dark-300",children:"Vuoi applicare il coperto a questo conto?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>Je(!0),className:"btn-primary py-3",children:"SÃ¬, applica"}),e.jsx("button",{onClick:()=>Je(!1),className:"btn-secondary py-3",children:"No, senza coperto"})]})]})}),e.jsx(F,{isOpen:dt,onClose:()=>{ve(!1),W(null)},title:"Chiudi Conto",size:S.method==="cash"?"2xl":"md",children:b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:S.method==="cash"?"md:grid md:grid-cols-2 md:gap-6":"",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-900 rounded-xl",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Totale da pagare"}),e.jsx("p",{className:"text-3xl font-bold text-primary-400",children:x(b.total)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Pagamento"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>se({...S,method:"cash"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${S.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ce,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>se({...S,method:"card"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${S.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(Ie,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Carta"})]}),e.jsxs("button",{onClick:()=>se({...S,method:"online"}),className:`p-3 lg:p-4 rounded-xl border-2 flex flex-col items-center gap-1 md:gap-2 transition-colors ${S.method==="online"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(os,{className:"w-5 h-5 lg:w-6 lg:h-6"}),e.jsx("span",{className:"text-xs lg:text-sm",children:"Online"})]})]})]}),q&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"smac_payment",checked:S.smac,onChange:s=>se({...S,smac:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"smac_payment",className:"text-white",children:"SMAC passato"})]})]}),S.method==="cash"&&b.total>0&&e.jsxs("div",{className:"mt-4 md:mt-0 p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-emerald-300",children:"Cliente dÃ "}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:T.customerGives,onChange:s=>te({customerGives:s.target.value}),className:"input flex-1",placeholder:"Es. 50.00"}),e.jsx("span",{className:"flex items-center text-dark-400",children:"â‚¬"})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[5,10,20,50,100].map(s=>e.jsx("button",{type:"button",onClick:()=>te({customerGives:s.toString()}),className:"px-3 py-1 text-sm bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg transition-colors",children:x(s)},s))}),T.customerGives&&parseFloat(T.customerGives)>0&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-dark-400",children:"Totale conto:"}),e.jsx("span",{className:"text-white",children:x(b.total)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-dark-400",children:"Cliente dÃ :"}),e.jsx("span",{className:"text-white",children:x(parseFloat(T.customerGives))})]}),e.jsx("div",{className:"border-t border-dark-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO DA DARE:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:x(Math.max(0,parseFloat(T.customerGives)-b.total))})]}),parseFloat(T.customerGives)<b.total&&e.jsxs("p",{className:"text-amber-400 text-sm mt-2",children:["Mancano ",x(b.total-parseFloat(T.customerGives))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{onClick:St,className:"btn-primary flex-1",children:"Conferma Pagamento"}),e.jsx("button",{onClick:()=>{ve(!1),W(null)},className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(F,{isOpen:gt,onClose:()=>ye(!1),title:"Dividi Conto",size:"2xl",children:b&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-dark-900 rounded-xl",children:(()=>{const s=(G||[]).reduce((n,i)=>n+(i.amount||0),0),t=b.total||0,r=Math.max(0,t-s),a=t>0?Math.min(100,s/t*100):0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:x(t)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:x(s)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:x(r)})]})]}),e.jsx("div",{className:"w-full bg-dark-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full transition-all duration-500",style:{width:`${a}%`}})})]})})()}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[G.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:"Pagamenti effettuati"}),e.jsx("div",{className:"space-y-2 max-h-40 lg:max-h-64 overflow-y-auto",children:G.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(ce,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(Ie,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(os,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-white text-sm",children:x(s.amount)}),s.notes&&e.jsxs("span",{className:"text-dark-400 text-xs",children:["- ",s.notes]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[q&&s.smac_passed&&e.jsx("span",{className:"text-[10px] bg-primary-500/20 text-primary-400 px-1.5 py-0.5 rounded-full",children:"SMAC"}),e.jsx("button",{onClick:()=>As(s),className:"p-1 hover:bg-dark-700 rounded transition-colors",title:"Stampa scontrino",children:e.jsx(ds,{className:"w-3.5 h-3.5 text-dark-400"})})]})]},s.id))})]}),G.length===0&&e.jsx("div",{className:"p-4 bg-dark-900 rounded-xl text-center text-dark-500 text-sm",children:"Nessun pagamento ancora effettuato"})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[D>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>ke("manual"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${we==="manual"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(ce,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Manuale"})]}),e.jsxs("button",{onClick:()=>ke("items"),className:`flex-1 p-2 lg:p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${we==="items"?"border-primary-500 bg-primary-500/10":"border-dark-700 hover:border-dark-600"}`,children:[e.jsx(pa,{className:"w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium",children:"Per Prodotto"})]})]}),we==="items"&&e.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-500/5 rounded-xl space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Seleziona quanti pezzi di ogni prodotto pagare."}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:$.length===0?e.jsx("p",{className:"text-center text-dark-500 py-4",children:"Tutti i prodotti sono stati pagati"}):$.map(s=>{const t=ae[s.id]||0;return e.jsx("div",{className:`p-3 rounded-lg border-2 ${t>0?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:[x(s.price)," â€¢ ",s.remainingQty," rimasti"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>Ot(s.id),disabled:t===0,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"-"}),e.jsx("span",{className:"w-8 text-center font-bold",children:t}),e.jsx("button",{onClick:()=>Et(s.id),disabled:t>=s.remainingQty,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"+"})]})]})},s.id)})}),e.jsxs("div",{className:"space-y-3",children:[K>0&&U>0&&e.jsxs("div",{className:`p-3 rounded-lg border-2 ${v>0?"border-blue-500 bg-blue-500/10":"border-dark-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium",children:"Coperto"}),e.jsxs("p",{className:"text-xs text-dark-400",children:[x(U)," â€¢ ",K," pers."]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-dark-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>_e(Math.max(0,v-1)),disabled:v===0,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"-"}),e.jsx("span",{className:"w-8 text-center font-bold",children:v}),e.jsx("button",{onClick:()=>_e(Math.min(K,v+1)),disabled:v>=K,className:"w-8 h-8 rounded bg-dark-700 disabled:opacity-30",children:"+"})]})]}),v>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-dark-600 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-dark-400",children:[v,"/",K," selezionati"]}),e.jsx("span",{className:"text-sm font-semibold text-blue-400",children:x(U*v)})]})]},"coperto"),e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg flex justify-between",children:[e.jsx("span",{children:"Totale:"}),e.jsx("span",{className:"text-blue-400 font-bold",children:x($s()+(v>0?v*U:0))})]})]}),e.jsx("button",{onClick:It,disabled:Object.keys(ae).length===0&&v===0,className:"btn-primary w-full bg-blue-600 hover:bg-blue-700",children:"Applica Selezione"})]}),we==="manual"&&e.jsxs("div",{className:"space-y-4 p-4 border border-dark-700 rounded-xl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Importo"}),e.jsx("input",{type:"number",step:"0.01",value:w.amount,onChange:s=>A({...w,amount:s.target.value}),className:"input",placeholder:`Max â‚¬${D.toFixed(2)}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{type:"text",value:w.notes,onChange:s=>A({...w,notes:s.target.value}),className:"input",placeholder:"Es. Marco"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>A({...w,method:"cash"}),className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${w.method==="cash"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(ce,{className:"w-4 h-4"})," Contanti"]}),e.jsxs("button",{onClick:()=>A({...w,method:"card"}),className:`flex-1 p-2 rounded-lg border flex items-center justify-center gap-2 ${w.method==="card"?"border-primary-500 bg-primary-500/10":"border-dark-700"}`,children:[e.jsx(Ie,{className:"w-4 h-4"})," Carta"]})]}),q&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary-500/5 border border-primary-500/20 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"orders_split_smac",checked:w.smac,onChange:s=>A({...w,smac:s.target.checked}),className:"w-5 h-5"}),e.jsx("label",{htmlFor:"orders_split_smac",className:"text-white",children:"SMAC passato"})]}),w.method==="cash"&&w.amount&&e.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"font-medium text-emerald-400",children:"Calcolatore Resto"})]}),e.jsx("input",{type:"number",value:T.customerGives,onChange:s=>te({customerGives:s.target.value}),className:"input",placeholder:"Cliente dÃ  â‚¬..."}),T.customerGives&&e.jsxs("div",{className:"p-3 bg-dark-900 rounded-lg flex justify-between",children:[e.jsx("span",{className:"text-emerald-400 font-semibold",children:"RESTO:"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:x(Tt())})]})]}),e.jsx("button",{onClick:Pt,className:"btn-primary w-full",children:"Aggiungi Pagamento"})]})]}),D===0&&e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(es,{className:"w-10 h-10 mx-auto mb-2 text-emerald-400"}),e.jsx("h4",{className:"text-lg font-bold text-emerald-400 mb-1",children:"Conto Saldato!"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Il conto Ã¨ stato completamente pagato."})]})]})]}),e.jsx("button",{onClick:()=>ye(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(F,{isOpen:jt,onClose:()=>Re(!1),title:"Stato del Conto",size:"2xl",children:b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Totale"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-white",children:x(b.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Pagato"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-emerald-400",children:x(b.total-D)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-dark-400",children:"Rimanente"}),e.jsx("p",{className:"text-base lg:text-lg font-bold text-primary-400",children:x(D)})]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsx("div",{children:G.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:["Pagamenti (",G.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 lg:max-h-72 overflow-y-auto",children:G.map((s,t)=>e.jsxs("div",{className:"p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_method==="cash"&&e.jsx(ce,{className:"w-4 h-4 text-emerald-400"}),s.payment_method==="card"&&e.jsx(Ie,{className:"w-4 h-4 text-blue-400"}),s.payment_method==="online"&&e.jsx(os,{className:"w-4 h-4 text-purple-400"}),e.jsxs("span",{className:"font-medium text-white text-sm",children:["#",t+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-primary-400",children:x(s.amount)}),q&&s.smac_passed&&e.jsx("span",{className:"text-[10px] bg-primary-500/20 text-primary-400 px-1.5 py-0.5 rounded-full",children:"SMAC"})]})]}),e.jsxs("div",{className:"text-xs text-dark-400",children:[new Date(s.paid_at).toLocaleString("it-IT"),s.notes&&` â€¢ ${s.notes}`]}),s.paid_items&&s.paid_items.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-700 space-y-0.5",children:s.paid_items.map((r,a)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-dark-300",children:[r.quantity,"x ",r.menu_item_name]}),e.jsx("span",{className:"text-dark-400",children:x(r.price*r.quantity)})]},a))}),e.jsxs("button",{onClick:()=>As(s),className:"mt-2 w-full btn-secondary text-xs py-1.5 flex items-center justify-center gap-1",children:[e.jsx(ds,{className:"w-3.5 h-3.5"}),"Stampa"]})]},s.id))})]}):e.jsxs("div",{className:"p-4 bg-dark-900 rounded-xl text-center",children:[e.jsx(ba,{className:"w-10 h-10 mx-auto mb-2 text-dark-600"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Nessun pagamento effettuato"})]})}),e.jsx("div",{className:"mt-4 md:mt-0",children:$.length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-dark-400 mb-2",children:["Da pagare (",$.length,")"]}),e.jsx("div",{className:"space-y-1.5 max-h-48 lg:max-h-72 overflow-y-auto",children:$.map(s=>e.jsxs("div",{className:"flex justify-between p-2 bg-dark-900 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-white",children:[s.remainingQty,"x ",s.menu_item_name]}),e.jsx("span",{className:"text-primary-400 font-medium",children:x(s.price*s.remainingQty)})]},s.id))})]}):e.jsxs("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl text-center",children:[e.jsx(es,{className:"w-10 h-10 mx-auto mb-2 text-emerald-400"}),e.jsx("p",{className:"text-emerald-400 font-medium",children:"Tutto pagato!"})]})})]}),e.jsx("button",{onClick:()=>Re(!1),className:"btn-secondary w-full",children:"Chiudi"})]})}),e.jsx(F,{isOpen:bt,onClose:()=>Ge(!1),title:"Scontrino",size:"sm",children:j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:j.shop_info.name}),j.shop_info.address&&e.jsx("p",{className:"text-xs",children:j.shop_info.address}),j.shop_info.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",j.shop_info.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-xs mb-3",children:e.jsxs("p",{children:["Data: ",j.date," ",j.time]})}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:j.items.map((s,t)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsx("span",{children:x(s.total)})]},t))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"TOTALE"}),e.jsx("span",{children:x(j.total)})]}),e.jsxs("div",{className:"text-xs mt-3",children:[e.jsxs("p",{children:["Pagamento: ",j.payment_method==="cash"?"Contanti":j.payment_method==="card"?"Carta":"Online"]}),q&&j.smac_passed&&e.jsx("p",{children:"SMAC: SÃ¬"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"text-center text-xs",children:e.jsx("p",{children:"Grazie e arrivederci!"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:$t,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5"}),"Stampa"]}),e.jsx("button",{onClick:()=>Ge(!1),className:"btn-secondary",children:"Chiudi"})]})]})})]})}export{Ma as Orders};
